(this["webpackJsonppopulation-arcgis"]=this["webpackJsonppopulation-arcgis"]||[]).push([[32],{1108:function(e,t,a){"use strict";function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}a.d(t,"a",(function(){return r}))},1142:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return l})),a.d(t,"c",(function(){return u})),a.d(t,"d",(function(){return i})),a.d(t,"e",(function(){return s}));var r=a(40),n=a(57),o=a(96);function l(e,t){if(!i(e,t)){const a=e.typeKeywords;a?a.push(t):e.typeKeywords=[t]}}function i(e,t){var a;return!(null==(a=e.typeKeywords)||!a.includes(t))}function s(e,t){const a=e.typeKeywords;if(a){const e=a.indexOf(t);e>-1&&a.splice(e,1)}}async function u(e){const t=e.clone().normalize();let a;if(t.length>1)for(const r of t)a?r.width>a.width&&(a=r):a=r;else a=t[0];return async function(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return Object(o.e)(e);const a=n.a.WGS84;return await Object(r.g)(t,a),Object(r.m)(e,a)}(a)}const c={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"}},1145:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var r=a(1108);function n(e){e&&e.writtenProperties&&e.writtenProperties.forEach((({target:e,propName:t,newOrigin:a})=>{Object(r.a)(e)&&a&&e.originOf(t)!==a&&e.updateOrigin(t,a)}))}},1160:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return l}));var r=a(44),n=a(220);function o(e){return{origin:"portal-item",url:Object(r.N)(e.itemUrl),portal:e.portal||n.a.getDefault(),portalItem:e,readResourcePaths:[]}}function l(e){return{origin:"portal-item",messages:[],writtenProperties:[],url:e.itemUrl?Object(r.N)(e.itemUrl):null,portal:e.portal||n.a.getDefault(),portalItem:e}}},1320:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return l}));var r=a(134);async function n(e,t){var a,r,n;let i=await l(e,t);i=i||{},i.layers=(null==(a=i.layers)?void 0:a.filter(o))||[];const s={serviceJSON:i};if((null!=(r=i.currentVersion)?r:0)<10.5)return s;const u=await l(e+"/layers",t);return s.layersJSON={layers:(null==u||null==(n=u.layers)?void 0:n.filter(o))||[],tables:(null==u?void 0:u.tables)||[]},s}function o(e){return!e.type||"Feature Layer"===e.type}async function l(e,t){return(await Object(r.default)(e,{responseType:"json",query:{f:"json",...null==t?void 0:t.customParameters,token:null==t?void 0:t.apiKey}})).data}},1551:function(e,t,a){"use strict";a.r(t),a.d(t,"save",(function(){return L})),a.d(t,"saveAll",(function(){return T})),a.d(t,"saveAs",(function(){return K}));var r=a(17),n=a(16),o=a(22),l=a(2),i=a(23),s=a(1145),u=a(902),c=a(306),d=a(1320),f=a(229),y=a(220),p=a(673),m=a(1160),b=a(1142);const w=o.a.getLogger("esri.layers.FeatureLayer"),v="Feature Service";function O(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function h(e,t){if(t.type!==v)throw new n.a("feature-layer:portal-item-wrong-type",O(e,`should have portal item of type "${v}"`))}async function j(e){if(await e.load(),Object(f.d)(e))throw new n.a("feature-layer:save",O(e,"using an in-memory source cannot be saved to a portal item"))}async function g(e,t,a){"beforeSave"in e&&"function"==typeof e.beforeSave&&await e.beforeSave();const r=e.write({},t);return function(e,t){var a;let r=(null!=(a=e.messages)?a:[]).filter((({type:e})=>"error"===e)).map((({name:e,message:t,details:a})=>new n.a(e,t,a)));if(null!=t&&t.ignoreUnsupported&&(r=r.filter((({name:e})=>"layer:unsupported"!==e&&"symbol:unsupported"!==e&&"symbol-layer:unsupported"!==e&&"property:unsupported"!==e&&"url:unsupported"!==e))),r.length>0)throw new n.a("feature-layer:save","Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}(t,a),r}function S(e){const{layer:t,layerJSON:a}=e;return t.isTable?{layers:[],tables:[a]}:{layers:[a],tables:[]}}function I(e){Object(b.b)(e,b.a.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,a)=>a.indexOf(e)===t)))}async function A(e,t){var a;return/\/\d+\/?$/.test(null!=(a=e.url)?a:"")?S(t[0]):async function(e,t){const{layer:{url:a,customParameters:r,apiKey:n}}=t[0];let o=await e.fetchData("json");o&&null!=o.layers&&null!=o.tables||(o=await async function(e,t,a){var r,n;e||(e={}),(r=e).layers||(r.layers=[]),(n=e).tables||(n.tables=[]);const{url:o,customParameters:s,apiKey:c}=t,{serviceJSON:f,layersJSON:y}=await Object(d.a)(o,{customParameters:s,apiKey:c}),p=E(e.layers,f.layers,a),m=E(e.tables,f.tables,a);e.layers=p.itemResources,e.tables=m.itemResources;const b=[...p.added,...m.added],w=y?[...y.layers,...y.tables]:[];return await async function(e,t,a,r){const n=t.map((({id:e})=>new u.default({url:a,layerId:e,sourceJSON:r.find((({id:t})=>t===e))})));await Object(i.g)(n.map((e=>e.load()))),n.forEach((t=>{const{layerId:a,loaded:r,defaultPopupTemplate:n}=t;r&&!Object(l.k)(n)&&P(t,{id:a,popupInfo:n.toJSON()},e)}))}(e,b,o,w),e}(o,{url:null!=a?a:"",customParameters:r,apiKey:n},t.map((e=>e.layer.layerId))));for(const l of t)P(l.layer,l.layerJSON,o);return o}(e,t)}function E(e,t,a){const n=Object(r.d)(e,t,((e,t)=>e.id===t.id));e=e.filter((e=>!n.removed.some((t=>t.id===e.id))));const o=n.added.map((({id:e})=>({id:e})));return o.forEach((({id:t})=>{e.push({id:t})})),{itemResources:e,added:o.filter((({id:e})=>!a.includes(e)))}}function P(e,t,a){e.isTable?J(a.tables,t):J(a.layers,t)}function J(e,t){if(!e)return;const a=e.findIndex((({id:e})=>e===t.id));-1===a?e.push(t):e[a]=t}function N(e){const{portalItem:t}=e;return Object(f.e)(e)&&!e.dynamicDataSource&&!(null==t||!t.loaded)&&t.type===v}const L=Object(i.f)((async function(e,t){await j(e),function(e){const t=e.portalItem;if(!t)throw w.error("save: requires the portalItem property to be set"),new n.a("feature-layer:portal-item-not-set",O(e,"requires the portalItem property to be set"));if(!t.loaded)throw new n.a("feature-layer:portal-item-not-loaded",O(e,"cannot be saved to a portal item that does not exist or is inaccessible"));h(e,t)}(e);const a=e.portalItem,r=Object(m.b)(a),o=await g(e,r,t),l=await A(a,[{layer:e,layerJSON:o}]);return I(a),await a.update({data:l}),Object(s.a)(r),a}));const T=Object(i.f)((async(e,t)=>{await async function(e){if(null==e||!e.length)throw new n.a("feature-layer-utils-saveall:missing-parameters","'layers' array should contain at least one feature layer");await Promise.all(e.map((e=>e.load())));for(const r of e)if(!N(r))throw new n.a("feature-layer-utils-saveall:invalid-parameters",`'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ${O(r,"does not conform")}`,{layer:r});const t=e.map((e=>e.portalItem.id));if(new Set(t).size>1)throw new n.a("feature-layer-utils-saveall:invalid-parameters","All layers in the 'layers' array should be loaded from the same portal item");const a=e.map((e=>e.layerId));if(new Set(a).size!==a.length)throw new n.a("feature-layer-utils-saveall:invalid-parameters","'layers' array should contain only one instance each of layer or table in a feature service")}(e);const a=e[0].portalItem,r=Object(m.b)(a),o=await Promise.all(e.map((e=>g(e,r,t)))),l=await A(a,e.map(((e,t)=>({layer:e,layerJSON:o[t]}))));return I(a),await a.update({data:l}),await Promise.all(e.slice(1).map((e=>e.portalItem.reload()))),Object(s.a)(r),a.clone()})),K=Object(i.f)((async function(e,t,a){await j(e);const r=function(e,t){var a,r;let n=p.default.from(t);return n.id&&(n=n.clone(),n.id=null),null!=(a=n).type||(a.type=v),null!=(r=n).portal||(r.portal=y.a.getDefault()),h(e,n),n}(e,t),n=Object(m.b)(r),o=S({layer:e,layerJSON:await g(e,n,a)});return await async function(e,t){const{url:a,layerId:r,title:n,fullExtent:o,isTable:i}=e,s=Object(c.e)(a),u=Object(l.l)(s)&&"FeatureServer"===s.serverType;t.url=u?a:`${a}/${r}`,t.title||(t.title=n),t.extent=null,!i&&Object(l.l)(o)&&(t.extent=await Object(b.c)(o)),Object(b.e)(t,b.a.METADATA),Object(b.e)(t,b.a.MULTI_LAYER),Object(b.b)(t,b.a.SINGLE_LAYER),i&&Object(b.b)(t,b.a.TABLE),I(t)}(e,r),await async function(e,t,a){var r;const n=e.portal;await(null==n?void 0:n._signIn()),await(null==n||null==(r=n.user)?void 0:r.addItem({item:e,data:t,folder:null==a?void 0:a.folder}))}(r,o,a),e.portalItem=r,Object(s.a)(n),r}))}}]);
//# sourceMappingURL=32.f4847c88.chunk.js.map