{"version":3,"sources":["../node_modules/@arcgis/core/views/layers/support/popupUtils.js","../node_modules/@arcgis/core/views/layers/ImageryLayerView.js","../node_modules/@arcgis/core/views/3d/layers/ImageryLayerView3D.js"],"names":["async","d","l","popupTemplate","e","s","getRequiredFields","fieldsIndex","lastEditInfoEnabled","i","objectIdField","n","typeIdField","u","globalIdField","a","relationships","o","includes","r","p","f","t","push","has","forEach","keyField","defaultPopupTemplateEnabled","defaultPopupTemplate","m","c","constructor","super","arguments","this","view","layer","popupEnabled","timeExtent","geometry","outFields","outSpatialReference","spatialReference","y","resolution","w","type","returnTopmostRaster","showNoDataRecords","h","layerOptions","returnDomainValues","pixelSize","signal","queryVisibleRasters","then","canResume","isEmpty","prototype","redrawDebounced","redraw","_redrawImage","initialize","handles","add","basemapTerrain","ready","_initializeMaximumDataResolution","once","initial","on","updatingHandles","addPromise","exportImageServiceParameters","version","refreshDebounced","renderer","maximumDataResolution","loaded","serviceRasterInfo","getFetchOptions","imageOrCanvasElement","image","document","createElement","pixelData","HTMLCanvasElement","Error","getContext","applyRenderer","applyFilter","pixelBlock","width","height","createImageData","data","set","getAsRGBA","putImageData"],"mappings":"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","file":"static/js/120.fe3d9cd8.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{isNone as e,isSome as l}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as t}from\"../../../layers/support/fieldUtils.js\";async function d(l,d=l.popupTemplate){if(e(d))return[];const s=await d.getRequiredFields(l.fieldsIndex),{lastEditInfoEnabled:i}=d,{objectIdField:n,typeIdField:u,globalIdField:a,relationships:o}=l;if(s.includes(\"*\"))return[\"*\"];const r=i?await p(l):[],f=t(l.fieldsIndex,[...s,...r]);return u&&f.push(u),f&&n&&l.fieldsIndex.has(n)&&!f.includes(n)&&f.push(n),f&&a&&l.fieldsIndex.has(a)&&!f.includes(a)&&f.push(a),o&&o.forEach((e=>{const{keyField:p}=e;f&&p&&l.fieldsIndex.has(p)&&!f.includes(p)&&f.push(p)})),f}function s(e,p){return e.popupTemplate?e.popupTemplate:l(p)&&p.defaultPopupTemplateEnabled&&l(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}export{s as getFetchPopupTemplate,d as getRequiredFields};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isNone as t,isSome as o}from\"../../core/maybe.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as p}from\"../../core/accessorSupport/decorators/subclass.js\";import i from\"../../geometry/Point.js\";import{combinedViewLayerTimeExtentProperty as a}from\"../../layers/support/commonProperties.js\";import n from\"../../rest/support/Query.js\";import{getFetchPopupTemplate as u}from\"./support/popupUtils.js\";const m=m=>{let c=class extends m{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,s){const{layer:p}=this;if(!e)throw new r(\"imagerylayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:p});const{popupEnabled:a}=p,m=u(p,s);if(!a||t(m))throw new r(\"imagerylayerview:fetchPopupFeatures\",\"Missing required popupTemplate or popupEnabled\",{popupEnabled:a,popupTemplate:m});const c=await m.getRequiredFields(),l=new n;l.timeExtent=this.timeExtent,l.geometry=e,l.outFields=c,l.outSpatialReference=e.spatialReference;const y=this.view.resolution,w=\"2d\"===this.view.type?new i(y,y,this.view.spatialReference):new i(.5*y,.5*y,this.view.spatialReference),{returnTopmostRaster:d,showNoDataRecords:h}=m.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},f={returnDomainValues:!0,returnTopmostRaster:d,pixelSize:w,showNoDataRecords:h,signal:o(s)?s.signal:null};return p.queryVisibleRasters(l,f).then((e=>e))}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return e([s()],c.prototype,\"layer\",void 0),e([s()],c.prototype,\"suspended\",void 0),e([s(a)],c.prototype,\"timeExtent\",void 0),e([s()],c.prototype,\"view\",void 0),c=e([p(\"esri.views.layers.ImageryLayerView\")],c),c};export{m as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{isNone as a}from\"../../../core/maybe.js\";import{debounce as t}from\"../../../core/promiseUtils.js\";import{when as i}from\"../../../core/reactiveUtils.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/Error.js\";import\"../../../core/has.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"./DynamicLayerView3D.js\";import o from\"../../layers/ImageryLayerView.js\";let n=class extends(o(s)){constructor(){super(...arguments),this.type=\"imagery-3d\",this.redrawDebounced=t((async e=>{this.redraw(((e,a)=>this._redrawImage(e,a)),e)}),2e3)}initialize(){this.handles.add([i((()=>this.view.basemapTerrain.ready),(()=>this._initializeMaximumDataResolution()),{once:!0,initial:!0}),this.layer.on(\"redraw\",(()=>this.updatingHandles.addPromise(this.redrawDebounced())))]),this.updatingHandles.add((()=>this.layer?.exportImageServiceParameters?.version),(()=>{this.updatingHandles.addPromise(this.refreshDebounced())})),this.updatingHandles.add((()=>this.layer?.renderer),(()=>{this.updatingHandles.addPromise(this.refreshDebounced())})),this.updatingHandles.add((()=>this.timeExtent),(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}_initializeMaximumDataResolution(){this.maximumDataResolution=this.layer.loaded?this.layer.serviceRasterInfo.pixelSize:null}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(e,a,t){a.imageOrCanvasElement?e.image=a.imageOrCanvasElement:(e.image=document.createElement(\"canvas\"),e.pixelData=a.pixelData,await this._redrawImage(e,t))}async _redrawImage(e,t){if(!(e.image instanceof HTMLCanvasElement)||a(e.pixelData))throw new Error;const i=e.image,r=i.getContext(\"2d\"),s=await this.layer.applyRenderer(e.pixelData,{signal:t}),o=this.layer.applyFilter(s).pixelBlock;if(a(o))throw new Error;i.width=o.width,i.height=o.height;const n=r.createImageData(o.width,o.height);n.data.set(o.getAsRGBA()),r.putImageData(n,0,0)}};n=e([r(\"esri.views.3d.layers.ImageryLayerView3D\")],n);const d=n;export{d as default};\n"],"sourceRoot":""}