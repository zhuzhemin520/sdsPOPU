(this["webpackJsonppopulation-arcgis"]=this["webpackJsonppopulation-arcgis"]||[]).push([[26],{1108:function(e,t,i){"use strict";function n(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,"a",(function(){return n}))},1114:function(e,t,i){"use strict";i.d(t,"a",(function(){return O}));var n=i(1108),o=i(44),a=i(901),r=i(356),s=i(103),c=i(1);function l(e){return u[function(e){return e instanceof Blob?e.type:function(e){const t=Object(o.p)(e);return p[t]||b}(e.url)}(e)]||d}const u={},b="text/plain",d=u[b],p={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const y in p)u[p[y]]=y;var h=i(199);function O(e){var t;const i=null!=(t=null==e?void 0:e.origins)?t:[void 0];return(t,a)=>{const u=function(e,t,i){var a;if("resource"===(null==e?void 0:e.type))return function(e,t,i){const a=Object(r.b)(t,i);return{type:String,read:(e,t,i)=>{const n=Object(h.g)(e,t,i);return a.type===String?n:"function"==typeof a.type?new a.type({url:n}):void 0},write:{writer(t,r,c,u){if(!u||!u.resources)return"string"==typeof t?void(r[c]=Object(h.h)(t,u)):void(r[c]=t.write({},u));const b=function(e){return null==e?null:"string"==typeof e?e:e.url}(t),d=Object(h.h)(b,{...u,verifyItemRelativeUrls:u&&u.verifyItemRelativeUrls?{writtenUrls:u.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},h.a.NO),p=a.type!==String&&(!Object(n.a)(this)||u&&u.origin&&this.originIdOf(i)>Object(s.e)(u.origin)),O={object:this,propertyName:i,value:t,targetUrl:d,dest:r,targetPropertyName:c,context:u,params:e};u&&u.portalItem&&d&&!Object(o.u)(d)?p?function(e){var t;const{context:i,targetUrl:n,params:a,value:r,dest:s,targetPropertyName:c}=e;if(!i.portalItem)return;const u=i.portalItem.resourceFromPath(n),b=g(r,n,i),d=l(b),p=Object(o.p)(u.path),h=null!=(t=null==a?void 0:a.compress)&&t;d===p?(i.resources&&j({...e,resource:u,content:b,compress:h,updates:i.resources.toUpdate}),s[c]=n):v(e)}(O):function({context:e,targetUrl:t,dest:i,targetPropertyName:n}){e.portalItem&&e.resources&&(e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(t),compress:!1}),i[n]=t)}(O):u&&u.portalItem&&(null==d||null!=Object(h.e)(d)||Object(o.v)(d)||p)?v(O):r[c]=d}}}}(e,t,i);switch(null!=(a=null==e?void 0:e.type)?a:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=h.b;return{read:e,write:t}}}}(e,t,a);for(const e of i){const i=Object(c.c)(t,e,a);for(const e in u)i[e]=u[e]}}}function v(e){var t,n,r;const{targetUrl:s,params:c,value:u,context:b,dest:d,targetPropertyName:p}=e;if(!b.portalItem)return;const O=Object(h.f)(s),v=null!=(t=null==O?void 0:O.filename)?t:Object(a.a)(),y=null!=(n=null==c?void 0:c.prefix)?n:null==O?void 0:O.prefix,f=g(u,s,b),m=Object(o.B)(y,v),_=`${m}.${l(f)}`,C=b.portalItem.resourceFromPath(_);Object(o.v)(s)&&b.resources&&b.resources.pendingOperations.push(async function(e){const t=(await Promise.resolve().then(i.bind(null,134))).default,{data:n}=await t(e,{responseType:"blob"});return n}(s).then((e=>{C.path=`${m}.${l(e)}`,d[p]=C.itemRelativeUrl})).catch((()=>{})));const w=null!=(r=null==c?void 0:c.compress)&&r;b.resources&&j({...e,resource:C,content:f,compress:w,updates:b.resources.toAdd}),d[p]=C.itemRelativeUrl}function j({object:e,propertyName:t,updates:i,resource:n,content:o,compress:a}){i.push({resource:n,content:o,compress:a,finish:i=>{!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(e,t,i)}})}function g(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}},1179:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i(0),o=i(226),a=i(2),r=i(446),s=i(1),c=(i(17),i(12),i(10));const l=e=>{let t=class extends(Object(r.b)(e)){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(e){this._userInteractive=e}get updating(){return!1}get visible(){return!Object(a.l)(this.parent)||this.parent.visible&&!this.parent.suspended}set visible(e){this._overrideIfSome("visible",e)}forceInteractiveForViewModel(){return this._interactiveViewModelCount++,Object(o.c)((()=>this._interactiveViewModelCount--))}};return Object(n.a)([Object(s.b)({readOnly:!0})],t.prototype,"type",void 0),Object(n.a)([Object(s.b)({constructOnly:!0})],t.prototype,"analysis",void 0),Object(n.a)([Object(s.b)({constructOnly:!0})],t.prototype,"parent",void 0),Object(n.a)([Object(s.b)({constructOnly:!0})],t.prototype,"view",void 0),Object(n.a)([Object(s.b)({type:Boolean})],t.prototype,"interactive",null),Object(n.a)([Object(s.b)()],t.prototype,"_userInteractive",void 0),Object(n.a)([Object(s.b)({readOnly:!0})],t.prototype,"updating",null),Object(n.a)([Object(s.b)()],t.prototype,"visible",null),Object(n.a)([Object(s.b)()],t.prototype,"_interactiveViewModelCount",void 0),t=Object(n.a)([Object(c.a)("esri.views.3d.analysis.AnalysisView3D")],t),t}},1231:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return a}));var n=i(2);function o(e,t){return a(e)===a(t)}function a(e){if(Object(n.k)(e))return null;const t=null!=e.layer?e.layer.id:"";let i=null;return i=null!=e.objectId?e.objectId:null!=e.layer&&"objectIdField"in e.layer&&null!=e.layer.objectIdField&&null!=e.attributes?e.attributes[e.layer.objectIdField]:e.uid,null==i?null:`o-${t}-${i}`}const r={json:{write:{writer:function(e,t){var i;Object(n.k)(e)||null==(null==(i=e.layer)?void 0:i.objectIdField)||null==e.attributes||(t.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})},target:{"feature.layerId":{type:[Number,String]},"feature.objectId":{type:[Number,String]}}},origins:{"web-scene":{read:function(e){if(null!=e.layerId&&null!=e.objectId)return{uid:null,layer:{id:e.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:e.objectId}}}}}}}},1232:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return r}));var n=i(2),o=i(127);function a(e,t=Object(o.j)(e)){return"on-the-ground"!==t.mode&&!(Object(n.k)(e.geometry)||!e.geometry.hasZ)}function r(e,t){let i=null;const o=e.events.on("grab-changed",(o=>{Object(n.l)(i)&&(i.remove(),i=null),"start"===o.action?(i=e.disableDisplay(),t&&t(o)):t&&t(o)}));return{remove(){Object(n.l)(i)&&i.remove(),o.remove()}}}},1270:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var n=i(0),o=i(13),a=i(1),r=(i(17),i(12),i(10)),s=i(1159);let c=class extends s.a{constructor(e){super(e)}initialize(){this.addHandles(Object(o.f)((()=>this.analysisViewData.visible),(e=>this.visible=e),o.e))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};Object(n.a)([Object(a.b)({constructOnly:!0})],c.prototype,"analysis",void 0),Object(n.a)([Object(a.b)()],c.prototype,"analysisViewData",void 0),c=Object(n.a)([Object(r.a)("esri.views.interactive.AnalysisToolBase")],c)},1271:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return l}));var n=i(157),o=i(2),a=i(23),r=i(13);function s(e,t){e.interactive=!0;const{tool:i,view:s}=e;s.activeTool=i;let c=Object(a.n)(t,(()=>{s.activeTool===i&&(s.activeTool=null)}));return Object(n.b)((async e=>{await Object(r.h)((()=>Object(o.k)(i)||!i.active),e),c=Object(o.s)(c)}),t)}function c(e,t){return Object(r.f)((()=>e.interactive),(()=>function(e,t){e.interactive?function(e,t){l(e);const{view:i,analysis:n}=e,o=new t({view:i,analysis:n,analysisViewData:e});e.tool=o,i.tools.add(o)}(e,t):l(e)}(e,t)),r.e)}function l(e){const{view:t,tool:i}=e;Object(o.k)(i)||(t.tools.remove(i),e.tool=null)}},1300:function(e,t,i){"use strict";i.d(t,"a",(function(){return O}));var n=i(0),o=i(1231),a=i(28),r=i(137),s=i(27),c=i(2),l=i(1),u=(i(17),i(12),i(10)),b=i(1114),d=i(62),p=i(727);let h=class extends(Object(s.b)(Object(r.b)(a.a))){constructor(e){super(e),this.position=null,this.elevationInfo=null,this.feature=null}equals(e){return Object(c.g)(this.position,e.position)&&Object(c.g)(this.elevationInfo,e.elevationInfo)&&Object(o.a)(this.feature,e.feature)}};Object(n.a)([Object(l.b)({type:d.a}),Object(b.a)()],h.prototype,"position",void 0),Object(n.a)([Object(l.b)({type:p.a}),Object(b.a)()],h.prototype,"elevationInfo",void 0),Object(n.a)([Object(l.b)(o.b)],h.prototype,"feature",void 0),h=Object(n.a)([Object(u.a)("esri.analysis.LineOfSightAnalysisObserver")],h);const O=h},1301:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var n=i(0),o=i(1231),a=i(137),r=i(27),s=i(2),c=i(1),l=(i(17),i(12),i(10)),u=i(1114),b=i(62),d=i(727);let p=class extends(Object(r.b)(a.a)){constructor(e){super(e),this.position=null,this.elevationInfo=null,this.feature=null}equals(e){return Object(s.g)(this.position,e.position)&&Object(s.g)(this.elevationInfo,e.elevationInfo)&&Object(o.a)(this.feature,e.feature)}};Object(n.a)([Object(c.b)({type:b.a}),Object(u.a)()],p.prototype,"position",void 0),Object(n.a)([Object(c.b)({type:d.a}),Object(u.a)()],p.prototype,"elevationInfo",void 0),Object(n.a)([Object(c.b)(o.b)],p.prototype,"feature",void 0),p=Object(n.a)([Object(l.a)("esri.analysis.LineOfSightAnalysisTarget")],p);const h=p},1499:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return Ne}));var n=i(0),o=i(28),a=i(59),r=i(108),s=i(2),c=i(1),l=i(17),u=(i(12),i(10)),b=i(9),d=i(1179),p=i(46);let h=class extends o.a{constructor(e){super(e),this.innerWidth=2,this.outerWidth=8,this.visibleInnerColor=new p.a([3,252,111,1]),this.visibleOuterColor=new p.a([3,252,111,.15]),this.occludedInnerColor=new p.a([252,3,69,1]),this.occludedOuterColor=new p.a([252,3,69,.1]),this.undefinedInnerColor=new p.a([255,255,255,1]),this.undefinedOuterColor=new p.a([127,127,127,.2])}};Object(n.a)([Object(c.b)({type:Number})],h.prototype,"innerWidth",void 0),Object(n.a)([Object(c.b)({type:Number})],h.prototype,"outerWidth",void 0),Object(n.a)([Object(c.b)({type:p.a})],h.prototype,"visibleInnerColor",void 0),Object(n.a)([Object(c.b)({type:p.a})],h.prototype,"visibleOuterColor",void 0),Object(n.a)([Object(c.b)({type:p.a})],h.prototype,"occludedInnerColor",void 0),Object(n.a)([Object(c.b)({type:p.a})],h.prototype,"occludedOuterColor",void 0),Object(n.a)([Object(c.b)({type:p.a})],h.prototype,"undefinedInnerColor",void 0),Object(n.a)([Object(c.b)({type:p.a})],h.prototype,"undefinedOuterColor",void 0),h=Object(n.a)([Object(u.a)("esri.views.3d.analysis.LineOfSight.LineOfSightConfiguration")],h);i(167);var O=i(1231),v=i(157),j=i(64),g=i(226),y=i(22),f=i(23),m=i(13),_=i(5),C=i(358),w=i(40),I=i(37),T=i(110),V=i(127);let P=class extends o.a{constructor(e){super(e),this.target=null,this.intersectedGraphic=null,this.intersectedLocation=null,this.elevationAlignedTargetLocation=null,this.visible=void 0}};Object(n.a)([Object(c.b)()],P.prototype,"target",void 0),Object(n.a)([Object(c.b)()],P.prototype,"intersectedGraphic",void 0),Object(n.a)([Object(c.b)()],P.prototype,"intersectedLocation",void 0),Object(n.a)([Object(c.b)()],P.prototype,"elevationAlignedTargetLocation",void 0),Object(n.a)([Object(c.b)({type:Boolean})],P.prototype,"visible",void 0),P=Object(n.a)([Object(u.a)("esri.views.3d.analysis.LineOfSightAnalysisResult")],P);let S=class extends o.a{constructor(e){super(e),this.elevationAlignedTargetLocation=null,this.inputPoints={isValid:!1,observer:Object(b.f)(),observerSurfaceNormal:null,observerFeatureId:null,target:Object(b.f)(),targetSurfaceNormal:null,targetFeatureId:null,observerAdjusted:Object(b.f)(),targetAdjusted:Object(b.f)()},this.computationResult={start:Object(b.f)(),end:Object(b.f)(),intersection:Object(b.f)(),isValid:!1,isTargetVisible:!1},this.result=null}notifyResultChanged(){this.notifyChange("computationResult")}notifyInputPointsChanged(){this.notifyChange("inputPoints")}};Object(n.a)([Object(c.b)()],S.prototype,"target",void 0),Object(n.a)([Object(c.b)()],S.prototype,"elevationAlignedTargetLocation",void 0),Object(n.a)([Object(c.b)()],S.prototype,"inputPoints",void 0),Object(n.a)([Object(c.b)()],S.prototype,"computationResult",void 0),Object(n.a)([Object(c.b)()],S.prototype,"result",void 0),S=Object(n.a)([Object(u.a)("esri.views.3d.analysis.LineOfSight.LineOfSightComputation")],S);var L,R=i(31),k=i(55),E=i(305),A=i(25);let H=L=class extends o.a{constructor(e){super(e)}clone(){return new L({type:this.type,id:Object(A.a)(this.id),mapPoint:Object(A.a)(this.mapPoint),renderPoint:Object(b.d)(this.renderPoint),normal:Object(A.a)(this.normal),ray:Object(A.a)(this.ray),graphic:this.graphic})}equals(e){return this.type===e.type&&this.id===e.id&&Object(s.g)(this.mapPoint,e.mapPoint)&&Object(_.f)(this.renderPoint,e.renderPoint)&&Object(l.e)(this.normal,e.normal)&&Object(T.e)(this.ray,e.ray)&&this.graphic===e.graphic}};Object(n.a)([Object(c.b)()],H.prototype,"type",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],H.prototype,"id",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],H.prototype,"mapPoint",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],H.prototype,"renderPoint",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],H.prototype,"normal",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],H.prototype,"graphic",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],H.prototype,"ray",void 0),H=L=Object(n.a)([Object(u.a)("esri.views.3d.analysis.LineOfSight.LineOfSightIntersectionResult")],H);var M=i(589),D=i(325),z=i(840),x=i(200),F=i(114),N=i(703);let G=class extends o.a{constructor(e){super(e),this._terrainIntersectionOptionsLayerUids=new Set(["terrain"])}initialize(){this.intersector=Object(x.b)(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=F.c.MIN}getScreenPointIntersection(e){const t=Object(R.j)(e,k.c.get()),i=Object(D.c)(this.view.state.camera,t,J);return this._getRayIntersection(i)}_getRayIntersection(e,t){if(Object(s.k)(e)||Object(s.k)(this.view.sceneIntersectionHelper))return null;this.intersector.options.store=F.c.MIN,this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e,this.intersector,t);const i=this.intersector.results.min,n=Object(b.f)();if(!i.getIntersectionPoint(n))return null;const o=this.view.renderCoordsHelper.fromRenderCoords(n,this.view.spatialReference),a=Object(b.d)(i.normal);if(Object(M.a)(i))return new H({type:F.b.OBJECT,id:`${i.target.layerUid}/${i.target.nodeIndex}/${i.target.componentIndex}`,mapPoint:o,renderPoint:n,normal:a,ray:Object(T.b)(e),graphic:null});if(Object(z.b)(i))return new H({type:F.b.TERRAIN,id:i.target.lij.slice(),mapPoint:o,renderPoint:n,normal:a,ray:Object(T.b)(e),graphic:null});const r=Object(N.c)(i,this.view);if(Object(s.l)(r)){const t=r.layer,i=r.sourceLayer;let s;return s=i&&"scene"===i.type?Object(E.g)(r,i.objectIdField):r.uid,new H({type:F.b.OBJECT,id:`${t.uid}/${s}`,mapPoint:o,renderPoint:n,normal:a,ray:Object(T.b)(e),graphic:r})}return null}updateFromGroundIntersection(e,t,i){const n=U,o=B,a=W,r=$;Object(_.l)(o,e),this.view.renderCoordsHelper.worldUpAtPosition(o,a),Object(_.w)(a,a);const c=this.view.basemapTerrain.visibleElevationBounds,l=c?Math.abs(c.max-c.min):100,u=t>=0?1:-1;Object(_.p)(r,a,u*(l+Math.abs(t))),Object(_.j)(n,o,r),Object(T.f)(n,o,J);const d=this._getRayIntersection(J,{include:this._terrainIntersectionOptionsLayerUids});return Object(s.l)(d)?(Object(_.p)(r,a,u*t),Object(_.j)(i,d.renderPoint,r),Object(b.d)(d.normal)):(Object(_.l)(i,e),null)}};Object(n.a)([Object(c.b)()],G.prototype,"view",void 0),Object(n.a)([Object(c.b)()],G.prototype,"intersector",void 0),G=Object(n.a)([Object(u.a)("esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector")],G);const U=Object(b.f)(),B=Object(b.f)(),W=Object(b.f)(),$=Object(b.f)(),J=Object(T.c)();var q=i(1180),Z=i(124),K=i(62);const Q="esri.views.3d.analysis.LineOfSight.LineOfSightController",X=y.a.getLogger(Q);let Y=class extends(r.a.EventedMixin(o.a)){constructor(e){super(e),this.updateOnCameraChange=!0,this._effectiveObserverElevationMode="absolute-height",this._observerFeatureId=null,this._updatingHandles=new C.a,this._frameTask=Z.a,this._handles=new j.a,this._computationHandles=new j.a,this._externalObserverUpdate=!0}initialize(){var e;const t=null==(e=this.view.resourceController)?void 0:e.scheduler;this._frameTask=t?t.registerTask(Z.b.LINE_OF_SIGHT_TOOL):Z.a,this._intersector=new G({view:this.view}),this._handles.add([this._connectObserver(),this._connectComputations(),this._connectTargets()])}destroy(){this._handles.destroy(),this._computationHandles.destroy(),this._computations.removeAll(),this._updatingHandles.destroy()}get updating(){return this._frameTask.updating||this._updatingHandles.updating}get priority(){return this._frameTask.priority}set priority(e){this._frameTask.priority=e}get _computations(){return this.analysisViewData.computations}get _elevationAlignedObserverPositionRenderSpace(){return this.analysisViewData.observerEngineLocation}set _elevationAlignedObserverPositionRenderSpace(e){this.analysisViewData.observerEngineLocation=e}get _screenPixelSize(){return this.view.state.camera.computeScreenPixelSizeAt(this._elevationAlignedObserverPositionRenderSpace)}_computeResult(e){const t=e.computation,{inputPoints:i,computationResult:n}=t,{observerAdjusted:o,targetAdjusted:a}=i,{start:r,end:s}=n;Object(_.l)(r,o),Object(_.l)(s,a),this._canCompute(t)?this._computeIntersection(e):this._interpolateIntersection(e),t.notifyResultChanged(),this.emit("result-changed",{target:e.computation.target,result:t.result})}_updateAdjustedPointsFromFeatures(e){const t=this.view,{sceneIntersectionHelper:i}=t,{inputPoints:n}=e,{observerAdjusted:o,observerFeatureId:a,targetFeatureId:r,targetAdjusted:c}=n;if(Object(s.k)(a)&&Object(s.k)(r))return;const l=Object(_.r)(o,c),u=this._intersector.intersector,d=Object(T.f)(n.observer,n.target,ie);u.options.store=F.c.ALL,i.intersectToolIntersectorRay(d,u);let p=null,h=null,v=null,j=null;for(const b of u.results.all){const e=Object(N.c)(b,this.view);if(Object(s.k)(e)||Object(s.k)(b.distanceInRenderSpace))continue;const i=Object(O.c)(e);Object(s.k)(i)||(Object(s.l)(a)&&i===a&&(Object(s.k)(p)&&(p=this._getFeatureDistanceThreshold(b,t,l)),b.distanceInRenderSpace<p&&(v=b)),Object(s.l)(r)&&i===r&&(Object(s.k)(h)&&(h=this._getFeatureDistanceThreshold(b,t,l)),Object(s.k)(j)&&b.distanceInRenderSpace<l&&l-b.distanceInRenderSpace<h&&(j=b)))}Object(s.l)(v)&&v.getIntersectionPoint(o)&&(n.observerSurfaceNormal=v.getTransformedNormal(Object(b.f)())),Object(s.l)(j)&&j.getIntersectionPoint(c)&&(n.targetSurfaceNormal=j.getTransformedNormal(Object(b.f)()))}_getFeatureDistanceThreshold(e,t,i){if(Object(N.b)(e)){const n=Object(N.a)(e,t);if(Object(s.l)(n))return Math.min(n*oe,i)}return 1e-5*i}_adjustStartEndPositions(e){const t=this._screenPixelSize,i=this.view,{inputPoints:n}=e,{observer:o,observerSurfaceNormal:a,target:r,targetSurfaceNormal:c,observerAdjusted:l,targetAdjusted:u}=n,b=te;Object(_.l)(l,o),Object(_.l)(u,r),this._updateAdjustedPointsFromFeatures(e),Object(s.l)(a)?Object(_.l)(b,a):Object(_.k)(b,u,l);const d=t;Object(_.w)(b,b),Object(_.p)(b,b,Math.min(d,1)),Object(_.j)(l,l,b),Object(s.l)(c)?Object(_.l)(b,c):Object(_.k)(b,l,u);const p=i.state.camera.computeScreenPixelSizeAt(u);Object(_.w)(b,b),Object(_.p)(b,b,Math.min(p,1)),Object(_.j)(u,u,b)}_computeIntersection({computation:e,interpolationInfo:t}){const{view:i}=this,{sceneIntersectionHelper:n,renderCoordsHelper:o}=i;if(Object(s.k)(n))return;const a=this._intersector.intersector,{computationResult:r,inputPoints:c}=e,{observer:l,target:u}=c,{start:b,end:d}=r,p=Object(T.f)(b,d,ie);a.options.store=F.c.MIN,n.intersectToolIntersectorRay(p,a);const h=a.results.min,O=r.intersection,v=te;let j=!0;if(Object(s.l)(h)&&h.getIntersectionPoint(O)){Object(_.l)(t.originalIntersection,O),Object(_.l)(t.originalObserver,b),Object(_.l)(t.originalTarget,d),o.fromRenderCoords(O,v,i.spatialReference);const e=1-Object(_.s)(d,u)/Object(_.s)(b,u);j=Object(_.s)(l,O)>=e*Object(_.s)(l,u)}const g=new K.a(v,i.spatialReference);{const{result:t,target:n}=e;Object(s.l)(t)?(t.target=n,t.intersectedGraphic=j?null:Object(N.c)(h,i),t.intersectedLocation=j?null:g,t.visible=j):e.result=new P({target:n,elevationAlignedTargetLocation:e.elevationAlignedTargetLocation,intersectedGraphic:j?null:Object(N.c)(h,i),intersectedLocation:j?null:g,visible:j})}r.isValid=c.isValid=!0,r.isTargetVisible=j}_interpolateIntersection({computation:e,interpolationInfo:t}){const{computationResult:i,inputPoints:n}=e,{start:o,end:a,intersection:r}=i,{originalIntersection:s,originalObserver:c,originalTarget:l}=t;if(Object(_.l)(r,s),n.isValid){const e=te,t=Object(_.s)(c,s)/Object(_.s)(c,l);Object(_.H)(e,o,c),Object(_.p)(e,e,1-t),Object(_.j)(r,r,e),Object(_.H)(e,a,l),Object(_.p)(e,e,t),Object(_.j)(r,r,e),i.isValid=!0}else e.result=null,i.isValid=!1,i.isTargetVisible=!1}_canCompute(e){const t=this.analysisViewData.elevationAlignedObserver,i=this.view.frustum;if(Object(s.k)(t)||Object(s.k)(e.elevationAlignedTargetLocation)||Object(s.k)(i))return!1;const{observerAdjusted:n,targetAdjusted:o}=e.inputPoints,a=i.intersectsPoint(n),r=i.intersectsPoint(o);return a&&r}_onObserverPositionChange(e,t,i,n,o){if(this._externalObserverUpdate=o,Object(s.k)(e))return this.analysisViewData.elevationAlignedObserver=null,void(this._observerFeatureId=null);if(Object(s.k)(t))return Object(q.b)(this.analysis,e.spatialReference,X),void(this.analysisViewData.elevationAlignedObserver=null);const a=this._getEffectiveElevationInfo(t,i),{absoluteZ:r,elevation:c}=Object(V.n)(t.x,t.y,t.z,this.view.spatialReference,this.view,a),l=t.clone();l.z=r,this._effectiveObserverElevationMode=a.mode,this.analysisViewData.elevationAlignedObserver=l;const u=Object(b.f)();this.view.renderCoordsHelper.toRenderCoords(l,u),this._elevationAlignedObserverPositionRenderSpace=u,this._observerGroundOffsetRenderSpace=r-c,this._observerFeatureId=Object(O.c)(n),this.priority=Z.b.LINE_OF_SIGHT_TOOL_INTERACTIVE}_onObserverRenderSpacePositionChangeForComputation(e,t,i,n,o){const{inputPoints:a}=e;switch(Object(_.l)(a.observer,t),a.observerFeatureId=o,a.observerSurfaceNormal=null,n){case"on-the-ground":case"relative-to-ground":{const e=this._intersector.updateFromGroundIntersection(a.observer,i,a.observer);Object(s.k)(a.observerFeatureId)&&(a.observerSurfaceNormal=e)}}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=Z.b.LINE_OF_SIGHT_TOOL_INTERACTIVE}_onTargetPositionChange(e,t,i,n,o,a=!0){const r=e.inputPoints;if(a&&(r.isValid=!1),Object(s.k)(i))return Object(s.l)(t)&&Object(q.b)(this.analysis,t.spatialReference,X),e.elevationAlignedTargetLocation=null,void e.notifyInputPointsChanged();const c=this._getEffectiveElevationInfo(i,n),{absoluteZ:l,elevation:u}=Object(V.n)(i.x,i.y,i.z,this.view.spatialReference,this.view,c),b=i.clone();switch(b.z=l,e.elevationAlignedTargetLocation=b,this.view.renderCoordsHelper.toRenderCoords(e.elevationAlignedTargetLocation,r.target),r.targetFeatureId=Object(O.c)(o),r.targetSurfaceNormal=null,c.mode){case"on-the-ground":case"relative-to-ground":{const e=this._intersector.updateFromGroundIntersection(r.target,l-u,r.target);Object(s.k)(r.targetFeatureId)&&(r.targetSurfaceNormal=e)}}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=Z.b.LINE_OF_SIGHT_TOOL_INTERACTIVE}_connectComputationToTarget(e){return Object(g.b)([this._updatingHandles.add((()=>({computation:e,targetPosition:e.target.position,targetElevationInfo:e.target.elevationInfo,targetFeatureInfo:e.target.feature,projectedTargetPosition:Object(w.s)(e.target.position,this.view.spatialReference)})),(({computation:e,targetPosition:t,targetElevationInfo:i,targetFeatureInfo:n,projectedTargetPosition:o})=>{Object(s.l)(o.pending)?this._updatingHandles.addPromise(o.pending):this._onTargetPositionChange(e,t,o.geometry,i,n)}),m.a)])}_connectComputationToObserver(e){return this._updatingHandles.add((()=>({computation:e,observer:this.analysisViewData.elevationAlignedObserver})),(({computation:e})=>{this._externalObserverUpdate&&(e.inputPoints.isValid=!1,e.notifyInputPointsChanged())}),m.a)}_connectComputationToRenderSpaceObserver(e){return this._updatingHandles.add((()=>({computation:e,observer:this._elevationAlignedObserverPositionRenderSpace,observerGroundOffset:this._observerGroundOffsetRenderSpace,observerElevationMode:this._effectiveObserverElevationMode,observerFeatureId:this._observerFeatureId})),(({computation:e,observer:t,observerGroundOffset:i,observerElevationMode:n,observerFeatureId:o})=>{this._onObserverRenderSpacePositionChangeForComputation(e,t,i,n,o)}),m.a)}_connectComputationToCamera(e){return this._updatingHandles.add((()=>({camera:this.view.state.camera,isDirty:this._isCameraDirty})),(({isDirty:t})=>{!this.updateOnCameraChange||e.inputPoints.isValid&&!t||e.notifyInputPointsChanged()}))}_connectComputationToSlicePlane(e){return this._updatingHandles.add((()=>this.view.slicePlane),(()=>{e.inputPoints.isValid=!1,e.notifyInputPointsChanged()}))}_connectComputationToElevation(e){const t=(i,n)=>{const o=this.analysis.observer,a=e.target;let r=null,c=null,l=null,u=null,b=null,d=null;if(Object(s.l)(o)&&Object(s.l)(o.position)){const e=Object(w.s)(o.position,this.view.spatialReference);if(Object(s.l)(e.pending))return this._updatingHandles.addPromise(e.pending),void e.pending.finally((()=>t(i,n)));r=e.geometry,c=o.elevationInfo,l=o.feature}if(Object(s.l)(a.position)){const e=Object(w.s)(a.position,this.view.spatialReference);if(Object(s.l)(e.pending))return this._updatingHandles.addPromise(e.pending),void e.pending.finally((()=>t(i,n)));u=e.geometry,b=a.elevationInfo,d=a.feature}Object(s.k)(r)&&Object(s.k)(u)||(Object(w.n)(i,n,ne,this.view.spatialReference),Object(s.l)(r)&&Object(I.i)(ne,r)&&this._onObserverPositionChange(Object(s.l)(o)?o.position:null,r,c,l,!1),Object(s.l)(u)&&Object(I.i)(ne,u)&&this._onTargetPositionChange(e,a.position,u,b,d,!1),Object(s.l)(r)&&Object(s.l)(u)&&Object(I.y)(ne,r,u)&&e.notifyInputPointsChanged())};return this.view.elevationProvider.on("elevation-change",(e=>t(e.extent,e.spatialReference)))}_connectComputationToTask(e){let t=s.p;const i={computation:e,interpolationInfo:{originalIntersection:Object(b.f)(),originalObserver:Object(b.f)(),originalTarget:Object(b.f)()}};return Object(g.b)([this._updatingHandles.add((()=>e.inputPoints),(()=>{t=Object(s.a)(t),t=Object(v.b)((async e=>{await Object(f.i)(this._frameTask.schedule((()=>this._computeResult(i)),e))}))}),{initial:!0,equals:()=>!1}),Object(g.c)((()=>t=Object(s.a)(t)))])}_connectComputation(e){const t=this._computationHandles;t.has(e)||t.add([this._connectComputationToTarget(e),this._connectComputationToObserver(e),this._connectComputationToRenderSpaceObserver(e),this._connectComputationToCamera(e),this._connectComputationToSlicePlane(e),this._connectComputationToElevation(e),this._connectComputationToTask(e)],e)}_disconnectComputation(e){this._computationHandles.remove(e)}_onComputationCollectionChange({added:e,removed:t}){for(const i of t)this._disconnectComputation(i);for(const i of e)this._connectComputation(i)}_onTargetCollectionChange({added:e,removed:t}){for(const i of t)this._removeTarget(i);for(const i of e)this._addTarget(i)}_onCursorTargetChange(e,t){Object(s.l)(t)&&this._removeTarget(t),Object(s.l)(e)&&this._addTarget(e)}_addTarget(e){this._computations.some((t=>t.target===e))||this._computations.add(new S({target:e}))}_removeTarget(e){const t=this._computations.findIndex((t=>t.target===e));this._computations.removeAt(t)}_connectObserver(){return Object(g.b)([this._updatingHandles.add((()=>({observerPosition:Object(s.l)(this.analysis.observer)?this.analysis.observer.position:null,projectedObserverPosition:Object(w.s)(Object(s.l)(this.analysis.observer)?this.analysis.observer.position:null,this.view.spatialReference),observerElevationInfo:Object(s.l)(this.analysis.observer)?this.analysis.observer.elevationInfo:null,observerFeatureInfo:Object(s.l)(this.analysis.observer)?this.analysis.observer.feature:null})),(({observerPosition:e,projectedObserverPosition:t,observerElevationInfo:i,observerFeatureInfo:n})=>{Object(s.l)(t.pending)?this._updatingHandles.addPromise(t.pending):this._onObserverPositionChange(e,t.geometry,i,n,!0)}),m.a)])}_connectComputations(){return this._updatingHandles.addOnCollectionChange((()=>this._computations),(e=>this._onComputationCollectionChange(e)),{initial:!0,final:!0})}_connectTargets(){return Object(g.b)([this._updatingHandles.addOnCollectionChange((()=>this.analysis.targets),(e=>this._onTargetCollectionChange(e)),{initial:!0,final:!0}),this._updatingHandles.add((()=>this.analysisViewData.cursorTarget),((e,t)=>{this._onCursorTargetChange(e,t)}))])}get _isCameraDirty(){const e=this.analysisViewData.elevationAlignedObserver,{view:t}=this,{renderCoordsHelper:i}=t;if(Object(s.k)(e)||Object(s.k)(i))return!1;const n=te;i.toRenderCoords(e,n);const o=t.state.camera.computeScreenPixelSizeAt(n);return Math.abs((o-this._screenPixelSize)/this._screenPixelSize)>ee}_getEffectiveElevationInfo(e,t){return e.hasZ?Object(s.u)(t,{mode:"absolute-height",offset:0}):{mode:"on-the-ground",offset:0}}};Object(n.a)([Object(c.b)({constructOnly:!0})],Y.prototype,"analysis",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],Y.prototype,"analysisViewData",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],Y.prototype,"view",void 0),Object(n.a)([Object(c.b)()],Y.prototype,"updating",null),Object(n.a)([Object(c.b)()],Y.prototype,"priority",null),Object(n.a)([Object(c.b)()],Y.prototype,"updateOnCameraChange",void 0),Object(n.a)([Object(c.b)()],Y.prototype,"_computations",null),Object(n.a)([Object(c.b)()],Y.prototype,"_elevationAlignedObserverPositionRenderSpace",null),Object(n.a)([Object(c.b)()],Y.prototype,"_observerGroundOffsetRenderSpace",void 0),Object(n.a)([Object(c.b)()],Y.prototype,"_effectiveObserverElevationMode",void 0),Object(n.a)([Object(c.b)()],Y.prototype,"_observerFeatureId",void 0),Object(n.a)([Object(c.b)()],Y.prototype,"_screenPixelSize",null),Object(n.a)([Object(c.b)({readOnly:!0})],Y.prototype,"_updatingHandles",void 0),Object(n.a)([Object(c.b)()],Y.prototype,"_frameTask",void 0),Object(n.a)([Object(c.b)()],Y.prototype,"_isCameraDirty",null),Y=Object(n.a)([Object(u.a)(Q)],Y);const ee=.1,te=Object(b.f)(),ie=Object(T.c)(),ne=Object(I.o)(),oe=.05;var ae=i(1300),re=i(1301),se=i(189),ce=i(727);let le=class extends o.a{constructor(e){super(e),this.enabled=!0,this.glowColor=new p.a([255,127,0]),this.glowWidth=8,this.innerColor=new p.a([255,255,255]),this.innerWidth=.75,this.globalAlpha=.75}};Object(n.a)([Object(c.b)({type:Boolean})],le.prototype,"enabled",void 0),Object(n.a)([Object(c.b)({type:p.a})],le.prototype,"glowColor",void 0),Object(n.a)([Object(c.b)({type:Number})],le.prototype,"glowWidth",void 0),Object(n.a)([Object(c.b)({type:p.a})],le.prototype,"innerColor",void 0),Object(n.a)([Object(c.b)({type:Number})],le.prototype,"innerWidth",void 0),Object(n.a)([Object(c.b)({type:Number})],le.prototype,"globalAlpha",void 0),le=Object(n.a)([Object(u.a)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightLaserLineConfiguration")],le);let ue=class extends o.a{constructor(e){super(e),this.size=.5,this.color=new p.a([255,127,0,.75])}};Object(n.a)([Object(c.b)({type:Number})],ue.prototype,"size",void 0),Object(n.a)([Object(c.b)({type:p.a})],ue.prototype,"color",void 0),ue=Object(n.a)([Object(u.a)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightObserverConfiguration")],ue);let be=class extends o.a{constructor(e){super(e),this.size=.5,this.visibleColor=new p.a([3,252,111,.75]),this.occludedColor=new p.a([252,3,69,.75]),this.undefinedColor=new p.a([127,127,127,.75])}};Object(n.a)([Object(c.b)({type:Number})],be.prototype,"size",void 0),Object(n.a)([Object(c.b)({type:p.a})],be.prototype,"visibleColor",void 0),Object(n.a)([Object(c.b)({type:p.a})],be.prototype,"occludedColor",void 0),Object(n.a)([Object(c.b)({type:p.a})],be.prototype,"undefinedColor",void 0),be=Object(n.a)([Object(u.a)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTargetConfiguration")],be);class de extends o.a{constructor(e){super(e),this.innerWidth=2,this.outerWidth=8,this.visibleInnerColor=new p.a([3,252,111,1]),this.visibleOuterColor=new p.a([3,252,111,.15]),this.occludedInnerColor=new p.a([252,3,69,1]),this.occludedOuterColor=new p.a([252,3,69,.1]),this.undefinedInnerColor=new p.a([255,255,255,1]),this.undefinedOuterColor=new p.a([127,127,127,.2])}}Object(n.a)([Object(c.b)({type:Number})],de.prototype,"innerWidth",void 0),Object(n.a)([Object(c.b)({type:Number})],de.prototype,"outerWidth",void 0),Object(n.a)([Object(c.b)({type:p.a})],de.prototype,"visibleInnerColor",void 0),Object(n.a)([Object(c.b)({type:p.a})],de.prototype,"visibleOuterColor",void 0),Object(n.a)([Object(c.b)({type:p.a})],de.prototype,"occludedInnerColor",void 0),Object(n.a)([Object(c.b)({type:p.a})],de.prototype,"occludedOuterColor",void 0),Object(n.a)([Object(c.b)({type:p.a})],de.prototype,"undefinedInnerColor",void 0),Object(n.a)([Object(c.b)({type:p.a})],de.prototype,"undefinedOuterColor",void 0);let pe=class extends o.a{constructor(e){super(e),this.laserLine=new le,this.observer=new ue,this.target=new be,this.lineOfSight=new de}};Object(n.a)([Object(c.b)({type:le})],pe.prototype,"laserLine",void 0),Object(n.a)([Object(c.b)({type:ue})],pe.prototype,"observer",void 0),Object(n.a)([Object(c.b)({type:be})],pe.prototype,"target",void 0),Object(n.a)([Object(c.b)({type:de})],pe.prototype,"lineOfSight",void 0),pe=Object(n.a)([Object(u.a)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightToolConfiguration")],pe);var he=i(1125),Oe=i(1147),ve=i(1232),je=i(285),ge=i(674);function ye(e,t,i){return{geometry:Object(je.k)(e,32,32),material:Object(Oe.c)(p.a.toUnitRGBA(t)),stateMask:i}}function fe(e){const t=[];return e.customColor1&&t.push(ye(e.size,e.customColor1,ge.b.Custom1)),e.customColor2&&t.push(ye(e.size,e.customColor2,ge.b.Custom2)),e.customColor3&&t.push(ye(e.size,e.customColor3,ge.b.Custom3)),e.color&&t.push(ye(e.size,e.color)),t}var me,_e,Ce=i(1236),we=(i(782),i(1270)),Ie=i(1110),Te=i(282),Ve=i(932);(_e=me||(me={})).Ready="ready",_e.Creating="creating",_e.Created="created";let Pe=class extends we.a{constructor(e){super(e),this.removeIncompleteOnCancel=!1,this.configuration=new pe,this.analysisViewData=null,this._laserlineVisualElement=null,this._grabbedManipulator=null,this._analysisHandles=new j.a,this._handles=new j.a,this._updatingHandles=new C.a,this._manipulatorHandles=new j.a,this._targetTrackerManipulator=null}initialize(){this._intersector=new G({view:this.view}),this._handles.add(Object(m.f)((()=>this.state),(e=>{e===me.Created&&this.finishToolCreation()}),m.e)),this._observerManipulator=this._createObserverManipulator(),this._handles.add([this._updatingHandles.add((()=>({...this.configuration.observer})),(()=>this._updateObserverManipulatorStyle())),this._updatingHandles.add((()=>this.analysisViewData.elevationAlignedObserver),(e=>this._onObserverLocationChange(e)),m.a),this._updatingHandles.add((()=>({...this.configuration.laserLine})),(()=>this._createVisualElements()),m.a),this._updatingHandles.add((()=>this._laserLineRendererDependencies()),(e=>this._updateLaserLineRenderer(e))),this._connectComputations(),this._updatingHandles.addWhen((()=>!this._shouldRenderTracker),(()=>this._clearCursorTracker()),m.a)])}destroy(){this._updatingHandles=Object(s.e)(this._updatingHandles),this._handles=Object(s.e)(this._handles),this._manipulatorHandles=Object(s.e)(this._manipulatorHandles),this._analysisHandles=Object(s.e)(this._analysisHandles),this._observerManipulator=null,this._clearCursorTracker(),this._removeVisualElements(),this._intersector=null,this._set("analysis",null)}get state(){return this.active?this.hasGrabbedManipulators?me.Created:me.Creating:Object(s.l)(this.analysis.observer)&&Object(s.l)(this.analysis.observer.position)?me.Created:me.Ready}get cursor(){return this.active&&this._showTracker?"crosshair":null}get updating(){return Object(s.l)(this.analysisViewData)&&this.analysisViewData.updating||this._updatingHandles.updating}get _showTracker(){return this.active&&"mouse"===this._latestPointerMovePointerType}get _shouldRenderTracker(){return this._showTracker&&Object(s.l)(this.analysis.observer)&&Object(s.l)(this.analysis.observer.position)&&!this.hasGrabbedManipulators}continue(){this.view.activeTool=this}stop(){this.view.activeTool=null}onEditableChange(){this.analysisViewData.editable=this.internallyEditable}onInputEvent(e){switch(e.type){case"immediate-double-click":this._doubleClickHandler(e);break;case"key-down":this._keyDownHandler(e);break;case"pointer-move":this._pointerMoveHandler(e)}}onInputEventAfter(e){"immediate-click"===e.type&&this._clickHandler(e)}onShow(){}onHide(){}onDeactivate(){this._clearCursorTracker()}_connectComputations(){return this._updatingHandles.addOnCollectionChange((()=>this.analysisViewData.computations),(e=>this._onComputationsCollectionChange(e)),{initial:!0,final:!0})}_onComputationsCollectionChange({added:e,removed:t}){for(const i of t)this._disconnectComputation(i);for(const i of e)this._connectComputation(i)}_connectComputation(e){if(this.destroyed)return void y.a.getLogger(this.declaredClass).warn("Attempting to connect an analysis to a destroyed LineOfSight tool. Ignoring.");const t=this._analysisHandles;if(t.has(e))return;const i=this._createTargetManipulator(e.target);Object(s.k)(this._targetTrackerManipulator)&&i.metadata.target===this.analysisViewData.cursorTarget&&(this._targetTrackerManipulator=i,this._targetTrackerManipulator.available=!1,this._targetTrackerManipulator.interactive=!1,this._updateLaserLineRenderer()),t.add([this._updatingHandles.add((()=>this._getLineOfSightManipulatorStateDependencies(e)),(()=>this._updateManipulatorState(i,e)),m.a),this._updatingHandles.add((()=>e.elevationAlignedTargetLocation),(e=>this._onTargetLocationChange(e,i)),m.a)],e)}_disconnectComputation(e){if(this.destroyed)return void y.a.getLogger(this.declaredClass).warn("Attempting to disconnect an analysis from a destroyed LineOfSight tool. Ignoring.");this._analysisHandles.remove(e);const t=this._getTargetManipulator(e.target);Object(s.l)(t)&&(this.manipulators.remove(t),this._manipulatorHandles.remove(t),Object(s.l)(this._targetTrackerManipulator)&&this._targetTrackerManipulator===t&&(this._targetTrackerManipulator=null))}_clearCursorTracker(){this.analysisViewData.cursorTarget=Object(s.e)(this.analysisViewData.cursorTarget)}_createManipulator(e,t,i){const n=function(e,t){const i=fe(t),n=new he.a({view:e,renderObjects:i,elevationInfo:{mode:"absolute-height",offset:0}});return Object(ve.b)(n),n}(this.view,e);return n.metadata=i,this._manipulatorHandles.add([t(n),n.events.on("grab-changed",(e=>this._manipulatorGrabChanged(n,e))),n.events.on("immediate-click",(e=>this._manipulatorClick(n,e)))],n),this.manipulators.add(n),n}_createTargetManipulator(e){const t=this.configuration,i={size:t.target.size,customColor1:t.target.visibleColor,customColor2:t.target.occludedColor,customColor3:t.target.undefinedColor,visible:!0},n={target:e,type:"target"},o=this._createManipulator(i,(e=>this._createTargetManipulatorDragPipeline(e)),n);return Object(s.l)(e.position)?o.elevationAlignedLocation=e.position:o.available=!1,o}_getTargetManipulator(e){let t=null;return this.manipulators.forEach((i=>{const n=i.manipulator;Object(s.k)(t)&&"target"===n.metadata.type&&n.metadata.target===e&&(t=n)})),t}_createObserverManipulator(){const e=this.configuration,t={size:e.observer.size,color:e.observer.color,visible:!0};return this._createManipulator(t,(e=>this._createObserverManipulatorDragPipeline(e)),{type:"observer",intersection:null})}_updateObserverManipulatorStyle(){const e=this._observerManipulator,t=this.configuration.observer,i={size:t.size,color:t.color,visible:e.available};e.renderObjects=fe(i)}_screenToIntersection(){return e=>{const t=this._intersector.getScreenPointIntersection(e.screenEnd);return Object(s.k)(t)?null:{...e,intersection:t}}}_createTargetManipulatorDragPipeline(e){return Object(Ie.e)(e,((t,i,n)=>{i.next(this._screenToIntersection()).next(this._updateTargetDragStep(e)).next((()=>this._updateLaserLineRenderer())),n.next(this._cancelTargetDragStep(e.metadata.target)).next((()=>this._updateLaserLineRenderer()))}))}_createObserverManipulatorDragPipeline(e){return Object(Ie.e)(e,((e,t,i)=>{t.next(this._screenToIntersection()).next(this._updateObserverDragStep()).next((()=>this._updateLaserLineRenderer())),i.next(this._cancelObserverDragStep()).next((()=>this._updateLaserLineRenderer()))}))}_updateObserverDragStep(){return e=>(Object(s.l)(e.intersection.mapPoint)?(Object(s.k)(this.analysis.observer)&&(this.analysis.observer=new ae.a),this._updateFromIntersection(this.analysis.observer,e.intersection)):this.analysis.observer=null,e)}_cancelObserverDragStep(){const e=Object(s.l)(this.analysis.observer)&&Object(s.l)(this.analysis.observer.position)?this.analysis.observer.clone():null;return t=>(this.analysis.observer=e,t)}_updateTargetDragStep(e){return t=>{this._updateFromIntersection(e.metadata.target,t.intersection);const i=t.intersection.mapPoint;return Object(s.l)(i)&&(e.elevationAlignedLocation=i),t}}_cancelTargetDragStep(e){const t=Object(s.b)(e.position,(e=>e.clone()));return i=>(e.position=t,i)}_manipulatorGrabChanged(e,t){switch(t.action){case"start":this._grabbedManipulator=e;break;case"end":this._grabbedManipulator===e&&(this._grabbedManipulator=null)}}_updateManipulatorState(e,t){const{isValid:i,isTargetVisible:n}=t.computationResult;e.state=i?n?ge.b.Custom1:ge.b.Custom2:ge.b.Custom3}_getLineOfSightManipulatorStateDependencies(e){const{isValid:t,isTargetVisible:i}=e.computationResult;return{isValid:t,isTargetVisible:i}}_laserLineRendererDependencies(){return{laserlineVisualElement:this._laserlineVisualElement,grabbedManipulator:this._grabbedManipulator,shouldRenderTracker:this._shouldRenderTracker,observerPosition:Object(s.l)(this.analysis.observer)?this.analysis.observer.position:null,visible:this.visible}}_updateLaserLineRenderer(e=this._laserLineRendererDependencies()){const{laserlineVisualElement:t,grabbedManipulator:i,shouldRenderTracker:n,observerPosition:o,visible:a}=e;if(Object(s.k)(t))return;const r=Object(s.l)(i)?i:n&&Object(s.l)(o)?this._targetTrackerManipulator:null;this.configuration.laserLine.enabled&&Object(s.l)(r)&&a?(t.visible=!0,t.heightManifoldTarget=r.renderLocation,r!==this._observerManipulator?t.lineVerticalPlaneSegment=Object(se.f)(this._observerManipulator.renderLocation,r.renderLocation,Se):t.lineVerticalPlaneSegment=null):(t.visible=!1,t.heightManifoldTarget=null,t.lineVerticalPlaneSegment=null)}_createVisualElements(){const e=this.configuration.laserLine;this._removeVisualElements(),this._laserlineVisualElement=new Ce.a({view:this.view,attached:!0,visible:this.visible,style:{glowColor:p.a.toUnitRGB(e.glowColor),glowWidth:e.glowWidth,innerColor:p.a.toUnitRGB(e.innerColor),innerWidth:e.innerWidth,globalAlpha:e.globalAlpha}})}_removeVisualElements(){Object(s.l)(this._laserlineVisualElement)&&(this._laserlineVisualElement.destroy(),this._laserlineVisualElement=null)}_onObserverLocationChange(e){Object(s.k)(e)?this._observerManipulator.available=!1:(this._observerManipulator.metadata.intersection=null,this._observerManipulator.available=!0,this._observerManipulator.elevationAlignedLocation=e)}_onTargetLocationChange(e,t){Object(s.l)(e)?(t.elevationAlignedLocation=e,t!==this._targetTrackerManipulator&&(t.available=!0)):t.available=!1}_addPointFromClickEvent(e){const t=this._intersector.getScreenPointIntersection(e);if(!Object(s.k)(t)&&!Object(s.k)(t.mapPoint))if(Object(s.l)(this.analysis.observer)&&Object(s.l)(this.analysis.observer.position)){this._clearCursorTracker();const e=new re.a;this._updateFromIntersection(e,t),this.analysis.targets.add(e)}else{const e=new ae.a;this._updateFromIntersection(e,t),this.analysis.observer=e}}_clickHandler(e){this.active&&e.button!==Ve.a.Right&&(this._addPointFromClickEvent(Object(Te.b)(e)),e.stopPropagation())}_doubleClickHandler(e){this.active&&e.button!==Ve.a.Right&&(this.stop(),e.stopPropagation())}_keyDownHandler(e){this.active&&"Escape"===e.key&&(this.stop(),e.stopPropagation())}_pointerMoveHandler(e){if(this.hasGrabbedManipulators)return;if(this._latestPointerMovePointerType=e.pointerType,this._updateLaserLineRenderer(),!this._showTracker||Object(s.k)(this.analysis.observer)||Object(s.k)(this.analysis.observer.position))return;const t=Object(Te.b)(e),i=this._intersector.getScreenPointIntersection(t);Object(s.l)(i)&&Object(s.l)(i.mapPoint)&&(Object(s.k)(this.analysisViewData.cursorTarget)&&(this.analysisViewData.cursorTarget=new re.a),this._updateFromIntersection(this.analysisViewData.cursorTarget,i),this._updateLaserLineRenderer())}_updateFromIntersection(e,t){if(Object(s.k)(t.mapPoint))return e.position=null,e.elevationInfo=null,void(e.feature=null);switch(t.type){case F.b.OBJECT:if(Object(s.l)(t.graphic)){const i=t.graphic,n=Object(V.j)(i);"on-the-ground"===n.mode&&(n.mode="relative-to-ground",n.offset=0),e.elevationInfo=new ce.a(n),e.feature=i}else e.elevationInfo=null,e.feature=null;break;case F.b.TERRAIN:case F.b.I3S:e.elevationInfo=new ce.a({mode:"on-the-ground"}),e.feature=null;break;default:e.elevationInfo=null,e.feature=null}const i=t.mapPoint.clone();i.z=Object(V.d)(this.view,i,{mode:"absolute-height",offset:0},e.elevationInfo),e.position=i}_manipulatorClick(e,t){if("observer"===e.metadata.type||e.grabbing||e.dragging||t.button!==Ve.a.Right||this.analysis.targets.length<=1)return;const{target:i}=e.metadata;this.analysis.targets.remove(i),t.stopPropagation()}get testInfo(){return{laserLineVisualElement:this._laserlineVisualElement}}};Object(n.a)([Object(c.b)({constructOnly:!0})],Pe.prototype,"view",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],Pe.prototype,"analysis",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Pe.prototype,"state",null),Object(n.a)([Object(c.b)({readOnly:!0})],Pe.prototype,"cursor",null),Object(n.a)([Object(c.b)()],Pe.prototype,"removeIncompleteOnCancel",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Pe.prototype,"updating",null),Object(n.a)([Object(c.b)({type:pe})],Pe.prototype,"configuration",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],Pe.prototype,"analysisViewData",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Pe.prototype,"_showTracker",null),Object(n.a)([Object(c.b)()],Pe.prototype,"_latestPointerMovePointerType",void 0),Object(n.a)([Object(c.b)()],Pe.prototype,"_shouldRenderTracker",null),Object(n.a)([Object(c.b)()],Pe.prototype,"_laserlineVisualElement",void 0),Object(n.a)([Object(c.b)()],Pe.prototype,"_grabbedManipulator",void 0),Pe=Object(n.a)([Object(u.a)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTool")],Pe);const Se=Object(se.d)();var Le=i(35),Re=i(1181),ke=i(1299);let Ee=class extends o.a{constructor(e){super(e),this._lineOfSightVisualizations=[],this._computationHandles=new j.a,this._updatingHandles=new C.a}initialize(){this.addHandles(this._connectComputations()),this._createObserverVisualization()}destroy(){this._updatingHandles=Object(s.e)(this._updatingHandles),this._computationHandles=Object(s.e)(this._computationHandles),this._observerVisualElement=Object(s.e)(this._observerVisualElement)}get visible(){return this.analysisViewData.visible}get updating(){return this._updatingHandles.updating}get interactiveAndEditable(){return this.analysisViewData.interactive&&this.analysisViewData.editable}get testInfo(){return{visualizations:this._lineOfSightVisualizations}}get _configuration(){return this.analysisViewData.configuration}_createLineOfSightVisualization(){const e=this._configuration,t=this.view,i={view:t,attached:!0,width:e.outerWidth,innerWidth:e.innerWidth},n=p.a.toUnitRGBA(e.visibleOuterColor),o=p.a.toUnitRGBA(e.visibleInnerColor),a=p.a.toUnitRGBA(e.occludedOuterColor),r=p.a.toUnitRGBA(e.occludedInnerColor),s=p.a.toUnitRGBA(e.undefinedOuterColor),c=p.a.toUnitRGBA(e.undefinedInnerColor),l={visibleLineVisualElement:new Re.a({...i,color:n,innerColor:o}),occludedLineVisualElement:new Re.a({...i,color:a,innerColor:r}),undefinedLineVisualElement:new Re.a({...i,color:s,innerColor:c}),targetVisualElement:new ke.a({view:t,attached:!0,...Ae,size:8})};return this._lineOfSightVisualizations.push(l),l}_destroyLineOfSightVisualization(e){e.visibleLineVisualElement=Object(s.e)(e.visibleLineVisualElement),e.occludedLineVisualElement=Object(s.e)(e.occludedLineVisualElement),e.undefinedLineVisualElement=Object(s.e)(e.undefinedLineVisualElement),e.targetVisualElement=Object(s.e)(e.targetVisualElement),this._lineOfSightVisualizations.splice(this._lineOfSightVisualizations.indexOf(e),1)}_updateLineOfSightVisualization(e,t,i){const n=this._configuration,{computationResult:o,inputPoints:a}=e,{start:r,end:c,intersection:l,isValid:u,isTargetVisible:d}=o,{observer:h}=a,O=ze;O[12]=h[0],O[13]=h[1],O[14]=h[2];const v=Object(_.k)(He,r,h),j=Object(_.k)(Me,c,h),g=Object(_.k)(De,l,h),{visibleLineVisualElement:y,occludedLineVisualElement:f,undefinedLineVisualElement:m,targetVisualElement:C}=t,w=Object(s.k)(this.analysisViewData.elevationAlignedObserver)||Object(s.k)(e.elevationAlignedTargetLocation),I=this.visible&&!w;y.visible=I,f.visible=I,m.visible=I,C.visible=I,C.attached=!i.interactiveAndEditable,I&&(y.geometry=null,f.geometry=null,m.geometry=null,C.geometry=e.elevationAlignedTargetLocation,u?d?(y.geometry=[[Object(b.g)(v),Object(b.g)(j)]],y.transform=O,y.color=p.a.toUnitRGBA(n.visibleOuterColor),C.color=p.a.toUnitRGBA(n.visibleInnerColor)):(y.geometry=[[Object(b.g)(v),Object(b.g)(g)]],y.transform=O,y.color=p.a.toUnitRGBA(n.occludedOuterColor),f.geometry=[[Object(b.g)(g),Object(b.g)(j)]],f.transform=O,C.color=p.a.toUnitRGBA(n.occludedInnerColor)):(m.geometry=[[Object(b.g)(v),Object(b.g)(j)]],m.transform=O,C.color=p.a.toUnitRGBA(n.undefinedInnerColor)))}_getLineOfSightVisualizationDependencies(e){const{computationResult:t}=e,{occludedOuterColor:i,visibleOuterColor:n}=this._configuration;return{computationResult:t,occludedOuterColor:i,visibleOuterColor:n,visible:this.visible,interactiveAndEditable:this.interactiveAndEditable}}_connectComputation(e){const t=this._computationHandles;if(t.has(e))return;const i=this._createLineOfSightVisualization();t.add([this._updatingHandles.add((()=>this._getLineOfSightVisualizationDependencies(e)),(t=>this._updateLineOfSightVisualization(e,i,t)),{initial:!0,equals:()=>!1}),Object(g.c)((()=>this._destroyLineOfSightVisualization(i)))],e)}_disconnectComputation(e){this._computationHandles.remove(e)}_connectComputations(){return this._updatingHandles.addOnCollectionChange((()=>this.analysisViewData.computations),(e=>this._onComputationsCollectionChange(e)),{initial:!0,final:!0})}_onComputationsCollectionChange({added:e,removed:t}){for(const i of t)this._disconnectComputation(i);for(const i of e)this._connectComputation(i)}_createObserverVisualization(){const e=p.a.toUnitRGBA(this._configuration.visibleInnerColor),t=new ke.a({view:this.view,attached:!1,color:e,...Ae});this._observerVisualElement=t,this.addHandles(this._updatingHandles.add((()=>({observer:this.analysisViewData.elevationAlignedObserver,interactiveAndEditable:this.interactiveAndEditable,visible:this.visible})),(({observer:e,interactiveAndEditable:i,visible:n})=>{Object(s.k)(e)||i||!n?t.attached=!1:(t.geometry=e,this._observerVisualElement.attached=!0)}),m.a))}};Object(n.a)([Object(c.b)({constructOnly:!0})],Ee.prototype,"analysis",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],Ee.prototype,"analysisViewData",void 0),Object(n.a)([Object(c.b)({constructOnly:!0})],Ee.prototype,"view",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Ee.prototype,"visible",null),Object(n.a)([Object(c.b)()],Ee.prototype,"updating",null),Object(n.a)([Object(c.b)()],Ee.prototype,"interactiveAndEditable",null),Object(n.a)([Object(c.b)()],Ee.prototype,"testInfo",null),Object(n.a)([Object(c.b)()],Ee.prototype,"_configuration",null),Ee=Object(n.a)([Object(u.a)("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],Ee);const Ae={size:6,pixelSnappingEnabled:!1,primitive:"circle",elevationInfo:{mode:"absolute-height",offset:0},outlineSize:0},He=Object(b.f)(),Me=Object(b.f)(),De=Object(b.f)(),ze=Object(Le.d)();var xe=i(1271);let Fe=class extends(Object(d.a)(r.a.EventedMixin(o.a))){constructor(e){super(e),this.type="line-of-sight-view-3d",this.analysis=null,this.tool=null,this.computations=new a.a,this.elevationAlignedObserver=null,this.configuration=new h,this.observerEngineLocation=Object(b.f)(),this.cursorTarget=null,this.editable=!0}initialize(){const e=this.view,t=this.analysis;this._analysisController=new Y({analysis:t,analysisViewData:this,view:e}),this._analysisVisualization=new Ee({analysis:t,analysisViewData:this,view:e}),this.addHandles([this._analysisController.on("result-changed",(e=>{e.target!==this.cursorTarget&&this.emit("result-changed",e)})),Object(xe.b)(this,Pe)])}destroy(){Object(xe.c)(this),this._analysisController=Object(s.e)(this._analysisController),this._analysisVisualization=Object(s.e)(this._analysisVisualization)}get results(){return this.computations.map((e=>e.result))}get priority(){return this._analysisController.priority}set priority(e){this._analysisController.priority=e}get updating(){return Object(s.l)(this._analysisController)&&this._analysisController.updating||Object(s.l)(this._analysisVisualization)&&this._analysisVisualization.updating}getResultForTarget(e){const t=this.computations.find((t=>t.target===e));return Object(s.b)(t,(e=>e.result))}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}};Object(n.a)([Object(c.b)({readOnly:!0})],Fe.prototype,"type",void 0),Object(n.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],Fe.prototype,"analysis",void 0),Object(n.a)([Object(c.b)()],Fe.prototype,"tool",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],Fe.prototype,"results",null),Object(n.a)([Object(c.b)()],Fe.prototype,"priority",null),Object(n.a)([Object(c.b)()],Fe.prototype,"computations",void 0),Object(n.a)([Object(c.b)()],Fe.prototype,"elevationAlignedObserver",void 0),Object(n.a)([Object(c.b)()],Fe.prototype,"configuration",void 0),Object(n.a)([Object(c.b)()],Fe.prototype,"observerEngineLocation",void 0),Object(n.a)([Object(c.b)()],Fe.prototype,"cursorTarget",void 0),Object(n.a)([Object(c.b)()],Fe.prototype,"updating",null),Object(n.a)([Object(c.b)()],Fe.prototype,"editable",void 0),Object(n.a)([Object(c.b)()],Fe.prototype,"_analysisController",void 0),Object(n.a)([Object(c.b)()],Fe.prototype,"_analysisVisualization",void 0),Fe=Object(n.a)([Object(u.a)("esri.views.3d.analysis.LineOfSightAnalysisView3D")],Fe);const Ne=Fe}}]);
//# sourceMappingURL=26.fdb62b8a.chunk.js.map