(this["webpackJsonppopulation-arcgis"]=this["webpackJsonppopulation-arcgis"]||[]).push([[73],{1070:function(t,e,n){"use strict";n.r(e),n.d(e,"FeatureCollectionSnappingSource",(function(){return f}));var a=n(0),o=n(28),i=n(2),r=n(23),s=n(13),c=n(1),l=(n(17),n(12),n(10)),u=n(127),p=n(78),d=n(1279),h=n(1246),g=n(1247),y=n(1248);let f=class extends o.a{constructor(t){super(t),this.view=null,this._layerView3D=null}get availability(){return 1}get updating(){return this.layerSource.updating}get _snappingElevationAligner(){const{view:t}=this,{layer:e}=this.layerSource,n=Object(i.l)(t)&&"3d"===t.type;if(!n||"subtype-group"===e.type)return Object(h.a)();return Object(h.a)(n,{elevationInfo:e.elevationInfo,alignPointsInFeatures:async(n,a)=>(await Object(r.u)(t.whenLayerView(e),a)).elevationAlignPointsInFeatures(n,a),spatialReference:t.spatialReference})}get _snappingElevationFilter(){const{view:t}=this,e=Object(i.l)(t)&&"3d"===t.type&&"subtype-group"!==this.layerSource.layer.type;return Object(g.a)(e)}get _symbologySnappingFetcher(){const{view:t}=this,{layer:e}=this.layerSource;return Object(i.l)(t)&&"3d"===t.type&&"subtype-group"!==e.type?Object(y.a)(this._symbologySnappingSupported,(async(n,a)=>{const o=await t.whenLayerView(e);return Object(r.q)(a),o.queryForSymbologySnapping({candidates:n,spatialReference:t.spatialReference},a)})):Object(y.a)()}get _symbologySnappingSupported(){return Object(i.l)(this._layerView3D)&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:t}=this,{layer:e}=this.layerSource;Object(i.l)(t)&&"3d"===t.type&&"subtype-group"!==e.type&&(t.whenLayerView(e).then((t=>this._layerView3D=t)),this.addHandles([t.elevationProvider.on("elevation-change",(({context:t})=>{const{elevationInfo:n}=e;Object(u.b)(t,n)&&this._snappingElevationAligner.notifyElevationSourceChange()})),Object(s.f)((()=>e.elevationInfo),(()=>this._snappingElevationAligner.notifyElevationSourceChange()),s.a),Object(s.f)((()=>{var t;return Object(i.l)(this._layerView3D)?null==(t=this._layerView3D.processor)?void 0:t.renderer:null}),(()=>this._symbologySnappingFetcher.notifySymbologyChange()),s.a)]))}refresh(){}async fetchCandidates(t,e){const{layer:n}=this.layerSource,{coordinateHelper:a,elevationInfo:o}=t,i=n.source;if(!i.querySnapping)return[];const s=Object(p.d)(n),c=Object(p.e)(t,s),l=await i.querySnapping(c,{signal:e});Object(r.q)(e);const h=await this._snappingElevationAligner.alignCandidates(l.candidates,e);Object(r.q)(e);const g=await this._symbologySnappingFetcher.fetch(h,e);Object(r.q)(e);const y=0===g.length?h:[...h,...g],f=this._snappingElevationFilter.filter(c,y),b=a.hasZ()?u.a:o,v=this._getGroundElevation;return f.map((t=>Object(d.a)(t,a,b,v)))}get _getGroundElevation(){return Object(d.b)(this.view)}};Object(a.a)([Object(c.b)({constructOnly:!0})],f.prototype,"layerSource",void 0),Object(a.a)([Object(c.b)({constructOnly:!0})],f.prototype,"view",void 0),Object(a.a)([Object(c.b)()],f.prototype,"_snappingElevationAligner",null),Object(a.a)([Object(c.b)()],f.prototype,"_snappingElevationFilter",null),Object(a.a)([Object(c.b)()],f.prototype,"_symbologySnappingFetcher",null),Object(a.a)([Object(c.b)()],f.prototype,"_layerView3D",void 0),Object(a.a)([Object(c.b)()],f.prototype,"_symbologySnappingSupported",null),Object(a.a)([Object(c.b)()],f.prototype,"_getGroundElevation",null),f=Object(a.a)([Object(l.a)("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],f)},1126:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a=n(78),o=n(510);class i extends o.a{constructor(t,e,n){super(e,n),this.point=t}equals(t){return t instanceof i&&Object(a.f)(this.point,t.point)}}},1215:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var a=n(357),o=n(735),i=n(1126);class r extends o.a{constructor(t){super({...t,constraint:new a.e(t.coordinateHelper,t.targetPoint)})}get hints(){return[new i.a(this.targetPoint,this.elevationInfo,this.domain)]}}},1246:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));n(32);var a=n(908),o=n(148),i=n(2),r=n(23),s=n(68),c=n(562);function l(t=!1,e){if(t){const{elevationInfo:t,alignPointsInFeatures:n,spatialReference:a}=e;return new p(t,n,a)}return new u}class u{async alignCandidates(t,e){return t}notifyElevationSourceChange(){}}class p{constructor(t,e,n){this._elevationInfo=t,this._alignPointsInFeatures=e,this.spatialReference=n,this._alignmentsCache=new a.a(1024),this._cacheVersion=0,this._metersPerVerticalUnit=Object(s.g)(n)}async alignCandidates(t,e){const n=this._elevationInfo;return Object(i.l)(n)&&"absolute-height"===n.mode&&!n.featureExpressionInfo?(this._alignAbsoluteElevationCandidates(t,n),t):this._alignComputedElevationCandidates(t,e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}_alignAbsoluteElevationCandidates(t,e){const{offset:n,unit:a}=e;if(Object(i.k)(n))return;const o=n*(Object(c.a)(null!=a?a:"meters")/this._metersPerVerticalUnit);for(const i of t)switch(i.type){case"edge":i.start.z+=o,i.end.z+=o;continue;case"vertex":i.target.z+=o;continue}}async _alignComputedElevationCandidates(t,e){const n=new Map;for(const r of t)Object(o.b)(n,r.objectId,g).push(r);const[a,i,s]=this._prepareQuery(n),c=await this._alignPointsInFeatures(a,e);if(Object(r.q)(e),s!==this._cacheVersion)return this._alignComputedElevationCandidates(t,e);this._applyCacheAndResponse(a,c,i);const{drapedObjectIds:l,failedObjectIds:u}=c,p=[];for(const o of t){const{objectId:t}=o;l.has(t)&&"edge"===o.type&&(o.draped=!0),u.has(t)||p.push(o)}return p}_prepareQuery(t){const e=[],n=[];for(const[a,o]of t){const t=[];for(const e of o)this._addToQueriesOrCachedResult(a,e.target,t,n),"edge"===e.type&&(this._addToQueriesOrCachedResult(a,e.start,t,n),this._addToQueriesOrCachedResult(a,e.end,t,n));0!==t.length&&e.push({objectId:a,points:t})}return[e,n,this._cacheVersion]}_addToQueriesOrCachedResult(t,e,n,a){const o=h(t,e),r=this._alignmentsCache.get(o);Object(i.l)(r)?a.push(new d(e,r)):n.push(e)}_applyCacheAndResponse(t,{elevations:e,drapedObjectIds:n,failedObjectIds:a},o){for(const s of o)s.apply();let i=0;const r=this._alignmentsCache;for(const{objectId:s,points:c}of t){if(a.has(s)){i+=c.length;continue}const t=!n.has(s);for(const n of c){const a=h(s,n),o=e[i++];n.z=o,t&&r.put(a,o,1)}}}}class d{constructor(t,e){this.point=t,this.z=e}apply(){this.point.z=this.z}}function h(t,{x:e,y:n,z:a}){return`${t}-${e}-${n}-${null!=a?a:0}}`}function g(){return[]}},1247:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));n(32);class a{filter(t,e){return e}notifyElevationSourceChange(){}}class o{filter(t,e){const{point:n,distance:a}=t,{z:o}=n;if(null==o)return e;if(0===e.length)return e;const r=function(t){return"number"==typeof t?{x:t,y:t,z:t}:t}(a),s=this._updateCandidatesTo3D(e,n,r).filter(i);return s.sort(l),s}_updateCandidatesTo3D(t,e,n){for(const a of t)switch(a.type){case"edge":s(a,e,n);continue;case"vertex":c(a,e,n);continue}return t}}function i(t){return t.distance<=1}function r(t=!1){return t?new o:new a}function s(t,e,{x:n,y:a,z:o}){const{start:i,end:r,target:s}=t;t.draped||function(t,e,n,a){const o=a.x-n.x,i=a.y-n.y,r=a.z-n.z,s=o*o+i*i+r*r,c=(e.x-n.x)*o+(e.y-n.y)*i+r*(e.z-n.z),l=Math.min(1,Math.max(0,c/s)),u=n.x+o*l,p=n.y+i*l,d=n.z+r*l;t.x=u,t.y=p,t.z=d}(s,e,i,r);const c=(e.x-s.x)/n,l=(e.y-s.y)/a,u=(e.z-s.z)/o;t.distance=Math.sqrt(c*c+l*l+u*u)}function c(t,e,{x:n,y:a,z:o}){const{target:i}=t,r=(e.x-i.x)/n,s=(e.y-i.y)/a,c=(e.z-i.z)/o,l=Math.sqrt(r*r+s*s+c*c);t.distance=l}function l(t,e){return t.distance-e.distance}},1248:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));n(32);var a=n(25),o=n(908),i=n(23),r=n(234);function s(t=!1,e){return t?new l(e):new c}class c{async fetch(){return[]}notifySymbologyChange(){}}class l{constructor(t){this._getSymbologyCandidates=t,this._candidatesCache=new o.a(1024),this._cacheVersion=0}async fetch(t,e){if(0===t.length)return[];const n=[],o=[],r=this._candidatesCache;for(const i of t){const t=u(i),e=r.get(t);if(e)for(const n of e)o.push(Object(a.a)(n));else n.push(i),r.put(t,[],1)}if(0===n.length)return o;const s=this._cacheVersion,{candidates:c,sourceCandidateIndices:l}=await this._getSymbologyCandidates(n,e);if(Object(i.q)(e),s!==this._cacheVersion)return this.fetch(t,e);const p=[],{length:d}=c;for(let i=0;i<d;++i){const t=c[i],e=u(n[l[i]]),o=r.get(e);o.push(t),r.put(e,o,o.length),p.push(Object(a.a)(t))}return o.concat(p)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function u(t){switch(t.type){case"vertex":{var e;const{objectId:n,target:a}=t,o=`${n}-vertex-${a.x}-${a.y}-${null!=(e=a.z)?e:0}`;return Object(r.b)(o).toString()}case"edge":{var n,a;const{objectId:e,start:o,end:i}=t,s=`${e}-edge-${o.x}-${o.y}-${null!=(n=o.z)?n:0}-to-${i.x}-${i.y}-${null!=(a=i.z)?a:0}`;return Object(r.b)(s).toString()}default:return""}}},1279:function(t,e,n){"use strict";n.d(e,"a",(function(){return p})),n.d(e,"b",(function(){return d}));var a=n(2),o=n(357),i=n(78),r=n(735),s=n(360);class c extends r.a{constructor(t){super({...t,constraint:new o.a(t.coordinateHelper,t.edgeStart,t.edgeEnd,t.getGroundElevation)})}get hints(){return[new s.a(i.a.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo,this.domain)]}}var l=n(925),u=n(1215);function p(t,e,n,a){switch(t.type){case"edge":return t.draped?new c({coordinateHelper:e,edgeStart:e.pointToVector(t.start),edgeEnd:e.pointToVector(t.end),targetPoint:e.pointToVector(t.target),objectId:t.objectId,getGroundElevation:a,elevationInfo:n}):new l.a({coordinateHelper:e,edgeStart:e.pointToVector(t.start),edgeEnd:e.pointToVector(t.end),targetPoint:e.pointToVector(t.target),objectId:t.objectId,elevationInfo:n});case"vertex":return new u.a({coordinateHelper:e,targetPoint:e.pointToVector(t.target),objectId:t.objectId,elevationInfo:n})}}function d(t){return Object(a.l)(t)&&"3d"===t.type?(e,n,a)=>t.elevationProvider.getElevation(e,n,a,t.spatialReference,"ground"):()=>null}}}]);
//# sourceMappingURL=73.731eb1a5.chunk.js.map