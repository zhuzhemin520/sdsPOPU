{"version":3,"sources":["../node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/sceneLayerSnappingUtils.js","../node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/SceneLayerSnappingSourceWorker.js"],"names":["a","t","e","i","c","m","n","s","o","r","j","constructor","this","_idToComponent","Map","_components","l","bounds","_edges","_tmpLineSegment","_tmpP1","d","_tmpP2","_tmpP3","remoteClient","async","Promise","resolve","_ensureEdgeLocations","forEachNeighbor","_addCandidates","length","result","candidates","info","id","uid","push","components","invoke","_setFetchEdgeLocations","E","set","add","get","component","remove","delete","f","createView","locations","Array","count","position0","getVec","position1","b","origin","C","objectIds","index","componentIndex","_addEdgeCandidate","_addVertexCandidate","types","g","EDGE","u","p","h","type","objectId","target","distance","start","end","VERTEX","y"],"mappings":"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","file":"static/js/260.030bf012.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{z as s,i as o,a as r}from\"../../../../../chunks/vec3.js\";import{c,g as n}from\"../../../../../chunks/sphere.js\";const t=1e3;function a(t,a,e){const i=c(),m=n(i);return s(m,m,t,.5),s(m,m,a,.5),i[3]=o(m,t),r(m,m,e),i}export{t as MAX_CANDIDATE_COUNT,a as boundsFromEdge};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import{isNone as t,unwrapOr as s}from\"../../../../../core/maybe.js\";import{throwIfAborted as o}from\"../../../../../core/promiseUtils.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/arrayUtils.js\";import\"../../../../../core/Error.js\";import\"../../../../../core/has.js\";import{subclass as n}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{a as i,i as r}from\"../../../../../chunks/vec3.js\";import{c as d,a as c}from\"../../../../../chunks/vec3f64.js\";import{create as a,fromPoints as p,projectPoint as m}from\"../../../../../geometry/support/lineSegment.js\";import{g as u,m as h}from\"../../../../../chunks/sphere.js\";import{SnappingTypes as g}from\"../../../../../layers/graphics/data/QueryEngineResult.js\";import l from\"../../../../3d/webgl-engine/lib/Octree.js\";import{extractComponentsEdgeLocationsLayout as f}from\"../../../../3d/webgl-engine/lib/edgeRendering/edgeProcessing.js\";import{MAX_CANDIDATE_COUNT as _,boundsFromEdge as b}from\"./sceneLayerSnappingUtils.js\";let j=class{constructor(){this._idToComponent=new Map,this._components=new l((e=>e.bounds)),this._edges=new l((e=>e.bounds)),this._tmpLineSegment=a(),this._tmpP1=d(),this._tmpP2=d(),this._tmpP3=d(),this.remoteClient=null}async fetchCandidates(e,t){await Promise.resolve(),o(t),await this._ensureEdgeLocations(e,t);const s=[];return this._edges.forEachNeighbor((t=>(this._addCandidates(e,t,s),s.length<_)),e.bounds),{result:{candidates:s}}}async _ensureEdgeLocations(e,o){const n=[];if(this._components.forEachNeighbor((e=>{if(t(e.info)){const{id:t,uid:s}=e;n.push({id:t,uid:s})}return!0}),e.bounds),!n.length)return;const i={components:n},r=await this.remoteClient.invoke(\"fetchAllEdgeLocations\",i,s(o,{}));for(const t of r.components)this._setFetchEdgeLocations(t)}async add(e){const t=new E(e.id,e.bounds);return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}}async remove(e){const t=this._idToComponent.get(e.id);if(t){const e=[];this._edges.forEachNeighbor((s=>(s.component===t&&e.push(s),!0)),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id)}return{result:{}}}_setFetchEdgeLocations(e){const s=this._idToComponent.get(e.id);if(t(s)||e.uid!==s.uid)return;const o=f.createView(e.locations),n=new Array(o.count),i=d(),r=d();for(let t=0;t<o.count;t++){o.position0.getVec(t,i),o.position1.getVec(t,r);const d=b(i,r,e.origin),c=new C(s,t,d);n[t]=c}this._edges.add(n);const{objectIds:c,origin:a}=e;s.info={locations:o,objectIds:c,origin:a}}_addCandidates(e,t,s){const{locations:o,origin:n,objectIds:r}=t.component.info,d=o.position0.getVec(t.index,this._tmpP1),c=o.position1.getVec(t.index,this._tmpP2);i(d,d,n),i(c,c,n);const a=r[o.componentIndex.get(t.index)];this._addEdgeCandidate(e,a,d,c,s),this._addVertexCandidate(e,a,d,s),this._addVertexCandidate(e,a,c,s)}_addEdgeCandidate(e,t,s,o,n){if(!(e.types&g.EDGE))return;const i=u(e.bounds),d=p(s,o,this._tmpLineSegment),a=m(d,i,this._tmpP3);if(!h(e.bounds,a))return null;n.push({type:\"edge\",objectId:t,target:c(a),distance:r(i,a),start:c(s),end:c(o)})}_addVertexCandidate(e,t,s,o){if(!(e.types&g.VERTEX))return;const n=u(e.bounds);if(!h(e.bounds,s))return null;o.push({type:\"vertex\",objectId:t,target:c(s),distance:r(n,s)})}};j=e([n(\"esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker\")],j);const y=j;class E{constructor(e,t){this.id=e,this.bounds=t,this.info=null,this.uid=++E.uid}}E.uid=0;class C{constructor(e,t,s){this.component=e,this.index=t,this.bounds=s}}export{y as default};\n"],"sourceRoot":""}