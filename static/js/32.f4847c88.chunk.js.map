{"version":3,"sources":["../node_modules/@arcgis/core/core/multiOriginJSONSupportUtils.js","../node_modules/@arcgis/core/portal/support/portalItemUtils.js","../node_modules/@arcgis/core/core/accessorSupport/originUtils.js","../node_modules/@arcgis/core/portal/support/jsonContext.js","../node_modules/@arcgis/core/layers/support/fetchService.js","../node_modules/@arcgis/core/layers/save/featureLayerUtils.js"],"names":["i","e","t","s","r","typeKeywords","push","includes","c","indexOf","splice","async","a","clone","normalize","length","o","width","n","spatialReference","isWGS84","isWebMercator","WGS84","f","DEVELOPER_BASEMAP","JSAPI","METADATA","MULTI_LAYER","SINGLE_LAYER","TABLE","writtenProperties","forEach","target","propName","newOrigin","originOf","updateOrigin","origin","url","itemUrl","portal","getDefault","portalItem","readResourcePaths","messages","layers","filter","serviceJSON","currentVersion","layersJSON","tables","type","responseType","query","customParameters","token","apiKey","data","I","getLogger","S","g","title","id","declaredClass","j","L","load","J","beforeSave","write","map","name","message","details","ignoreUnsupported","errors","P","N","layer","layerJSON","isTable","O","w","h","T","test","fetchData","l","u","p","A","y","itemResources","d","added","m","layerId","sourceJSON","find","loaded","defaultPopupTemplate","K","popupInfo","toJSON","U","x","$","removed","some","F","findIndex","R","dynamicDataSource","C","error","E","update","Y","Promise","all","Set","size","D","slice","reload","B","from","_","fullExtent","serverType","extent","v","b","q","_signIn","user","addItem","item","folder","z"],"mappings":"gIAIA,SAASA,EAAEA,GAAG,OAAOA,GAAG,gBAAgBA,GAAG,aAAaA,CAAC,CAJzD,iC,oCCAA,sMAI+W,SAASA,EAAEC,EAAEC,GAAG,IAAIC,EAAEF,EAAEC,GAAG,CAAC,MAAME,EAAEH,EAAEI,aAAaD,EAAEA,EAAEE,KAAKJ,GAAGD,EAAEI,aAAa,CAACH,EAAE,CAAC,CAAC,SAASC,EAAEF,EAAEC,GAAE,MAAC,QAAsB,OAAf,EAACD,EAAEI,gBAAF,EAAgBE,SAASL,GAAE,CAAC,SAASM,EAAEP,EAAEC,GAAG,MAAME,EAAEH,EAAEI,aAAa,GAAGD,EAAE,CAAC,MAAMH,EAAEG,EAAEK,QAAQP,GAAGD,GAAG,GAAGG,EAAEM,OAAOT,EAAE,EAAE,CAAC,CAACU,eAAeC,EAAEX,GAAG,MAAMC,EAAED,EAAEY,QAAQC,YAAY,IAAIV,EAAE,GAAGF,EAAEa,OAAO,EAAE,IAAI,MAAMC,KAAKd,EAAEE,EAAEY,EAAEC,MAAMb,EAAEa,QAAQb,EAAEY,GAAGZ,EAAEY,OAAOZ,EAAEF,EAAE,GAAG,OAArfS,eAAiBO,GAAG,MAAMlB,EAAEkB,EAAEC,iBAAiB,GAAGnB,EAAEoB,QAAQ,OAAOF,EAAEL,QAAQ,GAAGb,EAAEqB,cAAc,OAAOL,YAAEE,GAAG,MAAMf,EAAEC,IAAEkB,MAAM,aAAarB,YAAED,EAAEG,GAAGD,YAAEgB,EAAEf,EAAE,CAAsWe,CAAEd,EAAE,CAAC,MAAMmB,EAAE,CAACC,kBAAkB,mBAAmBC,MAAM,4BAA4BC,SAAS,WAAWC,YAAY,aAAaC,aAAa,cAAcC,MAAM,Q,oCCJv3B,gDAI2E,SAAS7B,EAAEA,GAAGA,GAAGA,EAAE8B,mBAAmB9B,EAAE8B,kBAAkBC,SAAS,EAAEC,OAAOhC,EAAEiC,SAAS/B,EAAEgC,UAAUjC,MAAMG,YAAEJ,IAAIC,GAAGD,EAAEmC,SAASjC,KAAKD,GAAGD,EAAEoC,aAAalC,EAAED,EAAE,GAAG,C,oCCJtO,yFAIiF,SAASA,EAAEA,GAAG,MAAM,CAACoC,OAAO,cAAcC,IAAIlC,YAAEH,EAAEsC,SAASC,OAAOvC,EAAEuC,QAAQtC,IAAEuC,aAAaC,WAAWzC,EAAE0C,kBAAkB,GAAG,CAAC,SAAS3B,EAAEf,GAAG,MAAM,CAACoC,OAAO,cAAcO,SAAS,GAAGd,kBAAkB,GAAGQ,IAAIrC,EAAEsC,QAAQnC,YAAEH,EAAEsC,SAAS,KAAKC,OAAOvC,EAAEuC,QAAQtC,IAAEuC,aAAaC,WAAWzC,EAAE,C,oCCJvW,iFAIgCU,eAAeP,EAAEH,EAAEG,GAAE,UAAC,IAAID,QAAQS,EAAEX,EAAEG,GAAGD,EAAEA,GAAG,CAAC,EAAEA,EAAE0C,QAAe,OAAR,EAAA1C,EAAE0C,aAAM,EAAR,EAAUC,OAAO5C,KAAI,GAAG,MAAMgB,EAAE,CAAC6B,YAAY5C,GAAG,IAAoB,OAAjB,EAACA,EAAE6C,gBAAc,EAAE,GAAG,KAAK,OAAO9B,EAAE,MAAMF,QAAQJ,EAAEX,EAAE,UAAUG,GAAG,OAAOc,EAAE+B,WAAW,CAACJ,QAAQ,MAAD7B,GAAS,OAAR,EAADA,EAAG6B,aAAF,EAAD,EAAWC,OAAO5C,KAAI,GAAGgD,QAAQ,MAADlC,OAAC,EAADA,EAAGkC,SAAQ,IAAIhC,CAAC,CAAC,SAAShB,EAAED,GAAG,OAAOA,EAAEkD,MAAM,kBAAkBlD,EAAEkD,IAAI,CAACxC,eAAeC,EAAER,EAAEF,GAAG,aAAaD,kBAAEG,EAAE,CAACgD,aAAa,OAAOC,MAAM,CAAC9B,EAAE,UAAW,MAADrB,OAAC,EAADA,EAAGoD,iBAAiBC,MAAO,MAADrD,OAAC,EAADA,EAAGsD,WAAWC,IAAI,C,oCCJ9c,2PAIk2B,MAAMC,EAAEtD,IAAEuD,UAAU,4BAA4BC,EAAE,kBAAkB,SAASC,EAAE5D,EAAEC,GAAG,MAAO,iBAAgBD,EAAE6D,cAAc7D,EAAE8D,gBAAgB9D,EAAE+D,kBAAkB9D,GAAG,CAAC,SAAS+D,EAAEhE,EAAEG,GAAG,GAAGA,EAAE+C,OAAOS,EAAE,MAAM,IAAI1D,IAAE,uCAAuC2D,EAAE5D,EAAG,oCAAmC2D,MAAM,CAACjD,eAAeuD,EAAEjE,GAAG,SAASA,EAAEkE,OAAO3D,YAAEP,GAAG,MAAM,IAAIC,IAAE,qBAAqB2D,EAAE5D,EAAE,8DAA8D,CAAyeU,eAAeyD,EAAEnE,EAAEC,EAAEE,GAAG,eAAeH,GAAG,mBAAmBA,EAAEoE,kBAAkBpE,EAAEoE,aAAa,MAAMzD,EAAEX,EAAEqE,MAAM,CAAC,EAAEpE,GAAG,OAA9lB,SAAWD,EAAEG,GAAE,MAAC,IAAIQ,GAAa,OAAX,EAACX,EAAE2C,UAAQ,EAAE,IAAIE,QAAQ,EAAEK,KAAKlD,KAAK,UAAUA,IAAIsE,KAAK,EAAEC,KAAKvE,EAAEwE,QAAQrE,EAAEsE,QAAQ9D,KAAK,IAAIV,IAAED,EAAEG,EAAEQ,KAAK,GAAI,MAADR,KAAGuE,oBAAoB/D,EAAEA,EAAEkC,QAAQ,EAAE0B,KAAKvE,KAAK,sBAAsBA,GAAG,uBAAuBA,GAAG,6BAA6BA,GAAG,yBAAyBA,GAAG,oBAAoBA,KAAKW,EAAEG,OAAO,EAAE,MAAM,IAAIb,IAAE,qBAAqB,yHAAyH,CAAC0E,OAAOhE,GAAG,CAA8HiE,CAAE3E,EAAEE,GAAGQ,CAAC,CAAC,SAASkE,EAAE7E,GAAG,MAAM8E,MAAM7E,EAAE8E,UAAU5E,GAAGH,EAAE,OAAOC,EAAE+E,QAAQ,CAACpC,OAAO,GAAGK,OAAO,CAAC9C,IAAI,CAACyC,OAAO,CAACzC,GAAG8C,OAAO,GAAG,CAAC,SAASgC,EAAEjF,GAAGkF,YAAElF,EAAEmF,IAAE3D,OAAOxB,EAAEI,eAAeJ,EAAEI,aAAaJ,EAAEI,aAAayC,QAAQ,CAAC7C,EAAEC,EAAEE,IAAIA,EAAEK,QAAQR,KAAKC,IAAI,CAAgWS,eAAe0E,EAAEpF,EAAEC,GAAE,MAAC,MAAM,YAAYoF,KAAU,OAAN,EAACrF,EAAEqC,KAAG,EAAE,IAAIwC,EAAE5E,EAAE,IAAWS,eAAiBV,EAAEC,GAAG,MAAM6E,OAAOzC,IAAIlC,EAAEkD,iBAAiB1C,EAAE4C,OAAOxC,IAAId,EAAE,GAAG,IAAIC,QAAQF,EAAEsF,UAAU,QAAQpF,GAAG,MAAMA,EAAE0C,QAAQ,MAAM1C,EAAE+C,SAAS/C,QAAqIQ,eAAiBV,EAAEC,EAAEE,GAAG,IAAIQ,EAAEI,EAAEf,IAAIA,EAAE,CAAC,IAAIW,EAAEX,GAAG4C,SAASjC,EAAEiC,OAAO,KAAK7B,EAAEf,GAAGiD,SAASlC,EAAEkC,OAAO,IAAI,MAAMZ,IAAInC,EAAEmD,iBAAiBkC,EAAEhC,OAAOxD,GAAGE,GAAG6C,YAAY7B,EAAE+B,WAAWwC,SAASC,YAAEvF,EAAE,CAACmD,iBAAiBkC,EAAEhC,OAAOxD,IAAIQ,EAAEmF,EAAE1F,EAAE4C,OAAO3B,EAAE2B,OAAOzC,GAAGwF,EAAED,EAAE1F,EAAEiD,OAAOhC,EAAEgC,OAAO9C,GAAGH,EAAE4C,OAAOrC,EAAEqF,cAAc5F,EAAEiD,OAAO0C,EAAEC,cAAc,MAAMC,EAAE,IAAItF,EAAEuF,SAASH,EAAEG,OAAOC,EAAEP,EAAE,IAAIA,EAAE5C,UAAU4C,EAAEvC,QAAQ,GAAG,aAAyRvC,eAAiBV,EAAEC,EAAEE,EAAEY,GAAG,MAAMb,EAAED,EAAEqE,KAAK,EAAER,GAAG9D,KAAK,IAAIiB,UAAE,CAACoB,IAAIlC,EAAE6F,QAAQhG,EAAEiG,WAAWlF,EAAEmF,MAAM,EAAEpC,GAAG7D,KAAKA,IAAID,cAAcuF,YAAErF,EAAEoE,KAAKtE,GAAGA,EAAEkE,UAAUhE,EAAE4B,SAAS7B,IAAI,MAAM+F,QAAQ7F,EAAEgG,OAAOpF,EAAEqF,qBAAqBlG,GAAGD,EAAMc,IAAGJ,YAAET,IAAUmG,EAAEpG,EAAE,CAAC6D,GAAG3D,EAAEmG,UAAUpG,EAAEqG,UAAUvG,EAAE,GAAG,CAAvhBwG,CAAExG,EAAE6F,EAAE3F,EAAE6F,GAAG/F,CAAC,CAA9gByG,CAAEvG,EAAE,CAACmC,IAAK,MAADlC,IAAG,GAAGkD,iBAAiB1C,EAAE4C,OAAOxC,GAAGd,EAAEqE,KAAKtE,GAAGA,EAAE8E,MAAMkB,YAAY,IAAI,MAAMT,KAAKtF,EAAEoG,EAAEd,EAAET,MAAMS,EAAER,UAAU7E,GAAG,OAAOA,CAAC,CAA3RwG,CAAE1G,EAAEC,EAAE,CAAwqB,SAASyF,EAAEzF,EAAEE,EAAEQ,GAAG,MAAMI,EAAEf,YAAEC,EAAEE,GAAG,CAACH,EAAEC,IAAID,EAAE8D,KAAK7D,EAAE6D,KAAK7D,EAAEA,EAAE4C,QAAQ7C,IAAIe,EAAE4F,QAAQC,MAAM3G,GAAGA,EAAE6D,KAAK9D,EAAE8D,OAAO,MAAM5D,EAAEa,EAAE+E,MAAMxB,KAAK,EAAER,GAAG9D,MAAE,CAAK8D,GAAG9D,MAAM,OAAOE,EAAE4B,SAAS,EAAEgC,GAAG9D,MAAMC,EAAEI,KAAK,CAACyD,GAAG9D,GAAG,IAAI,CAAC4F,cAAc3F,EAAE6F,MAAM5F,EAAE2C,QAAQ,EAAEiB,GAAG9D,MAAMW,EAAEL,SAASN,KAAK,CAA6Q,SAASqG,EAAErG,EAAEC,EAAEE,GAAGH,EAAEgF,QAAQ6B,EAAE1G,EAAE8C,OAAOhD,GAAG4G,EAAE1G,EAAEyC,OAAO3C,EAAE,CAAC,SAAS4G,EAAE7G,EAAEC,GAAG,IAAID,EAAE,OAAO,MAAMG,EAAEH,EAAE8G,WAAW,EAAEhD,GAAG9D,KAAKA,IAAIC,EAAE6D,MAAM,IAAI3D,EAAEH,EAAEK,KAAKJ,GAAGD,EAAEG,GAAGF,CAAC,CAAC,SAAS8G,EAAE/G,GAAG,MAAMyC,WAAWxC,GAAGD,EAAE,OAAO2F,YAAE3F,KAAKA,EAAEgH,qBAAsB,MAAD/G,MAAGkG,SAAQlG,EAAEiD,OAAOS,CAAC,CAA03C,MAAMsD,EAAE/G,aAAKQ,eAAiBV,EAAEC,SAASgE,EAAEjE,GAAlvG,SAAWA,GAAG,MAAMG,EAAEH,EAAEyC,WAAW,IAAItC,EAAE,MAAMsD,EAAEyD,MAAM,oDAAoD,IAAIjH,IAAE,oCAAoC2D,EAAE5D,EAAE,+CAA+C,IAAIG,EAAEgG,OAAO,MAAM,IAAIlG,IAAE,uCAAuC2D,EAAE5D,EAAE,4EAA4EgE,EAAEhE,EAAEG,EAAE,CAAu5FgH,CAAEnH,GAAG,MAAMG,EAAEH,EAAEyC,WAAW9B,EAAEW,YAAEnB,GAAGY,QAAQoD,EAAEnE,EAAEW,EAAEV,GAAGC,QAAQkF,EAAEjF,EAAE,CAAC,CAAC2E,MAAM9E,EAAE+E,UAAUhE,KAAK,OAAOkE,EAAE9E,SAASA,EAAEiH,OAAO,CAAC5D,KAAKtD,IAAIH,YAAEY,GAAGR,CAAC,IAAC,MAAMkH,EAAEnH,aAAGQ,MAAMV,EAAEC,WAA7jDS,eAAiBV,GAAG,GAAK,MAADA,MAAGc,OAAO,MAAM,IAAIb,IAAE,iDAAiD,kEAAkEqH,QAAQC,IAAIvH,EAAEsE,KAAKtE,GAAGA,EAAEkE,UAAU,IAAI,MAAMnD,KAAKf,EAAE,IAAI+G,EAAEhG,GAAG,MAAM,IAAId,IAAE,iDAAkD,gHAA+G2D,EAAE7C,EAAE,sBAAsB,CAAC+D,MAAM/D,IAAI,MAAMZ,EAAEH,EAAEsE,KAAKtE,GAAGA,EAAEyC,WAAWqB,KAAK,GAAG,IAAI0D,IAAIrH,GAAGsH,KAAK,EAAE,MAAM,IAAIxH,IAAE,iDAAiD,+EAA+E,MAAMU,EAAEX,EAAEsE,KAAKtE,GAAGA,EAAEgG,UAAU,GAAG,IAAIwB,IAAI7G,GAAG8G,OAAO9G,EAAEG,OAAO,MAAM,IAAIb,IAAE,iDAAiD,8FAA8F,CAA6vByH,CAAE1H,GAAG,MAAMG,EAAEH,EAAE,GAAGyC,WAAW9B,EAAEW,YAAEnB,GAAGY,QAAQuG,QAAQC,IAAIvH,EAAEsE,KAAKtE,GAAGmE,EAAEnE,EAAEW,EAAEV,MAAMC,QAAQkF,EAAEjF,EAAEH,EAAEsE,KAAK,CAACtE,EAAEC,KAAC,CAAK6E,MAAM9E,EAAE+E,UAAUhE,EAAEd,QAAQ,OAAOgF,EAAE9E,SAASA,EAAEiH,OAAO,CAAC5D,KAAKtD,UAAUoH,QAAQC,IAAIvH,EAAE2H,MAAM,GAAGrD,KAAKtE,GAAGA,EAAEyC,WAAWmF,YAAY7H,YAAEY,GAAGR,EAAES,OAAO,IAAIiH,EAAE3H,aAAKQ,eAAiBV,EAAEC,EAAEE,SAAS8D,EAAEjE,GAAG,MAAMW,EAAviC,SAAWX,EAAEC,GAAE,IAAKE,EAAEQ,EAAE,IAAII,EAAEgF,UAAE+B,KAAK7H,GAAG,OAAOc,EAAE+C,KAAK/C,EAAEA,EAAEH,QAAQG,EAAE+C,GAAG,MAAgB,OAAT3D,EAAEY,GAAGmC,OAAO/C,EAAE+C,KAAKS,GAAe,OAAXhD,EAAEI,GAAGwB,SAAS5B,EAAE4B,OAAOsD,IAAErD,cAAcwB,EAAEhE,EAAEe,GAAGA,CAAC,CAAq5BgH,CAAE/H,EAAEC,GAAGc,EAAEO,YAAEX,GAAGT,EAAE2E,EAAE,CAACC,MAAM9E,EAAE+E,gBAAgBZ,EAAEnE,EAAEe,EAAEZ,KAAK,aAA18BO,eAAiBV,EAAEC,GAAG,MAAMoC,IAAIlC,EAAE6F,QAAQrF,EAAEkD,MAAM3D,EAAE8H,WAAWzC,EAAEP,QAAQjF,GAAGC,EAAEiB,EAAEuE,YAAErF,GAAGsF,EAAE1E,YAAEE,IAAI,kBAAkBA,EAAEgH,WAAWhI,EAAEoC,IAAIoD,EAAEtF,EAAG,GAAEA,KAAKQ,IAAIV,EAAE4D,QAAQ5D,EAAE4D,MAAM3D,GAAGD,EAAEiI,OAAO,MAAMnI,GAAGgB,YAAEwE,KAAKtF,EAAEiI,aAAaC,YAAE5C,IAAI6C,YAAEnI,EAAEkF,IAAE1D,UAAU2G,YAAEnI,EAAEkF,IAAEzD,aAAawD,YAAEjF,EAAEkF,IAAExD,cAAc5B,GAAGmF,YAAEjF,EAAEkF,IAAEvD,OAAOqD,EAAEhF,EAAE,CAAurBoI,CAAErI,EAAEW,SAA1rBD,eAAiBV,EAAEC,EAAEE,GAAE,MAAC,MAAMQ,EAAEX,EAAEuC,aAAc,MAAD5B,OAAC,EAADA,EAAG2H,iBAAkB,MAAD3H,GAAO,OAAN,EAADA,EAAG4H,WAAF,EAAD,EAASC,QAAQ,CAACC,KAAKzI,EAAEwD,KAAKvD,EAAEyI,OAAQ,MAADvI,OAAC,EAADA,EAAGuI,SAAS,CAA6kBC,CAAEhI,EAAET,EAAEC,GAAGH,EAAEyC,WAAW9B,EAAEZ,YAAEgB,GAAGJ,CAAC,G","file":"static/js/32.f4847c88.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nfunction i(i){return i&&\"getAtOrigin\"in i&&\"originOf\"in i}export{i as isMultiOriginJSONMixin};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{initializeProjection as e,project as t}from\"../../geometry/projection.js\";import r from\"../../geometry/SpatialReference.js\";import{webMercatorToGeographic as o}from\"../../geometry/support/webMercatorUtils.js\";async function n(n){const i=n.spatialReference;if(i.isWGS84)return n.clone();if(i.isWebMercator)return o(n);const s=r.WGS84;return await e(i,s),t(n,s)}function i(e,t){if(!s(e,t)){const r=e.typeKeywords;r?r.push(t):e.typeKeywords=[t]}}function s(e,t){return!!e.typeKeywords?.includes(t)}function c(e,t){const r=e.typeKeywords;if(r){const e=r.indexOf(t);e>-1&&r.splice(e,1)}}async function a(e){const t=e.clone().normalize();let r;if(t.length>1)for(const o of t)r?o.width>r.width&&(r=o):r=o;else r=t[0];return n(r)}const f={DEVELOPER_BASEMAP:\"DeveloperBasemap\",JSAPI:\"ArcGIS API for JavaScript\",METADATA:\"Metadata\",MULTI_LAYER:\"Multilayer\",SINGLE_LAYER:\"Singlelayer\",TABLE:\"Table\"};export{f as TypeKeyword,i as addTypeKeyword,a as getWGS84ExtentForItem,s as hasTypeKeyword,c as removeTypeKeyword};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{isMultiOriginJSONMixin as r}from\"../multiOriginJSONSupportUtils.js\";function i(i){i&&i.writtenProperties&&i.writtenProperties.forEach((({target:i,propName:t,newOrigin:e})=>{r(i)&&e&&i.originOf(t)!==e&&i.updateOrigin(t,e)}))}export{i as updateOrigins};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{urlToObject as r}from\"../../core/urlUtils.js\";import t from\"../Portal.js\";function e(e){return{origin:\"portal-item\",url:r(e.itemUrl),portal:e.portal||t.getDefault(),portalItem:e,readResourcePaths:[]}}function o(e){return{origin:\"portal-item\",messages:[],writtenProperties:[],url:e.itemUrl?r(e.itemUrl):null,portal:e.portal||t.getDefault(),portalItem:e}}export{e as createForItemRead,o as createForItemWrite};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport e from\"../../request.js\";async function r(e,r){let s=await a(e,r);s=s||{},s.layers=s.layers?.filter(t)||[];const n={serviceJSON:s};if((s.currentVersion??0)<10.5)return n;const o=await a(e+\"/layers\",r);return n.layersJSON={layers:o?.layers?.filter(t)||[],tables:o?.tables||[]},n}function t(e){return!e.type||\"Feature Layer\"===e.type}async function a(r,t){return(await e(r,{responseType:\"json\",query:{f:\"json\",...t?.customParameters,token:t?.apiKey}})).data}export{r as fetchFeatureService,a as fetchService};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{difference as e}from\"../../core/arrayUtils.js\";import t from\"../../core/Error.js\";import r from\"../../core/Logger.js\";import{isNone as a,isSome as o}from\"../../core/maybe.js\";import{debounce as s,eachAlways as l}from\"../../core/promiseUtils.js\";import{updateOrigins as i}from\"../../core/accessorSupport/originUtils.js\";import n from\"../FeatureLayer.js\";import{parse as u}from\"../support/arcgisLayerUrl.js\";import{fetchFeatureService as p}from\"../support/fetchService.js\";import{isFeatureCollectionLayer as c,isFeatureServiceLayer as y}from\"../support/layerUtils.js\";import d from\"../../portal/Portal.js\";import m from\"../../portal/PortalItem.js\";import{createForItemWrite as f}from\"../../portal/support/jsonContext.js\";import{addTypeKeyword as w,TypeKeyword as h,getWGS84ExtentForItem as v,removeTypeKeyword as b}from\"../../portal/support/portalItemUtils.js\";const I=r.getLogger(\"esri.layers.FeatureLayer\"),S=\"Feature Service\";function g(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function j(e,r){if(r.type!==S)throw new t(\"feature-layer:portal-item-wrong-type\",g(e,`should have portal item of type \"${S}\"`))}async function L(e){if(await e.load(),c(e))throw new t(\"feature-layer:save\",g(e,\"using an in-memory source cannot be saved to a portal item\"))}function P(e,r){let a=(e.messages??[]).filter((({type:e})=>\"error\"===e)).map((({name:e,message:r,details:a})=>new t(e,r,a)));if(r?.ignoreUnsupported&&(a=a.filter((({name:e})=>\"layer:unsupported\"!==e&&\"symbol:unsupported\"!==e&&\"symbol-layer:unsupported\"!==e&&\"property:unsupported\"!==e&&\"url:unsupported\"!==e))),a.length>0)throw new t(\"feature-layer:save\",\"Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information\",{errors:a})}async function J(e,t,r){\"beforeSave\"in e&&\"function\"==typeof e.beforeSave&&await e.beforeSave();const a=e.write({},t);return P(t,r),a}function N(e){const{layer:t,layerJSON:r}=e;return t.isTable?{layers:[],tables:[r]}:{layers:[r],tables:[]}}function O(e){w(e,h.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}function E(e){const r=e.portalItem;if(!r)throw I.error(\"save: requires the portalItem property to be set\"),new t(\"feature-layer:portal-item-not-set\",g(e,\"requires the portalItem property to be set\"));if(!r.loaded)throw new t(\"feature-layer:portal-item-not-loaded\",g(e,\"cannot be saved to a portal item that does not exist or is inaccessible\"));j(e,r)}async function T(e,t){return/\\/\\d+\\/?$/.test(e.url??\"\")?N(t[0]):$(e,t)}async function $(e,t){const{layer:{url:r,customParameters:a,apiKey:o}}=t[0];let s=await e.fetchData(\"json\");s&&null!=s.layers&&null!=s.tables||(s=await x(s,{url:r??\"\",customParameters:a,apiKey:o},t.map((e=>e.layer.layerId))));for(const l of t)K(l.layer,l.layerJSON,s);return s}async function x(e,t,r){var a,o;e||(e={}),(a=e).layers||(a.layers=[]),(o=e).tables||(o.tables=[]);const{url:s,customParameters:l,apiKey:i}=t,{serviceJSON:n,layersJSON:u}=await p(s,{customParameters:l,apiKey:i}),c=A(e.layers,n.layers,r),y=A(e.tables,n.tables,r);e.layers=c.itemResources,e.tables=y.itemResources;const d=[...c.added,...y.added],m=u?[...u.layers,...u.tables]:[];return await U(e,d,s,m),e}function A(t,r,a){const o=e(t,r,((e,t)=>e.id===t.id));t=t.filter((e=>!o.removed.some((t=>t.id===e.id))));const s=o.added.map((({id:e})=>({id:e})));return s.forEach((({id:e})=>{t.push({id:e})})),{itemResources:t,added:s.filter((({id:e})=>!a.includes(e)))}}async function U(e,t,r,o){const s=t.map((({id:e})=>new n({url:r,layerId:e,sourceJSON:o.find((({id:t})=>t===e))})));await l(s.map((e=>e.load()))),s.forEach((t=>{const{layerId:r,loaded:o,defaultPopupTemplate:s}=t;if(!o||a(s))return;K(t,{id:r,popupInfo:s.toJSON()},e)}))}function K(e,t,r){e.isTable?F(r.tables,t):F(r.layers,t)}function F(e,t){if(!e)return;const r=e.findIndex((({id:e})=>e===t.id));-1===r?e.push(t):e[r]=t}function R(e){const{portalItem:t}=e;return y(e)&&!e.dynamicDataSource&&!!t?.loaded&&t.type===S}async function D(e){if(!e?.length)throw new t(\"feature-layer-utils-saveall:missing-parameters\",\"'layers' array should contain at least one feature layer\");await Promise.all(e.map((e=>e.load())));for(const o of e)if(!R(o))throw new t(\"feature-layer-utils-saveall:invalid-parameters\",`'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ${g(o,\"does not conform\")}`,{layer:o});const r=e.map((e=>e.portalItem.id));if(new Set(r).size>1)throw new t(\"feature-layer-utils-saveall:invalid-parameters\",\"All layers in the 'layers' array should be loaded from the same portal item\");const a=e.map((e=>e.layerId));if(new Set(a).size!==a.length)throw new t(\"feature-layer-utils-saveall:invalid-parameters\",\"'layers' array should contain only one instance each of layer or table in a feature service\")}function _(e,t){var r,a;let o=m.from(t);return o.id&&(o=o.clone(),o.id=null),(r=o).type??(r.type=S),(a=o).portal??(a.portal=d.getDefault()),j(e,o),o}async function q(e,t){const{url:r,layerId:a,title:s,fullExtent:l,isTable:i}=e,n=u(r),p=o(n)&&\"FeatureServer\"===n.serverType;t.url=p?r:`${r}/${a}`,t.title||(t.title=s),t.extent=null,!i&&o(l)&&(t.extent=await v(l)),b(t,h.METADATA),b(t,h.MULTI_LAYER),w(t,h.SINGLE_LAYER),i&&w(t,h.TABLE),O(t)}async function z(e,t,r){const a=e.portal;await(a?._signIn()),await(a?.user?.addItem({item:e,data:t,folder:r?.folder}))}const C=s(M);async function M(e,t){await L(e),E(e);const r=e.portalItem,a=f(r),o=await J(e,a,t),s=await T(r,[{layer:e,layerJSON:o}]);return O(r),await r.update({data:s}),i(a),r}const Y=s((async(e,t)=>{await D(e);const r=e[0].portalItem,a=f(r),o=await Promise.all(e.map((e=>J(e,a,t)))),s=await T(r,e.map(((e,t)=>({layer:e,layerJSON:o[t]}))));return O(r),await r.update({data:s}),await Promise.all(e.slice(1).map((e=>e.portalItem.reload()))),i(a),r.clone()})),B=s(G);async function G(e,t,r){await L(e);const a=_(e,t),o=f(a),s=N({layer:e,layerJSON:await J(e,o,r)});return await q(e,a),await z(a,s,r),e.portalItem=a,i(o),a}export{C as save,Y as saveAll,B as saveAs};\n"],"sourceRoot":""}