{"version":3,"sources":["../node_modules/@arcgis/core/geometry/support/meshUtils/loadGLTFMesh.js"],"names":["async","W","e","t","r","o","S","resolveFile","busy","request","s","i","a","responseType","signal","n","data","X","N","model","lods","shift","Map","c","textures","forEach","set","d","wrap","ae","parameters","te","materials","f","ue","le","color","opacity","emissiveFactor","l","fe","p","colorTexture","textureColor","get","normalTexture","textureNormal","emissiveColor","emissiveTexture","textureEmissive","occlusionTexture","textureOcclusion","alphaMode","ie","alphaCutoff","doubleSided","metallic","metallicFactor","roughness","roughnessFactor","metallicRoughnessTexture","textureMetallicRoughness","colorTextureTransform","normalTextureTransform","occlusionTextureTransform","emissiveTextureTransform","metallicRoughnessTextureTransform","re","u","has","tangent","normal","texCoord0","parts","attributes","position","Y","Z","transform","m","start","length","count","push","gltf","writeVertices","region","vertexAttributes","$","j","w","x","T","y","components","ee","oe","typedBuffer","uv","L","spatialReference","g","buffer","size","byteOffset","byteLength","toString","A","slice","M","C","q","dstIndex","k","B","K","H","J","elementCount","F","Q","h","I","v","fromTypedArray","typedBufferStride","R","z","b","E","ne","U","TRIANGLES","D","G","TRIANGLE_STRIP","_","TRIANGLE_FAN","O","se","indices","primitiveType","faces","material","trustSourceNormals","horizontal","ce","vertical","V","CLAMP_TO_EDGE","MIRRORED_REPEAT","REPEAT","P"],"mappings":"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","file":"static/js/43.16eed891.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport e from\"../../../Color.js\";import t from\"../../../request.js\";import{getOrCreateMapValue as r}from\"../../../core/MapUtils.js\";import{hasScaling as o}from\"../../../core/mathUtils.js\";import{isSome as n,unwrap as s,applySome as i,isNone as a}from\"../../../core/maybe.js\";import{b as c}from\"../../../chunks/mat3.js\";import{c as u}from\"../../../chunks/mat3f64.js\";import{f as l}from\"../../../chunks/vec3f64.js\";import{f}from\"../../../chunks/vec4f64.js\";import m from\"../MeshComponent.js\";import p from\"../MeshMaterialMetallicRoughness.js\";import d from\"../MeshTexture.js\";import{MeshVertexAttributes as g}from\"../MeshVertexAttributes.js\";import{BufferViewVec4f as x,BufferViewVec4u8 as T,BufferViewVec4u16 as h,BufferViewVec3u8 as v,BufferViewVec3f as w,BufferViewVec3u16 as b,BufferViewVec3f64 as j,BufferViewVec2f as y}from\"../buffer/BufferView.js\";import{t as A,a as M,n as C,s as R,b as E}from\"../../../chunks/vec32.js\";import{t as k,n as B,s as F,a as I}from\"../../../chunks/vec42.js\";import{createBuffer as $}from\"../buffer/utils.js\";import{georeferenceByTransform as L}from\"./georeference.js\";import{DefaultLoadingContext as S}from\"../../../views/3d/glTF/DefaultLoadingContext.js\";import{loadGLTF as N}from\"../../../views/3d/glTF/loader.js\";import{triangleFanToTriangles as O,triangleStripToTriangles as _,trianglesToTriangles as D}from\"../../../views/3d/glTF/internal/indexUtils.js\";import{generateIndexArray as G}from\"../../../views/3d/webgl-engine/lib/Indices.js\";import{COLOR_GAMMA as P}from\"../../../views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA.js\";import{PrimitiveType as U,TextureWrapMode as V}from\"../../../views/webgl/enums.js\";import{f as q,c as z}from\"../../../chunks/vec33.js\";import{f as K,c as Q}from\"../../../chunks/vec43.js\";import{n as H,f as J}from\"../../../chunks/vec22.js\";async function W(e,t,r){const o=new S(X(r)),s=(await N(o,t,r,!0)).model,i=s.lods.shift(),a=new Map,c=new Map;s.textures.forEach(((e,t)=>a.set(t,te(e)))),s.materials.forEach(((e,t)=>c.set(t,re(e,a))));const u=ee(i);for(const n of u.parts)oe(u,n,c);const{position:l,normal:f,tangent:m,color:p,texCoord0:d}=u.vertexAttributes,x={position:l.typedBuffer,normal:n(f)?f.typedBuffer:null,tangent:n(m)?m.typedBuffer:null,uv:n(d)?d.typedBuffer:null,color:n(p)?p.typedBuffer:null},T=L(x,e,r);return{transform:T.transform,components:u.components,spatialReference:e.spatialReference,vertexAttributes:new g({position:T.vertexAttributes.position,normal:T.vertexAttributes.normal,tangent:T.vertexAttributes.tangent,color:x.color,uv:x.uv})}}function X(e){const r=e?.resolveFile;return r?{busy:!1,request:async(e,o,s)=>{const i=r(e),a=\"image\"===o?\"image\":\"binary\"===o?\"array-buffer\":\"json\";return(await t(i,{responseType:a,signal:n(s)?s.signal:null})).data}}:null}function Y(e,t){if(a(e))return\"-\";const o=e.typedBuffer;return`${r(t,o.buffer,(()=>t.size))}/${o.byteOffset}/${o.byteLength}`}function Z(e){return n(e)?e.toString():\"-\"}function ee(e){let t=0;const has={color:!1,tangent:!1,normal:!1,texCoord0:!1},o=new Map,n=new Map,s=[];for(const i of e.parts){const{attributes:{position:e,normal:a,color:c,tangent:u,texCoord0:l}}=i,f=`\\n      ${Y(e,o)}/\\n      ${Y(a,o)}/\\n      ${Y(c,o)}/\\n      ${Y(u,o)}/\\n      ${Y(l,o)}/\\n      ${Z(i.transform)}\\n    `;let m=!1;const p=r(n,f,(()=>(m=!0,{start:t,length:e.count})));m&&(t+=e.count),a&&(has.normal=!0),c&&(has.color=!0),u&&(has.tangent=!0),l&&(has.texCoord0=!0),s.push({gltf:i,writeVertices:m,region:p})}return{vertexAttributes:{position:$(j,t),normal:has.normal?$(w,t):null,tangent:has.tangent?$(x,t):null,color:has.color?$(T,t):null,texCoord0:has.texCoord0?$(y,t):null},parts:s,components:[]}}function te(e){return new d({data:e.data,wrap:ae(e.parameters.wrap)})}function re(t,r){const o=new e(le(t.color,t.opacity)),n=t.emissiveFactor?new e(fe(t.emissiveFactor)):null;return new p({color:o,colorTexture:s(i(t.textureColor,(e=>r.get(e)))),normalTexture:s(i(t.textureNormal,(e=>r.get(e)))),emissiveColor:n,emissiveTexture:s(i(t.textureEmissive,(e=>r.get(e)))),occlusionTexture:s(i(t.textureOcclusion,(e=>r.get(e)))),alphaMode:ie(t.alphaMode),alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,metallic:t.metallicFactor,roughness:t.roughnessFactor,metallicRoughnessTexture:s(i(t.textureMetallicRoughness,(e=>r.get(e)))),colorTextureTransform:t.colorTextureTransform,normalTextureTransform:t.normalTextureTransform,occlusionTextureTransform:t.occlusionTextureTransform,emissiveTextureTransform:t.emissiveTextureTransform,metallicRoughnessTextureTransform:t.metallicRoughnessTextureTransform})}function oe(e,t,r){t.writeVertices&&ne(e,t);const o=t.gltf,n=se(o.indices||o.attributes.position.count,o.primitiveType),s=t.region.start;if(s)for(let i=0;i<n.length;i++)n[i]+=s;e.components.push(new m({faces:n,material:r.get(o.material),trustSourceNormals:!0}))}function ne(e,t){const{position:r,normal:s,tangent:i,color:a,texCoord0:l}=e.vertexAttributes,f=t.region.start,{attributes:m,transform:p}=t.gltf,d=m.position.count;if(A(r.slice(f,d),m.position,p),n(m.normal)&&n(s)){const e=c(u(),p),t=s.slice(f,d);M(t,m.normal,e),o(e)&&C(t,t)}else n(s)&&q(s,0,0,1,{dstIndex:f,count:d});if(n(m.tangent)&&n(i)){const e=c(u(),p),t=i.slice(f,d);k(t,m.tangent,e),o(e)&&B(t,t)}else n(i)&&K(i,0,0,1,1,{dstIndex:f,count:d});if(n(m.texCoord0)&&n(l)?H(l.slice(f,d),m.texCoord0):n(l)&&J(l,0,0,{dstIndex:f,count:d}),n(m.color)&&n(a)){const e=m.color,t=a.slice(f,d);if(4===e.elementCount)e instanceof x?F(t,e,255):e instanceof T?Q(t,e):e instanceof h&&I(t,e,8);else{K(t,255,255,255,255);const r=v.fromTypedArray(t.typedBuffer,t.typedBufferStride);e instanceof w?R(r,e,255):e instanceof v?z(r,e):e instanceof b&&E(r,e,8)}}else n(a)&&K(a.slice(f,d),255,255,255,255)}function se(e,t){switch(t){case U.TRIANGLES:return D(e,G);case U.TRIANGLE_STRIP:return _(e);case U.TRIANGLE_FAN:return O(e)}}function ie(e){switch(e){case\"OPAQUE\":return\"opaque\";case\"MASK\":return\"mask\";case\"BLEND\":return\"blend\"}}function ae(e){return{horizontal:ce(e.s),vertical:ce(e.t)}}function ce(e){switch(e){case V.CLAMP_TO_EDGE:return\"clamp\";case V.MIRRORED_REPEAT:return\"mirror\";case V.REPEAT:return\"repeat\"}}function ue(e){return e**(1/P)*255}function le(e,t){return f(ue(e[0]),ue(e[1]),ue(e[2]),t)}function fe(e){return l(ue(e[0]),ue(e[1]),ue(e[2]))}export{W as loadGLTFMesh};\n"],"sourceRoot":""}