(this["webpackJsonppopulation-arcgis"]=this["webpackJsonppopulation-arcgis"]||[]).push([[260],{1084:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return m}));var s=n(0),o=n(2),i=n(23),c=(n(22),n(12),n(17),n(16),n(32),n(10)),d=n(5),r=n(9),a=n(189),u=n(79),b=n(883),h=n(350),p=n(775);function g(t,e,n){const s=Object(u.c)(),o=Object(u.g)(s);return Object(d.I)(o,o,t,.5),Object(d.I)(o,o,e,.5),s[3]=Object(d.r)(o,t),Object(d.j)(o,o,n),s}let j=class{constructor(){this._idToComponent=new Map,this._components=new h.a((t=>t.bounds)),this._edges=new h.a((t=>t.bounds)),this._tmpLineSegment=Object(a.d)(),this._tmpP1=Object(r.f)(),this._tmpP2=Object(r.f)(),this._tmpP3=Object(r.f)(),this.remoteClient=null}async fetchCandidates(t,e){await Promise.resolve(),Object(i.q)(e),await this._ensureEdgeLocations(t,e);const n=[];return this._edges.forEachNeighbor((e=>(this._addCandidates(t,e,n),n.length<1e3)),t.bounds),{result:{candidates:n}}}async _ensureEdgeLocations(t,e){const n=[];if(this._components.forEachNeighbor((t=>{if(Object(o.k)(t.info)){const{id:e,uid:s}=t;n.push({id:e,uid:s})}return!0}),t.bounds),!n.length)return;const s={components:n},i=await this.remoteClient.invoke("fetchAllEdgeLocations",s,Object(o.u)(e,{}));for(const o of i.components)this._setFetchEdgeLocations(o)}async add(t){const e=new _(t.id,t.bounds);return this._idToComponent.set(e.id,e),this._components.add([e]),{result:{}}}async remove(t){const e=this._idToComponent.get(t.id);if(e){const t=[];this._edges.forEachNeighbor((n=>(n.component===e&&t.push(n),!0)),e.bounds),this._edges.remove(t),this._components.remove([e]),this._idToComponent.delete(e.id)}return{result:{}}}_setFetchEdgeLocations(t){const e=this._idToComponent.get(t.id);if(Object(o.k)(e)||t.uid!==e.uid)return;const n=p.b.createView(t.locations),s=new Array(n.count),i=Object(r.f)(),c=Object(r.f)();for(let o=0;o<n.count;o++){n.position0.getVec(o,i),n.position1.getVec(o,c);const d=g(i,c,t.origin),r=new O(e,o,d);s[o]=r}this._edges.add(s);const{objectIds:d,origin:a}=t;e.info={locations:n,objectIds:d,origin:a}}_addCandidates(t,e,n){const{locations:s,origin:o,objectIds:i}=e.component.info,c=s.position0.getVec(e.index,this._tmpP1),r=s.position1.getVec(e.index,this._tmpP2);Object(d.j)(c,c,o),Object(d.j)(r,r,o);const a=i[s.componentIndex.get(e.index)];this._addEdgeCandidate(t,a,c,r,n),this._addVertexCandidate(t,a,c,n),this._addVertexCandidate(t,a,r,n)}_addEdgeCandidate(t,e,n,s,o){if(!(t.types&b.b.EDGE))return;const i=Object(u.g)(t.bounds),c=Object(a.f)(n,s,this._tmpLineSegment),h=Object(a.i)(c,i,this._tmpP3);if(!Object(u.m)(t.bounds,h))return null;o.push({type:"edge",objectId:e,target:Object(r.d)(h),distance:Object(d.r)(i,h),start:Object(r.d)(n),end:Object(r.d)(s)})}_addVertexCandidate(t,e,n,s){if(!(t.types&b.b.VERTEX))return;const o=Object(u.g)(t.bounds);if(!Object(u.m)(t.bounds,n))return null;s.push({type:"vertex",objectId:e,target:Object(r.d)(n),distance:Object(d.r)(o,n)})}};j=Object(s.a)([Object(c.a)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],j);const m=j;class _{constructor(t,e){this.id=t,this.bounds=e,this.info=null,this.uid=++_.uid}}_.uid=0;class O{constructor(t,e,n){this.component=t,this.index=e,this.bounds=n}}}}]);
//# sourceMappingURL=260.030bf012.chunk.js.map