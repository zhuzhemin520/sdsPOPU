(this["webpackJsonppopulation-arcgis"]=this["webpackJsonppopulation-arcgis"]||[]).push([[65],{1077:function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return nt}));var s=i(0),n=i(108),r=i(64),a=i(2),o=i(23),c=i(13),h=i(1),l=i(17),u=(i(12),i(10)),d=i(358),_=i(57),f=i(1134),p=i(1151),g=i(672),b=i(774),y=i(249),m=i(727),O=i(1246),j=i(1247),E=i(1248),x=i(28);let v=class extends x.a{constructor(){super(...arguments),this.updating=!1,this._pending=[]}push(t,e){this._pending.push({promise:t,callback:e}),1===this._pending.length&&this._process()}_process(){if(!this._pending.length)return void(this.updating=!1);this.updating=!0;const t=this._pending[0];t.promise.then((e=>t.callback(e))).catch((()=>{})).then((()=>{this._pending.shift(),this._process()}))}};Object(s.a)([Object(h.b)()],v.prototype,"updating",void 0),v=Object(s.a)([Object(u.a)("esri.core.AsyncSequence")],v);var C,I,F=i(157),T=i(243),S=i(226),w=i(22),B=i(86),M=i(37),A=i(336),R=i(306),P=i(944),D=i(899);class H{constructor(t,e){this.data=t,this.resolution=e,this.state={type:C.CREATED},this.alive=!0}process(t){switch(this.state.type){case C.CREATED:return this.state=this._gotoFetchCount(this.state,t),this.state.task.promise.then(t.resume,t.resume);case C.FETCH_COUNT:break;case C.FETCHED_COUNT:return this.state=this._gotoFetchFeatures(this.state,t),this.state.task.promise.then(t.resume,t.resume);case C.FETCH_FEATURES:break;case C.FETCHED_FEATURES:this.state=this._goToDone(this.state,t);case C.DONE:}return null}get debugInfo(){return{data:this.data,featureCount:this._featureCount,state:this._stateToString}}get _featureCount(){switch(this.state.type){case C.CREATED:case C.FETCH_COUNT:return 0;case C.FETCHED_COUNT:return this.state.featureCount;case C.FETCH_FEATURES:return this.state.previous.featureCount;case C.FETCHED_FEATURES:return this.state.features.length;case C.DONE:return this.state.previous.features.length}}get _stateToString(){switch(this.state.type){case C.CREATED:return"created";case C.FETCH_COUNT:return"fetch-count";case C.FETCHED_COUNT:return"fetched-count";case C.FETCH_FEATURES:return"fetch-features";case C.FETCHED_FEATURES:return"fetched-features";case C.DONE:return"done"}}_gotoFetchCount(t,e){return{type:C.FETCH_COUNT,previous:t,task:Object(F.b)((async t=>{const i=await Object(F.f)(e.fetchCount(this,t));this.state.type===C.FETCH_COUNT&&(this.state=this._gotoFetchedCount(this.state,i.ok?i.value:1/0))}))}}_gotoFetchedCount(t,e){return{type:C.FETCHED_COUNT,featureCount:e,previous:t}}_gotoFetchFeatures(t,e){return{type:C.FETCH_FEATURES,previous:t,task:Object(F.b)((async i=>{const s=await Object(F.f)(e.fetchFeatures(this,t.featureCount,i));this.state.type===C.FETCH_FEATURES&&(this.state=this._gotoFetchedFeatures(this.state,s.ok?s.value:[]))}))}}_gotoFetchedFeatures(t,e){return{type:C.FETCHED_FEATURES,previous:t,features:e}}_goToDone(t,e){return e.finish(this,t.features),{type:C.DONE,previous:t}}reset(){const t=this.state;switch(this.state={type:C.CREATED},t.type){case C.CREATED:case C.FETCHED_COUNT:case C.FETCHED_FEATURES:case C.DONE:break;case C.FETCH_COUNT:case C.FETCH_FEATURES:t.task.abort()}}intersects(t){return!(!Object(a.k)(t)&&this.data.extent)||(Object(M.t)(t,z),Object(M.x)(this.data.extent,z))}}(I=C||(C={}))[I.CREATED=0]="CREATED",I[I.FETCH_COUNT=1]="FETCH_COUNT",I[I.FETCHED_COUNT=2]="FETCHED_COUNT",I[I.FETCH_FEATURES=3]="FETCH_FEATURES",I[I.FETCHED_FEATURES=4]="FETCHED_FEATURES",I[I.DONE=5]="DONE";const z=Object(M.m)();let N=class extends T.a{constructor(t){super(t),this.tilesOfInterest=[],this.availability=0,this._pendingTiles=new Map,this._pendingEdits=new v,this._pendingEditsAbortController=new AbortController}get _minimumVerticesPerFeature(){var t;switch(null==(t=this.store)?void 0:t.featureStore.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":return 1;case"esriGeometryPolygon":return 4;case"esriGeometryPolyline":return 2}}set filter(t){const e=this._get("filter"),i=this._filterProperties(t);JSON.stringify(e)!==JSON.stringify(i)&&this._set("filter",i)}set customParameters(t){const e=this._get("customParameters");JSON.stringify(e)!==JSON.stringify(t)&&this._set("customParameters",t)}get _configuration(){return{filter:this.filter,customParameters:this.customParameters,tileInfo:this.tileInfo,tileSize:this.tileSize}}set tileInfo(t){const e=this._get("tileInfo");e!==t&&(Object(a.l)(t)&&Object(a.l)(e)&&JSON.stringify(t)===JSON.stringify(e)||(this._set("tileInfo",t),this.store.tileInfo=t))}set tileSize(t){this._get("tileSize")!==t&&this._set("tileSize",t)}get updating(){return this.updatingExcludingEdits||this._pendingEdits.updating}get updatingExcludingEdits(){return this.updatingHandles.updating}get hasZ(){return this.store.featureStore.hasZ}initialize(){this._initializeFetchExtent(),this.updatingHandles.add((()=>this._configuration),(()=>this.refresh())),this.updatingHandles.add((()=>this.tilesOfInterest),((t,e)=>{Object(l.e)(t,e,(({id:t},{id:e})=>t===e))||this._process()}),c.d)}destroy(){this._pendingTiles.forEach((t=>this._deletePendingTile(t))),this._pendingTiles.clear(),this.store.destroy(),this.tilesOfInterest.length=0,this._pendingEditsAbortController.abort(),this._pendingEditsAbortController=null}refresh(){this.store.refresh(),this._pendingTiles.forEach((t=>this._deletePendingTile(t))),this._process()}applyEdits(t){this._pendingEdits.push(t,(async t=>{if(0===t.addedFeatures.length&&0===t.updatedFeatures.length&&0===t.deletedFeatures.length)return;for(const[,i]of this._pendingTiles)i.reset();const e={...t,deletedFeatures:t.deletedFeatures.map((({objectId:t,globalId:e})=>t&&-1!==t?t:this._lookupObjectIdByGlobalId(e)))};await this.updatingHandles.addPromise(this.store.processEdits(e,((t,e)=>this._queryFeaturesById(t,e)),this._pendingEditsAbortController.signal)),this._processPendingTiles()}))}_initializeFetchExtent(){if(!this.capabilities.query.supportsExtent||!Object(R.c)(this.url))return;const t=Object(F.b)((async t=>{try{var e;const i=await Object(D.executeQueryForExtent)(this.url,new y.a({where:"1=1",outSpatialReference:this.spatialReference,cacheHint:!!this.capabilities.query.supportsCacheHint||void 0}),{query:this._configuration.customParameters,signal:t});this.store.extent=B.a.fromJSON(null==(e=i.data)?void 0:e.extent)}catch(I){Object(o.p)(I),w.a.getLogger(this.declaredClass).warn("Failed to fetch data extent",I)}}));this.updatingHandles.addPromise(t.promise.then((()=>this._process()))),this.handles.add(Object(S.c)((()=>t.abort())))}get debugInfo(){return{numberOfFeatures:this.store.featureStore.numFeatures,tilesOfInterest:this.tilesOfInterest,pendingTiles:Array.from(this._pendingTiles.values()).map((t=>t.debugInfo)),storedTiles:this.store.debugInfo}}_process(){this._markTilesNotAlive(),this._createPendingTiles(),this._deletePendingTiles(),this._processPendingTiles()}_markTilesNotAlive(){for(const[,t]of this._pendingTiles)t.alive=!1}_createPendingTiles(){const t=this._collectMissingTilesInfo();if(this._setAvailability(Object(a.k)(t)?1:t.coveredArea/t.fullArea),!Object(a.k)(t))for(const{data:e,resolution:i}of t.missingTiles){const t=this._pendingTiles.get(e.id);t?(t.resolution=i,t.alive=!0):this._createPendingTile(e,i)}}_collectMissingTilesInfo(){let t=null;for(let e=this.tilesOfInterest.length-1;e>=0;e--){const i=this.tilesOfInterest[e],s=this.store.process(i,((t,e)=>this._verifyTileComplexity(t,e)));Object(a.k)(t)?t=s:t.prepend(s)}return t}_deletePendingTiles(){for(const[,t]of this._pendingTiles)t.alive||this._deletePendingTile(t)}_processPendingTiles(){const t={fetchCount:(t,e)=>this._fetchCount(t,e),fetchFeatures:(t,e,i)=>this._fetchFeatures(t,e,i),finish:(t,e)=>this._finishPendingTile(t,e),resume:()=>this._processPendingTiles()};if(this._ensureFetchAllCounts(t))for(const[,e]of this._pendingTiles)this._verifyTileComplexity(this.store.getFeatureCount(e.data),e.resolution)&&this.updatingHandles.addPromise(e.process(t))}_verifyTileComplexity(t,e){return this._verifyVertexComplexity(t)&&this._verifyFeatureDensity(t,e)}_verifyVertexComplexity(t){return t*this._minimumVerticesPerFeature<X}_verifyFeatureDensity(t,e){if(Object(a.k)(this.tileInfo))return!1;const i=this.tileSize*e;return t*(Y/(i*i))<q}_ensureFetchAllCounts(t){let e=!0;for(const[,i]of this._pendingTiles)i.state.type<C.FETCHED_COUNT&&this.updatingHandles.addPromise(i.process(t)),i.state.type<=C.FETCH_COUNT&&(e=!1);return e}_finishPendingTile(t,e){this.store.add(t.data,e),this._deletePendingTile(t),this._updateAvailability()}_updateAvailability(){const t=this._collectMissingTilesInfo();this._setAvailability(Object(a.k)(t)?1:t.coveredArea/t.fullArea)}_setAvailability(t){this._set("availability",t)}_createPendingTile(t,e){const i=new H(t,e);return this._pendingTiles.set(t.id,i),i}_deletePendingTile(t){t.reset(),this._pendingTiles.delete(t.data.id)}async _fetchCount(t,e){return this.store.fetchCount(t.data,this.url,this._createCountQuery(t),{query:this.customParameters,timeout:U,signal:e})}async _fetchFeatures(t,e,i){let s,n=0,r=0,o=e;for(;;){const c=this._createFeaturesQuery(t),h=this._setPagingParameters(c,n,o),{features:l,exceededTransferLimit:u}=await this._queryFeatures(c,i);if(h&&(n+=Object(a.t)(c.num)),r+=l.length,s=s?s.concat(l):l,o=e-r,!h||!u||o<=0)return s}}_filterProperties(t){return Object(a.k)(t)?{where:"1=1",gdbVersion:void 0,timeExtent:void 0}:{where:t.where||"1=1",timeExtent:t.timeExtent,gdbVersion:t.gdbVersion}}_lookupObjectIdByGlobalId(t){const e=this.globalIdField,i=this.objectIdField;if(Object(a.k)(e))throw new Error("Expected globalIdField to be defined");let s=null;if(this.store.featureStore.forEach((n=>{var r;t===n.attributes[e]&&(s=null!=(r=n.objectId)?r:n.attributes[i])})),Object(a.k)(s))throw new Error(`Expected to find a feature with globalId ${t}`);return s}_queryFeaturesById(t,e){const i=this._createFeaturesQuery();return i.objectIds=t,this._queryFeatures(i,e)}_queryFeatures(t,e){return this.capabilities.query.supportsFormatPBF?this._queryFeaturesPBF(t,e):this._queryFeaturesJSON(t,e)}async _queryFeaturesPBF(t,e){const{sourceSpatialReference:i}=this,{data:s}=await Object(D.executeQueryPBF)(this.url,t,new P.b({sourceSpatialReference:i}),{query:this._configuration.customParameters,timeout:U,signal:e});return Object(A.w)(s)}async _queryFeaturesJSON(t,e){const{sourceSpatialReference:i}=this,{data:s}=await Object(D.executeQuery)(this.url,t,i,{query:this._configuration.customParameters,timeout:U,signal:e});return Object(A.b)(s,this.objectIdField)}_createCountQuery(t){const e=this._createBaseQuery(t);return this.capabilities.query.supportsCacheHint&&(e.cacheHint=!0),e}_createFeaturesQuery(t=null){const e=this._createBaseQuery(t);return e.outFields=this.globalIdField?[this.globalIdField,this.objectIdField]:[this.objectIdField],e.returnGeometry=!0,Object(a.l)(t)&&(this.capabilities.query.supportsResultType?e.resultType="tile":this.capabilities.query.supportsCacheHint&&(e.cacheHint=!0)),e}_createBaseQuery(t){const e=new y.a({returnZ:this.hasZ,returnM:!1,geometry:Object(a.l)(this.tileInfo)&&Object(a.l)(t)?Object(M.C)(t.data.extent,this.tileInfo.spatialReference):void 0}),i=this._configuration.filter;return Object(a.l)(i)&&(e.where=i.where,e.gdbVersion=i.gdbVersion,e.timeExtent=i.timeExtent),e.outSpatialReference=this.spatialReference,e}_setPagingParameters(t,e,i){if(!this.capabilities.query.supportsPagination)return!1;const{supportsMaxRecordCountFactor:s,supportsCacheHint:n,tileMaxRecordCount:r,maxRecordCount:a,supportsResultType:o}=this.capabilities.query,c=s?y.a.MAX_MAX_RECORD_COUNT_FACTOR:1,h=c*((o||n)&&r?r:a||k);return t.start=e,s?(t.maxRecordCountFactor=Math.min(c,Math.ceil(i/h)),t.num=Math.min(i,t.maxRecordCountFactor*h)):t.num=Math.min(i,h),!0}};Object(s.a)([Object(h.b)({constructOnly:!0})],N.prototype,"url",void 0),Object(s.a)([Object(h.b)({constructOnly:!0})],N.prototype,"objectIdField",void 0),Object(s.a)([Object(h.b)({constructOnly:!0})],N.prototype,"globalIdField",void 0),Object(s.a)([Object(h.b)({constructOnly:!0})],N.prototype,"capabilities",void 0),Object(s.a)([Object(h.b)({constructOnly:!0})],N.prototype,"sourceSpatialReference",void 0),Object(s.a)([Object(h.b)({constructOnly:!0})],N.prototype,"spatialReference",void 0),Object(s.a)([Object(h.b)({constructOnly:!0})],N.prototype,"store",void 0),Object(s.a)([Object(h.b)({readOnly:!0})],N.prototype,"_minimumVerticesPerFeature",null),Object(s.a)([Object(h.b)()],N.prototype,"filter",null),Object(s.a)([Object(h.b)()],N.prototype,"customParameters",null),Object(s.a)([Object(h.b)({readOnly:!0})],N.prototype,"_configuration",null),Object(s.a)([Object(h.b)()],N.prototype,"tileInfo",null),Object(s.a)([Object(h.b)()],N.prototype,"tileSize",null),Object(s.a)([Object(h.b)()],N.prototype,"tilesOfInterest",void 0),Object(s.a)([Object(h.b)({readOnly:!0})],N.prototype,"updating",null),Object(s.a)([Object(h.b)({readOnly:!0})],N.prototype,"updatingExcludingEdits",null),Object(s.a)([Object(h.b)({readOnly:!0})],N.prototype,"availability",void 0),Object(s.a)([Object(h.b)()],N.prototype,"hasZ",null),N=Object(s.a)([Object(u.a)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher")],N);const k=2e3,U=6e5,X=1e6,Y=25,q=1;var L=i(375),V=i(1129),J=i(911);class ${constructor(){this._store=new Map,this._byteSize=0}set(t,e){this.delete(t),this._store.set(t,e),this._byteSize+=e.byteSize}delete(t){const e=this._store.get(t);return!!this._store.delete(t)&&(null!=e&&(this._byteSize-=e.byteSize),!0)}get(t){return this._used(t),this._store.get(t)}has(t){return this._used(t),this._store.has(t)}clear(){this._store.clear()}applyByteSizeLimit(t,e){for(const[i,s]of this._store){if(this._byteSize<=t)break;this.delete(i),e(s)}}values(){return this._store.values()}[Symbol.iterator](){return this._store[Symbol.iterator]()}_used(t){const e=this._store.get(t);e&&(this._store.delete(t),this._store.set(t,e))}}let Q=class extends x.a{constructor(t){super(t),this.tileInfo=null,this.extent=null,this.maximumByteSize=10*L.a.MEGABYTES,this._tileBounds=new V.a,this._tiles=new $,this._refCounts=new Map,this._tileFeatureCounts=new Map,this._tmpBoundingRect=Object(M.m)()}add(t,e){const i=[];for(const s of e)this._referenceFeature(s.objectId)===et.ADDED&&i.push(s);this._addTileStorage(t,new Set(e.map((({objectId:t})=>t))),function(t){return t.reduce(((t,e)=>t+function(t){return 32+function(t){if(Object(a.k)(t))return 0;const e=Object(L.c)(t.lengths,4);return 32+Object(L.c)(t.coords,8)+e}(t.geometry)+Object(L.b)(t.attributes)}(e)),0)}(e)),this.featureStore.addMany(i),this._tiles.applyByteSizeLimit(this.maximumByteSize,(t=>this._removeTileStorage(t)))}destroy(){this.clear(),this._tileFeatureCounts.clear()}clear(){this.featureStore.clear(),this._tileBounds.clear(),this._tiles.clear(),this._refCounts.clear()}refresh(){this.clear(),this._tileFeatureCounts.clear()}processEdits(t,e,i){return this._processEditsDelete(t.deletedFeatures.concat(t.updatedFeatures)),this._processEditsRefetch(t.addedFeatures.concat(t.updatedFeatures),e,i)}_addTileStorage(t,e,i){this._tiles.set(t.id,new G(t,e,i)),this._tileBounds.set(t.id,t.extent),this._tileFeatureCounts.set(t.id,e.size)}_remove({id:t}){const e=this._tiles.get(t);e&&this._removeTileStorage(e)}_removeTileStorage(t){const e=[];for(const s of t.objectIds)this._unreferenceFeature(s)===et.REMOVED&&e.push(s);this.featureStore.removeManyById(e);const i=t.data.id;this._tiles.delete(i),this._tileBounds.delete(i)}_processEditsDelete(t){this.featureStore.removeManyById(t);for(const[,e]of this._tiles){for(const i of t)e.objectIds.delete(i);this._tileFeatureCounts.set(e.data.id,e.objectIds.size)}for(const e of t)this._refCounts.delete(e)}async _processEditsRefetch(t,e,i){const s=(await e(t,i)).features,{hasZ:n,hasM:r}=this.featureStore;for(const o of s){const t=Object(A.p)(this._tmpBoundingRect,o.geometry,n,r);Object(a.k)(t)||this._tileBounds.forEachInBounds(t,(t=>{const e=this._tiles.get(t);this.featureStore.add(o),e.objectIds.has(o.objectId)||(e.objectIds.add(o.objectId),this._referenceFeature(o.objectId),this._tileFeatureCounts.set(e.data.id,e.objectIds.size))}))}}process(t,e=(()=>!0)){if(Object(a.k)(this.tileInfo)||!t.extent||Object(a.l)(this.extent)&&!Object(M.x)(Object(M.t)(this.extent,this._tmpBoundingRect),t.extent))return new W(t);if(this._tiles.has(t.id))return new W(t);const i=this._createTileTree(t,this.tileInfo);return this._simplify(i,e,null,0,1),this._collectMissingTiles(t,i,this.tileInfo)}get debugInfo(){return Array.from(this._tiles.values()).map((({data:t})=>({data:t,featureCount:this._tileFeatureCounts.get(t.id)||0})))}getFeatureCount(t){var e;return null!=(e=this._tileFeatureCounts.get(t.id))?e:0}async fetchCount(t,e,i,s){const n=this._tileFeatureCounts.get(t.id);if(null!=n)return n;const r=await Object(D.executeQueryForCount)(e,i,s);return this._tileFeatureCounts.set(t.id,r.data.count),r.data.count}_createTileTree(t,e){const i=new Z(t.level,t.row,t.col);return e.updateTileInfo(i,g.a.ExtrapolateOptions.POWER_OF_TWO),this._tileBounds.forEachInBounds(t.extent,(s=>{const n=this._tiles.get(s).data;this._tilesAreRelated(t,n)&&this._populateChildren(i,n,e,this._tileFeatureCounts.get(n.id)||0)})),i}_tilesAreRelated(t,e){if(!t||!e)return!1;if(t.level===e.level)return t.row===e.row&&t.col===e.col;const i=t.level<e.level,s=i?t:e,n=i?e:t,r=1<<n.level-s.level;return Math.floor(n.row/r)===s.row&&Math.floor(n.col/r)===s.col}_populateChildren(t,e,i,s){const n=e.level-t.level-1;if(n<0)return void(t.isLeaf=!0);const r=e.row>>n,o=e.col>>n,c=t.row<<1,h=o-(t.col<<1)+(r-c<<1),l=t.children[h];if(Object(a.l)(l))this._populateChildren(l,e,i,s);else{const n=new Z(t.level+1,r,o);i.updateTileInfo(n,g.a.ExtrapolateOptions.POWER_OF_TWO),t.children[h]=n,this._populateChildren(n,e,i,s)}}_simplify(t,e,i,s,n){const r=n*n;if(t.isLeaf)return e(this.getFeatureCount(t),n)?0:(this._remove(t),Object(a.l)(i)&&(i.children[s]=null),r);const o=n/2,c=o*o;let h=0;for(let l=0;l<t.children.length;l++){const i=t.children[l];h+=Object(a.l)(i)?this._simplify(i,e,t,l,o):c}return 0===h?this._mergeChildren(t):1-h/r<tt&&(this._purge(t),Object(a.l)(i)&&(i.children[s]=null),h=r),h}_mergeChildren(t){const e=new Set;let i=0;this._forEachLeaf(t,(t=>{const s=this._tiles.get(t.id);if(s){i+=s.byteSize;for(const t of s.objectIds)e.has(t)||(e.add(t),this._referenceFeature(t));this._remove(t)}})),this._addTileStorage(t,e,i),t.isLeaf=!0,t.children[0]=t.children[1]=t.children[2]=t.children[3]=null,this._tileFeatureCounts.set(t.id,e.size)}_forEachLeaf(t,e){for(const i of t.children)Object(a.k)(i)||(i.isLeaf?e(i):this._forEachLeaf(i,e))}_purge(t){if(!Object(a.k)(t))if(t.isLeaf)this._remove(t);else for(let e=0;e<t.children.length;e++){const i=t.children[e];this._purge(i),t.children[e]=null}}_collectMissingTiles(t,e,i){const s=new K(i,t,this.extent);return this._collectMissingTilesRecurse(e,s,1),s.info}_collectMissingTilesRecurse(t,e,i){if(t.isLeaf)return;if(!t.hasChildren)return void e.addMissing(t.level,t.row,t.col,i);const s=i/2;for(let n=0;n<t.children.length;n++){const i=t.children[n];Object(a.k)(i)?e.addMissing(t.level+1,(t.row<<1)+((2&n)>>1),(t.col<<1)+(1&n),s):this._collectMissingTilesRecurse(i,e,s)}}_referenceFeature(t){const e=(this._refCounts.get(t)||0)+1;return this._refCounts.set(t,e),1===e?et.ADDED:et.UNCHANGED}_unreferenceFeature(t){const e=(this._refCounts.get(t)||0)-1;return 0===e?(this._refCounts.delete(t),et.REMOVED):(e>0&&this._refCounts.set(t,e),et.UNCHANGED)}get test(){return{tiles:Array.from(this._tiles.values()).map((t=>`${t.data.id}:[${Array.from(t.objectIds)}]`)),featureReferences:Array.from(this._refCounts.keys()).map((t=>`${t}:${this._refCounts.get(t)}`))}}};Object(s.a)([Object(h.b)({constructOnly:!0})],Q.prototype,"featureStore",void 0),Object(s.a)([Object(h.b)()],Q.prototype,"tileInfo",void 0),Object(s.a)([Object(h.b)()],Q.prototype,"extent",void 0),Object(s.a)([Object(h.b)()],Q.prototype,"maximumByteSize",void 0),Q=Object(s.a)([Object(u.a)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTileStore")],Q);class G{constructor(t,e,i){this.data=t,this.objectIds=e,this.byteSize=i}}class Z{constructor(t,e,i){this.level=t,this.row=e,this.col=i,this.isLeaf=!1,this.extent=null,this.children=[null,null,null,null]}get hasChildren(){return!this.isLeaf&&(Object(a.l)(this.children[0])||Object(a.l)(this.children[1])||Object(a.l)(this.children[2])||Object(a.l)(this.children[3]))}}class W{constructor(t,e=[]){this.missingTiles=e,this.fullArea=0,this.coveredArea=0,this.fullArea=Object(M.d)(t.extent),this.coveredArea=this.fullArea}prepend(t){this.missingTiles=t.missingTiles.concat(this.missingTiles),this.coveredArea+=t.coveredArea,this.fullArea+=t.fullArea}}class K{constructor(t,e,i){this._tileInfo=t,this._extent=null,this.info=new W(e),Object(a.l)(i)&&(this._extent=Object(M.t)(i))}addMissing(t,e,i,s){const n=new J.a(null,t,e,i);this._tileInfo.updateTileInfo(n,g.a.ExtrapolateOptions.POWER_OF_TWO),Object(a.k)(n.extent)||Object(a.l)(this._extent)&&!Object(M.x)(this._extent,n.extent)||(this.info.missingTiles.push({data:n,resolution:s}),this.info.coveredArea-=Object(M.d)(n.extent))}}const tt=.18751;var et,it;(it=et||(et={}))[it.ADDED=0]="ADDED",it[it.REMOVED=1]="REMOVED",it[it.UNCHANGED=2]="UNCHANGED";let st=class extends n.a.EventedAccessor{constructor(){super(...arguments),this._isInitializing=!0,this.remoteClient=null,this._whenSetup=Object(o.d)(),this._elevationAligner=Object(O.a)(),this._elevationFilter=Object(j.a)(),this._symbologyCandidatesFetcher=Object(E.a)(),this._handles=new r.a,this._updatingHandles=new d.a,this._editsUpdatingHandles=new d.a,this._pendingApplyEdits=new Map,this._alignPointsInFeatures=async(t,e)=>{const i={points:t},s=await this.remoteClient.invoke("alignElevation",i,{signal:e});return Object(o.q)(e),s},this._getSymbologyCandidates=async(t,e)=>{const i={candidates:t,spatialReference:this._spatialReference.toJSON()},s=await this.remoteClient.invoke("getSymbologyCandidates",i,{signal:e});return Object(o.q)(e),s}}get updating(){return this.updatingExcludingEdits||this._editsUpdatingHandles.updating||this._featureFetcher.updating}get updatingExcludingEdits(){return this._featureFetcher.updatingExcludingEdits||this._isInitializing||this._updatingHandles.updating}destroy(){this._featureFetcher.destroy(),this._queryEngine.destroy(),this._featureStore.clear(),this._handles.destroy()}async setup(t){const{geometryType:e,objectIdField:i,timeInfo:s,fields:n}=t.serviceInfo,{hasZ:r}=t,o=_.a.fromJSON(t.spatialReference);this._spatialReference=o,this._featureStore=new f.a({...t.serviceInfo,hasZ:r,hasM:!1}),this._queryEngine=new p.a({spatialReference:t.spatialReference,featureStore:this._featureStore,geometryType:e,fields:n,hasZ:r,hasM:!1,objectIdField:i,timeInfo:s?b.a.fromJSON(s):null}),this._featureFetcher=new N({store:new Q({featureStore:this._featureStore}),url:t.serviceInfo.url,objectIdField:t.serviceInfo.objectIdField,globalIdField:t.serviceInfo.globalIdField,capabilities:t.serviceInfo.capabilities,spatialReference:o,sourceSpatialReference:_.a.fromJSON(t.serviceInfo.spatialReference)});const h="3d"===t.configuration.viewType;return this._elevationAligner=Object(O.a)(h,{elevationInfo:Object(a.l)(t.elevationInfo)?m.a.fromJSON(t.elevationInfo):null,alignPointsInFeatures:this._alignPointsInFeatures,spatialReference:o}),this._elevationFilter=Object(j.a)(h),this._handles.add([Object(c.f)((()=>this._featureFetcher.availability),(t=>this.emit("notify-availability",{availability:t})),c.d),Object(c.f)((()=>this.updating),(()=>this._notifyUpdating()))]),this._whenSetup.resolve(),this._isInitializing=!1,this.configure(t.configuration)}async configure(t){return await this._updatingHandles.addPromise(this._whenSetup.promise),this._updateFeatureFetcherConfiguration(t),{result:{}}}async fetchCandidates(t,e){await this._whenSetup.promise,Object(o.q)(e);const i=function(t){return{point:t.point,distance:t.distance,types:t.types,query:Object(a.l)(t.filter)?t.filter:{where:"1=1"}}}(t),s=Object(a.l)(e)?e.signal:null,n=await this._queryEngine.executeQueryForSnapping(i,s);Object(o.q)(s);const r=await this._elevationAligner.alignCandidates(n.candidates,s);Object(o.q)(s);const c=await this._symbologyCandidatesFetcher.fetch(r,s);Object(o.q)(s);const h=0===c.length?r:r.concat(c);return{result:{candidates:this._elevationFilter.filter(i,h)}}}async updateTiles(t,e){return await this._updatingHandles.addPromise(this._whenSetup.promise),Object(o.q)(e),this._featureFetcher.tileSize=t.tileSize,this._featureFetcher.tilesOfInterest=t.tiles,this._featureFetcher.tileInfo=Object(a.l)(t.tileInfo)?g.a.fromJSON(t.tileInfo):null,rt}async refresh(t,e){return await this._updatingHandles.addPromise(this._whenSetup.promise),Object(o.q)(e),this._featureFetcher.refresh(),rt}async whenNotUpdating(t,e){return await this._updatingHandles.addPromise(this._whenSetup.promise),Object(o.q)(e),await Object(c.h)((()=>!this.updatingExcludingEdits),e),Object(o.q)(e),rt}async getDebugInfo(t,e){return Object(o.q)(e),{result:this._featureFetcher.debugInfo}}async beginApplyEdits(t,e){this._updatingHandles.addPromise(this._whenSetup.promise),Object(o.q)(e);const i=Object(o.d)();return this._pendingApplyEdits.set(t.id,i),this._featureFetcher.applyEdits(i.promise),this._editsUpdatingHandles.addPromise(i.promise),rt}async endApplyEdits(t,e){const i=this._pendingApplyEdits.get(t.id);return i&&i.resolve(t.edits),Object(o.q)(e),rt}async notifyElevationSourceChange(t,e){return this._elevationAligner.notifyElevationSourceChange(),rt}async notifySymbologyChange(t,e){return rt}async setSymbologySnappingSupported(t){return this._symbologyCandidatesFetcher=Object(E.a)(t,this._getSymbologyCandidates),rt}_updateFeatureFetcherConfiguration(t){this._featureFetcher.filter=Object(a.l)(t.filter)?y.a.fromJSON(t.filter):null,this._featureFetcher.customParameters=t.customParameters}_notifyUpdating(){this.emit("notify-updating",{updating:this.updating})}};Object(s.a)([Object(h.b)({readOnly:!0})],st.prototype,"updating",null),Object(s.a)([Object(h.b)({readOnly:!0})],st.prototype,"updatingExcludingEdits",null),Object(s.a)([Object(h.b)()],st.prototype,"_isInitializing",void 0),st=Object(s.a)([Object(u.a)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorker")],st);const nt=st;const rt={result:{}}},1118:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var s=i(17),n=i(2),r=i(84),a=i(1133);class o{constructor(t=9,e){this._compareMinX=u,this._compareMinY=d,this._toBBox=t=>t,this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&("function"==typeof e?this._toBBox=e:this._initFormat(e)),this.clear()}destroy(){this.clear(),O.prune(),j.prune(),E.prune(),x.prune()}all(t){this._all(this._data,t)}search(t,e){let i=this._data;const s=this._toBBox;if(y(t,i))for(O.clear();i;){for(let n=0,r=i.children.length;n<r;n++){const r=i.children[n],a=i.leaf?s(r):r;y(t,a)&&(i.leaf?e(r):b(t,a)?this._all(r,e):O.push(r))}i=O.pop()}}collides(t){let e=this._data;const i=this._toBBox;if(!y(t,e))return!1;for(O.clear();e;){for(let s=0,n=e.children.length;s<n;s++){const n=e.children[s],r=e.leaf?i(n):n;if(y(t,r)){if(e.leaf||b(t,r))return!0;O.push(n)}}e=O.pop()}return!1}load(t){if(!t.length)return this;if(t.length<this._minEntries){for(let e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}let e=this._build(t.slice(0,t.length),0,t.length-1,0);if(this._data.children.length)if(this._data.height===e.height)this._splitRoot(this._data,e);else{if(this._data.height<e.height){const t=this._data;this._data=e,e=t}this._insert(e,this._data.height-e.height-1,!0)}else this._data=e;return this}insert(t){return t&&this._insert(t,this._data.height-1),this}clear(){return this._data=new I([]),this}remove(t){if(!t)return this;let e,i=this._data,r=null,a=0,o=!1;const c=this._toBBox(t);for(E.clear(),x.clear();i||E.length>0;){var h;if(i||(i=Object(n.d)(E.pop()),r=E.data[E.length-1],a=null!=(h=x.pop())?h:0,o=!0),i.leaf&&(e=Object(s.g)(i.children,t,i.children.length,i.indexHint),-1!==e))return i.children.splice(e,1),E.push(i),this._condense(E),this;o||i.leaf||!b(i,c)?r?(a++,i=r.children[a],o=!1):i=null:(E.push(i),x.push(a),a=0,r=i,i=i.children[0])}return this}toJSON(){return this._data}fromJSON(t){return this._data=t,this}_all(t,e){let i=t;for(j.clear();i;){var s;if(!0===i.leaf)for(const t of i.children)e(t);else j.pushArray(i.children);i=null!=(s=j.pop())?s:null}}_build(t,e,i,s){const n=i-e+1;let r=this._maxEntries;if(n<=r){const s=new I(t.slice(e,i+1));return c(s,this._toBBox),s}s||(s=Math.ceil(Math.log(n)/Math.log(r)),r=Math.ceil(n/r**(s-1)));const a=new F([]);a.height=s;const o=Math.ceil(n/r),h=o*Math.ceil(Math.sqrt(r));m(t,e,i,h,this._compareMinX);for(let c=e;c<=i;c+=h){const e=Math.min(c+h-1,i);m(t,c,e,o,this._compareMinY);for(let i=c;i<=e;i+=o){const n=Math.min(i+o-1,e);a.children.push(this._build(t,i,n,s-1))}}return c(a,this._toBBox),a}_chooseSubtree(t,e,i,s){for(;s.push(e),!0!==e.leaf&&s.length-1!==i;){let i,s=1/0,n=1/0;for(let r=0,a=e.children.length;r<a;r++){const a=e.children[r],o=_(a),c=p(t,a)-o;c<n?(n=c,s=o<s?o:s,i=a):c===n&&o<s&&(s=o,i=a)}e=i||e.children[0]}return e}_insert(t,e,i){const s=this._toBBox,n=i?t:s(t);E.clear();const r=this._chooseSubtree(n,this._data,e,E);for(r.children.push(t),l(r,n);e>=0&&E.data[e].children.length>this._maxEntries;)this._split(E,e),e--;this._adjustParentBBoxes(n,E,e)}_split(t,e){const i=t.data[e],s=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,s);const r=this._chooseSplitIndex(i,n,s);if(!r)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const a=i.children.splice(r,i.children.length-r),o=i.leaf?new I(a):new F(a);o.height=i.height,c(i,this._toBBox),c(o,this._toBBox),e?t.data[e-1].children.push(o):this._splitRoot(i,o)}_splitRoot(t,e){this._data=new F([t,e]),this._data.height=t.height+1,c(this._data,this._toBBox)}_chooseSplitIndex(t,e,i){let s,n,r;s=n=1/0;for(let a=e;a<=i-e;a++){const e=h(t,0,a,this._toBBox),o=h(t,a,i,this._toBBox),c=g(e,o),l=_(e)+_(o);c<s?(s=c,r=a,n=l<n?l:n):c===s&&l<n&&(n=l,r=a)}return r}_chooseSplitAxis(t,e,i){const s=t.leaf?this._compareMinX:u,n=t.leaf?this._compareMinY:d;this._allDistMargin(t,e,i,s)<this._allDistMargin(t,e,i,n)&&t.children.sort(s)}_allDistMargin(t,e,i,s){t.children.sort(s);const n=this._toBBox,r=h(t,0,e,n),a=h(t,i-e,i,n);let o=f(r)+f(a);for(let c=e;c<i-e;c++){const e=t.children[c];l(r,t.leaf?n(e):e),o+=f(r)}for(let c=i-e-1;c>=e;c--){const e=t.children[c];l(a,t.leaf?n(e):e),o+=f(a)}return o}_adjustParentBBoxes(t,e,i){for(let s=i;s>=0;s--)l(e.data[s],t)}_condense(t){for(let e=t.length-1;e>=0;e--){const i=t.data[e];if(0===i.children.length)if(e>0){const n=t.data[e-1],r=n.children;r.splice(Object(s.g)(r,i,r.length,n.indexHint),1)}else this.clear();else c(i,this._toBBox)}}_initFormat(t){const e=["return a"," - b",";"];this._compareMinX=new Function("a","b",e.join(t[0])),this._compareMinY=new Function("a","b",e.join(t[1])),this._toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}function c(t,e){h(t,0,t.children.length,e,t)}function h(t,e,i,s,n){n||(n=new I([])),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let r,a=e;a<i;a++)r=t.children[a],l(n,t.leaf?s(r):r);return n}function l(t,e){t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY)}function u(t,e){return t.minX-e.minX}function d(t,e){return t.minY-e.minY}function _(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function f(t){return t.maxX-t.minX+(t.maxY-t.minY)}function p(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function g(t,e){const i=Math.max(t.minX,e.minX),s=Math.max(t.minY,e.minY),n=Math.min(t.maxX,e.maxX),r=Math.min(t.maxY,e.maxY);return Math.max(0,n-i)*Math.max(0,r-s)}function b(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function y(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function m(t,e,i,s,r){const o=[e,i];for(;o.length;){const e=Object(n.d)(o.pop()),i=Object(n.d)(o.pop());if(e-i<=s)continue;const c=i+Math.ceil((e-i)/s/2)*s;Object(a.a)(t,c,i,e,r),o.push(i,c,c,e)}}const O=new r.a,j=new r.a,E=new r.a,x=new r.a({deallocator:void 0});class v{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class C extends v{constructor(){super(...arguments),this.height=1,this.indexHint=new s.a}}class I extends C{constructor(t){super(),this.children=t,this.leaf=!0}}class F extends C{constructor(t){super(),this.children=t,this.leaf=!1}}},1128:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var s=i(2),n=i(1132),r=i(447),a=i(295);const o={getObjectId:t=>t.objectId,getAttributes:t=>t.attributes,getAttribute:(t,e)=>t.attributes[e],cloneWithGeometry:(t,e)=>new r.a(e,t.attributes,null,t.objectId),getGeometry:t=>t.geometry,getCentroid:(t,e)=>(Object(s.k)(t.centroid)&&(t.centroid=Object(n.a)(new a.a,t.geometry,e.hasZ,e.hasM)),t.centroid)}},1129:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var s=i(32),n=i(1118),r=i(37);const a={minX:0,minY:0,maxX:0,maxY:0};function o(t,e,i){(function(t){a.minX=t[0],a.minY=t[1],a.maxX=t[2],a.maxY=t[3]})(e),t.search(a,i)}class c{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new n.a(9,Object(s.a)("esri-csp-restrictions")?t=>({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const t=new Array(this._idByBounds.size);let e=0;this._idByBounds.forEach(((i,s)=>{t[e++]=s})),this._indexInvalid=!1,this._index.clear(),this._index.load(t)}else this._boundsToLoad.length&&(this._index.load(this._boundsToLoad.filter((t=>this._idByBounds.has(t)))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const t=Object(r.o)();for(const e of this._boundsById.values())e&&(t[0]=Math.min(e[0],t[0]),t[1]=Math.min(e[1],t[1]),t[2]=Math.max(e[2],t[2]),t[3]=Math.max(e[3],t[3]));return t}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(t){const e=this._boundsById.get(t);this._boundsById.delete(t),e&&(this._idByBounds.delete(e),this._indexInvalid||this._index.remove(e))}forEachInBounds(t,e){this._loadIndex(),o(this._index,t,(t=>e(this._idByBounds.get(t))))}get(t){return this._boundsById.get(t)}has(t){return this._boundsById.has(t)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(t,e){if(!this._indexInvalid){const e=this._boundsById.get(t);e&&(this._index.remove(e),this._idByBounds.delete(e))}this._boundsById.set(t,e),e&&(this._idByBounds.set(e,t),this._indexInvalid||(this._boundsToLoad.push(e),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},1134:function(t,e,i){"use strict";i.d(e,"a",(function(){return d}));var s=i(16),n=i(108),r=i(22),a=i(2),o=i(39),c=i(37),h=i(336),l=i(1129),u=i(1128);class d{constructor(t){this.geometryInfo=t,this._boundsStore=new l.a,this._featuresById=new Map,this._markedIds=new Set,this.events=new n.a,this.featureAdapter=u.a}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let t=0;return this._featuresById.forEach((e=>{Object(a.l)(e.geometry)&&e.geometry.coords&&(t+=e.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:t/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}add(t){this._add(t),this._emitChanged()}addMany(t){for(const e of t)this._add(e);this._emitChanged()}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(t){const e=this._featuresById.get(t);return e?(this._remove(e),this._emitChanged(),e):null}removeManyById(t){this._boundsStore.invalidateIndex();for(const e of t){const t=this._featuresById.get(e);t&&this._remove(t)}this._emitChanged()}forEachBounds(t,e,i){for(const s of t){const t=this._boundsStore.get(s.objectId);t&&e(Object(o.r)(i,t))}}getFeature(t){return this._featuresById.get(t)}has(t){return this._featuresById.has(t)}toArray(){return Array.from(this._featuresById.values())}forEach(t){this._featuresById.forEach((e=>t(e)))}forEachInBounds(t,e){this._boundsStore.forEachInBounds(t,(t=>{e(this._featuresById.get(t))}))}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let t=!1;this._featuresById.forEach(((e,i)=>{this._markedIds.has(i)||(t=!0,this._remove(e))})),this._markedIds.clear(),t&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(t){if(!t)return;const e=t.objectId;if(null==e)return void r.a.getLogger("esri.layers.graphics.data.FeatureStore").error(new s.a("featurestore:invalid-feature","feature id is missing",{feature:t}));const i=this._featuresById.get(e);let n;if(this._markedIds.add(e),i?(t.displayId=i.displayId,n=this._boundsStore.get(e),this._boundsStore.delete(e)):Object(a.l)(this.onFeatureAdd)&&this.onFeatureAdd(t),Object(a.k)(t.geometry)||!t.geometry.coords||!t.geometry.coords.length)return this._boundsStore.set(e,null),void this._featuresById.set(e,t);n=Object(h.p)(Object(a.l)(n)?n:Object(c.m)(),t.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),Object(a.l)(n)&&this._boundsStore.set(e,n),this._featuresById.set(e,t)}_remove(t){return Object(a.l)(this.onFeatureRemove)&&this.onFeatureRemove(t),this._markedIds.delete(t.objectId),this._boundsStore.delete(t.objectId),this._featuresById.delete(t.objectId),t}}},1246:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));i(32);var s=i(908),n=i(148),r=i(2),a=i(23),o=i(68),c=i(562);function h(t=!1,e){if(t){const{elevationInfo:t,alignPointsInFeatures:i,spatialReference:s}=e;return new u(t,i,s)}return new l}class l{async alignCandidates(t,e){return t}notifyElevationSourceChange(){}}class u{constructor(t,e,i){this._elevationInfo=t,this._alignPointsInFeatures=e,this.spatialReference=i,this._alignmentsCache=new s.a(1024),this._cacheVersion=0,this._metersPerVerticalUnit=Object(o.g)(i)}async alignCandidates(t,e){const i=this._elevationInfo;return Object(r.l)(i)&&"absolute-height"===i.mode&&!i.featureExpressionInfo?(this._alignAbsoluteElevationCandidates(t,i),t):this._alignComputedElevationCandidates(t,e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}_alignAbsoluteElevationCandidates(t,e){const{offset:i,unit:s}=e;if(Object(r.k)(i))return;const n=i*(Object(c.a)(null!=s?s:"meters")/this._metersPerVerticalUnit);for(const r of t)switch(r.type){case"edge":r.start.z+=n,r.end.z+=n;continue;case"vertex":r.target.z+=n;continue}}async _alignComputedElevationCandidates(t,e){const i=new Map;for(const a of t)Object(n.b)(i,a.objectId,f).push(a);const[s,r,o]=this._prepareQuery(i),c=await this._alignPointsInFeatures(s,e);if(Object(a.q)(e),o!==this._cacheVersion)return this._alignComputedElevationCandidates(t,e);this._applyCacheAndResponse(s,c,r);const{drapedObjectIds:h,failedObjectIds:l}=c,u=[];for(const n of t){const{objectId:t}=n;h.has(t)&&"edge"===n.type&&(n.draped=!0),l.has(t)||u.push(n)}return u}_prepareQuery(t){const e=[],i=[];for(const[s,n]of t){const t=[];for(const e of n)this._addToQueriesOrCachedResult(s,e.target,t,i),"edge"===e.type&&(this._addToQueriesOrCachedResult(s,e.start,t,i),this._addToQueriesOrCachedResult(s,e.end,t,i));0!==t.length&&e.push({objectId:s,points:t})}return[e,i,this._cacheVersion]}_addToQueriesOrCachedResult(t,e,i,s){const n=_(t,e),a=this._alignmentsCache.get(n);Object(r.l)(a)?s.push(new d(e,a)):i.push(e)}_applyCacheAndResponse(t,{elevations:e,drapedObjectIds:i,failedObjectIds:s},n){for(const o of n)o.apply();let r=0;const a=this._alignmentsCache;for(const{objectId:o,points:c}of t){if(s.has(o)){r+=c.length;continue}const t=!i.has(o);for(const i of c){const s=_(o,i),n=e[r++];i.z=n,t&&a.put(s,n,1)}}}}class d{constructor(t,e){this.point=t,this.z=e}apply(){this.point.z=this.z}}function _(t,{x:e,y:i,z:s}){return`${t}-${e}-${i}-${null!=s?s:0}}`}function f(){return[]}},1247:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));i(32);class s{filter(t,e){return e}notifyElevationSourceChange(){}}class n{filter(t,e){const{point:i,distance:s}=t,{z:n}=i;if(null==n)return e;if(0===e.length)return e;const a=function(t){return"number"==typeof t?{x:t,y:t,z:t}:t}(s),o=this._updateCandidatesTo3D(e,i,a).filter(r);return o.sort(h),o}_updateCandidatesTo3D(t,e,i){for(const s of t)switch(s.type){case"edge":o(s,e,i);continue;case"vertex":c(s,e,i);continue}return t}}function r(t){return t.distance<=1}function a(t=!1){return t?new n:new s}function o(t,e,{x:i,y:s,z:n}){const{start:r,end:a,target:o}=t;t.draped||function(t,e,i,s){const n=s.x-i.x,r=s.y-i.y,a=s.z-i.z,o=n*n+r*r+a*a,c=(e.x-i.x)*n+(e.y-i.y)*r+a*(e.z-i.z),h=Math.min(1,Math.max(0,c/o)),l=i.x+n*h,u=i.y+r*h,d=i.z+a*h;t.x=l,t.y=u,t.z=d}(o,e,r,a);const c=(e.x-o.x)/i,h=(e.y-o.y)/s,l=(e.z-o.z)/n;t.distance=Math.sqrt(c*c+h*h+l*l)}function c(t,e,{x:i,y:s,z:n}){const{target:r}=t,a=(e.x-r.x)/i,o=(e.y-r.y)/s,c=(e.z-r.z)/n,h=Math.sqrt(a*a+o*o+c*c);t.distance=h}function h(t,e){return t.distance-e.distance}},1248:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));i(32);var s=i(25),n=i(908),r=i(23),a=i(234);function o(t=!1,e){return t?new h(e):new c}class c{async fetch(){return[]}notifySymbologyChange(){}}class h{constructor(t){this._getSymbologyCandidates=t,this._candidatesCache=new n.a(1024),this._cacheVersion=0}async fetch(t,e){if(0===t.length)return[];const i=[],n=[],a=this._candidatesCache;for(const r of t){const t=l(r),e=a.get(t);if(e)for(const i of e)n.push(Object(s.a)(i));else i.push(r),a.put(t,[],1)}if(0===i.length)return n;const o=this._cacheVersion,{candidates:c,sourceCandidateIndices:h}=await this._getSymbologyCandidates(i,e);if(Object(r.q)(e),o!==this._cacheVersion)return this.fetch(t,e);const u=[],{length:d}=c;for(let r=0;r<d;++r){const t=c[r],e=l(i[h[r]]),n=a.get(e);n.push(t),a.put(e,n,n.length),u.push(Object(s.a)(t))}return n.concat(u)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function l(t){switch(t.type){case"vertex":{var e;const{objectId:i,target:s}=t,n=`${i}-vertex-${s.x}-${s.y}-${null!=(e=s.z)?e:0}`;return Object(a.b)(n).toString()}case"edge":{var i,s;const{objectId:e,start:n,end:r}=t,o=`${e}-edge-${n.x}-${n.y}-${null!=(i=n.z)?i:0}-to-${r.x}-${r.y}-${null!=(s=r.z)?s:0}`;return Object(a.b)(o).toString()}default:return""}}}}]);
//# sourceMappingURL=65.bf4bacc6.chunk.js.map