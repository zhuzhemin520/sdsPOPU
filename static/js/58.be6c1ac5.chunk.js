(this["webpackJsonppopulation-arcgis"]=this["webpackJsonppopulation-arcgis"]||[]).push([[58],{1104:function(e,t,i){"use strict";i.d(t,"a",(function(){return _}));var n=i(0),r=i(28),o=i(108),a=i(243),s=i(509),l=i(22),c=i(2),h=i(446),u=i(1),d=(i(17),i(12),i(10));let f=class extends(Object(a.b)(Object(s.b)(Object(h.b)(o.a.EventedMixin(r.a))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";l.a.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e)}}))}get fullOpacity(){return Object(c.u)(this.get("layer.opacity"),1)*Object(c.u)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var e;return!this.suspended&&!0===(null==(e=this.layer)?void 0:e.legendEnabled)}get updating(){var e;return!((null==(e=this.updatingHandles)||!e.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var e;return!0===(null==(e=this.layer)?void 0:e.visible)}set visible(e){this._overrideIfSome("visible",e)}canResume(){var e,t,i;return this.visible&&(null==(e=this.layer)?void 0:e.loaded)&&!(null!=(t=this.parent)&&t.suspended)&&(null==(i=this.view)?void 0:i.ready)||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(n.a)([Object(u.b)()],f.prototype,"fullOpacity",null),Object(n.a)([Object(u.b)()],f.prototype,"layer",void 0),Object(n.a)([Object(u.b)()],f.prototype,"parent",void 0),Object(n.a)([Object(u.b)({readOnly:!0})],f.prototype,"suspended",null),Object(n.a)([Object(u.b)({readOnly:!0})],f.prototype,"suspendInfo",null),Object(n.a)([Object(u.b)({readOnly:!0})],f.prototype,"legendEnabled",null),Object(n.a)([Object(u.b)({type:Boolean,readOnly:!0})],f.prototype,"updating",null),Object(n.a)([Object(u.b)({readOnly:!0})],f.prototype,"updatingProgress",null),Object(n.a)([Object(u.b)()],f.prototype,"visible",null),Object(n.a)([Object(u.b)()],f.prototype,"view",void 0),f=Object(n.a)([Object(d.a)("esri.views.layers.LayerView")],f);const _=f},1106:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var n=i(0),r=i(226),o=i(23),a=i(13),s=i(1),l=(i(17),i(12),i(10)),c=i(868);const h=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(e){super.postscript(e),Object(c.c)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.handles.add(Object(r.c)((()=>e.abort()))),await Object(a.h)((()=>{var e;return null==(e=this.view.defaultsFromMap)?void 0:e.heightModelInfoReady}),t),Object(o.q)(t);const i=Object(c.b)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(i)throw i}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!e||!e.minScale||!e.maxScale||e.minScale>=e.maxScale)}getSuspendInfo(){const e=super.getSuspendInfo(),t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return t&&t.minScale&&t.maxScale&&t.minScale<t.maxScale&&(e.outsideScaleRange=!0),e}};return Object(n.a)([Object(s.b)()],t.prototype,"view",void 0),Object(n.a)([Object(s.b)()],t.prototype,"slicePlaneEnabled",void 0),t=Object(n.a)([Object(l.a)("esri.views.3d.layers.LayerView3D")],t),t}},1112:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return r}));const n=new Float32Array(1);new Uint32Array(n.buffer);function r(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]}function o(e,t){return 65535&e|t<<16}function a(e,t,i,n){return 255&e|(255&t)<<8|(255&i)<<16|n<<24}},1113:function(e,t,i){"use strict";var n,r,o,a,s,l,c,h;i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return s})),i.d(t,"f",(function(){return l})),function(e){e[e.FILL=0]="FILL",e[e.LINE=1]="LINE",e[e.MARKER=2]="MARKER",e[e.TEXT=3]="TEXT",e[e.LABEL=4]="LABEL"}(n||(n={})),function(e){e[e.SUCCEEDED=0]="SUCCEEDED",e[e.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY"}(r||(r={})),function(e){e[e.NONE=0]="NONE",e[e.MAP=1]="MAP",e[e.LABEL=2]="LABEL",e[e.LABEL_ALPHA=4]="LABEL_ALPHA",e[e.HITTEST=8]="HITTEST",e[e.HIGHLIGHT=16]="HIGHLIGHT",e[e.CLIP=32]="CLIP",e[e.DEBUG=64]="DEBUG",e[e.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(o||(o={})),function(e){e[e.SIZE=0]="SIZE",e[e.COLOR=1]="COLOR",e[e.OPACITY=2]="OPACITY",e[e.ROTATION=3]="ROTATION"}(a||(a={})),function(e){e[e.NONE=0]="NONE",e[e.OPACITY=1]="OPACITY",e[e.COLOR=2]="COLOR",e[e.ROTATION=4]="ROTATION",e[e.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE",e[e.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS",e[e.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS",e[e.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"}(s||(s={})),function(e){e[e.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",e[e.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",e[e.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",e[e.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(l||(l={})),function(e){e[e.SPRITE=0]="SPRITE",e[e.GLYPH=1]="GLYPH"}(c||(c={})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SIMPLE=1]="SIMPLE",e[e.DOT_DENSITY=2]="DOT_DENSITY",e[e.OUTLINE_FILL=3]="OUTLINE_FILL",e[e.OUTLINE_FILL_SIMPLE=4]="OUTLINE_FILL_SIMPLE",e[e.HEATMAP=5]="HEATMAP",e[e.PIE_CHART=6]="PIE_CHART"}(h||(h={}))},1163:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var n=i(0),r=i(16),o=i(2),a=i(13),s=i(1),l=(i(17),i(12),i(10)),c=i(904),h=i(29);const u=e=>{let t=class extends e{get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return this.fullOpacity>=1&&this.imageFormatIsOpaque}get dataLevelRange(){const e=this.tileInfo.lods,t=e[0].scale,i=e[e.length-1].scale;return this.levelRangeFromScaleRange(t,i)}get displayLevelRange(){const e=this.tileInfo.lods,t=this.layer.minScale||e[0].scale,i=this.layer.maxScale||e[e.length-1].scale,n=this.levelRangeFromScaleRange(t,i);return this.layer.maxScale&&n.maxLevel++,n}getTileUrl(e,t,i){return this.layer.getTileUrl(e,t,i)}_addTilingSchemeMatchPromise(){if(Object(o.k)(this.fullExtent))return this.addResolvingPromise(Promise.reject(new r.a("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));const e=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(Object(o.l)(e))return this.addResolvingPromise(Promise.reject(e));const t=Object(a.h)((()=>{var e,t;return null==(e=this.view)||null==(t=e.basemapTerrain)?void 0:t.tilingSchemeLocked})).then((()=>{const e=this.view.basemapTerrain.tilingScheme,t=this._getTileInfoCompatibilityError(this.tileInfo,e);if(t)throw t}));this.addResolvingPromise(t)}_getTileInfoSupportError(e,t){const i=Object(h.d)(e,t,this.view.spatialReference,this.view.state.viewingMode);if(i){const e={layer:this.layer,error:i};let t;switch(i.name){case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":case"tilingscheme:local-unsupported-spatial-reference":t=new r.a("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",e);break;default:t=new r.a("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",e)}return t}return null}_getTileInfoCompatibilityError(e,t){return t.compatibleWith(e)?null:new r.a("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(e,t){const i={minLevel:0,maxLevel:1/0},n=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!n)return i;const r=n.levels[0],o=e=>{const t=Math.log(r.scale/e)/Math.LN2;return.5-Math.abs(.5-t%1)<1e-9?Math.round(t):Math.ceil(t)};return null!=e&&e>0&&(i.minLevel=Math.max(0,o(e))),null!=t&&t>0&&(i.maxLevel=Math.max(0,o(t))),i}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};return Object(n.a)([Object(s.b)({readOnly:!0})],t.prototype,"imageFormatIsOpaque",null),Object(n.a)([Object(s.b)({readOnly:!0})],t.prototype,"updating",void 0),Object(n.a)([Object(s.b)(c.a)],t.prototype,"updatingProgress",void 0),Object(n.a)([Object(s.b)(c.b)],t.prototype,"updatingProgressValue",void 0),Object(n.a)([Object(s.b)()],t.prototype,"fullExtent",null),Object(n.a)([Object(s.b)({readOnly:!0})],t.prototype,"isOpaque",null),Object(n.a)([Object(s.b)({readOnly:!0})],t.prototype,"dataLevelRange",null),Object(n.a)([Object(s.b)({readOnly:!0})],t.prototype,"displayLevelRange",null),Object(n.a)([Object(s.b)()],t.prototype,"layer",void 0),Object(n.a)([Object(s.b)()],t.prototype,"tileInfo",void 0),t=Object(n.a)([Object(l.a)("esri.views.3d.layers.TiledLayerView3D")],t),t}},1198:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));class n{constructor(e=0,t=0,i=0,n=0){this.x=e,this.y=t,this.width=i,this.height=n}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}},1199:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return r}));Number.POSITIVE_INFINITY,Math.PI,Math.LN2;function n(e,t){return(e%=t)>=0?e:e+t}function r(e){return n(.7111111111111111*e,256)}function o(e,t,i){return e>=t&&e<=i||e>=i&&e<=t}},1250:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i(181);class r{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}forEach(e,t){const{spans:i,lodInfo:n}=this,{level:r}=n;if(0!==i.length)for(const{row:o,colFrom:a,colTo:s}of i)for(let i=a;i<=s;i++)e.call(t,r,o,n.normalizeCol(i),n.getWorldForColumn(i))}}r.pool=new n.a(r)},1314:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var n=i(47),r=i(2),o=i(905);function a(e,t){return[e,t]}function s(e,t,i){return e[0]=t,e[1]=i,e}const l=new o.a("0/0/0/0");class c{constructor(e,t,i,n,r,o,a,s,l,c,h,u){this.level=e,this.resolution=t,this.scale=i,this.origin=n,this.first=r,this.last=o,this.size=a,this.norm=s,this.worldStart=l,this.worldEnd=c,this.worldSize=h,this.wrap=u}static create(e,t,i=null){const o=Object(n.e)(e.spatialReference),l=t.origin||a(e.origin.x,e.origin.y),h=a(e.size[0]*t.resolution,e.size[1]*t.resolution),u=a(-1/0,-1/0),d=a(1/0,1/0),f=a(1/0,1/0);Object(r.l)(i)&&(s(u,Math.max(0,Math.floor((i.xmin-l[0])/h[0])),Math.max(0,Math.floor((l[1]-i.ymax)/h[1]))),s(d,Math.max(0,Math.floor((i.xmax-l[0])/h[0])),Math.max(0,Math.floor((l[1]-i.ymin)/h[1]))),s(f,d[0]-u[0]+1,d[1]-u[1]+1));const{cols:_,rows:p}=t;let m,g,v,y;return!i&&_&&p&&(s(u,_[0],p[0]),s(d,_[1],p[1]),s(f,_[1]-_[0]+1,p[1]-p[0]+1)),e.isWrappable?(m=a(Math.ceil(Math.round((o.valid[1]-o.valid[0])/t.resolution)/e.size[0]),f[1]),g=a(Math.floor((o.origin[0]-l[0])/h[0]),u[1]),v=a(m[0]+g[0]-1,d[1]),y=!0):(g=u,v=d,m=f,y=!1),new c(t.level,t.resolution,t.scale,l,u,d,f,h,g,v,m,y)}normalizeCol(e){if(!this.wrap)return e;const t=this.worldSize[0];return e<0?t-1-Math.abs((e+1)%t):e%t}denormalizeCol(e,t){return this.wrap?this.worldSize[0]*t+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,t,i=!1){l.set(t);const n=i?l.col:this.denormalizeCol(l.col,l.world),r=l.row;return function(e,t,i,n,r){e[0]=t,e[1]=i,e[2]=n,e[3]=r}(e,this.getXForColumn(n),this.getYForRow(r+1),this.getXForColumn(n+1),this.getYForRow(r)),e}getTileCoords(e,t,i=!1){l.set(t);const n=i?l.col:this.denormalizeCol(l.col,l.world);return Array.isArray(e)?s(e,this.getXForColumn(n),this.getYForRow(l.row)):(e.x=this.getXForColumn(n),e.y=this.getYForRow(l.row)),e}}var h=i(1250);class u{constructor(e,t,i){this.row=e,this.colFrom=t,this.colTo=i}}const d=new o.a("0/0/0/0");class f{constructor(e,t,i,n,r,o,a,s){this.x=e,this.ymin=t,this.ymax=i,this.invM=n,this.leftAdjust=r,this.rightAdjust=o,this.leftBound=a,this.rightBound=s}static create(e,t){e[1]>t[1]&&([e,t]=[t,e]);const[i,n]=e,[r,o]=t,a=r-i,s=o-n,l=0!==s?a/s:0,c=(Math.ceil(n)-n)*l,h=(Math.floor(n)-n)*l;return new f(i,Math.floor(n),Math.ceil(o),l,a<0?c:h,a<0?h:c,a<0?r:i,a<0?i:r)}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const _=[[0,0],[0,0],[0,0],[0,0]];class p{constructor(e,t=null){this.tileInfo=e,this.fullExtent=t,this.scales=[],this._infoByScale={},this._infoByLevel={};const i=e.lods.slice();i.sort(((e,t)=>t.scale-e.scale));const n=this._lodInfos=i.map((i=>c.create(e,i,t)));i.forEach(((e,t)=>{this._infoByLevel[e.level]=n[t],this._infoByScale[e.scale]=n[t],this.scales[t]=e.scale}),this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel["number"==typeof e?e:e.level]}getTileBounds(e,t,i=!1){d.set(t);const n=this._infoByLevel[d.level];return n?n.getTileBounds(e,d,i):e}getTileCoords(e,t,i=!1){d.set(t);const n=this._infoByLevel[d.level];return n?n.getTileCoords(e,d,i):e}getTileCoverage(e,t=192,i="closest"){const n="closest"===i?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),r=h.a.pool.acquire(n),o=this._wrap;let a,s,l,c=1/0,d=-1/0;const p=r.spans;_[0][0]=_[0][1]=_[1][1]=_[3][0]=-t,_[1][0]=_[2][0]=e.size[0]+t,_[2][1]=_[3][1]=e.size[1]+t;for(const h of _)e.toMap(h,h),h[0]=n.getColumnForX(h[0]),h[1]=n.getRowForY(h[1]);const m=[];let g=3;for(let h=0;h<4;h++){if(_[h][1]===_[g][1]){g=h;continue}const e=f.create(_[h],_[g]);c=Math.min(e.ymin,c),d=Math.max(e.ymax,d),void 0===m[e.ymin]&&(m[e.ymin]=[]),m[e.ymin].push(e),g=h}if(null==c||null==d||d-c>100)return null;let v=[];for(a=c;a<d;){null!=m[a]&&(v=v.concat(m[a])),s=1/0,l=-1/0;for(let e=v.length-1;e>=0;e--){const t=v[e];s=Math.min(s,t.getLeftCol()),l=Math.max(l,t.getRightCol())}if(s=Math.floor(s),l=Math.floor(l),a>=n.first[1]&&a<=n.last[1])if(o)if(n.size[0]<n.worldSize[0]){const e=Math.floor(l/n.worldSize[0]);for(let t=Math.floor(s/n.worldSize[0]);t<=e;t++)p.push(new u(a,Math.max(n.getFirstColumnForWorld(t),s),Math.min(n.getLastColumnForWorld(t),l)))}else p.push(new u(a,s,l));else s>n.last[0]||l<n.first[0]||(s=Math.max(s,n.first[0]),l=Math.min(l,n.last[0]),p.push(new u(a,s,l)));a+=1;for(let e=v.length-1;e>=0;e--){const t=v[e];t.ymax>=a?t.incrRow():v.splice(e,1)}}return r}getTileParentId(e){d.set(e);const t=this._infoByLevel[d.level],i=this._lodInfos.indexOf(t)-1;return i<0?null:(this._getTileIdAtLOD(d,this._lodInfos[i],d),d.id)}getTileResolution(e){const t=this._infoByLevel["object"==typeof e?e.level:e];return t?t.resolution:-1}getTileScale(e){const t=this._infoByLevel[e.level];return t?t.scale:-1}intersects(e,t){d.set(t);const i=this._infoByLevel[d.level],n=e.lodInfo;if(n.resolution>i.resolution){this._getTileIdAtLOD(d,n,d);const t=n.denormalizeCol(d.col,d.world);for(const i of e.spans)if(i.row===d.row&&i.colFrom<=t&&i.colTo>=t)return!0}if(n.resolution<i.resolution){const[t,r,o,a]=e.spans.reduce(((e,t)=>(e[0]=Math.min(e[0],t.row),e[1]=Math.max(e[1],t.row),e[2]=Math.min(e[2],t.colFrom),e[3]=Math.max(e[3],t.colTo),e)),[1/0,-1/0,1/0,-1/0]),s=i.denormalizeCol(d.col,d.world),l=n.getColumnForX(i.getXForColumn(s)),c=n.getRowForY(i.getYForRow(d.row)),h=n.getColumnForX(i.getXForColumn(s+1))-1,u=n.getRowForY(i.getYForRow(d.row+1))-1;return!(l>a||h<o||c>r||u<t)}const r=n.denormalizeCol(d.col,d.world);return e.spans.some((e=>e.row===d.row&&e.colFrom<=r&&e.colTo>=r))}normalizeBounds(e,t,i){if(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],this._wrap){const t=Object(n.e)(this.tileInfo.spatialReference),r=-i*(t.valid[1]-t.valid[0]);e[0]+=r,e[2]+=r}return e}getSmallestInfoForScale(e){const t=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>t[0])return this._infoByScale[t[0]];for(let i=1;i<t.length-1;i++)if(e>t[i]+1e-6)return this._infoByScale[t[i-1]];return this._infoByScale[t[t.length-1]]}getClosestInfoForScale(e){const t=this.scales;return this._infoByScale[e]||(e=t.reduce(((t,i)=>Math.abs(i-e)<Math.abs(t-e)?i:t),t[0])),this._infoByScale[e]}scaleToLevel(e){const t=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let i=t.length-1;i>=0;i--)if(e<t[i])return i===t.length-1?this._infoByScale[t[t.length-1]].level:this._infoByScale[t[i]].level+(t[i]-e)/(t[i]-t[i+1]);return this._infoByScale[t[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,t,i){const n=this._infoByLevel[i.level];return e.set(i),t.resolution<n.resolution?null:(t.resolution===n.resolution||(e.level=t.level,e.col=Math.floor(i.col*n.resolution/t.resolution+.01),e.row=Math.floor(i.row*n.resolution/t.resolution+.01)),e)}}},1353:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return o}));var n=i(379),r=i(14);function o(e,t,i){const n=Object(r.p)(Math.ceil(i)),o=(e=>"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e)(t)?8*n:16*n,a=2*n;e.width=o,e.height=o;const s=e.getContext("2d");s.strokeStyle="#FFFFFF",s.lineWidth=n,s.beginPath(),"vertical"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSVertical"!==t||(s.moveTo(o/2,-a),s.lineTo(o/2,o+a)),"horizontal"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSHorizontal"!==t||(s.moveTo(-a,o/2),s.lineTo(o+a,o/2)),"forward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSDiagonalCross"!==t&&"esriSFSForwardDiagonal"!==t||(s.moveTo(-a,-a),s.lineTo(o+a,o+a),s.moveTo(o-a,-a),s.lineTo(o+a,a),s.moveTo(-a,o-a),s.lineTo(a,o+a)),"backward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSBackwardDiagonal"!==t&&"esriSFSDiagonalCross"!==t||(s.moveTo(o+a,-a),s.lineTo(-a,o+a),s.moveTo(a,-a),s.lineTo(-a,a),s.moveTo(o+a,o-a),s.lineTo(o-a,o+a)),s.stroke();const l=s.getImageData(0,0,e.width,e.height),c=new Uint8Array(l.data);let h;for(let r=0;r<c.length;r+=4)h=c[r+3]/255,c[r]=c[r]*h,c[r+1]=c[r+1]*h,c[r+2]=c[r+2]*h;return[c,e.width,e.height]}function a(e,t){const i="Butt"===t,r="Square"===t,o=!i&&!r;e.length%2==1&&(e=[...e,...e]);const a=15.5;let s=0;for(const n of e)s+=n;const l=Math.round(s*a),c=new Float32Array(31*l),h=7.75;let u=0,d=0,f=.5,_=!0;for(const n of e){for(u=d,d+=n*a;f<=d;){let e=.5;for(;e<31;){const t=(e-.5)*l+f-.5,n=o?(e-a)*(e-a):Math.abs(e-a);c[t]=_?i?Math.max(Math.max(u+h-f,n),Math.max(f-d+h,n)):n:o?Math.min((f-u)*(f-u)+n,(f-d)*(f-d)+n):r?Math.min(Math.max(f-u,n),Math.max(d-f,n)):Math.min(Math.max(f-u+h,n),Math.max(d+h-f,n)),e++}f++}_=!_}const p=c.length,m=new Uint8Array(4*p);for(let g=0;g<p;++g){const e=(o?Math.sqrt(c[g]):c[g])/a;Object(n.a)(e,m,4*g)}return[m,l,31]}},1636:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return Le}));var n=i(0),r=i(16),o=i(2),a=i(23),s=i(13),l=i(1),c=(i(17),i(12),i(10));class h{constructor(e,t){this._lockedSchemaPixelSize=e,this._isGCS=t}getLevelRowColumn(e){return this._isGCS?[e[0],e[1]>>1,e[2]>>1]:256===this._lockedSchemaPixelSize&&e[0]>0?[e[0]-1,e[1]>>1,e[2]>>1]:e}adjustLevel(e){return this._isGCS?e:256===this._lockedSchemaPixelSize?e>0?e-1:0:e}getShift(e,t){let i=0,n=0;return(256===this._lockedSchemaPixelSize||this._isGCS)&&(e[2]%2&&(i=t),e[1]%2&&(n=t)),[i,n]}getScale(e){if(this._isGCS){if(512===this._lockedSchemaPixelSize)return 4}else if(256===this._lockedSchemaPixelSize&&0===e)return 1;return 2}}var u=i(460),d=i(239),f=i(37),_=i(44),p=i(512),m=i(1198);class g{constructor(e,t){this._width=0,this._height=0,this._free=[],this._width=e,this._height=t,this._free.push(new m.a(0,0,e,t))}get width(){return this._width}get height(){return this._height}allocate(e,t){if(e>this._width||t>this._height)return new m.a;let i=null,n=-1;for(let r=0;r<this._free.length;++r){const o=this._free[r];e<=o.width&&t<=o.height&&(null===i||o.y<=i.y&&o.x<=i.x)&&(i=o,n=r)}return null===i?new m.a:(this._free.splice(n,1),i.width<i.height?(i.width>e&&this._free.push(new m.a(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new m.a(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new m.a(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new m.a(i.x,i.y+t,e,i.height-t))),new m.a(i.x,i.y,e,t))}release(e){for(let t=0;t<this._free.length;++t){const i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}var v=i(7),y=i(89);class b{constructor(e,t,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=e,this.height=t,this._glyphSource=i,this._binPack=new g(e-4,t-4),this._glyphData.push(new Uint8Array(e*t)),this._dirties.push(!0),this._textures.push(void 0)}getGlyphItems(e,t){const i=[],n=this._glyphSource,r=new Set;for(const a of t){const e=Math.floor(.00390625*a);r.add(e)}const o=[];return r.forEach((t=>{if(t<=256){const i=e+t;if(this._rangePromises.has(i))o.push(this._rangePromises.get(i));else{const r=n.getRange(e,t).then((()=>{this._rangePromises.delete(i)}),(()=>{this._rangePromises.delete(i)}));this._rangePromises.set(i,r),o.push(r)}}})),Promise.all(o).then((()=>{let r=this._glyphIndex[e];r||(r={},this._glyphIndex[e]=r);for(const o of t){const t=r[o];if(t){i[o]={sdf:!0,rect:t.rect,metrics:t.metrics,page:t.page,code:o};continue}const a=n.getGlyph(e,o);if(!a||!a.metrics)continue;const s=a.metrics;let l;if(0===s.width)l=new m.a(0,0,0,0);else{const e=3,t=s.width+2*e,i=s.height+2*e;let n=t%4?4-t%4:4,r=i%4?4-i%4:4;1===n&&(n=5),1===r&&(r=5),l=this._binPack.allocate(t+n,i+r),l.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new g(this.width-4,this.height-4),l=this._binPack.allocate(t+n,i+r));const o=this._glyphData[this._currentPage],c=a.bitmap;let h,u;if(c)for(let a=0;a<i;a++){h=t*a,u=this.width*(l.y+a+1)+l.x;for(let e=0;e<t;e++)o[u+e+1]=c[h+e]}}r[o]={rect:l,metrics:s,tileIDs:null,page:this._currentPage},i[o]={sdf:!0,rect:l,metrics:s,page:this._currentPage,code:o},this._dirties[this._currentPage]=!0}return i}))}removeGlyphs(e){for(const t in this._glyphIndex){const i=this._glyphIndex[t];if(!i)continue;let n;for(const t in i)if(n=i[t],n.tileIDs.delete(e),0===n.tileIDs.size){const e=this._glyphData[n.page],r=n.rect;let o,a;for(let t=0;t<r.height;t++)for(o=this.width*(r.y+t)+r.x,a=0;a<r.width;a++)e[o+a]=0;delete i[t],this._dirties[n.page]=!0}}}bind(e,t,i,n=0){this._textures[i]||(this._textures[i]=new y.a(e,{pixelFormat:v.p.ALPHA,dataType:v.q.UNSIGNED_BYTE,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));const r=this._textures[i];r.setSamplingMode(t),this._dirties[i]&&r.setData(this._glyphData[i]),e.bindTexture(r,n),this._dirties[i]=!1}dispose(){this._binPack=null;for(const e of this._textures)e&&e.dispose();this._textures.length=0}}var w=i(134),x=i(872);class S{constructor(e){if(this._metrics=[],this._bitmaps=[],e)for(;e.next();)switch(e.tag()){case 1:{const t=e.getMessage();for(;t.next();)switch(t.tag()){case 3:{const e=t.getMessage();let i,n,r,o,a,s,l;for(;e.next();)switch(e.tag()){case 1:i=e.getUInt32();break;case 2:n=e.getBytes();break;case 3:r=e.getUInt32();break;case 4:o=e.getUInt32();break;case 5:a=e.getSInt32();break;case 6:s=e.getSInt32();break;case 7:l=e.getUInt32();break;default:e.skip()}e.release(),i&&(this._metrics[i]={width:r,height:o,left:a,top:s,advance:l},this._bitmaps[i]=n);break}default:t.skip()}t.release();break}default:e.skip()}}getMetrics(e){return this._metrics[e]}getBitmap(e){return this._bitmaps[e]}}class T{constructor(){this._ranges=[]}getRange(e){return this._ranges[e]}addRange(e,t){this._ranges[e]=t}}class I{constructor(e){this._glyphInfo={},this._baseURL=e}getRange(e,t){const i=this._getFontStack(e);if(i.getRange(t))return Promise.resolve();const n=256*t,r=n+255;if(this._baseURL){const o=this._baseURL.replace("{fontstack}",e).replace("{range}",n+"-"+r);return Object(w.default)(o,{responseType:"array-buffer"}).then((e=>{i.addRange(t,new S(new x.a(new Uint8Array(e.data),new DataView(e.data))))})).catch((()=>{i.addRange(t,new S)}))}return i.addRange(t,new S),Promise.resolve()}getGlyph(e,t){const i=this._getFontStack(e);if(!i)return;const n=Math.floor(t/256);if(n>256)return;const r=i.getRange(n);return r?{metrics:r.getMetrics(t),bitmap:r.getBitmap(t)}:void 0}_getFontStack(e){let t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new T),t}}var M=i(1353);class O{constructor(e,t,i=0){this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(e<=0||t<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=e,this._pageHeight=t,i>0&&(this._maxItemSize=i),this._binPack=new g(e-4,t-4)}dispose(){this._binPack=null,this._mosaicRects={};for(const e of this._textures)e&&e.dispose();this._textures.length=0}getWidth(e){return e>=this._size.length?-1:this._size[e][0]}getHeight(e){return e>=this._size.length?-1:this._size[e][1]}getPageSize(e){return e>=this._size.length?null:this._size[e]}setSpriteSource(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new g(this._pageWidth-4,this._pageHeight-4);const e=Math.floor(this._pageWidth),t=Math.floor(this._pageHeight),i=new Uint32Array(e*t);this._mosaicsData[0]=i,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}getSpriteItem(e,t=!1){let i,n,r=this._mosaicRects[e];if(r)return r;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(e&&e.startsWith("dasharray-")?([i,n]=this._rasterizeDash(e),t=!0):i=this._sprites.getSpriteInfo(e),!i||!i.width||!i.height||i.width<0||i.height<0)return null;const o=i.width,a=i.height,[s,l,c]=this._allocateImage(o,a);return s.width<=0?null:(this._copy(s,i,l,c,t,n),r={rect:s,width:o,height:a,sdf:i.sdf,simplePattern:!1,pixelRatio:i.pixelRatio,page:l},this._mosaicRects[e]=r,r)}getSpriteItems(e){const t={};for(const i of e)t[i.name]=this.getSpriteItem(i.name,i.repeat);return t}getMosaicItemPosition(e,t){const i=this.getSpriteItem(e,t),n=i&&i.rect;if(!n)return null;n.width=i.width,n.height=i.height;const r=i.width,o=i.height;return{tl:[n.x+2,n.y+2],br:[n.x+2+r,n.y+2+o],page:i.page}}bind(e,t,i=0,n=0){if(i>=this._size.length||i>=this._mosaicsData.length)return;this._textures[i]||(this._textures[i]=new y.a(e,{pixelFormat:v.p.RGBA,dataType:v.q.UNSIGNED_BYTE,wrapMode:v.B.CLAMP_TO_EDGE,width:this._size[i][0],height:this._size[i][1]},new Uint8Array(this._mosaicsData[i].buffer)));const r=this._textures[i];r.setSamplingMode(t),this._dirties[i]&&r.setData(new Uint8Array(this._mosaicsData[i].buffer)),e.bindTexture(r,n),this._dirties[i]=!1}static _copyBits(e,t,i,n,r,o,a,s,l,c,h){let u=n*t+i,d=s*o+a;if(h){d-=o;for(let a=-1;a<=c;a++,u=((a+c)%c+n)*t+i,d+=o)for(let t=-1;t<=l;t++)r[d+t]=e[u+(t+l)%l]}else for(let f=0;f<c;f++){for(let t=0;t<l;t++)r[d+t]=e[u+t];u+=t,d+=o}}_copy(e,t,i,n,r,o){if(!this._sprites||"loaded"!==this._sprites.loadStatus||i>=this._mosaicsData.length)return;const a=new Uint32Array(o?o.buffer:this._sprites.image.buffer),s=this._mosaicsData[i];s&&a||console.error("Source or target images are uninitialized!");const l=o?t.width:this._sprites.width;O._copyBits(a,l,t.x,t.y,s,n[0],e.x+2,e.y+2,t.width,t.height,r),this._dirties[i]=!0}_allocateImage(e,t){e+=2,t+=2;const i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){const i=new m.a(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[i,this._mosaicsData.length-1,[e,t]]}let n=e%4?4-e%4:4,r=t%4?4-t%4:4;1===n&&(n=5),1===r&&(r=5);const o=this._binPack.allocate(e+n,t+r);return o.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new g(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[o,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(e){const t=e.match(/\[(.*?)\]/);if(!t)return null;const i=t[1].split(",").map(Number),n=e.slice(e.lastIndexOf("-")+1),[r,o,a]=Object(M.a)(i,n);return[{x:0,y:0,width:o,height:a,sdf:!0,pixelRatio:1},new Uint8Array(r.buffer)]}}var P=i(905);class R{constructor(e,t,i){this._layer=e,this._styleRepository=t,this.devicePixelRatio=i,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null}destroy(){this._connection&&(this._connection.close(),this._connection=null),this._styleRepository=null,this._layer=null,this._spriteMosaic&&(this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic=null)}get spriteMosaic(){return this._spriteSourcePromise.then((()=>this._spriteMosaic))}get glyphMosaic(){return this._glyphMosaic}async start(e){this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,e),this._spriteSourcePromise.then((e=>{this._spriteMosaic=new O(1024,1024,250),this._spriteMosaic.setSpriteSource(e)}));const t=new I(this._layer.currentStyleInfo.glyphsUrl?Object(_.e)(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new b(1024,1024,t),this._broadcastPromise=Object(p.b)("WorkerTileHandler",{client:this,schedule:e.schedule,signal:e.signal}).then((t=>{if(this._connection=t,this._layer&&!this._connection.closed){const i=t.broadcast("setStyle",this._layer.currentStyleInfo.style,e);Promise.all(i).catch((e=>Object(a.r)(e)))}}))}async updateStyle(e){return await this._broadcastPromise,this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",e)),this._broadcastPromise}setSpriteSource(e){const t=new O(1024,1024,250);return t.setSpriteSource(e),this._spriteMosaic=t,this._spriteSourcePromise=Promise.resolve(e),t}async setStyle(e,t){await this._broadcastPromise,this._styleRepository=e,this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,null),this._spriteSourcePromise.then((e=>{this._spriteMosaic=new O(1024,1024,250),this._spriteMosaic.setSpriteSource(e)}));const i=new I(this._layer.currentStyleInfo.glyphsUrl?Object(_.e)(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);return this._glyphMosaic=new b(1024,1024,i),this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",t)),this._broadcastPromise}fetchTileData(e,t){return this._getRefKeys(e,t).then((e=>{const i=this._layer.sourceNameToSource,n=[];for(const t in i)n.push(t);return this._getSourcesData(n,e,t)}))}parseTileData(e,t){const i=e&&e.data;if(!i)return Promise.resolve(null);const{sourceName2DataAndRefKey:n,transferList:r}=i;return 0===Object.keys(n).length?Promise.resolve(null):this._broadcastPromise.then((()=>this._connection.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:n,styleLayerUIDs:e.styleLayerUIDs},{...t,transferList:r})))}async getSprites(e){return await this._spriteSourcePromise,this._spriteMosaic.getSpriteItems(e)}getGlyphs(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}async _getTilePayload(e,t,i){const n=P.a.pool.acquire(e.id),r=this._layer.sourceNameToSource[t],{level:o,row:s,col:l}=n;P.a.pool.release(n);try{return{protobuff:await r.requestTile(o,s,l,i),sourceName:t}}catch(c){if(Object(a.j)(c))throw c;return{protobuff:null,sourceName:t}}}_getRefKeys(e,t){const i=this._layer.sourceNameToSource,n=new Array;for(const r in i){const o=i[r].getRefKey(e,t);n.push(o)}return Object(a.g)(n)}_getSourcesData(e,t,i){const n=[];for(let r=0;r<t.length;r++)if(null==t[r].value||null==e[r])n.push(null);else{const o=this._getTilePayload(t[r].value,e[r],i);n.push(o)}return Object(a.g)(n).then((e=>{const i={},n=[];for(let r=0;r<e.length;r++)if(e[r].value&&e[r].value&&e[r].value.protobuff&&e[r].value.protobuff.byteLength>0){const o=t[r].value.id;i[e[r].value.sourceName]={refKey:o,protobuff:e[r].value.protobuff},n.push(e[r].value.protobuff)}return{sourceName2DataAndRefKey:i,transferList:n}}))}}var C=i(657),E=i(993),L=i(876),D=i(937),A=i(1137);function U(e,t,i,n,r,o){const{iconRotationAlignment:a,textRotationAlignment:s,iconTranslate:l,iconTranslateAnchor:c,textTranslate:h,textTranslateAnchor:u}=n;let d=0;for(const f of e.colliders){const[e,n]=0===f.partIndex?l:h,_=0===f.partIndex?c:u,p=f.minLod<=o&&o<=f.maxLod;d+=p?0:1,f.enabled=p,f.xScreen=f.xTile*r[0]+f.yTile*r[3]+r[6],f.yScreen=f.xTile*r[1]+f.yTile*r[4]+r[7],_===A.i.MAP?(f.xScreen+=i*e-t*n,f.yScreen+=t*e+i*n):(f.xScreen+=e,f.yScreen+=n),A.a.VIEWPORT===(0===f.partIndex?a:s)?(f.dxScreen=f.dxPixels,f.dyScreen=f.dyPixels):(f.dxScreen=i*(f.dxPixels+f.width/2)-t*(f.dyPixels+f.height/2)-f.width/2,f.dyScreen=t*(f.dxPixels+f.width/2)+i*(f.dyPixels+f.height/2)-f.height/2)}e.colliders.length>0&&d===e.colliders.length&&(e.unique.show=!1)}class F{constructor(e,t,i,n,r,o){this._symbols=e,this._styleRepository=n,this._zoom=r,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new D.a(t,i,L.a),this._si=Math.sin(Math.PI*o/180),this._co=Math.cos(Math.PI*o/180);for(const a of e)for(const e of a.symbols)this._allNeededMatrices.has(e.tile)||this._allNeededMatrices.set(e.tile,Object(d.a)(e.tile.transforms.tileUnitsToPixels))}work(e){const t=this._gridIndex;function i(e){const i=e.xScreen+e.dxScreen,n=e.yScreen+e.dyScreen,r=i+e.width,o=n+e.height,[a,s,l,c]=t.getCellSpan(i,n,r,o);for(let h=s;h<=c;h++)for(let e=a;e<=l;e++){const a=t.cells[h][e];for(const e of a){const t=e.xScreen+e.dxScreen,a=e.yScreen+e.dyScreen,s=t+e.width,l=a+e.height;if(!(r<t||i>s||o<a||n>l))return!0}}return!1}const n=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const t=this._symbols[this._currentLayerCursor],r=this._getProperties(t.styleLayerUID);for(;this._currentSymbolCursor<t.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-n>e)return!1;const o=t.symbols[this._currentSymbolCursor];if(!o.unique.show)continue;U(o,this._si,this._co,r,this._allNeededMatrices.get(o.tile),this._zoom);const a=o.unique;if(!a.show)continue;const{iconAllowOverlap:s,iconIgnorePlacement:l,textAllowOverlap:c,textIgnorePlacement:h}=r;for(const e of o.colliders){if(!e.enabled)continue;const t=a.parts[e.partIndex];t.show&&(!(e.partIndex?c:s)&&i(e)&&(e.hard?a.show=!1:t.show=!1))}if(a.show)for(const e of o.colliders){if(!e.enabled)continue;if(e.partIndex?h:l)continue;if(!a.parts[e.partIndex].show)continue;const t=e.xScreen+e.dxScreen,i=e.yScreen+e.dyScreen,n=t+e.width,r=i+e.height,[o,s,c,u]=this._gridIndex.getCellSpan(t,i,n,r);for(let a=s;a<=u;a++)for(let t=o;t<=c;t++)this._gridIndex.cells[a][t].push(e)}}}return!0}_getProperties(e){const t=this._styleProps.get(e);if(t)return t;const i=this._zoom,n=this._styleRepository.getStyleLayerByUID(e),r=n.getLayoutValue("symbol-placement",i)!==A.e.POINT;let o=n.getLayoutValue("icon-rotation-alignment",i);o===A.a.AUTO&&(o=r?A.a.MAP:A.a.VIEWPORT);let a=n.getLayoutValue("text-rotation-alignment",i);a===A.a.AUTO&&(a=r?A.a.MAP:A.a.VIEWPORT);const s=n.getPaintValue("icon-translate",i),l=n.getPaintValue("icon-translate-anchor",i),c=n.getPaintValue("text-translate",i),h=n.getPaintValue("text-translate-anchor",i),u={iconAllowOverlap:n.getLayoutValue("icon-allow-overlap",i),iconIgnorePlacement:n.getLayoutValue("icon-ignore-placement",i),textAllowOverlap:n.getLayoutValue("text-allow-overlap",i),textIgnorePlacement:n.getLayoutValue("text-ignore-placement",i),iconRotationAlignment:o,textRotationAlignment:a,iconTranslateAnchor:l,iconTranslate:s,textTranslateAnchor:h,textTranslate:c};return this._styleProps.set(e,u),u}}function z(e,t){if(e.priority-t.priority)return e.priority-t.priority;const i=e.tile.key,n=t.tile.key;return i.world-n.world?i.world-n.world:i.level-n.level?i.level-n.level:i.row-n.row?i.row-n.row:i.col-n.col?i.col-n.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}class j{constructor(e,t,i,n,r,o){this._visibleTiles=e,this._symbolRepository=t,this._createCollisionJob=i,this._assignTileSymbolsOpacity=n,this._symbolLayerSorter=r,this._isLayerVisible=o,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}get running(){return this._running}setScreenSize(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const t=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const t=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}return this._running=!1,!0}_createSelectionJob(){const e=this._symbolRepository.uniqueSymbols;for(let a=0;a<e.length;a++){const t=e[a];for(let e=0;e<t.uniqueSymbols.length;e++){const i=t.uniqueSymbols[e];for(const e of i.tileSymbols)e.selectedForRendering=!1}}const t=[];let i=0,n=0;const r=this._isLayerVisible;const o=this._symbolLayerSorter;return{work:function(o){let a;const s=performance.now();for(;n<e.length;n++,i=0){const l=e[n],c=l.styleLayerUID;if(!r(c)){t[n]||(t[n]={styleLayerUID:c,symbols:[]});continue}t[n]=t[n]||{styleLayerUID:c,symbols:[]};const h=t[n];for(;i<l.uniqueSymbols.length;i++){if(a=l.uniqueSymbols[i],i%100==99&&performance.now()-s>o)return!1;let e=null,t=!1,n=!1;for(const i of a.tileSymbols)if(!n||!t){const r=i.tile;(!e||r.isCoverage||r.neededForCoverage&&!t)&&(e=i,(r.neededForCoverage||r.isCoverage)&&(n=!0),r.isCoverage&&(t=!0))}if(e.selectedForRendering=!0,n){h.symbols.push(e),a.show=!0;for(const e of a.parts)e.show=!0}else a.show=!1}}for(const e of t)e.symbols.sort(z);return!0},get sortedSymbols(){return t.sort(o)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,t=this._visibleTiles;let i=0;function n(t,i){const r=t.symbols;for(const[e,n]of r)k(n,i);e(t,i);for(const e of t.childrenTiles)n(e,i)}return{work(e){const r=performance.now();for(;i<t.length;i++){if(performance.now()-r>e)return!1;const a=t[i];Object(o.l)(a.parentTile)||n(a,performance.now())}return!0}}}}function k(e,t){for(const i of e){const e=i.unique;for(const i of e.parts){const n=i.targetOpacity>.5?1:-1;i.startOpacity+=n*((t-i.startTime)/L.c),i.startOpacity=Math.min(Math.max(i.startOpacity,0),1),i.startTime=t,i.targetOpacity=e.show&&i.show?1:0}}}class N{constructor(e,t,i){this.tileCoordRange=e,this._visibleTiles=t,this._createUnique=i,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return Object(o.k)(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}add(e,t){this._uniqueSymbolLayerArray=null;let i=this._tiles.get(e.id);i||(i={symbols:new Map},this._tiles.set(e.id,i));const n=new Map;if(t)for(const a of t)i.symbols.has(a)&&(n.set(a,i.symbols.get(a)),i.symbols.delete(a));else for(const[a,s]of e.layerData)i.symbols.has(a)&&(n.set(a,i.symbols.get(a)),i.symbols.delete(a));this._removeSymbols(n);const r=e.symbols,o=new Map;for(const[a,s]of r){let e=s.length;if(e>=32){let t=this.tileCoordRange;do{t/=2,e/=4}while(e>8&&t>64);const n=new D.a(this.tileCoordRange,this.tileCoordRange,t);o.set(a,{flat:s,index:n}),i.symbols.set(a,{flat:s,index:n});for(const e of s)n.getCell(e.xTile,e.yTile).push(e)}else o.set(a,{flat:s}),i.symbols.set(a,{flat:s})}this._addSymbols(e.key,r)}deleteStyleLayers(e){this._uniqueSymbolLayerArray=null;for(const[t,i]of this._tiles){const n=new Map;for(const t of e)i.symbols.has(t)&&(n.set(t,i.symbols.get(t)),i.symbols.delete(t));this._removeSymbols(n),0===i.symbols.size&&this._tiles.delete(t)}}removeTile(e){this._uniqueSymbolLayerArray=null;const t=this._tiles.get(e.id);if(!t)return;const i=new Map;for(const[n,r]of e.symbols)t.symbols.has(n)&&(i.set(n,t.symbols.get(n)),t.symbols.delete(n));this._removeSymbols(i),0===t.symbols.size&&this._tiles.delete(e.id)}_removeSymbols(e){for(const[t,{flat:i}]of e)for(const e of i){const i=e.unique,n=i.tileSymbols,r=n.length-1;for(let t=0;t<r;t++)if(n[t]===e){n[t]=n[r];break}if(n.length=r,0===r){const e=this._uniqueSymbolsReferences.get(t);e.delete(i),0===e.size&&this._uniqueSymbolsReferences.delete(t)}e.unique=null}}_addSymbols(e,t){if(0===t.size)return;const i=this._visibleTiles;for(const n of i)n.parentTile||n.key.world!==e.world||n.key.level===e.level&&!n.key.equals(e)||this._matchSymbols(n,e,t);for(const[n,r]of t)for(const e of r)if(Object(o.k)(e.unique)){const t=this._createUnique();e.unique=t,t.tileSymbols.push(e);let i=this._uniqueSymbolsReferences.get(n);i||(i=new Set,this._uniqueSymbolsReferences.set(n,i)),i.add(t)}}_matchSymbols(e,t,i){if(e.key.level>t.level){const i=e.key.level-t.level;if(e.key.row>>i!==t.row||e.key.col>>i!==t.col)return}if(t.level>e.key.level){const i=t.level-e.key.level;if(t.row>>i!==e.key.row||t.col>>i!==e.key.col)return}if(t.equals(e.key)){for(const n of e.childrenTiles)this._matchSymbols(n,t,i);return}const n=new Map;for(const[r,a]of i){const i=[];for(const n of a){const r=Object(D.c)(this.tileCoordRange,n.xTile,t.level,t.col,e.key.level,e.key.col),o=Object(D.c)(this.tileCoordRange,n.yTile,t.level,t.row,e.key.level,e.key.row);r>=0&&r<this.tileCoordRange&&o>=0&&o<this.tileCoordRange&&i.push({symbol:n,xTransformed:r,yTransformed:o})}const s=[],l=e.key.level<t.level?1:1<<e.key.level-t.level,c=this._tiles.get(e.id).symbols.get(r);if(c){const e=c.flat;for(const t of i){let i,n=!1;const r=t.xTransformed,a=t.yTransformed;i=Object(o.l)(c.index)?c.index.getCell(r,a):e;const h=t.symbol,u=h.hash;for(const e of i)if(u===e.hash&&Math.abs(r-e.xTile)<=l&&Math.abs(a-e.yTile)<=l){const t=e.unique;h.unique=t,t.tileSymbols.push(h),n=!0;break}n||s.push(h)}}s.length>0&&n.set(r,s)}for(const r of e.childrenTiles)this._matchSymbols(r,t,n)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsReferences,t=new Array(e.size);let i,n=0;for(const[r,o]of e){const e=new Array(o.size);i=0;for(const t of o)e[i++]=t;t[n]={styleLayerUID:r,uniqueSymbols:e},n++}return t}}var V=i(672),B=i(1314);class H extends B.a{constructor(){super(...arguments),this._fullCacheLodInfos=null,this._levelByScale={}}getTileParentId(e){const t=P.a.pool.acquire(e),i=0===t.level?null:P.a.getId(t.level-1,t.row>>1,t.col>>1,t.world);return P.a.pool.release(t),i}getTileCoverage(e,t,i){const n=super.getTileCoverage(e,t,i);if(!n)return n;const r=1<<n.lodInfo.level;return n.spans=n.spans.filter((e=>e.row>=0&&e.row<r)),n}scaleToLevel(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];{const t=this._fullCacheLodInfos;if(e>t[0].scale)return t[0].level;let i,n;for(let r=0;r<t.length-1;r++)if(n=t[r+1],e>n.scale)return i=t[r],i.level+(i.scale-e)/(i.scale-n.scale);return t[t.length-1].level}}_initializeFullCacheLODs(e){let t;if(0===e[0].level)t=e.map((e=>({level:e.level,resolution:e.resolution,scale:e.scale})));else{const e=this.tileInfo.size[0],i=this.tileInfo.spatialReference;t=V.a.create({size:e,spatialReference:i}).lods.map((e=>({level:e.level,resolution:e.resolution,scale:e.scale})))}for(let i=0;i<t.length;i++)this._levelByScale[t[i].scale]=t[i].level;this._fullCacheLodInfos=t}}class q extends R{constructor(e,t,i,n,r){super(e,t,i),this._memCache=n,this._loader=r,this._ongoingTileRequests=new Map,this._ongoingRequestToController=new Map,this._tileInfoView=new H(e.tileInfo,e.fullExtent)}destroy(){super.destroy(),this._ongoingRequestToController.forEach((e=>e.abort())),this._ongoingRequestToController.clear(),this._ongoingTileRequests.clear()}async getVectorTile(e,t,i,n){const r=new P.a(e,t,i,0);let s=this._memCache.get(r.id);if(Object(o.l)(s))return s.retain(),s;const l=await this._getVectorTileData(r);if(Object(a.q)(n),!this._layer)return null;if(s=this._memCache.get(r.id),Object(o.l)(s))return s.retain(),s;const c=this._layer.tileInfo.getTileBounds(Object(f.m)(),r),h=this._tileInfoView.getTileResolution(e);return s=new C.a(r,h,c[0],c[3],512,512,this._styleRepository,this._memCache),Object(o.l)(l)?(s.setData(l),s.retain(),this._memCache.put(r.id,s,s.memoryUsage*s.referenced,u.a)):s.setData(null),s.neededForCoverage=!0,s.transforms.tileUnitsToPixels=Object(d.c)(1/8,0,0,0,1/8,0,0,0,1),function(e,t){const i=[],n=new N(4096,i,(()=>{const e=new E.b;return e.show=!1,e.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1}),e.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1}),e})),r=new j(i,n,((t,i,n)=>new F(t,i,n,e.styleRepository,e.key.level,0)),((e,t)=>{Object(D.d)(e,t,!1)}),(()=>0),(e=>{const i=t.getStyleLayerByUID(e).getLayoutProperty("visibility");return!i||i.getValue()!==A.j.NONE}));i.push(e),n.add(e),r.setScreenSize(512,512),r.continue(1/0)}(s,this._styleRepository),s}_getVectorTileData(e){const t=e.id;if(this._ongoingTileRequests.has(t))return this._ongoingTileRequests.get(t);const i=new AbortController,n={signal:i.signal},r=this._getParsedVectorTileData(e,n).then((e=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),e))).catch((()=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),null)));return this._ongoingTileRequests.set(t,r),this._ongoingRequestToController.set(t,i),r}_getParsedVectorTileData(e,t){return this.fetchTileData(e,t).then((i=>this.parseTileData({key:e,data:i},t)))}request(e,t){return this._loader.request(e,"binary",t)}}var W=i(14),G=i(401),Y=i(1103),J=i(1113),X=i(1112);class K{constructor(){this.name=this.constructor.name||"UnnamedBrush",this.brushEffect=null}prepareState(e,t){}draw(e,t,i){}drawMany(e,t,i){for(const n of t)n.visible&&this.draw(e,n,i)}}var $=i(111),Z=i(289);const Q=1/65536;var ee=i(341),te=i(1199);const ie={vtlBackground:class extends K{constructor(){super(...arguments),this._color=Object(G.c)(1,0,0,1),this._patternMatrix=Object(d.b)(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(e,t){const{context:i,painter:n,styleLayerUID:r,requestRender:a,allowDelayedRender:s}=e;this._loadWGLResources(e);const l=e.displayLevel,c=e.styleLayer,h=c.backgroundMaterial,u=n.vectorTilesMaterialManager,d=c.getPaintValue("background-color",l),f=c.getPaintValue("background-opacity",l),_=c.getPaintValue("background-pattern",l),p=void 0!==_,m=d[3]*f,g=1|window.devicePixelRatio,y=e.spriteMosaic;let b,w;const x=g>Y.A?2:1,S=e.drawPhase===J.b.HITTEST,T=this._programOptions;T.id=S,T.pattern=p;const I=u.getMaterialProgram(i,h,T);if(s&&Object(o.l)(a)&&!I.isCompiled)a();else{if(i.bindVAO(this._vao),i.useProgram(I),p){const e=y.getMosaicItemPosition(_,!0);if(Object(o.l)(e)){const{tl:t,br:n,page:r}=e;b=n[0]-t[0],w=n[1]-t[1];const a=y.getPageSize(r);Object(o.l)(a)&&(y.bind(i,v.z.LINEAR,r,Y.C),I.setUniform4f("u_tlbr",t[0],t[1],n[0],n[1]),I.setUniform2fv("u_mosaicSize",a),I.setUniform1i("u_texture",Y.C))}I.setUniform1f("u_opacity",f)}else this._color[0]=m*d[0],this._color[1]=m*d[1],this._color[2]=m*d[2],this._color[3]=m,I.setUniform4fv("u_color",this._color);if(I.setUniform1f("u_depth",c.z||0),S){const e=Object(X.c)(r+1);I.setUniform4fv("u_id",e)}for(const e of t){if(I.setUniform1f("u_coord_range",e.rangeX),I.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),p){const t=Math.max(2**(Math.round(l)-e.key.level),1),i=x*e.width*t,n=i/Object(W.p)(b),r=i/Object(W.p)(w);this._patternMatrix[0]=n,this._patternMatrix[4]=r,I.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}i.setStencilFunction(v.h.EQUAL,0,255),i.drawArrays(v.r.TRIANGLE_STRIP,0,4)}}}_loadWGLResources(e){if(this._vao)return;const{context:t,styleLayer:i}=e,n=i.backgroundMaterial,r=new Int8Array([0,0,1,0,0,1,1,1]),o=$.a.createVertex(t,v.D.STATIC_DRAW,r),a=new Z.a(t,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:o});this._vao=a}},vtlFill:class extends K{constructor(){super(...arguments),this._fillProgramOptions={id:!1,pattern:!1},this._outlineProgramOptions={id:!1}}dispose(){}drawMany(e,t){const{displayLevel:i,drawPhase:n,renderPass:r,spriteMosaic:o,styleLayerUID:a}=e;let s=!1;for(const b of t)if(b.layerData.has(a)){const e=b.layerData.get(a);if(e.fillIndexCount>0||e.outlineIndexCount>0){s=!0;break}}if(!s)return;const l=e.styleLayer,c=l.getPaintProperty("fill-pattern"),h=void 0!==c,u=h&&c.isDataDriven;let d;if(h&&!u){const e=c.getValue(i);d=o.getMosaicItemPosition(e,!0)}const f=!h&&l.getPaintValue("fill-antialias",i);let _,p=!0,m=1;if(!h){const e=l.getPaintProperty("fill-color"),t=l.getPaintProperty("fill-opacity");if((null==e||!e.isDataDriven)&&(null==t||!t.isDataDriven)){const e=l.getPaintValue("fill-color",i);m=l.getPaintValue("fill-opacity",i)*e[3],m>=1&&(p=!1)}}if(p&&"opaque"===r)return;n===J.b.HITTEST&&(_=Object(X.c)(a+1));const g=l.getPaintValue("fill-translate",i),v=l.getPaintValue("fill-translate-anchor",i);(p||"translucent"!==r)&&this._drawFill(e,a,l,t,g,v,h,d,u,_);const y=!l.hasDataDrivenOutlineColor&&l.outlineUsesFillColor&&m<1;f&&"opaque"!==r&&!y&&this._drawOutline(e,a,l,t,g,v,_)}_drawFill(e,t,i,n,r,a,s,l,c,h){if(s&&!c&&Object(o.k)(l))return;const{context:u,displayLevel:d,state:f,drawPhase:_,painter:p,pixelRatio:m,spriteMosaic:g,requestRender:y,allowDelayedRender:b}=e,w=i.fillMaterial,x=p.vectorTilesMaterialManager,S=m>Y.A?2:1,T=_===J.b.HITTEST,I=this._fillProgramOptions;I.id=T,I.pattern=s;const M=x.getMaterialProgram(u,w,I);if(b&&Object(o.l)(y)&&!M.isCompiled)return void y();if(u.useProgram(M),Object(o.l)(l)){const{page:e}=l,t=g.getPageSize(e);Object(o.l)(t)&&(g.bind(u,v.z.LINEAR,e,Y.C),M.setUniform2fv("u_mosaicSize",t),M.setUniform1i("u_texture",Y.C))}M.setUniformMatrix3fv("u_displayMat3",a===A.i.VIEWPORT?f.displayMat3:f.displayViewMat3),M.setUniform2fv("u_fillTranslation",r),M.setUniform1f("u_depth",i.z+Q),T&&M.setUniform4fv("u_id",h);let O=-1;for(const P of n){if(!P.layerData.has(t))continue;P.key.level!==O&&(O=P.key.level,w.setDataUniforms(M,d,i,O,g));const e=P.layerData.get(t);if(!e.fillIndexCount)continue;e.prepareForRendering(u);const n=e.fillVertexArrayObject;if(!Object(o.k)(n)){if(u.bindVAO(n),M.setUniformMatrix3fv("u_dvsMat3",P.transforms.dvs),u.setStencilFunction(v.h.EQUAL,P.stencilRef,255),s){const e=Math.max(2**(Math.round(d)-P.key.level),1),t=P.rangeX/(S*P.width*e);M.setUniform1f("u_patternFactor",t)}if(c){const t=e.patternMap;if(!t)continue;for(const[e,i]of t){const t=g.getPageSize(e);Object(o.l)(t)&&(g.bind(u,v.z.LINEAR,e,Y.C),M.setUniform2fv("u_mosaicSize",t),M.setUniform1i("u_texture",Y.C),u.drawElements(v.r.TRIANGLES,i[1],v.k.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]))}}else u.drawElements(v.r.TRIANGLES,e.fillIndexCount,v.k.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.fillIndexStart);P.triangleCount+=e.fillIndexCount/3}}}_drawOutline(e,t,i,n,r,a,s){const{context:l,displayLevel:c,state:h,drawPhase:u,painter:d,pixelRatio:f,spriteMosaic:_,requestRender:p,allowDelayedRender:m}=e,g=i.outlineMaterial,y=d.vectorTilesMaterialManager,b=.75/f,w=u===J.b.HITTEST,x=this._outlineProgramOptions;x.id=w;const S=y.getMaterialProgram(l,g,x);if(m&&Object(o.l)(p)&&!S.isCompiled)return void p();l.useProgram(S),S.setUniformMatrix3fv("u_displayMat3",a===A.i.VIEWPORT?h.displayMat3:h.displayViewMat3),S.setUniform2fv("u_fillTranslation",r),S.setUniform1f("u_depth",i.z+Q),S.setUniform1f("u_outline_width",b),w&&S.setUniform4fv("u_id",s);let T=-1;for(const I of n){if(!I.layerData.has(t))continue;I.key.level!==T&&(T=I.key.level,g.setDataUniforms(S,c,i,T,_));const e=I.layerData.get(t);if(e.prepareForRendering(l),!e.outlineIndexCount)continue;const n=e.outlineVertexArrayObject;Object(o.k)(n)||(l.bindVAO(n),S.setUniformMatrix3fv("u_dvsMat3",I.transforms.dvs),l.setStencilFunction(v.h.EQUAL,I.stencilRef,255),l.drawElements(v.r.TRIANGLES,e.outlineIndexCount,v.k.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.outlineIndexStart),I.triangleCount+=e.outlineIndexCount/3)}}},vtlLine:class extends K{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(e,t){const{context:i,displayLevel:n,state:r,drawPhase:a,painter:s,pixelRatio:l,spriteMosaic:c,styleLayerUID:h,requestRender:u,allowDelayedRender:d}=e;if(!t.some((e=>{var t,i;return null!=(t=null==(i=e.layerData.get(h))?void 0:i.lineIndexCount)&&t})))return;const f=e.styleLayer,_=f.lineMaterial,p=s.vectorTilesMaterialManager,m=f.getPaintValue("line-translate",n),g=f.getPaintValue("line-translate-anchor",n),y=f.getPaintProperty("line-pattern"),b=void 0!==y,w=b&&y.isDataDriven;let x,S;if(b&&!w){const e=y.getValue(n);x=c.getMosaicItemPosition(e)}let T=!1;if(!b){const e=f.getPaintProperty("line-dasharray");if(S=void 0!==e,T=S&&e.isDataDriven,S&&!T){const t=e.getValue(n),i=f.getDashKey(t,f.getLayoutValue("line-cap",n));x=c.getMosaicItemPosition(i)}}const I=1/l,M=a===J.b.HITTEST,O=this._programOptions;O.id=M,O.pattern=b,O.sdf=S;const P=p.getMaterialProgram(i,_,O);if(d&&Object(o.l)(u)&&!P.isCompiled)return void u();if(i.useProgram(P),P.setUniformMatrix3fv("u_displayViewMat3",r.displayViewMat3),P.setUniformMatrix3fv("u_displayMat3",g===A.i.VIEWPORT?r.displayMat3:r.displayViewMat3),P.setUniform2fv("u_lineTranslation",m),P.setUniform1f("u_depth",f.z),P.setUniform1f("u_antialiasing",I),M){const e=Object(X.c)(h+1);P.setUniform4fv("u_id",e)}if(x&&Object(o.l)(x)){const{page:e}=x,t=c.getPageSize(e);Object(o.l)(t)&&(c.bind(i,v.z.LINEAR,e,Y.C),P.setUniform2fv("u_mosaicSize",t),P.setUniform1i("u_texture",Y.C))}let R=-1;for(const C of t){if(!C.layerData.has(h))continue;C.key.level!==R&&(R=C.key.level,_.setDataUniforms(P,n,f,R,c));const e=2**(n-R)/l;P.setUniform1f("u_zoomFactor",e);const t=C.layerData.get(h);if(!t.lineIndexCount)continue;t.prepareForRendering(i);const r=t.lineVertexArrayObject;if(!Object(o.k)(r)){if(i.bindVAO(r),P.setUniformMatrix3fv("u_dvsMat3",C.transforms.dvs),i.setStencilFunction(v.h.EQUAL,C.stencilRef,255),w||T){const e=t.patternMap;if(!e)continue;for(const[t,n]of e){const e=c.getPageSize(t);Object(o.l)(e)&&(c.bind(i,v.z.LINEAR,t,Y.C),P.setUniform2fv("u_mosaicSize",e),P.setUniform1i("u_texture",Y.C),i.drawElements(v.r.TRIANGLES,n[1],v.k.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n[0]))}}else i.drawElements(v.r.TRIANGLES,t.lineIndexCount,v.k.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t.lineIndexStart);C.triangleCount+=t.lineIndexCount/3}}}},vtlCircle:class extends K{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(e,t){const{context:i,displayLevel:n,requiredLevel:r,state:a,drawPhase:s,painter:l,spriteMosaic:c,styleLayerUID:h,requestRender:u,allowDelayedRender:d}=e;if(!t.some((e=>{var t,i;return null!=(t=null==(i=e.layerData.get(h))?void 0:i.circleIndexCount)&&t})))return;const f=e.styleLayer,_=f.circleMaterial,p=l.vectorTilesMaterialManager,m=f.getPaintValue("circle-translate",n),g=f.getPaintValue("circle-translate-anchor",n),y=s===J.b.HITTEST,b=this._programOptions;b.id=y;const w=p.getMaterialProgram(i,_,b);if(d&&Object(o.l)(u)&&!w.isCompiled)return void u();i.useProgram(w),w.setUniformMatrix3fv("u_displayMat3",g===A.i.VIEWPORT?a.displayMat3:a.displayViewMat3),w.setUniform2fv("u_circleTranslation",m),w.setUniform1f("u_depth",f.z),w.setUniform1f("u_antialiasingWidth",1.2);let x=-1;if(y){const e=Object(X.c)(h+1);w.setUniform4fv("u_id",e)}for(const S of t){if(!S.layerData.has(h))continue;S.key.level!==x&&(x=S.key.level,_.setDataUniforms(w,n,f,x,c));const e=S.layerData.get(h);if(!e.circleIndexCount)continue;e.prepareForRendering(i);const t=e.circleVertexArrayObject;Object(o.k)(t)||(i.bindVAO(t),w.setUniformMatrix3fv("u_dvsMat3",S.transforms.dvs),r!==S.key.level?i.setStencilFunction(v.h.EQUAL,S.stencilRef,255):i.setStencilFunction(v.h.GREATER,255,255),i.drawElements(v.r.TRIANGLES,e.circleIndexCount,v.k.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.circleIndexStart),S.triangleCount+=e.circleIndexCount/3)}}},vtlSymbol:class extends K{constructor(){super(...arguments),this._iconProgramOptions={id:!1,sdf:!1},this._sdfProgramOptions={id:!1},this._spritesTextureSize=Object(ee.c)()}dispose(){}drawMany(e,t){const{drawPhase:i,styleLayerUID:n}=e,r=e.styleLayer;let o;i===J.b.HITTEST&&(o=Object(X.c)(n+1)),this._drawIcons(e,r,t,o),this._drawText(e,r,t,o)}_drawIcons(e,t,i,n){const{context:r,displayLevel:a,drawPhase:s,painter:l,spriteMosaic:c,state:h,styleLayerUID:u,requestRender:d,allowDelayedRender:f}=e,_=t.iconMaterial,p=l.vectorTilesMaterialManager;let m,g=!1;for(const o of i)if(o.layerData.has(u)&&(m=o.layerData.get(u),m.iconPerPageElementsMap.size>0)){g=!0;break}if(!g)return;const v=t.getPaintValue("icon-translate",a),y=t.getPaintValue("icon-translate-anchor",a);let b=t.getLayoutValue("icon-rotation-alignment",a);b===A.a.AUTO&&(b=t.getLayoutValue("symbol-placement",a)===A.e.POINT?A.a.VIEWPORT:A.a.MAP);const w=b===A.a.MAP,x=t.getLayoutValue("icon-keep-upright",a)&&w,S=m.isIconSDF,T=s===J.b.HITTEST,I=this._iconProgramOptions;I.id=T,I.sdf=S;const M=p.getMaterialProgram(r,_,I);if(f&&Object(o.l)(d)&&!M.isCompiled)return void d();r.useProgram(M),M.setUniformMatrix3fv("u_displayViewMat3",b===A.a.MAP?h.displayViewMat3:h.displayMat3),M.setUniformMatrix3fv("u_displayMat3",y===A.i.VIEWPORT?h.displayMat3:h.displayViewMat3),M.setUniform2fv("u_iconTranslation",v),M.setUniform1f("u_depth",t.z),M.setUniform1f("u_mapRotation",Object(te.b)(h.rotation)),M.setUniform1f("u_keepUpright",x?1:0),M.setUniform1f("u_level",10*a),M.setUniform1i("u_texture",Y.C),M.setUniform1f("u_fadeDuration",L.c/1e3),T&&M.setUniform4fv("u_id",n);let O=-1;for(const P of i){if(!P.layerData.has(u))continue;if(P.key.level!==O&&(O=P.key.level,_.setDataUniforms(M,a,t,O,c)),m=P.layerData.get(u),0===m.iconPerPageElementsMap.size)continue;m.prepareForRendering(r),m.updateOpacityInfo();const i=m.iconVertexArrayObject;if(!Object(o.k)(i)){r.bindVAO(i),M.setUniformMatrix3fv("u_dvsMat3",P.transforms.dvs),M.setUniform1f("u_time",(performance.now()-m.lastOpacityUpdate)/1e3);for(const[t,i]of m.iconPerPageElementsMap)this._renderIconRange(e,M,i,t,P)}}}_renderIconRange(e,t,i,n,r){const{context:o,spriteMosaic:a}=e;this._spritesTextureSize[0]=a.getWidth(n)/4,this._spritesTextureSize[1]=a.getHeight(n)/4,t.setUniform2fv("u_mosaicSize",this._spritesTextureSize),a.bind(o,v.z.LINEAR,n,Y.C),o.setStencilTestEnabled(!0),o.setStencilFunction(v.h.GREATER,255,255),o.setStencilWriteMask(0),o.drawElements(v.r.TRIANGLES,i[1],v.k.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]),r.triangleCount+=i[1]/3}_drawText(e,t,i,n){const{context:r,displayLevel:a,drawPhase:s,glyphMosaic:l,painter:c,pixelRatio:h,spriteMosaic:u,state:d,styleLayerUID:f,requestRender:_,allowDelayedRender:p}=e,m=t.textMaterial,g=c.vectorTilesMaterialManager;let y,b=!1;for(const o of i)if(o.layerData.has(f)&&(y=o.layerData.get(f),y.glyphPerPageElementsMap.size>0)){b=!0;break}if(!b)return;const w=t.getPaintProperty("text-opacity");if(w&&!w.isDataDriven&&0===w.getValue(a))return;const x=t.getPaintProperty("text-color"),S=!x||x.isDataDriven||x.getValue(a)[3]>0,T=t.getPaintProperty("text-halo-width"),I=t.getPaintProperty("text-halo-color"),M=(!T||T.isDataDriven||T.getValue(a)>0)&&(!I||I.isDataDriven||I.getValue(a)[3]>0);if(!S&&!M)return;let O=t.getLayoutValue("text-rotation-alignment",a);O===A.a.AUTO&&(O=t.getLayoutValue("symbol-placement",a)===A.e.POINT?A.a.VIEWPORT:A.a.MAP);const P=O===A.a.MAP,R=t.getLayoutValue("text-keep-upright",a)&&P,C=s===J.b.HITTEST,E=.8*3/h;this._glyphTextureSize||(this._glyphTextureSize=Object(ee.d)(l.width/4,l.height/4));const D=t.getPaintValue("text-translate",a),U=t.getPaintValue("text-translate-anchor",a),F=this._sdfProgramOptions;F.id=C;const z=g.getMaterialProgram(r,m,F);if(p&&Object(o.l)(_)&&!z.isCompiled)return void _();r.useProgram(z),z.setUniformMatrix3fv("u_displayViewMat3",O===A.a.MAP?d.displayViewMat3:d.displayMat3),z.setUniformMatrix3fv("u_displayMat3",U===A.i.VIEWPORT?d.displayMat3:d.displayViewMat3),z.setUniform2fv("u_textTranslation",D),z.setUniform1f("u_depth",t.z+152587890625e-16),z.setUniform2fv("u_mosaicSize",this._glyphTextureSize),z.setUniform1f("u_mapRotation",Object(te.b)(d.rotation)),z.setUniform1f("u_keepUpright",R?1:0),z.setUniform1f("u_level",10*a),z.setUniform1i("u_texture",Y.B),z.setUniform1f("u_antialiasingWidth",E),z.setUniform1f("u_fadeDuration",L.c/1e3),C&&z.setUniform4fv("u_id",n);let j=-1;for(const L of i){if(!L.layerData.has(f))continue;if(L.key.level!==j&&(j=L.key.level,m.setDataUniforms(z,a,t,j,u)),y=L.layerData.get(f),0===y.glyphPerPageElementsMap.size)continue;y.prepareForRendering(r),y.updateOpacityInfo();const e=y.textVertexArrayObject;if(Object(o.k)(e))continue;r.bindVAO(e),z.setUniformMatrix3fv("u_dvsMat3",L.transforms.dvs),r.setStencilTestEnabled(!0),r.setStencilFunction(v.h.GREATER,255,255),r.setStencilWriteMask(0);const i=(performance.now()-y.lastOpacityUpdate)/1e3;z.setUniform1f("u_time",i),y.glyphPerPageElementsMap.forEach(((e,t)=>{this._renderGlyphRange(r,e,t,l,z,M,S,L)}))}}_renderGlyphRange(e,t,i,n,r,o,a,s){n.bind(e,v.z.LINEAR,i,Y.B),o&&(r.setUniform1f("u_halo",1),e.drawElements(v.r.TRIANGLES,t[1],v.k.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),s.triangleCount+=t[1]/3),a&&(r.setUniform1f("u_halo",0),e.drawElements(v.r.TRIANGLES,t[1],v.k.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),s.triangleCount+=t[1]/3)}}};var ne=i(342);const re={background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = u_opacity * color;\n#else\ngl_FragColor = u_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             = u_tlbr / u_mosaicSize.xyxy;\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float dist = length(v_offset);\nmediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_stroke_color = stroke_color * stroke_opacity;\nv_stroke_width = stroke_width;\nv_radius = radius;\nv_blur = max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset = offset;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = v_color[3] * color;\n#else\ngl_FragColor = v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include <util/util.glsl>\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n#ifdef PATTERN\nfloat patternWidth = nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight = nextPOT(tlbr.w - tlbr.y);\nfloat scaleX = 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY = 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat = mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord = (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             = tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor = v_color;\nfloat d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio = 0.248062016;\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * softEdgeRatio * size;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width > 0.25) {\nlowp vec4 outlinePixelColor = u_outlineColor;\nconst float outlineLimitRatio = (16.0 / 86.0);\nfloat clampedOutlineSize = softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor = v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor = texture2D(u_texture, v_tex);\ngl_FragColor = v_opacity * texColor;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color = color;\nv_opacity = opacity;\n#ifdef SDF\nv_halo_width = halo_width;\n#endif\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *= interpolatedOpacity;\nmediump float a_angle         = a_levelInfo[1];\nmediump float a_minLevel      = a_levelInfo[2];\nmediump float a_maxLevel      = a_levelInfo[3];\nmediump vec2 a_tex            = a_texAngleRange.xy;\nmediump float delta_z = 0.0;\nmediump float rotated = mod(a_angle + u_mapRotation, 256.0);\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_opacity, 0.0);\nvec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\nv_size = abs(offset);\n#ifdef SDF\noffset = (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_tex = a_tex.xy / u_mosaicSize;\n}"},line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include <util/encoding.glsl>\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float fragDist = length(v_normal) * v_lineHalfWidth;\nlowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX = fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY = 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\ngl_FragColor = alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX = fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY =  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor = alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor = alpha * v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\nconst mediump float tileCoordRatio = 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth = 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_blur = blur + u_antialiasing;\nv_normal = a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          = tlbr / u_mosaicSize.xyxy;\nv_patternSize   = vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio = width / v_patternSize.y;\n#else\nv_widthRatio = width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth = (width + u_antialiasing) * 0.5;\nmediump vec2 dir = a_dir_normal.xy * scale;\nmediump vec2 offset_ = a_extrude_offset.zw * scale * offset;\nmediump vec2 dist = v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance = a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = abs(v_normal.y);\nlowp float alpha = smoothstep(1.0, 0.0, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_normal = a_xnormal;\nmediump vec2 dist = u_outline_width * scale * a_offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nconst float sdfPixel = 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo > 0.5)\n{\nv_color = halo_color * opacity;\nhalo_width *= sdfPixel;\nhalo_blur *= sdfPixel;\n}\nelse\n{\nv_color = color * opacity;\nhalo_width = 0.0;\nhalo_blur = 0.0;\n}\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *= interpolatedOpacity;\nmediump float a_angle       = a_levelInfo[1];\nmediump float a_minLevel    = a_levelInfo[2];\nmediump float a_maxLevel    = a_levelInfo[3];\nmediump vec2 a_tex          = a_texAngleRange.xy;\nmediump float a_visMinAngle    = a_texAngleRange.z;\nmediump float a_visMaxAngle    = a_texAngleRange.w;\nmediump float delta_z = 0.0;\nmediump float angle = mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle < a_visMaxAngle)\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_color[3], 0.0);\nv_tex = a_tex.xy / u_mosaicSize;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_edgeDistance = edgePos - halo_width / size;\nv_edgeWidth = (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}};const oe=new class{constructor(e){this._readFile=e}resolveIncludes(e){return this._resolve(e)}_resolve(e,t=new Map){if(t.has(e))return t.get(e);const i=this._read(e);if(!i)throw new Error(`cannot find shader file ${e}`);const n=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let r=n.exec(i);const o=[];for(;null!=r;)o.push({path:r[1],start:r.index,length:r[0].length}),r=n.exec(i);let a=0,s="";return o.forEach((e=>{s+=i.slice(a,e.start),s+=t.has(e.path)?"":this._resolve(e.path,t),a=e.start+e.length})),s+=i.slice(a),t.set(e,s),s}_read(e){return this._readFile(e)}}((function(e){let t=re;return e.split("/").forEach((e=>{t&&(t=t[e])})),t}));function ae(e){return oe.resolveIncludes(e)}function se(e){const{options:t,value:i}=e;return"number"==typeof t[i]}function le(e){let t="";for(const i in e){const n=e[i];if("boolean"==typeof n)n&&(t+=`#define ${i}\n`);else if("number"==typeof n)t+=`#define ${i} ${n.toFixed()}\n`;else if("object"==typeof n)if(se(n)){const{value:e,options:r,namespace:o}=n,a=o?`${o}_`:"";for(const i in r)t+=`#define ${a}${i} ${r[i].toFixed()}\n`;t+=`#define ${i} ${a}${e}\n`}else{const e=n.options;let r=0;for(const i in e)t+=`#define ${e[i]} ${(r++).toFixed()}\n`;t+=`#define ${i} ${e[n.value]}\n`}}return t}const ce=e=>le({ID:e.id,PATTERN:e.pattern}),he={shaders:e=>({vertexShader:ce(e)+ae("background/background.vert"),fragmentShader:ce(e)+ae("background/background.frag")})},ue=e=>le({ID:e.id}),de={shaders:e=>({vertexShader:ue(e)+ae("circle/circle.vert"),fragmentShader:ue(e)+ae("circle/circle.frag")})},fe=e=>le({ID:e.id,PATTERN:e.pattern}),_e={shaders:e=>({vertexShader:fe(e)+ae("fill/fill.vert"),fragmentShader:fe(e)+ae("fill/fill.frag")})},pe=e=>le({ID:e.id}),me={shaders:e=>({vertexShader:pe(e)+ae("outline/outline.vert"),fragmentShader:pe(e)+ae("outline/outline.frag")})},ge=e=>le({ID:e.id,SDF:e.sdf}),ve={shaders:e=>({vertexShader:ge(e)+ae("icon/icon.vert"),fragmentShader:ge(e)+ae("icon/icon.frag")})},ye=e=>le({ID:e.id,PATTERN:e.pattern,SDF:e.sdf}),be={shaders:e=>({vertexShader:ye(e)+ae("line/line.vert"),fragmentShader:ye(e)+ae("line/line.frag")})},we=e=>le({ID:e.id}),xe={shaders:e=>({vertexShader:we(e)+ae("text/text.vert"),fragmentShader:we(e)+ae("text/text.frag")})};class Se{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach((e=>e.dispose())),this._programByKey.clear()}getMaterialProgram(e,t,i){const n=t.key<<3|this._getMaterialOptionsValue(t.type,i);if(this._programByKey.has(n))return this._programByKey.get(n);const r=this._getProgramTemplate(t.type),{shaders:o}=r,{vertexShader:a,fragmentShader:s}=o(i),l=t.getShaderHeader(),c=t.getShaderMain(),h=a.replace("#pragma header",l).replace("#pragma main",c),u=e.programCache.acquire(h,s,t.getAttributeLocations());return this._programByKey.set(n,u),u}_getMaterialOptionsValue(e,t){switch(e){case ne.b.BACKGROUND:{const e=t;return(e.pattern?1:0)<<1|(e.id?1:0)}case ne.b.FILL:{const e=t;return(e.pattern?1:0)<<1|(e.id?1:0)}case ne.b.OUTLINE:return t.id?1:0;case ne.b.LINE:{const e=t;return(e.sdf?1:0)<<2|(e.pattern?1:0)<<1|(e.id?1:0)}case ne.b.ICON:{const e=t;return(e.sdf?1:0)<<1|(e.id?1:0)}case ne.b.CIRCLE:case ne.b.TEXT:return t.id?1:0;default:return 0}}_getProgramTemplate(e){switch(e){case ne.b.BACKGROUND:return he;case ne.b.CIRCLE:return de;case ne.b.FILL:return _e;case ne.b.ICON:return ve;case ne.b.LINE:return be;case ne.b.OUTLINE:return me;case ne.b.TEXT:return xe;default:return null}}}const Te=1e-6;class Ie{constructor(e,t){this.spriteMosaic=e,this.glyphMosaic=t,this._brushCache=new Map,this._vtlMaterialManager=new Se}dispose(){this._brushCache&&(this._brushCache.forEach((e=>e.dispose())),this._brushCache=null),this._vtlMaterialManager=Object(o.f)(this._vtlMaterialManager),this.spriteMosaic.dispose(),this.glyphMosaic.dispose()}get vectorTilesMaterialManager(){return this._vtlMaterialManager}drawTile(e,t,i){const{context:n}=e,r=i.layers;i.backgroundBucketIds.length>0&&(e.renderPass="background",i.backgroundBucketIds.forEach((n=>this._renderStyleLayer(i.getLayerById(n),e,t,!0)))),n.setBlendingEnabled(!1),n.setDepthTestEnabled(!0),n.setDepthWriteEnabled(!0),n.setDepthFunction(v.h.LEQUAL),e.renderPass="opaque";for(let o=r.length-1;o>=0;o--)this._renderStyleLayer(r[o],e,t,!1);n.setDepthWriteEnabled(!1),n.setBlendingEnabled(!0),n.setBlendFunctionSeparate(v.b.ONE,v.b.ONE_MINUS_SRC_ALPHA,v.b.ONE,v.b.ONE_MINUS_SRC_ALPHA),e.renderPass="translucent";for(let o=0;o<r.length;o++)this._renderStyleLayer(r[o],e,t,!1);n.setDepthTestEnabled(!1),n.bindVAO()}_renderStyleLayer(e,t,i,n=!1){if(!(n||e&&i.layerData.has(e.uid)))return;const r=e.getLayoutProperty("visibility");if(r&&r.getValue()===A.j.NONE)return;const{renderPass:o}=t;let a;switch(e.type){case A.c.BACKGROUND:if("background"!==o)return;a="vtlBackground";break;case A.c.FILL:if("opaque"!==o&&"translucent"!==t.renderPass)return;a="vtlFill";break;case A.c.LINE:if("translucent"!==o)return;a="vtlLine";break;case A.c.CIRCLE:if("translucent"!==o)return;a="vtlCircle";break;case A.c.SYMBOL:if("translucent"!==o)return;a="vtlSymbol"}const s=t.displayLevel;void 0!==e.minzoom&&e.minzoom>s+Te||void 0!==e.maxzoom&&e.maxzoom<=s-Te||(t.styleLayerUID=e.uid,t.styleLayer=e,this._drawWithBrush(t,i,a))}_drawWithBrush(e,t,i){if(!this._brushCache.has(i)){const e=ie[i];this._brushCache.set(i,new e)}this._brushCache.get(i).drawMany(e,[t])}}var Me=i(1347),Oe=i(1106),Pe=i(1163),Re=i(29),Ce=i(1104);let Ee=class extends(Object(Pe.a)(Object(Oe.a)(Ce.a))){constructor(){super(...arguments),this.type="vector-tile-3d"}initialize(){if(Object(o.k)(this.layer.fullExtent))return void this.addResolvingPromise(Promise.reject(new r.a("vectortilelayerview:full-extent-undefined","This layer view's layer does not define a fullExtent.")));const{basemapTerrain:e,spatialReference:t,state:i,viewingMode:n}=this.view,{pixelRatio:l}=i,c="local"===n&&!Object(Re.M)(t)||Re.J.force512VTL,u=this.layer.tileInfo.spatialReference.isGeographic,d=c?this.layer.tileInfo:this.layer.tileInfo.getOrCreateCompatible(256,u?1:2),f=this._getTileInfoSupportError(d,this.layer.fullExtent);if(Object(o.l)(f))return this.addResolvingPromise(Promise.reject(f));const _=Object(s.h)((()=>{var e,t;return null==(e=this.view)||null==(t=e.basemapTerrain)?void 0:t.tilingSchemeLocked})).then((()=>{const t=e.tilingScheme,i=t.pixelSize;let n;if(this.schemaHelper=new h(i,Object(o.l)(e.spatialReference)&&e.spatialReference.isGeographic),256===i){const e=this.layer.tileInfo.spatialReference.isGeographic;n=this.layer.tileInfo.getOrCreateCompatible(256,e?1:2)}else n=this.view.spatialReference.isGeographic?this.layer.tileInfo.getOrCreateCompatible(512,.5):this.layer.tileInfo;const r=this._getTileInfoCompatibilityError(n,t);if(r)throw r;this.tileInfo=n}));this._tileHandlerController=new AbortController;const p=this.view.resourceController;this._memCache=p.memoryController.newCache(this.layer.uid,(e=>{e.release()}));const m=new Me.a(this.layer.currentStyleInfo.style),g=e.mapTileRequester;this._tileHandler=new q(this.layer,m,l,this._memCache,g);const v=this._tileHandlerController.signal,y=e=>p.schedule(e),b=this._tileHandler.start({signal:v,schedule:y}),w=this._tileHandler.spriteMosaic;w.then((e=>{!Object(a.k)(v)&&this._tileHandler&&(this.painter=new Ie(e,this._tileHandler.glyphMosaic))})),b.then((()=>this._tileHandlerController=null)),this.updatingHandles.add((()=>{var e;return{style:this.layer.currentStyleInfo.style,newPixelRatio:null==(e=this.view.state)?void 0:e.pixelRatio}}),(({style:e})=>{this._tileHandlerController&&this._tileHandlerController.abort(),this._tileHandlerController=new AbortController,this._memCache.clear();const t=new Me.a(e),i=new q(this.layer,t,l,this._memCache,g),n=i.start({signal:this._tileHandlerController.signal,schedule:y}),r=i.spriteMosaic;n.then((()=>this._tileHandlerController=null)),this.updatingHandles.addPromise(Promise.all([n,r]).then((([,e])=>{const t=this._tileHandler,n=this.painter;this.painter=new Ie(e,i.glyphMosaic),this._tileHandler=i,this.emit("data-changed"),t.destroy(),n&&n.dispose()})))}));const x=Promise.all([_,b,w]);this.addResolvingPromise(x)}destroy(){this.painter=Object(o.f)(this.painter),this._tileHandlerController&&(this._tileHandlerController.abort(),this._tileHandlerController=null),Object(o.e)(this._tileHandler),this._memCache=Object(o.e)(this._memCache),this._tileHandler=null}get dataLevelRange(){const e=this.tileInfo.lods,t=e[0].scale,i=e[e.length-1].scale,n=this.levelRangeFromScaleRange(t,i);return 1===n.minLevel&&256===this.tileInfo.size[0]&&(n.minLevel=0),n}async fetchTile(e,t,i,n){return this._tileHandler.getVectorTile(e,t,i,n)}};Object(n.a)([Object(l.b)()],Ee.prototype,"layer",void 0),Object(n.a)([Object(l.b)()],Ee.prototype,"dataLevelRange",null),Object(n.a)([Object(l.b)()],Ee.prototype,"updatingProgressValue",void 0),Ee=Object(n.a)([Object(c.a)("esri.views.3d.layers.VectorTileLayerView3D")],Ee);const Le=Ee}}]);
//# sourceMappingURL=58.be6c1ac5.chunk.js.map