(this["webpackJsonppopulation-arcgis"]=this["webpackJsonppopulation-arcgis"]||[]).push([[94],{1116:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a}));var i=r(2),s=r(99);async function a(e,t=e.popupTemplate){if(Object(i.k)(t))return[];const r=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:a}=t,{objectIdField:n,typeIdField:o,globalIdField:l,relationships:c}=e;if(r.includes("*"))return["*"];const u=a?await Object(s.n)(e):[],p=Object(s.j)(e.fieldsIndex,[...r,...u]);return o&&p.push(o),p&&n&&e.fieldsIndex.has(n)&&!p.includes(n)&&p.push(n),p&&l&&e.fieldsIndex.has(l)&&!p.includes(l)&&p.push(l),c&&c.forEach((t=>{const{keyField:r}=t;p&&r&&e.fieldsIndex.has(r)&&!p.includes(r)&&p.push(r)})),p}function n(e,t){return e.popupTemplate?e.popupTemplate:Object(i.l)(t)&&t.defaultPopupTemplateEnabled&&Object(i.l)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},1146:function(e,t,r){"use strict";function i(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function s(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){let t=0,r=0;for(let i=0;i<e.length;i++){const s=e[i].size;"number"==typeof s&&(t+=s,r++)}return t/r}(e.stops):t}function a(e,t){if(!t)return e;const r=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:r,minSize:i}=t;return(s(r,e)+s(i,e))/2}));let i=0;const a=r.length;if(0===a)return e;for(let s=0;s<a;s++)i+=r[s];const n=Math.floor(i/a);return Math.max(n,e)}function n(e){const t=e&&e.renderer,r="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return r;const s="visualVariables"in t?a(r,t.visualVariables):r;if("simple"===t.type)return i(s,t.symbol);if("unique-value"===t.type){var n;let e=s;return null!=(n=t.uniqueValueInfos)&&n.forEach((t=>{e=i(e,t.symbol)})),e}if("class-breaks"===t.type){let e=s;return t.classBreakInfos.forEach((t=>{e=i(e,t.symbol)})),e}return"dot-density"===t.type||t.type,s}r.d(t,"a",(function(){return n}))},1165:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l}));r(167);var i=r(2),s=r(68),a=r(1146),n=r(86);function o(e,t,r,a=new n.a){let o;if("2d"===r.type)o=t*r.resolution;else if("3d"===r.type){const a=r.overlayPixelSizeInMapUnits(e),n=r.basemapSpatialReference;o=Object(i.l)(n)&&!n.equals(r.spatialReference)?Object(s.f)(n)/Object(s.f)(r.spatialReference):t*a}const l=e.x-o,c=e.y-o,u=e.x+o,p=e.y+o,{spatialReference:y}=r;return a.xmin=Math.min(l,u),a.ymin=Math.min(c,p),a.xmax=Math.max(l,u),a.ymax=Math.max(c,p),a.spatialReference=y,a}function l(e,t,r){const s=r.toMap(e);return!Object(i.k)(s)&&o(s,Object(a.a)(),r,c).intersects(t)}const c=new n.a},1647:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return X}));var i=r(0),s=(r(22),r(12)),a=(r(17),r(16)),n=r(32),o=r(10),l=r(1315),c=(r(106),r(148)),u=r(2),p=r(23),y=r(13),h=r(68),d=r(1),b=r(86),f=r(739),m=r(183),g=r(970),j=r(874),O=r(1146),v=r(134),w=r(675),x=r(558),I=r(604),P=r(122),F=r(940);const E=e=>e.spatialReference.wkid||JSON.stringify(e.spatialReference);function R(e,t){const{dpi:r,gdbVersion:i,geometry:s,geometryPrecision:a,height:n,layerOption:o,mapExtent:l,maxAllowableOffset:c,returnFieldName:p,returnGeometry:y,returnUnformattedValues:h,returnZ:d,spatialReference:b,timeExtent:m,tolerance:g,width:O}=e.toJSON(),{dynamicLayers:v,layerDefs:w,layerIds:x}=function(e){var t,r;const{mapExtent:i,floors:s,width:a,sublayers:n,layerIds:o,layerOption:l,gdbVersion:c}=e,p=null==n||null==(t=n.find((e=>null!=e.layer)))||null==(r=t.layer)?void 0:r.serviceSublayers,y="popup"===l,h={},d=Object(f.c)({extent:i,width:a,spatialReference:null==i?void 0:i.spatialReference}),b=[],m=e=>{const t=0===d,r=0===e.minScale||d<=e.minScale,i=0===e.maxScale||d>=e.maxScale;if(e.visible&&(t||r&&i))if(e.sublayers)e.sublayers.forEach(m);else{if(!1===(null==o?void 0:o.includes(e.id))||y&&(!e.popupTemplate||!e.popupEnabled))return;b.unshift(e)}};if(null!=n&&n.forEach(m),n&&!b.length)h.layerIds=[];else{const e=Object(F.a)(b,p,c),t=b.map((e=>{const t=Object(j.b)(s,e);return e.toExportImageJSON(t)}));if(e)h.dynamicLayers=JSON.stringify(t);else{if(n){let e=b.map((({id:e})=>e));o&&(e=e.filter((e=>o.includes(e)))),h.layerIds=e}else(null==o?void 0:o.length)&&(h.layerIds=o);const e=function(e,t){const r=!(null==e||!e.length),i=t.filter((e=>null!=e.definitionExpression||r&&null!=e.floorInfo));return i.length?i.map((t=>{const r=Object(j.b)(e,t),i=Object(I.b)(r,t.definitionExpression);return{id:t.id,definitionExpression:i}})):null}(s,b);if(Object(u.l)(e)&&e.length){const t={};for(const r of e)r.definitionExpression&&(t[r.id]=r.definitionExpression);Object.keys(t).length&&(h.layerDefs=JSON.stringify(t))}}}return h}(e),R=t&&Object(u.l)(t.geometry)?t.geometry:null,S={geometryPrecision:a,maxAllowableOffset:c,returnFieldName:p,returnGeometry:y,returnUnformattedValues:h,returnZ:d,tolerance:g},N=R&&R.toJSON()||s;if(S.imageDisplay=`${O},${n},${r}`,i&&(S.gdbVersion=i),N&&(delete N.spatialReference,S.geometry=JSON.stringify(N),S.geometryType=Object(P.c)(N)),b?S.sr=b.wkid||JSON.stringify(b):N&&N.spatialReference?S.sr=E(N):l&&l.spatialReference&&(S.sr=E(l)),S.time=m?[m.start,m.end].join(","):null,l){const{xmin:e,ymin:t,xmax:r,ymax:i}=l;S.mapExtent=`${e},${t},${r},${i}`}return w&&(S.layerDefs=w),v&&!w&&(S.dynamicLayers=v),S.layers="popup"===o?"visible":o,x&&!v&&(S.layers+=`:${x.join(",")}`),S}var S,N=r(167),_=r(265),M=r(27),G=r(57);let V=S=class extends M.a{constructor(e){super(e),this.dpi=96,this.floors=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=null,this.height=400,this.layerIds=null,this.layerOption="top",this.mapExtent=null,this.maxAllowableOffset=null,this.returnFieldName=!0,this.returnGeometry=!1,this.returnM=!1,this.returnUnformattedValues=!0,this.returnZ=!1,this.spatialReference=null,this.sublayers=null,this.timeExtent=null,this.tolerance=null,this.width=400}static from(e){return Object(s.d)(S,e)}};Object(i.a)([Object(d.b)({type:Number,json:{write:!0}})],V.prototype,"dpi",void 0),Object(i.a)([Object(d.b)()],V.prototype,"floors",void 0),Object(i.a)([Object(d.b)({type:String,json:{write:!0}})],V.prototype,"gdbVersion",void 0),Object(i.a)([Object(d.b)({types:N.a,json:{read:P.a,write:!0}})],V.prototype,"geometry",void 0),Object(i.a)([Object(d.b)({type:Number,json:{write:!0}})],V.prototype,"geometryPrecision",void 0),Object(i.a)([Object(d.b)({type:Number,json:{write:!0}})],V.prototype,"height",void 0),Object(i.a)([Object(d.b)({type:[Number],json:{write:!0}})],V.prototype,"layerIds",void 0),Object(i.a)([Object(d.b)({type:["top","visible","all","popup"],json:{write:!0}})],V.prototype,"layerOption",void 0),Object(i.a)([Object(d.b)({type:b.a,json:{write:!0}})],V.prototype,"mapExtent",void 0),Object(i.a)([Object(d.b)({type:Number,json:{write:!0}})],V.prototype,"maxAllowableOffset",void 0),Object(i.a)([Object(d.b)({type:Boolean,json:{write:!0}})],V.prototype,"returnFieldName",void 0),Object(i.a)([Object(d.b)({type:Boolean,json:{write:!0}})],V.prototype,"returnGeometry",void 0),Object(i.a)([Object(d.b)({type:Boolean,json:{write:!0}})],V.prototype,"returnM",void 0),Object(i.a)([Object(d.b)({type:Boolean,json:{write:!0}})],V.prototype,"returnUnformattedValues",void 0),Object(i.a)([Object(d.b)({type:Boolean,json:{write:!0}})],V.prototype,"returnZ",void 0),Object(i.a)([Object(d.b)({type:G.a,json:{write:!0}})],V.prototype,"spatialReference",void 0),Object(i.a)([Object(d.b)()],V.prototype,"sublayers",void 0),Object(i.a)([Object(d.b)({type:_.a,json:{write:!0}})],V.prototype,"timeExtent",void 0),Object(i.a)([Object(d.b)({type:Number,json:{write:!0}})],V.prototype,"tolerance",void 0),Object(i.a)([Object(d.b)({type:Number,json:{write:!0}})],V.prototype,"width",void 0),V=S=Object(i.a)([Object(o.a)("esri.rest.support.IdentifyParameters")],V);const T=V;var A=r(171),k=r(51),J=r(50),L=r(323);let U=class extends M.a{constructor(e){super(e),this.displayFieldName=null,this.feature=null,this.layerId=null,this.layerName=null}readFeature(e,t){return A.a.fromJSON({attributes:{...t.attributes},geometry:{...t.geometry}})}writeFeature(e,t){if(!e)return;const{attributes:r,geometry:i}=e;r&&(t.attributes={...r}),Object(u.l)(i)&&(t.geometry=i.toJSON(),t.geometryType=L.c.toJSON(i.type))}};Object(i.a)([Object(d.b)({type:String,json:{write:!0}})],U.prototype,"displayFieldName",void 0),Object(i.a)([Object(d.b)({type:A.a})],U.prototype,"feature",void 0),Object(i.a)([Object(k.a)("feature",["attributes","geometry"])],U.prototype,"readFeature",null),Object(i.a)([Object(J.a)("feature")],U.prototype,"writeFeature",null),Object(i.a)([Object(d.b)({type:Number,json:{write:!0}})],U.prototype,"layerId",void 0),Object(i.a)([Object(d.b)({type:String,json:{write:!0}})],U.prototype,"layerName",void 0),U=Object(i.a)([Object(o.a)("esri.rest.support.IdentifyResult")],U);const z=U;async function H(e,t,r){const i=(a=t,t=T.from(a)).geometry?[t.geometry]:[],s=Object(x.c)(e);var a;return s.path+="/identify",Object(w.a)(i).then((e=>{const i=R(t,{geometry:e&&e[0]}),a=Object(x.b)({...s.query,f:"json",...i}),n=Object(x.a)(a,r);return Object(v.default)(s.path,n).then($).then((e=>function(e,t){if(null==t||!t.length)return e;const r=new Map;function i(e){r.set(e.id,e),e.sublayers&&e.sublayers.forEach(i)}t.forEach(i);for(const s of e.results)s.feature.sourceLayer=r.get(s.layerId);return e}(e,t.sublayers)))}))}function $(e){const t=e.data;return t.results=t.results||[],t.exceededTransferLimit=Boolean(t.exceededTransferLimit),t.results=t.results.map((e=>z.fromJSON(e))),t}var q=r(245),Q=r(640),B=r(1116),D=r(221);let Z=null;const W=e=>{let t=class extends e{constructor(){super(...arguments),this._featuresResolutions=new WeakMap,this.highlightGraphics=new Q.a,this.updateHighlightedFeatures=Object(p.f)((async e=>{this.destroyed||this.updatingHandles.addPromise(this._updateHighlightedFeaturesGeometries(e).catch((()=>{})))}))}initialize(){this.exportImageParameters=new g.a({layer:this.layer}),this.handles.add([Object(y.b)((()=>this.highlightGraphics),"change",(e=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(e.added).catch((()=>{}))),this.updateHighlightedFeatures(this._highlightGeometriesResolution)}))])}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null!=(e=this.exportImageParameters)&&e.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}async fetchPopupFeatures(e,t){var r,i,s,n,o,l;const{layer:c}=this;if(!e)throw new a.a("mapimagelayer:fetchPopupFeatures","Nothing to fetch without area",{layer:c});const u=null==(r=null==(i=this.layer.capabilities)||null==(s=i.operations)?void 0:s.supportsQuery)||r;if((null!=(n=null==(o=this.layer.capabilities)||null==(l=o.operations)?void 0:l.supportsIdentify)&&!n||!(this.layer.version>=10.5))&&!u)throw new a.a("mapimagelayer:fetchPopupFeatures-not-supported","query operation is disabled for this service",{layer:c});return u?this._fetchPopupFeaturesUsingQueries(e,t):this._fetchPopupFeaturesUsingIdentify(e,t)}canResume(){var e;return!!super.canResume()&&!(null!=(e=this.timeExtent)&&e.isEmpty)}async _updateHighlightedFeaturesSymbols(e){for(const t of e){const e="renderer"in t.sourceLayer&&t.sourceLayer.renderer;"geometryType"in t.sourceLayer&&"point"===t.sourceLayer.geometryType&&e&&"getSymbolAsync"in e&&e.getSymbolAsync(t).then((async i=>{var s;let a="width"in i&&"height"in i&&null!=i.width&&null!=i.height?Math.max(i.width,i.height):"size"in i?i.size:null;const n="visualVariables"in e&&(null==(s=e.visualVariables)?void 0:s.find((e=>"size"===e.type)));n&&(Z||(Z=(await Promise.resolve().then(r.bind(null,451))).getSize),a=Z(n,t,{view:this.view.type,scale:this.view.scale,shape:"simple-marker"===i.type?i.style:null})),this.highlightGraphics.includes(t)&&(t.symbol=new D.a({style:"square",size:a,xoffset:"xoffset"in i?i.xoffset:0,yoffset:"yoffset"in i?i.yoffset:0}),t.visible=!0,this.highlightGraphicUpdated(t,"symbol"))}))}}async _updateHighlightedFeaturesGeometries(e){this._highlightGeometriesResolution=e;const t=this.highlightGraphics;if(!t.length||!this.layer.capabilities.operations.supportsQuery)return;const r=this._getTargetResolution(e),i=new Map;for(const n of t)if(!this._featuresResolutions.has(n)||this._featuresResolutions.get(n)>r){const e=n.sourceLayer;Object(c.b)(i,e,(()=>new Map)).set(n.getObjectId(),n)}const s=Array.from(i,(([e,t])=>{const i=e.createQuery();return i.objectIds=[...t.keys()],i.outFields=[e.objectIdField],i.returnGeometry=!0,i.maxAllowableOffset=r,i.outSpatialReference=this.view.spatialReference,e.queryFeatures(i)})),a=await Promise.all(s);if(!this.destroyed)for(const{features:n}of a)for(const e of n){const t=e.sourceLayer,s=i.get(t).get(e.getObjectId());s&&this.highlightGraphics.includes(s)&&(s.geometry=e.geometry,this.highlightGraphicUpdated(s,"geometry"),this._featuresResolutions.set(s,r))}}_getTargetResolution(e){const t=e*Object(h.f)(this.view.spatialReference),r=t/16;return r<=10?0:e/t*r}async _fetchPopupFeaturesUsingIdentify(e,t){const r=await this._createIdentifyParameters(e,t);if(Object(u.k)(r))return[];const{results:i}=await H(this.layer.parsedUrl,r);return i.map((e=>e.feature))}async _createIdentifyParameters(e,t){const{floors:r,spatialReference:i,scale:s}=this.view,a=Object(u.l)(t)?t.event:null,o=await this._collectPopupProviders(this.layer.sublayers,s,t);if(!o.length)return null;await Promise.all(o.map((({sublayer:e})=>e.load().catch((()=>{})))));const l=Math.min(Object(n.a)("mapimagelayer-popup-identify-max-tolerance"),this.layer.allSublayers.reduce(((e,t)=>t.renderer?Object(O.a)({renderer:t.renderer,event:a}):e),2)),c=this.createFetchPopupFeaturesQueryGeometry(e,l),p=Object(f.a)(s,i),y=Math.round(c.width/p),h=new b.a({xmin:c.center.x-p*y,ymin:c.center.y-p*y,xmax:c.center.x+p*y,ymax:c.center.y+p*y,spatialReference:c.spatialReference});return new T({floors:r,gdbVersion:this.layer.gdbVersion,geometry:e,height:y,layerOption:"popup",mapExtent:h,returnGeometry:!0,spatialReference:i,sublayers:this.layer.sublayers,timeExtent:this.timeExtent,tolerance:l,width:y})}async _fetchPopupFeaturesUsingQueries(e,t){const r=await this._collectPopupProviders(this.layer.sublayers,this.view.scale,t),i=Object(u.l)(t)?t.event:null,s=r.map((async({sublayer:t,popupTemplate:r})=>{await t.load().catch((()=>{}));const s=t.createQuery(),a=Object(O.a)({renderer:t.renderer,event:i}),n=this.createFetchPopupFeaturesQueryGeometry(e,a);if(s.geometry=n,s.outFields=await Object(B.b)(t,r),s.timeExtent=this.timeExtent,"floors"in this.view){var o,l;const e=null==(o=this.view)||null==(l=o.floors)?void 0:l.clone(),r=Object(j.b)(e,t);Object(u.l)(r)&&(s.where=s.where?`(${s.where}) AND (${r})`:r)}const c=this._getTargetResolution(n.width/a),p=await this._loadArcadeModules(r),y="point"===t.geometryType||p&&p.arcadeUtils.hasGeometryOperations(r);y||(s.maxAllowableOffset=c);const{features:h}=await t.queryFeatures(s),d=y?0:c;for(const e of h)this._featuresResolutions.set(e,d);return h}));return(await Object(p.g)(s)).reverse().reduce(((e,t)=>t.value?[...e,...t.value]:e),[]).filter((e=>null!=e))}async _collectPopupProviders(e,t,r){const i=[],s=async e=>{const a=0===e.minScale||t<=e.minScale,n=0===e.maxScale||t>=e.maxScale;if(e.visible&&a&&n)if(e.sublayers)e.sublayers.forEach(s);else if(e.popupEnabled){const t=Object(B.a)(e,{...r,defaultPopupTemplateEnabled:!1});Object(u.l)(t)&&i.unshift({sublayer:e,popupTemplate:t})}},a=e.toArray().reverse().map(s);return await Promise.all(a),i}_loadArcadeModules(e){var t;if(null!=(t=e.expressionInfos)&&t.length||Array.isArray(e.content)&&e.content.some((e=>"expression"===e.type)))return Object(q.e)()}};return Object(i.a)([Object(d.b)()],t.prototype,"highlightGraphics",void 0),Object(i.a)([Object(d.b)()],t.prototype,"exportImageParameters",void 0),Object(i.a)([Object(d.b)({readOnly:!0})],t.prototype,"exportImageVersion",null),Object(i.a)([Object(d.b)()],t.prototype,"layer",void 0),Object(i.a)([Object(d.b)()],t.prototype,"suspended",void 0),Object(i.a)([Object(d.b)(m.a)],t.prototype,"timeExtent",void 0),t=Object(i.a)([Object(o.a)("esri.views.layers.MapImageLayerView")],t),t};var C=r(1165);let K=class extends(W(l.a)){constructor(){super(...arguments),this.type="map-image-3d"}initialize(){this.updatingHandles.add((()=>this.exportImageVersion),(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}createFetchPopupFeaturesQueryGeometry(e,t){return Object(C.a)(e,t,this.view)}highlight(e){return{remove:()=>{}}}highlightGraphicUpdated(e,t){}getFetchOptions(){return{timeExtent:this.timeExtent}}};K=Object(i.a)([Object(o.a)("esri.views.3d.layers.MapImageLayerView3D")],K);const X=K}}]);
//# sourceMappingURL=94.91205564.chunk.js.map