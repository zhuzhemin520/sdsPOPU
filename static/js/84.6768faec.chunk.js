(this["webpackJsonppopulation-arcgis"]=this["webpackJsonppopulation-arcgis"]||[]).push([[84],{1076:function(e,t,i){"use strict";i.r(t),i.d(t,"FeatureServiceSnappingSource",(function(){return L}));var n=i(0),a=i(28),r=i(243),o=i(226),s=i(2),l=i(23),c=i(13),d=i(1),u=(i(17),i(12),i(10)),h=i(570),p=i(127),b=i(911),y=i(5),g=i(41),f=i(266);function O(e,t){return Object(f.h)(t.extent,v),Object(f.i)(v,Object(y.B)(w,e.x,e.y,0))}const v=Object(f.b)(),w=Object(g.e)();var j=i(677);let _=class extends a.a{constructor(e){super(e),this.pointOfInterest=null}get tiles(){const e=this.tilesCoveringView,t=Object(s.l)(this.pointOfInterest)?this.pointOfInterest:this.view.center;return e.sort(((e,i)=>O(t,e)-O(t,i))),e}_scaleEnabled(){return Object(j.e)(this.view.scale,this.layer.minScale||0,this.layer.maxScale||0)}get tilesCoveringView(){if(!this.view.ready||!this.view.featuresTilingScheme||!this.view.state||Object(s.k)(this.tileInfo))return[];if(!this._scaleEnabled)return[];const{spans:e,lodInfo:t}=this.view.featuresTilingScheme.getTileCoverage(this.view.state,0),{level:i}=t,n=[];for(const{row:a,colFrom:r,colTo:o}of e)for(let e=r;e<=o;e++){const r=t.normalizeCol(e),o=new b.a(null,i,a,r);this.tileInfo.updateTileInfo(o),n.push(o)}return n}get tileInfo(){var e,t;return null!=(e=null==(t=this.view.featuresTilingScheme)?void 0:t.tileInfo)?e:null}get tileSize(){return Object(s.l)(this.tileInfo)?this.tileInfo.size[0]:256}initialize(){this.addHandles(Object(c.f)((()=>{var e,t;return null==(e=this.view)||null==(t=e.state)?void 0:t.viewpoint}),(()=>this.notifyChange("tilesCoveringView")),c.d))}};Object(n.a)([Object(d.b)({readOnly:!0})],_.prototype,"tiles",null),Object(n.a)([Object(d.b)({readOnly:!0})],_.prototype,"_scaleEnabled",null),Object(n.a)([Object(d.b)({readOnly:!0})],_.prototype,"tilesCoveringView",null),Object(n.a)([Object(d.b)({readOnly:!0})],_.prototype,"tileInfo",null),Object(n.a)([Object(d.b)({readOnly:!0})],_.prototype,"tileSize",null),Object(n.a)([Object(d.b)({constructOnly:!0})],_.prototype,"view",void 0),Object(n.a)([Object(d.b)({constructOnly:!0})],_.prototype,"layer",void 0),Object(n.a)([Object(d.b)()],_.prototype,"pointOfInterest",void 0),_=Object(n.a)([Object(u.a)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles2D")],_);var S=i(262);let I=class extends r.a{constructor(e){super(e),this.pointOfInterest=null}get tiles(){const e=this.tilesCoveringView,t=this._effectivePointOfInterest;if(Object(s.l)(t)){const i=e.map((e=>O(t,e)));for(let n=1;n<i.length;n++)if(i[n-1]>i[n])return e.sort(((e,i)=>O(t,e)-O(t,i))),e.slice()}return e}get tilesCoveringView(){var e,t;return this._filterTiles(null==(e=this.view.featureTiles)||null==(t=e.tiles)?void 0:t.toArray()).map(m)}get tileInfo(){var e,t;return null!=(e=null==(t=this.view.featureTiles)?void 0:t.tilingScheme.toTileInfo())?e:null}get tileSize(){var e,t;return null!=(e=null==(t=this.view.featureTiles)?void 0:t.tileSize)?e:256}get _effectivePointOfInterest(){var e;const t=this.pointOfInterest;return Object(s.l)(t)?t:null==(e=this.view.pointsOfInterest)?void 0:e.focus.location}initialize(){this.handles.add(Object(c.f)((()=>this.view.featureTiles),(e=>{this.handles.remove(H),e&&this.handles.add(e.addClient(),H)}),c.a))}_filterTiles(e){return Object(s.k)(e)?[]:e.filter((e=>Math.abs(e.measures.screenRect[3]-e.measures.screenRect[1])>k&&e.measures.visibility===S.b.VISIBLE_ON_SURFACE))}};function m({lij:[e,t,i],extent:n}){return new b.a(`${e}/${t}/${i}`,e,t,i,n)}Object(n.a)([Object(d.b)({readOnly:!0})],I.prototype,"tiles",null),Object(n.a)([Object(d.b)({readOnly:!0})],I.prototype,"tilesCoveringView",null),Object(n.a)([Object(d.b)({readOnly:!0})],I.prototype,"tileInfo",null),Object(n.a)([Object(d.b)({readOnly:!0})],I.prototype,"tileSize",null),Object(n.a)([Object(d.b)({constructOnly:!0})],I.prototype,"view",void 0),Object(n.a)([Object(d.b)()],I.prototype,"pointOfInterest",void 0),Object(n.a)([Object(d.b)()],I.prototype,"_effectivePointOfInterest",null),I=Object(n.a)([Object(u.a)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles3D")],I);const k=50,H="feature-tiles";var T=i(1279),P=i(64),E=i(180),C=i(37),F=i(1191);let z=class extends F.a{constructor(e){super(e),this._handles=new P.a}initialize(){const e=setInterval((()=>this._fetchDebugInfo()),2e3);this._handles.add(Object(o.c)((()=>clearInterval(e))))}destroy(){this._handles.destroy()}getTiles(){if(!this._debugInfo)return[];const e=new Map,t=new Map;this._debugInfo.storedTiles.forEach((t=>{e.set(t.data.id,t.featureCount)})),this._debugInfo.pendingTiles.forEach((i=>{e.set(i.data.id,i.featureCount),t.set(i.data.id,i.state)}));const i=i=>{var n;const a=t.get(i),r=null!=(n=e.get(i))?n:"?";return a?`${a}:${r}\n${i}`:`store:${r}\n${i}`},n=new Map;return this._debugInfo.storedTiles.forEach((e=>{n.set(e.data.id,e.data)})),this._debugInfo.pendingTiles.forEach((e=>{n.set(e.data.id,e.data)})),Array.from(n.values()).map((e=>({lij:[e.level,e.row,e.col],geometry:E.a.fromExtent(Object(C.C)(e.extent,this.view.spatialReference)),label:i(e.id)})))}_fetchDebugInfo(){this.handle.getDebugInfo(null).then((e=>{this._debugInfo=e,this.update()}))}};Object(n.a)([Object(d.b)({constructOnly:!0})],z.prototype,"handle",void 0),z=Object(n.a)([Object(u.a)("esri.views.interactive.snapping.featureSources.WorkerTileTreeDebugger")],z);var M=i(733),x=i(323);let R=class extends r.a{constructor(e){super(e),this.schedule=null,this.hasZ=!1,this.elevationAlignPointsInFeatures=async e=>{const t=[];for(const{points:i}of e)for(const{z:e}of i)t.push(e);return{elevations:t,drapedObjectIds:new Set,failedObjectIds:new Set}},this.queryForSymbologySnapping=async()=>({candidates:[],sourceCandidateIndices:[]}),this.availability=0,this._workerHandleUpdating=!0,this._editId=0}get updating(){return this.updatingHandles.updating||this._workerHandleUpdating}destroy(){this._workerHandle.destroy()}initialize(){this._workerHandle=new N(this.schedule,{alignElevation:async(e,{signal:t})=>({result:await this.elevationAlignPointsInFeatures(e.points,t)}),getSymbologyCandidates:async(e,{signal:t})=>({result:await this.queryForSymbologySnapping(e,t)})}),this.handles.add([this._workerHandle.on("notify-updating",(({updating:e})=>this._workerHandleUpdating=e)),this._workerHandle.on("notify-availability",(({availability:e})=>this._set("availability",e)))])}async setup(e,t){var i;const n=this._serviceInfoFromLayer(e.layer);if(Object(s.k)(n))return;const a={configuration:this._convertConfiguration(e.configuration),serviceInfo:n,spatialReference:e.spatialReference.toJSON(),hasZ:this.hasZ,elevationInfo:null==(i=e.layer.elevationInfo)?void 0:i.toJSON()};await this.updatingHandles.addPromise(this._workerHandle.invokeMethod("setup",a,t)),this.updatingHandles.addPromise(this._workerHandle.invokeMethod("whenNotUpdating",{},t))}async configure(e,t){const i=this._convertConfiguration(e);await this.updatingHandles.addPromise(this._workerHandle.invokeMethod("configure",i,t)),this.updatingHandles.addPromise(this._workerHandle.invokeMethod("whenNotUpdating",{},t))}async refresh(e){await this.updatingHandles.addPromise(this._workerHandle.invokeMethod("refresh",{},e)),this.updatingHandles.addPromise(this._workerHandle.invokeMethod("whenNotUpdating",{},e))}async fetchCandidates(e,t){const i={distance:e.distance,point:e.coordinateHelper.vectorToPoint(e.point).toJSON(),types:e.types,filter:Object(s.l)(e.filter)?e.filter.toJSON():null};return this._workerHandle.invoke(i,t)}async updateTiles(e,t){const i={tiles:e.tiles,tileInfo:Object(s.l)(e.tileInfo)?e.tileInfo.toJSON():null,tileSize:e.tileSize};await this.updatingHandles.addPromise(this._workerHandle.invokeMethod("updateTiles",i,t)),this.updatingHandles.addPromise(this._workerHandle.invokeMethod("whenNotUpdating",{},t))}async applyEdits(e,t){var i,n,a,r,o,c;const d=this._editId++,u={id:d};await this.updatingHandles.addPromise(this._workerHandle.invokeMethod("beginApplyEdits",u,t));const h=await this.updatingHandles.addPromise(Object(l.u)(e.result,t)),p={id:d,edits:{addedFeatures:null!=(i=null==(n=h.addedFeatures)?void 0:n.map((({objectId:e})=>e)).filter(s.l))?i:[],deletedFeatures:null!=(a=null==(r=h.deletedFeatures)?void 0:r.map((({objectId:e,globalId:t})=>({objectId:e,globalId:t}))))?a:[],updatedFeatures:null!=(o=null==(c=h.updatedFeatures)?void 0:c.map((({objectId:e})=>e)).filter(s.l))?o:[]}};await this.updatingHandles.addPromise(this._workerHandle.invokeMethod("endApplyEdits",p,t)),this.updatingHandles.addPromise(this._workerHandle.invokeMethod("whenNotUpdating",{},t))}getDebugInfo(e){return this._workerHandle.invokeMethod("getDebugInfo",{},e)}async notifyElevationSourceChange(){await this._workerHandle.invokeMethod("notifyElevationSourceChange",{})}async notifySymbologyChange(){await this._workerHandle.invokeMethod("notifySymbologyChange",{})}async setSymbologySnappingSupported(e){await this._workerHandle.invokeMethod("setSymbologySnappingSupported",e)}_convertConfiguration(e){return{filter:Object(s.l)(e.filter)?e.filter.toJSON():null,customParameters:e.customParameters,viewType:e.viewType}}_serviceInfoFromLayer(e){var t,i,n;return"multipatch"===e.geometryType||"mesh"===e.geometryType?null:{url:null!=(t=null==(i=e.parsedUrl)?void 0:i.path)?t:"",fields:e.fields.map((e=>e.toJSON())),geometryType:x.a.toJSON(e.geometryType),capabilities:e.capabilities,objectIdField:e.objectIdField,globalIdField:e.globalIdField,spatialReference:e.spatialReference.toJSON(),timeInfo:null==(n=e.timeInfo)?void 0:n.toJSON()}}};Object(n.a)([Object(d.b)({constructOnly:!0})],R.prototype,"schedule",void 0),Object(n.a)([Object(d.b)({constructOnly:!0})],R.prototype,"hasZ",void 0),Object(n.a)([Object(d.b)({constructOnly:!0})],R.prototype,"elevationAlignPointsInFeatures",void 0),Object(n.a)([Object(d.b)({constructOnly:!0})],R.prototype,"queryForSymbologySnapping",void 0),Object(n.a)([Object(d.b)({readOnly:!0})],R.prototype,"updating",null),Object(n.a)([Object(d.b)({readOnly:!0})],R.prototype,"availability",void 0),Object(n.a)([Object(d.b)()],R.prototype,"_workerHandleUpdating",void 0),R=Object(n.a)([Object(u.a)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorkerHandle")],R);class N extends M.a{constructor(e,t){super("FeatureServiceSnappingSourceWorker","fetchCandidates",{},e,{strategy:"dedicated",client:t})}}var V=i(62),A=i(873),J=i(672);let U=class extends a.a{constructor(e){super(e),this.pointOfInterest=null}get tiles(){return[new b.a("0/0/0",0,0,0,Object(C.u)(-1e8,-1e8,1e8,1e8))]}get tileInfo(){return new J.a({origin:new V.a({x:-1e8,y:1e8,spatialReference:this.layer.spatialReference}),size:[512,512],lods:[new A.a({level:0,scale:1,resolution:390625})],spatialReference:this.layer.spatialReference})}get tileSize(){return this.tileInfo.size[0]}};Object(n.a)([Object(d.b)({readOnly:!0})],U.prototype,"tiles",null),Object(n.a)([Object(d.b)({readOnly:!0})],U.prototype,"tileInfo",null),Object(n.a)([Object(d.b)({readOnly:!0})],U.prototype,"tileSize",null),Object(n.a)([Object(d.b)({constructOnly:!0})],U.prototype,"layer",void 0),Object(n.a)([Object(d.b)()],U.prototype,"pointOfInterest",void 0),U=Object(n.a)([Object(u.a)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTilesSimple")],U);var D=i(986);let L=class extends(Object(r.b)(a.a)){constructor(e){super(e)}get _updateTilesParameters(){return{tiles:this._tilesOfInterest.tiles,tileInfo:this._tilesOfInterest.tileInfo,tileSize:this._tilesOfInterest.tileSize}}get updating(){return this._workerHandle.updating||this.updatingHandles.updating}get configuration(){const{view:e}=this,t=Object(s.l)(e)?e.type:"2d";return{filter:this._layer.createQuery(),customParameters:this._layer.customParameters,viewType:t}}get availability(){return this._workerHandle.availability}get _layer(){return this.layerSource.layer}initialize(){const e=this.view;if(Object(s.l)(e))switch(e.type){case"2d":this._tilesOfInterest=new _({view:e,layer:this._layer}),this._workerHandle=new R;break;case"3d":{var t;const{resourceController:i}=e,n=this._layer,a=e.whenLayerView(n);this._tilesOfInterest=new I({view:e}),this._workerHandle=new R({schedule:e=>i.schedule(e),hasZ:this._layer.hasZ&&(null==(t=this._layer.returnZ)||t),elevationAlignPointsInFeatures:async(e,t)=>{const i=await a;return Object(l.q)(t),i.elevationAlignPointsInFeatures(e,t)},queryForSymbologySnapping:async(e,t)=>{const i=await a;return Object(l.q)(t),i.queryForSymbologySnapping(e,t)}});const r=new h.a(null);a.then((e=>r.set(e))),this.addHandles([e.elevationProvider.on("elevation-change",(({context:e})=>{var t;const{elevationInfo:i}=n;Object(p.b)(e,i)&&(null==(t=this._workerHandle)||t.notifyElevationSourceChange())})),Object(c.f)((()=>n.elevationInfo),(()=>{var e;return null==(e=this._workerHandle)?void 0:e.notifyElevationSourceChange()}),c.a),Object(c.f)((()=>Object(s.b)(r.get(),(({processor:e})=>null==e?void 0:e.renderer))),(()=>{var e;return null==(e=this._workerHandle)?void 0:e.notifySymbologyChange()}),c.a),Object(c.f)((()=>Object(s.n)(r.get(),!1,(e=>e.symbologySnappingSupported))),(e=>{var t;return null==(t=this._workerHandle)?void 0:t.setSymbologySnappingSupported(e)}),c.a)]);break}}else this._tilesOfInterest=new U({layer:this._layer}),this._workerHandle=new R;this.handles.add([Object(o.a)(this._workerHandle)]),this._workerHandle.setup({layer:this._layer,spatialReference:this.spatialReference,configuration:this.configuration},null),this.updatingHandles.add((()=>this._updateTilesParameters),(()=>this._workerHandle.updateTiles(this._updateTilesParameters,null)),c.a),this.handles.add([Object(c.f)((()=>this.configuration),(e=>this._workerHandle.configure(e,null)),c.d)]),Object(s.l)(e)&&this.handles.add(Object(c.f)((()=>D.a.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES),(t=>{t&&!this._debug?(this._debug=new z({view:e,handle:this._workerHandle}),this.handles.add(Object(o.a)(this._debug),"debug")):!t&&this._debug&&this.handles.remove("debug")}),c.a)),this.handles.add(this.layerSource.layer.on("apply-edits",(e=>{this._workerHandle.applyEdits(e,null)})))}refresh(){this._workerHandle.refresh(null)}async fetchCandidates(e,t){const{coordinateHelper:i,elevationInfo:n,point:a}=e;this._tilesOfInterest.pointOfInterest=i.vectorToPoint(a);const r=i.hasZ()?p.a:n,o=this._getGroundElevation;return(await this._workerHandle.fetchCandidates({...e},t)).candidates.map((e=>Object(T.a)(e,i,r,o)))}getDebugInfo(e){return this._workerHandle.getDebugInfo(e)}get _getGroundElevation(){return Object(T.b)(this.view)}};Object(n.a)([Object(d.b)({constructOnly:!0})],L.prototype,"spatialReference",void 0),Object(n.a)([Object(d.b)({constructOnly:!0})],L.prototype,"layerSource",void 0),Object(n.a)([Object(d.b)({constructOnly:!0})],L.prototype,"view",void 0),Object(n.a)([Object(d.b)()],L.prototype,"_tilesOfInterest",void 0),Object(n.a)([Object(d.b)({readOnly:!0})],L.prototype,"_updateTilesParameters",null),Object(n.a)([Object(d.b)({readOnly:!0})],L.prototype,"updating",null),Object(n.a)([Object(d.b)({readOnly:!0})],L.prototype,"configuration",null),Object(n.a)([Object(d.b)({readOnly:!0})],L.prototype,"availability",null),Object(n.a)([Object(d.b)()],L.prototype,"_getGroundElevation",null),L=Object(n.a)([Object(u.a)("esri.views.interactive.snapping.featureSources.FeatureServiceSnappingSource")],L)},1126:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i(78),a=i(510);class r extends a.a{constructor(e,t,i){super(t,i),this.point=e}equals(e){return e instanceof r&&Object(n.f)(this.point,e.point)}}},1191:function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var n=i(0),a=i(46),r=i(171),o=i(28),s=i(14),l=i(2),c=i(1),d=(i(17),i(12),i(10)),u=i(338),h=i(256),p=i(425),b=i(340);const y=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];let g=class extends o.a{constructor(e){super(e),this.updating=!1,this.enablePolygons=!0,this.enableLabels=!0,this._polygons=new Map,this._labels=new Map,this._enabled=!0}initialize(){this._symbols=y.map((e=>new h.a({color:[e[0],e[1],e[2],.6],outline:{color:"black",width:1}}))),this.update()}destroy(){this._enabled=!1,this.clear()}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this.update())}update(){if(!this._enabled)return void this.clear();const e=this.getTiles(),t=new Array,i=new Set((this._labels.size,this._labels.keys()));e.forEach(((n,o)=>{const c=n.lij.toString();i.delete(c);const d=n.lij[0],h=n.geometry;if(this.enablePolygons&&!this._polygons.has(c)){const e=new r.a({geometry:h,symbol:this._symbols[d%this._symbols.length]});this._polygons.set(c,e),t.push(e)}if(this.enableLabels){const i=(e=>{if(Object(l.l)(e.label))return e.label;let t=e.lij.toString();return Object(l.l)(e.loadPriority)&&(t+=` (${e.loadPriority})`),t})(n),d=o/(e.length-1),y=Object(s.m)(0,200,d),g=Object(s.m)(20,6,d)/.75,f=Object(l.l)(n.loadPriority)&&n.loadPriority>=e.length,O=new a.a([y,f?0:y,f?0:y]),v="3d"===this.view.type?()=>new u.a({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new b.a({text:i,halo:{color:"white",size:1/.75},material:{color:O},size:g})]}):()=>new p.a({text:i,haloColor:"white",haloSize:1/.75,color:O,size:g});if(this._labels.has(c)){const e=this._labels.get(c),t=v();(Object(l.k)(e.symbol)||JSON.stringify(t)!==JSON.stringify(e.symbol))&&(e.symbol=t)}else{const e=new r.a({geometry:h.extent.center,symbol:v()});this._labels.set(c,e),t.push(e)}}}));const n=new Array;i.forEach((e=>{this._polygons.has(e)&&(n.push(this._polygons.get(e)),this._polygons.delete(e)),this._labels.has(e)&&(n.push(this._labels.get(e)),this._labels.delete(e))})),this.view.graphics.removeMany(n),this.view.graphics.addMany(t)}clear(){this.view.graphics.removeMany(Array.from(this._polygons.values())),this.view.graphics.removeMany(Array.from(this._labels.values())),this._polygons.clear(),this._labels.clear()}};Object(n.a)([Object(c.b)({constructOnly:!0})],g.prototype,"view",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],g.prototype,"updating",void 0),Object(n.a)([Object(c.b)()],g.prototype,"enabled",null),g=Object(n.a)([Object(d.a)("esri.views.support.TileTreeDebugger")],g)},1215:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i(357),a=i(735),r=i(1126);class o extends a.a{constructor(e){super({...e,constraint:new n.e(e.coordinateHelper,e.targetPoint)})}get hints(){return[new r.a(this.targetPoint,this.elevationInfo,this.domain)]}}},1279:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return h}));var n=i(2),a=i(357),r=i(78),o=i(735),s=i(360);class l extends o.a{constructor(e){super({...e,constraint:new a.a(e.coordinateHelper,e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new s.a(r.a.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo,this.domain)]}}var c=i(925),d=i(1215);function u(e,t,i,n){switch(e.type){case"edge":return e.draped?new l({coordinateHelper:t,edgeStart:t.pointToVector(e.start),edgeEnd:t.pointToVector(e.end),targetPoint:t.pointToVector(e.target),objectId:e.objectId,getGroundElevation:n,elevationInfo:i}):new c.a({coordinateHelper:t,edgeStart:t.pointToVector(e.start),edgeEnd:t.pointToVector(e.end),targetPoint:t.pointToVector(e.target),objectId:e.objectId,elevationInfo:i});case"vertex":return new d.a({coordinateHelper:t,targetPoint:t.pointToVector(e.target),objectId:e.objectId,elevationInfo:i})}}function h(e){return Object(n.l)(e)&&"3d"===e.type?(t,i,n)=>e.elevationProvider.getElevation(t,i,n,e.spatialReference,"ground"):()=>null}}}]);
//# sourceMappingURL=84.6768faec.chunk.js.map