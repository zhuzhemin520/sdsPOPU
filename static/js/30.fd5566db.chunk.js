(this["webpackJsonppopulation-arcgis"]=this["webpackJsonppopulation-arcgis"]||[]).push([[30],{1104:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n(0),r=n(28),a=n(108),s=n(243),l=n(509),o=n(22),c=n(2),u=n(446),f=n(1),h=(n(17),n(12),n(10));let p=class extends(Object(s.b)(Object(l.b)(Object(u.b)(a.a.EventedMixin(r.a))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",n=this.layer&&this.layer.title||"no title";o.a.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${n}', id: '${t}')`,e)}}))}get fullOpacity(){return Object(c.u)(this.get("layer.opacity"),1)*Object(c.u)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var e;return!this.suspended&&!0===(null==(e=this.layer)?void 0:e.legendEnabled)}get updating(){var e;return!((null==(e=this.updatingHandles)||!e.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var e;return!0===(null==(e=this.layer)?void 0:e.visible)}set visible(e){this._overrideIfSome("visible",e)}canResume(){var e,t,n;return this.visible&&(null==(e=this.layer)?void 0:e.loaded)&&!(null!=(t=this.parent)&&t.suspended)&&(null==(n=this.view)?void 0:n.ready)||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(i.a)([Object(f.b)()],p.prototype,"fullOpacity",null),Object(i.a)([Object(f.b)()],p.prototype,"layer",void 0),Object(i.a)([Object(f.b)()],p.prototype,"parent",void 0),Object(i.a)([Object(f.b)({readOnly:!0})],p.prototype,"suspended",null),Object(i.a)([Object(f.b)({readOnly:!0})],p.prototype,"suspendInfo",null),Object(i.a)([Object(f.b)({readOnly:!0})],p.prototype,"legendEnabled",null),Object(i.a)([Object(f.b)({type:Boolean,readOnly:!0})],p.prototype,"updating",null),Object(i.a)([Object(f.b)({readOnly:!0})],p.prototype,"updatingProgress",null),Object(i.a)([Object(f.b)()],p.prototype,"visible",null),Object(i.a)([Object(f.b)()],p.prototype,"view",void 0),p=Object(i.a)([Object(h.a)("esri.views.layers.LayerView")],p);const d=p},1106:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n(0),r=n(226),a=n(23),s=n(13),l=n(1),o=(n(17),n(12),n(10)),c=n(868);const u=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(e){super.postscript(e),Object(c.c)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.handles.add(Object(r.c)((()=>e.abort()))),await Object(s.h)((()=>{var e;return null==(e=this.view.defaultsFromMap)?void 0:e.heightModelInfoReady}),t),Object(a.q)(t);const n=Object(c.b)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(n)throw n}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!e||!e.minScale||!e.maxScale||e.minScale>=e.maxScale)}getSuspendInfo(){const e=super.getSuspendInfo(),t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return t&&t.minScale&&t.maxScale&&t.minScale<t.maxScale&&(e.outsideScaleRange=!0),e}};return Object(i.a)([Object(l.b)()],t.prototype,"view",void 0),Object(i.a)([Object(l.b)()],t.prototype,"slicePlaneEnabled",void 0),t=Object(i.a)([Object(o.a)("esri.views.3d.layers.LayerView3D")],t),t}},1116:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return a}));var i=n(2),r=n(99);async function a(e,t=e.popupTemplate){if(Object(i.k)(t))return[];const n=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:a}=t,{objectIdField:s,typeIdField:l,globalIdField:o,relationships:c}=e;if(n.includes("*"))return["*"];const u=a?await Object(r.n)(e):[],f=Object(r.j)(e.fieldsIndex,[...n,...u]);return l&&f.push(l),f&&s&&e.fieldsIndex.has(s)&&!f.includes(s)&&f.push(s),f&&o&&e.fieldsIndex.has(o)&&!f.includes(o)&&f.push(o),c&&c.forEach((t=>{const{keyField:n}=t;f&&n&&e.fieldsIndex.has(n)&&!f.includes(n)&&f.push(n)})),f}function s(e,t){return e.popupTemplate?e.popupTemplate:Object(i.l)(t)&&t.defaultPopupTemplateEnabled&&Object(i.l)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},1146:function(e,t,n){"use strict";function i(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function r(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){let t=0,n=0;for(let i=0;i<e.length;i++){const r=e[i].size;"number"==typeof r&&(t+=r,n++)}return t/n}(e.stops):t}function a(e,t){if(!t)return e;const n=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:n,minSize:i}=t;return(r(n,e)+r(i,e))/2}));let i=0;const a=n.length;if(0===a)return e;for(let r=0;r<a;r++)i+=n[r];const s=Math.floor(i/a);return Math.max(s,e)}function s(e){const t=e&&e.renderer,n="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return n;const r="visualVariables"in t?a(n,t.visualVariables):n;if("simple"===t.type)return i(r,t.symbol);if("unique-value"===t.type){var s;let e=r;return null!=(s=t.uniqueValueInfos)&&s.forEach((t=>{e=i(e,t.symbol)})),e}if("class-breaks"===t.type){let e=r;return t.classBreakInfos.forEach((t=>{e=i(e,t.symbol)})),e}return"dot-density"===t.type||t.type,r}n.d(t,"a",(function(){return s}))},1163:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var i=n(0),r=n(16),a=n(2),s=n(13),l=n(1),o=(n(17),n(12),n(10)),c=n(904),u=n(29);const f=e=>{let t=class extends e{get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return this.fullOpacity>=1&&this.imageFormatIsOpaque}get dataLevelRange(){const e=this.tileInfo.lods,t=e[0].scale,n=e[e.length-1].scale;return this.levelRangeFromScaleRange(t,n)}get displayLevelRange(){const e=this.tileInfo.lods,t=this.layer.minScale||e[0].scale,n=this.layer.maxScale||e[e.length-1].scale,i=this.levelRangeFromScaleRange(t,n);return this.layer.maxScale&&i.maxLevel++,i}getTileUrl(e,t,n){return this.layer.getTileUrl(e,t,n)}_addTilingSchemeMatchPromise(){if(Object(a.k)(this.fullExtent))return this.addResolvingPromise(Promise.reject(new r.a("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));const e=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(Object(a.l)(e))return this.addResolvingPromise(Promise.reject(e));const t=Object(s.h)((()=>{var e,t;return null==(e=this.view)||null==(t=e.basemapTerrain)?void 0:t.tilingSchemeLocked})).then((()=>{const e=this.view.basemapTerrain.tilingScheme,t=this._getTileInfoCompatibilityError(this.tileInfo,e);if(t)throw t}));this.addResolvingPromise(t)}_getTileInfoSupportError(e,t){const n=Object(u.d)(e,t,this.view.spatialReference,this.view.state.viewingMode);if(n){const e={layer:this.layer,error:n};let t;switch(n.name){case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":case"tilingscheme:local-unsupported-spatial-reference":t=new r.a("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",e);break;default:t=new r.a("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",e)}return t}return null}_getTileInfoCompatibilityError(e,t){return t.compatibleWith(e)?null:new r.a("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(e,t){const n={minLevel:0,maxLevel:1/0},i=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!i)return n;const r=i.levels[0],a=e=>{const t=Math.log(r.scale/e)/Math.LN2;return.5-Math.abs(.5-t%1)<1e-9?Math.round(t):Math.ceil(t)};return null!=e&&e>0&&(n.minLevel=Math.max(0,a(e))),null!=t&&t>0&&(n.maxLevel=Math.max(0,a(t))),n}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};return Object(i.a)([Object(l.b)({readOnly:!0})],t.prototype,"imageFormatIsOpaque",null),Object(i.a)([Object(l.b)({readOnly:!0})],t.prototype,"updating",void 0),Object(i.a)([Object(l.b)(c.a)],t.prototype,"updatingProgress",void 0),Object(i.a)([Object(l.b)(c.b)],t.prototype,"updatingProgressValue",void 0),Object(i.a)([Object(l.b)()],t.prototype,"fullExtent",null),Object(i.a)([Object(l.b)({readOnly:!0})],t.prototype,"isOpaque",null),Object(i.a)([Object(l.b)({readOnly:!0})],t.prototype,"dataLevelRange",null),Object(i.a)([Object(l.b)({readOnly:!0})],t.prototype,"displayLevelRange",null),Object(i.a)([Object(l.b)()],t.prototype,"layer",void 0),Object(i.a)([Object(l.b)()],t.prototype,"tileInfo",void 0),t=Object(i.a)([Object(o.a)("esri.views.3d.layers.TiledLayerView3D")],t),t}},1164:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(0),r=n(22),a=n(23),s=n(13),l=n(1),o=(n(17),n(12),n(10));const c=e=>{let t=class extends e{initialize(){this.handles.add(Object(s.b)((()=>this.layer),"refresh",(e=>{this.doRefresh(e.dataChanged).catch((e=>{Object(a.j)(e)||r.a.getLogger(this.declaredClass).error(e)}))})),"RefreshableLayerView")}};return Object(i.a)([Object(l.b)()],t.prototype,"layer",void 0),t=Object(i.a)([Object(o.a)("esri.layers.mixins.RefreshableLayerView")],t),t}},1165:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return o}));n(167);var i=n(2),r=n(68),a=n(1146),s=n(86);function l(e,t,n,a=new s.a){let l;if("2d"===n.type)l=t*n.resolution;else if("3d"===n.type){const a=n.overlayPixelSizeInMapUnits(e),s=n.basemapSpatialReference;l=Object(i.l)(s)&&!s.equals(n.spatialReference)?Object(r.f)(s)/Object(r.f)(n.spatialReference):t*a}const o=e.x-l,c=e.y-l,u=e.x+l,f=e.y+l,{spatialReference:h}=n;return a.xmin=Math.min(o,u),a.ymin=Math.min(c,f),a.xmax=Math.max(o,u),a.ymax=Math.max(c,f),a.spatialReference=h,a}function o(e,t,n){const r=n.toMap(e);return!Object(i.k)(r)&&l(r,Object(a.a)(),n,c).intersects(t)}const c=new s.a},1253:function(e,t,n){"use strict";n.d(t,"a",(function(){return v})),n.d(t,"b",(function(){return q})),n.d(t,"c",(function(){return W})),n.d(t,"d",(function(){return N})),n.d(t,"e",(function(){return C})),n.d(t,"f",(function(){return j})),n.d(t,"g",(function(){return L})),n.d(t,"h",(function(){return S})),n.d(t,"i",(function(){return w})),n.d(t,"j",(function(){return d})),n.d(t,"k",(function(){return B})),n.d(t,"l",(function(){return J}));n(167);var i,r,a=n(16),s=n(2),l=n(68),o=n(779),c=n(40),u=n(86),f=n(62),h=n(180),p=n(57);function d(e,t,n){return!Object(c.b)(e,t,n)}function b(e,t,n){const i=d(e,t,n);if(i&&!Object(c.h)())throw new a.a("rasterprojectionhelper-project","projection engine is not loaded");return i}(r=i||(i={}))[r.None=0]="None",r[r.North=1]="North",r[r.South=2]="South",r[r.Both=3]="Both";const m=(e,t,n,i=0)=>{if(1===n[0])return[0,0];let r=1,a=-1,s=1,l=-1;for(let m=0;m<e.length;m+=2)isNaN(e[m])||(r=r>e[m]?e[m]:r,a=a>e[m]?a:e[m],s=s>e[m+1]?e[m+1]:s,l=l>e[m+1]?l:e[m+1]);const{cols:o,rows:c}=t,u=(a-r)/o/n[0],f=(l-s)/c/n[1],h=2*i;let p=0,d=!1,b=[0,0];for(let m=0;m<o-3;m++){for(let t=0;t<c-3;t++){const n=m*c*2+2*t,i=(e[n]+e[n+4]+e[n+4*c]+e[n+4*c+4])/4,r=(e[n+1]+e[n+5]+e[n+4*c+1]+e[n+4*c+5])/4,a=Math.abs((i-e[n+2*c+2])/u),s=Math.abs((r-e[n+2*c+3])/f);if(a+s>p&&(p=a+s,b=[a,s]),h&&p>h){d=!0;break}}if(d)break}return b},y={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},g=new Map,x=new Map,O=500;async function j(){Object(c.h)()||await Object(c.i)()}function v(e,t,n){return b(e.spatialReference,t)?n?Object(c.f)(t,e.spatialReference,e):Object(c.f)(e.spatialReference,t,e):null}function w(e,t,n,i=null){const r=e.spatialReference;if(r.equals(t))return e;b(r,t,i);const a=n.center,o=new u.a({xmin:a.x-e.x/2,xmax:a.x+e.x/2,ymin:a.y-e.y/2,ymax:a.y+e.y/2,spatialReference:r}),f=Object(c.m)(o,t,i),h=N(t);let p;if(Object(s.k)(f)||Object(s.l)(h)&&f.width>=h){const n=Object(l.f)(r)/Object(l.f)(t);p={x:e.x*n,y:e.y*n}}else p={x:f.width,y:f.height};return p}function R(e,t=.01){return Object(l.f)(e)?t/Object(l.f)(e):0}function S(e,t,n=null,i=!0){const r=e.spatialReference;if(r.equals(t))return e;b(r,t,n);const a=Object(c.m)(e,t,n);return i&&a?(M([e],[a],r,t),a):a}function M(e,t,n,i){const r=z(n,!0),a=z(i,!0),l=R(n,O),o=R(i,O);if(l&&Object(s.l)(r)&&Object(s.l)(a))for(let s=0;s<e.length;s++){const n=t[s];if(!n)continue;const{x:i}=e[s],{x:c}=n;c>=a[1]-o&&Math.abs(i-r[0])<l?n.x-=a[1]-a[0]:c<=a[0]+o&&Math.abs(i-r[1])<l&&(n.x+=a[1]-a[0])}}function T(e){const{inSR:t,outSR:n,datumTransformation:i,preferPE:r}=e;if(t.equals(n)){const{points:t}=k(e,null);return t}if(t.isWebMercator&&n.isWGS84||t.isWGS84&&n.isWebMercator)return function(e){const{cols:t,rows:n,xres:i,yres:r,usePixelCenter:a,inSR:s,outSR:l}=e;let{xmin:o,ymax:u}=e;a&&(o+=i/2,u-=r/2);const h=[],p=[],d=Math.max(t,n);for(let m=0;m<d;m++){const e=o+i*Math.min(t,m),a=u-r*Math.min(n,m),d=Object(c.m)(new f.a({x:e,y:a,spatialReference:s}),l);m<=t&&h.push(d.x),m<=n&&p.push(d.y)}const b=[];for(let c=0;c<t;c++)for(let e=0;e<n;e++)b.push([h[c],p[e]]);return b}(e);if(b(t,n,i)&&r){if(t.isGeographic)return E(e);const n=I(t);if(Object(s.l)(n))return E(e)}return function(e){const{points:t}=k(e,null),{inSR:n,outSR:i,datumTransformation:r}=e,a=t.map((e=>new f.a(e[0],e[1],n))),s=Object(c.m)(a,i,r);return r&&M(a,s,n,i),s.map((e=>e?[e.x,e.y]:[NaN,NaN]))}(e)}function E(e){const{inSR:t,outSR:n,datumTransformation:i}=e,r=I(t),{points:a,mask:l}=k(e,r);if(!t.isGeographic){const e=t.wkid?o.a.coordsys(t.wkid):o.a.fromString(t.isGeographic?o.b.PE_TYPE_GEOGCS:o.b.PE_TYPE_PROJCS,t.wkt);o.c.projToGeog(e,a.length,a)}if(Object(s.l)(i)&&i.steps.length){let e;const t=179.9955;if(n.isGeographic&&(e=a.map((([e])=>e>t?1:e<-t?-1:0))),i.steps.forEach((e=>{const t=e.wkid?o.a.geogtran(e.wkid):o.a.fromString(o.b.PE_TYPE_GEOGTRAN,e.wkt);o.d.geogToGeog(t,a.length,a,null,e.isInverse?o.b.PE_TRANSFORM_2_TO_1:o.b.PE_TRANSFORM_1_TO_2)})),e)for(let n=0;n<a.length;n++){const i=e[n],r=a[n][0],s=r>t?1:r<-t?-1:0;i&&s&&i!==s&&(a[n][0]=i>0?r+360:r-360)}}if(!n.isGeographic){const e=I(n,!0),t=Object(s.l)(e)&&e.isEnvelope?[e.bbox[1],e.bbox[3]]:[-90,90];!function(e,t){const[n,i]=t;for(let r=0;r<e.length;r++){const t=e[r][1];(t<n||t>i)&&(e[r]=[NaN,NaN])}}(a,t);const i=n.wkid?o.a.coordsys(n.wkid):o.a.fromString(n.isGeographic?o.b.PE_TYPE_GEOGCS:o.b.PE_TYPE_PROJCS,n.wkt);o.c.geogToProj(i,a.length,a)}let c=a;if(l&&a.length!==l.length){c=[];for(let e=0,t=0;e<l.length;e++)l[e]?c.push(a[t++]):c.push([NaN,NaN])}return c}function I(e,t=!1){let n=e.wkid||e.wkt;if(!n||e.isGeographic)return null;if(n=String(n),g.has(n)){const e=g.get(n);return t?null==e?void 0:e.gcs:null==e?void 0:e.pcs}const i=e.wkid?o.a.coordsys(e.wkid):o.a.fromString(e.isGeographic?o.b.PE_TYPE_GEOGCS:o.b.PE_TYPE_PROJCS,e.wkt),r=P(i,R(e,1e-4)),a=P(i,0,!0);return g.set(n,{pcs:r,gcs:a}),t?a:r}function P(e,t=0,n=!1){const i=o.f.generate(e),r=n?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!i||null==r||!r.length)return null;let a=!1,s=r.find((e=>1===e.getInclusive()&&1===e.getKind()));if(!s){if(s=r.find((e=>1===e.getInclusive()&&0===e.getKind())),!s)return null;a=!0}const l=n?0:(2===i.getNorthPoleLocation()?1:0)|(2===i.getSouthPoleLocation()?2:0),c=i.isPannableRectangle(),u=s.getCoord();if(a)return{isEnvelope:a,isPannable:c,vertices:u,coef:null,bbox:[u[0][0]-t,u[0][1]-t,u[1][0]+t,u[1][1]+t],poleLocation:l};let f=0;const h=[];let[p,d]=u[0],[b,m]=u[0];for(let o=0,y=u.length;o<y;o++){f++,f===y&&(f=0);const[e,t]=u[o],[n,i]=u[f];if(i===t)h.push([e,n,t,i,2]);else{const r=(n-e)/(i-t||1e-4),a=e-r*t;t<i?h.push([r,a,t,i,0]):h.push([r,a,i,t,1])}p=p<e?p:e,d=d<t?d:t,b=b>e?b:e,m=m>t?m:t}return{isEnvelope:!1,isPannable:c,vertices:u,coef:h,bbox:[p,d,b,m],poleLocation:l}}function k(e,t){const n=[],{cols:i,rows:r,xres:a,yres:l,usePixelCenter:o}=e;let{xmin:c,ymax:u}=e;if(o&&(c+=a/2,u-=l/2),Object(s.k)(t)){for(let e=0;e<i;e++)for(let t=0;t<r;t++)n.push([c+a*e,u-l*t]);return{points:n}}const f=new Uint8Array(i*r);if(t.isEnvelope){const{bbox:[e,s,o,h]}=t;for(let p=0,d=0;p<i;p++){const i=c+a*p,b=t.isPannable||i>=e&&i<=o;for(let e=0;e<r;e++,d++){const t=u-l*e;b&&t>=s&&t<=h&&(n.push([i,t]),f[d]=1)}}return{points:n,mask:f}}const h=t.coef,p=[];for(let s=0;s<r;s++){const e=u-l*s,t=[],n=[];for(let r=0;r<h.length;r++){const[i,a,s,l,o]=h[r];if(e===s&&s===l)t.push(i),t.push(a),n.push(2),n.push(2);else if(e>=s&&e<=l){const r=i*e+a;t.push(r),n.push(o)}}let i=t;if(t.length>2){let e=2===n[0]?0:n[0],r=t[0];i=[];for(let a=1;a<n.length;a++)2===n[a]&&a!==n.length-1||(n[a]!==e&&(i.push(0===e?Math.min(r,t[a-1]):Math.max(r,t[a-1])),e=n[a],r=t[a]),a===n.length-1&&i.push(0===n[a]?Math.min(r,t[a]):Math.max(r,t[a])));i.sort(((e,t)=>e-t))}else t[0]>t[1]&&(i=[t[1],t[0]]);p.push(i)}for(let s=0,d=0;s<i;s++){const e=c+a*s;for(let t=0;t<r;t++,d++){const i=u-l*t,r=p[t];if(2===r.length)e>=r[0]&&e<=r[1]&&(n.push([e,i]),f[d]=1);else if(r.length>2){let t=!1;for(let n=0;n<r.length;n+=2)if(e>=r[n]&&e<=r[n+1]){t=!0;break}t&&(n.push([e,i]),f[d]=1)}}}return{points:n,mask:f}}function G(e){const t=N(e[0].spatialReference);if(e.length<2||Object(s.k)(t))return e[0];let{xmin:n,xmax:i,ymin:r,ymax:a}=e[0];for(let s=1;s<e.length;s++){const n=e[s];i=n.xmax+t*s,r=Math.min(r,n.ymin),a=Math.max(a,n.ymax)}return new u.a({xmin:n,xmax:i,ymin:r,ymax:a,spatialReference:e[0].spatialReference})}function L(e,t,n=null,r=!0){const a=e.spatialReference;if(a.equals(t))return e;const l=C(e),o=N(a,!0),f=N(t);if(0===l||Object(s.k)(o)||Object(s.k)(f)){const l=_(e,t,n,r);if(Object(s.k)(o)&&Object(s.l)(f)&&Math.abs(l.width-f)<R(t)&&Object(c.h)()){const n=I(a);if(Object(s.l)(n)&&n.poleLocation===i.None&&e.width<(n.bbox[2]-n.bbox[0])/2)return function(e,t){const n=N(t);if(Object(s.k)(n))return null;let{xmin:i,ymin:r,xmax:a,ymax:l}=e;const o=e.spatialReference,f=new h.a({spatialReference:o,rings:[[[i,r],[a,r],[a,l],[i,l],[i,r]]]}),p=Object(c.m)(f,t);if(2!==p.rings.length||!p.rings[0].length||!p.rings[1].length)return null;const{rings:d}=p,b=R(o),m=new u.a({spatialReference:t});for(let s=0;s<2;s++){i=a=d[s][0][0],r=l=d[s][0][1];for(let e=0;e<d[s].length;e++)i=i>d[s][e][0]?d[s][e][0]:i,a=a<d[s][e][0]?d[s][e][0]:a,r=r>d[s][e][1]?d[s][e][1]:r,l=l<d[s][e][1]?d[s][e][1]:l;if(0===s)m.ymin=r,m.ymax=l,m.xmin=i,m.xmax=a;else if(m.ymin=Math.min(m.ymin,r),m.ymax=Math.max(m.ymax,l),Math.abs(a-n/2)<b)m.xmin=i,m.xmax=m.xmax+n;else{if(!(Math.abs(i+n/2)<b))return null;m.xmax=a+n}}return m}(e,t)||l}return l}const p=e.clone().normalize();if(1===p.length&&e.xmax<o&&e.xmax-o/2>R(a)){const{xmin:t,xmax:n}=e;for(let i=0;i<=l;i++){const r=0===i?t:-o/2,s=i===l?n-o*i:o/2;p[i]=new u.a({xmin:r,xmax:s,ymin:e.ymin,ymax:e.ymax,spatialReference:a})}}return G(p.map((e=>_(e,t,n,r))).filter(s.l))}function _(e,t,n=null,i=!0,r=!0){const a=e.spatialReference;if(a.equals(t)||!t)return e;b(a,t,n);const l=Object(c.m)(e,t,n);if(r&&t.isWebMercator&&l&&(l.ymax=Math.min(20037508.342787,l.ymax),l.ymin=Math.max(-20037508.342787,l.ymin),l.ymin>=l.ymax))return null;if(!i||!l)return l;const o=z(a,!0),u=z(t,!0);if(Object(s.k)(o)||Object(s.k)(u))return l;const h=R(a,.001),p=R(a,O),d=R(t,.001);if(Math.abs(l.xmin-u[0])<d&&Math.abs(l.xmax-u[1])<d){const i=Math.abs(e.xmin-o[0]),r=Math.abs(o[1]-e.xmax);if(i<h&&r>p){l.xmin=u[0];const i=[];i.push(new f.a(e.xmax,e.ymin,a)),i.push(new f.a(e.xmax,(e.ymin+e.ymax)/2,a)),i.push(new f.a(e.xmax,e.ymax,a));const r=i.map((e=>S(e,t,n))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));l.xmax=Math.max.apply(null,r)}if(r<h&&i>p){l.xmax=u[1];const i=[];i.push(new f.a(e.xmin,e.ymin,a)),i.push(new f.a(e.xmin,(e.ymin+e.ymax)/2,a)),i.push(new f.a(e.xmin,e.ymax,a));const r=i.map((e=>S(e,t,n))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));l.xmin=Math.min.apply(null,r)}}else{const e=R(t,.001);Math.abs(l.xmin-u[0])<e&&(l.xmin=u[0]),Math.abs(l.xmax-u[1])<e&&(l.xmax=u[1])}return l}function N(e,t=!1){if(!e)return null;const n=t?20037508.342787:20037508.342788905;return e.isWebMercator?2*n:e.wkid&&e.isGeographic?360:2*y[e.wkid]||null}function z(e,t=!1){if(e.isGeographic)return[-180,180];const n=N(e,t);return Object(s.l)(n)?[-n/2,n/2]:null}function F(e,t,n,i){let r=(e-t)/n;return r-Math.floor(r)!=0?r=Math.floor(r):i&&(r-=1),r}function C(e,t=!1){const n=N(e.spatialReference);if(Object(s.k)(n))return 0;const i=t?0:-n/2,r=R(e.spatialReference),a=!t&&Math.abs(e.xmax-n/2)<r?n/2:e.xmax,l=!t&&Math.abs(e.xmin+n/2)<r?-n/2:e.xmin;return F(a,i,n,!0)-F(l,i,n,!1)}function W(e){const t=e.storageInfo.origin.x,n=N(e.spatialReference,!0);if(Object(s.k)(n))return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const i=n/2,{nativePixelSize:r,storageInfo:a,extent:l}=e,{maximumPyramidLevel:o,blockWidth:c,pyramidScalingFactor:u}=a;let f=r.x;const h=[],p=Object(s.l)(e.transform)&&"gcs-shift"===e.transform.type,d=t+(p?0:i),b=p?n-t:i-t;for(let s=0;s<=o;s++){const e=(l.xmax-t)/f/c,n=e-Math.floor(e)==0?e:Math.ceil(e),i=b/f/c,r=i-Math.floor(i)==0?i:Math.ceil(i),a=Math.floor(d/f/c),s=Math.round(d/f)%c,o=(c-Math.round(b/f)%c)%c;h.push({resolutionX:f,blockWidth:c,datsetColumnCount:n,worldColumnCountFromOrigin:r,leftMargin:s,rightPadding:o,originColumnOffset:a}),f*=u}return{originX:t,halfWorldWidth:i,pyramidsInfo:h,hasGCSSShiftTransform:p}}function q(e){const t=e.isAdaptive&&null==e.spacing;let n=e.spacing||[32,32],i=A(e),r={cols:i.size[0]+1,rows:i.size[1]+1};const a=i.outofBoundPointCount>0&&i.outofBoundPointCount<i.offsets.length/2;let l=i.outofBoundPointCount===i.offsets.length/2||t&&a?[0,0]:m(i.offsets,r,n,4);const c=(l[0]+l[1])/2,u=e.projectedExtent.spatialReference,f=e.srcBufferExtent.spatialReference;if(t&&(a||c>4)&&(d(u,f,e.datumTransformation)&&(u.isGeographic||Object(s.l)(I(u))),n=[4,4],i=A({...e,spacing:n}),r={cols:i.size[0]+1,rows:i.size[1]+1},l=m(i.offsets,r,n,4)),i.error=l,n[0]>1&&(i.coefficients=V(i.offsets,r,a)),e.includeGCSGrid&&!u.isGeographic&&!u.isWebMercator)if(f.isGeographic)i.gcsGrid={offsets:i.offsets,coefficients:i.coefficients,spacing:n};else{const t=I(u);if(Object(s.l)(t)&&!t.isEnvelope){const t=function(e){if(!e||e.isGeographic)return e;const t=String(e.wkid||e.wkt);let n;return x.has(t)?n=x.get(t):(n=(e.wkid?o.a.coordsys(e.wkid):o.a.fromString(o.b.PE_TYPE_PROJCS,e.wkt)).getGeogcs().getCode(),x.set(t,n)),new p.a({wkid:n})}(u),s=L(e.projectedExtent,t),{offsets:l}=A({...e,srcBufferExtent:s,spacing:n}),c=V(l,r,a);i.gcsGrid={offsets:l,coefficients:c,spacing:n}}}return i}function A(e){const{projectedExtent:t,srcBufferExtent:n,pixelSize:i,datumTransformation:r,rasterTransform:a}=e,l=t.spatialReference,o=n.spatialReference,c=b(l,o),{xmin:u,ymin:h,xmax:p,ymax:d}=t,m=N(o),y=Object(s.l)(m)&&(e.hasWrapAround||"gcs-shift"===(null==a?void 0:a.type)),g=e.spacing||[32,32],x=g[0]*i.x,j=g[1]*i.y,v=1===g[0],w=Math.ceil((p-u)/x-.1/g[0])+(v?0:1),S=Math.ceil((d-h)/j-.1/g[1])+(v?0:1),M=T({cols:w,rows:S,xmin:u,ymax:d,xres:x,yres:j,inSR:l,outSR:o,datumTransformation:r,preferPE:g[0]<=4,usePixelCenter:v}),E=[];let P,k=0;const G=v?-1:NaN,{xmin:L,xmax:_,ymax:z,width:F,height:C}=n,W=R(o,O),q=Object(s.l)(m)&&L>0&&_>m/2;let A=!1;if(c){const e=I(l);A=Object(s.l)(e)&&e.poleLocation>0}for(let s=0;s<w;s++){const e=[];for(let t=0;t<S;t++){let n=M[s*S+t];if(y&&n[0]>_&&n[0]>m/2-W?n[0]-=m:y&&0===s&&n[0]<0&&q&&!a&&(n[0]+=m),!n||isNaN(n[0])||isNaN(n[1]))E.push(G),E.push(G),e.push(null),k++;else{if(a){const e=a.inverseTransform(new f.a({x:n[0],y:n[1],spatialReference:o}));n=[e.x,e.y]}e.push(n),s>0&&y&&P[t]&&n[0]<P[t][0]&&(n[0]+=m,A&&n[0]>_&&n[0]>m&&(n[0]-=m)),E.push((n[0]-L)/F),E.push((z-n[1])/C)}}P=e}return{offsets:E,error:null,coefficients:null,outofBoundPointCount:k,spacing:g,size:v?[w,S]:[w-1,S-1]}}function V(e,t,n){const{cols:i,rows:r}=t,a=new Float32Array((i-1)*(r-1)*2*6),s=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),l=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let o=0;o<i-1;o++){for(let t=0;t<r-1;t++){let n=o*r*2+2*t;const c=e[n],u=e[n+1],f=e[n+2],h=e[n+3];n+=2*r;const p=e[n],d=e[n+1],b=e[n+2],m=e[n+3];let y=0,g=12*(t*(i-1)+o);for(let e=0;e<3;e++)a[g++]=s[y++]*c+s[y++]*f+s[y++]*b;y=0;for(let e=0;e<3;e++)a[g++]=s[y++]*u+s[y++]*h+s[y++]*m;y=0;for(let e=0;e<3;e++)a[g++]=l[y++]*c+l[y++]*p+l[y++]*b;y=0;for(let e=0;e<3;e++)a[g++]=l[y++]*u+l[y++]*d+l[y++]*m}if(n)for(let e=0;e<a.length;e++)isNaN(a[e])&&(a[e]=-1)}return a}function B(e){const t=e.clone().normalize();return 1===t.length?t[0]:G(t)}function J(e,t,n){const{storageInfo:i,pixelSize:r}=t;let a=0,o=!1;const{pyramidResolutions:c}=i;if(Object(s.l)(c)&&c.length){const i=(e.x+e.y)/2,s=c[c.length-1],u=(s.x+s.y)/2,h=(r.x+r.y)/2;if(i<=h)a=0;else if(i>=u)a=c.length,o=i/u>8;else{let e,t=h;for(let r=1;r<=c.length;r++){if(e=(c[r-1].x+c[r-1].y)/2,i<=e){i===e?a=r:"down"===n?(a=r-1,o=i/t>8):a="up"===n||i-t>e-i||i/t>2?r:r-1;break}t=e}}const p=0===a?r:c[a-1];return o&&Math.min(p.x,p.y)*Object(l.f)(t.spatialReference)>19567&&(o=!1),{pyramidLevel:a,pyramidResolution:new f.a({x:p.x,y:p.y,spatialReference:t.spatialReference}),excessiveReading:o}}const u=Math.log(e.x/r.x)/Math.LN2,h=Math.log(e.y/r.y)/Math.LN2,p=t.storageInfo.maximumPyramidLevel||0;a="down"===n?Math.floor(Math.min(u,h)):"up"===n?Math.ceil(Math.max(u,h)):Math.round((u+h)/2),a<0?a=0:a>p&&(o=a>p+3,a=p);const d=2**a;return{pyramidLevel:a,pyramidResolution:new f.a({x:d*t.nativePixelSize.x,y:d*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:o}}},1660:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return v}));var i=n(0),r=n(16),a=n(2),s=n(13),l=n(1),o=(n(17),n(12),n(10)),c=n(1106),u=n(1163),f=n(1015),h=n(171),p=n(183),d=n(1253),b=n(1116);const m=e=>{let t=class extends e{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.tileInfo=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return this.projectFullExtent(this.view.spatialReference)}get hasTilingEffects(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}get datumTransformation(){return Object(d.a)(Object(a.t)(this.layer.fullExtent),this.view.spatialReference,!0)}supportsSpatialReference(e){return!!this.projectFullExtent(e)}projectFullExtent(e){const t=Object(a.t)(this.layer.fullExtent),n=Object(d.a)(t,e,!1);return Object(d.g)(t,e,n)}async fetchPopupFeatures(e,t){const{layer:n}=this;if(!e)throw new r.a("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:n});const{popupEnabled:i}=n,s=Object(b.a)(n,t);if(!i||Object(a.k)(s))throw new r.a("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:i,popupTemplate:s});const l=[],{value:o,magdirValue:c}=await n.identify(e,{timeExtent:this.timeExtent});let u="";if(o&&o.length){u="imagery-tile"===n.type&&n.hasStandardTime()&&null!=o[0]?o.map((e=>n.getStandardTimeValue(e))).join(", "):o.join(", ");const e={ObjectId:0};e["Raster.ServicePixelValue"]=u;const t=n.rasterInfo.attributeTable;if(Object(a.l)(t)){const{fields:n,features:i}=t,r=n.find((({name:e})=>"value"===e.toLowerCase())),a=r?i.find((e=>String(e.attributes[r.name])===u)):null;if(a)for(const t in a.attributes)a.attributes.hasOwnProperty(t)&&(e[this._rasterFieldPrefix+t]=a.attributes[t])}const i=n.rasterInfo.dataType;"vector-magdir"!==i&&"vector-uv"!==i||(e["Raster.Magnitude"]=null==c?void 0:c[0],e["Raster.Direction"]=null==c?void 0:c[1]);const r=new h.a(this.fullExtent.clone(),null,e);r.layer=n,r.sourceLayer=r.layer,l.push(r)}return l}};return Object(i.a)([Object(l.b)()],t.prototype,"layer",void 0),Object(i.a)([Object(l.b)(p.a)],t.prototype,"timeExtent",void 0),Object(i.a)([Object(l.b)()],t.prototype,"view",void 0),Object(i.a)([Object(l.b)()],t.prototype,"fullExtent",null),Object(i.a)([Object(l.b)()],t.prototype,"tileInfo",void 0),Object(i.a)([Object(l.b)({readOnly:!0})],t.prototype,"hasTilingEffects",null),t=Object(i.a)([Object(o.a)("esri.views.layers.ImageryTileLayerView")],t),t};var y=n(1104),g=n(1164),x=n(1165),O=n(969);let j=class extends(m(Object(g.a)(Object(u.a)(Object(c.a)(y.a))))){constructor(){super(...arguments),this.type="imagery-tile-3d",this.isAlignedMapTile=!0}initialize(){this.layer.increaseRasterJobHandlerUsage(),null==this.fullExtent&&this.addResolvingPromise(Promise.reject(new r.a("layerview:spatial-reference-incompatible","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})));const e=Object(s.h)((()=>{var e,t;return null==(e=this.view)||null==(t=e.basemapTerrain)?void 0:t.tilingSchemeLocked})).then((()=>{const e=this.view.basemapTerrain.tilingScheme,{tileInfo:t}=this.layer,n=["png","png24","png32","jpg","mixed"].includes(t.format)&&e.compatibleWith(t);this.isAlignedMapTile=n;const i=n?t:e.toTileInfo();this.tileInfo=i,this.updatingHandles.add((()=>[this.layer.renderer,this.layer.interpolation,this.layer.bandIds,this.layer.multidimensionalDefinition,this.layer.multidimensionalSubset,this.layer.rasterFunction]),(()=>this.refresh()))}));this.addResolvingPromise(e)}destroy(){this.layer.decreaseRasterJobHandlerUsage(),this.view=null}get _blankTile(){const e=document.createElement("canvas"),t=e.getContext("2d"),[n,i]=this.tileInfo.size;return e.width=n,e.height=i,t.clearRect(0,0,n,i),t.getImageData(0,0,n,i)}get imageFormatIsOpaque(){return"jpg"===this.layer.tileInfo.format}get hasMixedImageFormats(){return"mixed"===this.layer.tileInfo.format}get dataLevelRange(){const e=this.tileInfo.lods,t=this.layer.tileInfo.lods,n=e[0].scale,i=t[t.length-1].scale;return this.levelRangeFromScaleRange(n,i)}_getfullExtent(){return this.projectFullExtent(this.view.basemapTerrain&&Object(a.l)(this.view.basemapTerrain.spatialReference)?this.view.basemapTerrain.spatialReference:this.view.spatialReference)}async fetchTile(e,t,n,i){const r=this.tileInfo,s=this._canSymbolizeInWebGL(),l={tileInfo:r,requestRawData:s,signal:Object(a.t)(i.signal),requestAsImageElement:this.isAlignedMapTile},o=await this.layer.fetchTile(e,t,n,l);if(o instanceof HTMLImageElement)return o;let c=o&&o.pixelBlock;if(Object(a.k)(c))return this._blankTile;if(!s&&(c=await this.layer.applyRenderer(o),Object(a.k)(c)))return this._blankTile;const u=new f.a([e,t,n],c,r.size[0],r.size[1]);return s?(u.symbolizerRenderer=this.layer.symbolizer.rendererJSON,u.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e)),u.transformGrid=o.transformGrid):u.isRendereredSource=!0,u.interpolation=this.layer.interpolation,u.bandIds=this.layer.bandIds,u}_getSymbolizerOptions(e){const t=this.tileInfo.lodAt(e).resolution;return{pixelBlock:null,isGCS:this.view.basemapTerrain&&Object(a.l)(this.view.basemapTerrain.spatialReference)?this.view.basemapTerrain.spatialReference.isGeographic:this.view.spatialReference.isGeographic,resolution:{x:t,y:t},bandIds:this.layer.bandIds}}ensureSymbolizerParameters(e){this._canSymbolizeInWebGL()&&JSON.stringify(e.symbolizerRenderer)!==JSON.stringify(this.layer.symbolizer.rendererJSON)&&(e.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e.lij[0])))}createFetchPopupFeaturesQueryGeometry(e,t){return Object(x.a)(e,t,this.view)}refresh(){this.emit("data-changed")}async doRefresh(){this.suspended||this.emit("data-changed")}_canSymbolizeInWebGL(){return Object(O.a)("3d").supportsTextureFloat&&this.layer.symbolizer.canRenderInWebGL}};Object(i.a)([Object(l.b)({readOnly:!0})],j.prototype,"_blankTile",null),Object(i.a)([Object(l.b)({readOnly:!0})],j.prototype,"imageFormatIsOpaque",null),Object(i.a)([Object(l.b)({readOnly:!0})],j.prototype,"hasMixedImageFormats",null),Object(i.a)([Object(l.b)({readOnly:!0})],j.prototype,"dataLevelRange",null),j=Object(i.a)([Object(o.a)("esri.views.3d.layers.ImageryTileLayerView3D")],j);const v=j}}]);
//# sourceMappingURL=30.fd5566db.chunk.js.map