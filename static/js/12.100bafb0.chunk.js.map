{"version":3,"sources":["../node_modules/@arcgis/core/layers/support/ElevationTile.js","../node_modules/@arcgis/core/layers/support/ElevationQuery.js"],"names":["e","constructor","a","this","tile","zmin","zmax","t","extent","_samplerData","i","minValue","maxValue","sample","safeWidth","width","r","pixelData","o","noDataValue","n","dx","l","dy","m","y1","h","x0","f","p","s","u","c","Math","floor","x","D","d","z","y","V","_","g","async","ignoreInvisibleLayers","filter","visible","slice","length","fromGeometry","returnSampleInfo","A","query","_queryAllContinue","geometry","export","sampleInfo","type","R","spatialReference","signal","load","_createGeometryDescriptor","_selectTiles","_populateElevationTiles","_sampleGeometryWithElevation","_createQueryResult","_createSampler","_createSamplerAllContinue","tileInfo","equals","source","dest","q","T","elevationTiles","layer","options","pop","samplers","map","concat","coordinates","demResolution","push","clone","Error","forEach","project","outSpatialReference","_extractSampleInfo","elevationTile","wkid","_preselectOutsideLayerExtent","_selectTilesClosestResolution","_selectTilesFinestContiguous","_selectTilesAuto","fullExtent","v","outsideExtentTile","xmin","xmax","ymin","ymax","_findNearestDemResolutionLODIndex","selectTilesAtLOD","lods","abs","resolution","I","minDemResolution","_selectTilesFinestContiguousAt","tilemapCache","getTilesToFetch","Promise","all","fetchAvailability","level","row","col","allElevationTilesFetched","clearElevationTiles","cache","id","uid","get","fetchTile","put","populateElevationTiles","_selectTilesAutoFinest","_reduceTilesForMaximumRequests","_selectTilesAutoPrefetchUpsample","w","fetchAvailabilityUpsample","ok","error","remapTiles","forEachTileToFetch","maximumAutoTileRequests","upsampleTile","lodAt","_exporter","points","static","hasZ","hasM","spatiaReference","paths","E","super","tileAt","some","_candidateTiles","_fetchedCandidates","Set","intersection","maskExtents","_maximumLodForRequests","min","_selectCandidateTilesCoveringExtentAt","size","ceil","height","clear","add","_uniqueNonOverlappingTiles","has","sort","updateTileInfo","_tileIsMasked","findIndex"],"mappings":"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","file":"static/js/12.100bafb0.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{isSome as t,isNone as a}from\"../../core/maybe.js\";import{ElevationSamplerData as i}from\"./ElevationSamplerData.js\";class e{constructor(a,e=null){if(this.tile=a,this.zmin=0,this.zmax=0,t(e)&&t(a)){const t=a.extent;this._samplerData=new i(e,t),this.zmin=e.minValue,this.zmax=e.maxValue}}sample(t,i){if(a(this._samplerData))return;const{safeWidth:e,width:r,pixelData:o,noDataValue:n,dx:l,dy:m,y1:h,x0:f}=this._samplerData,p=s(m*(h-i),0,e),u=s(l*(t-f),0,e),c=Math.floor(p),x=Math.floor(u),D=c*r+x,d=D+r,z=o[D],y=o[d],V=o[D+1],_=o[d+1];if(z!==n&&y!==n&&V!==n&&_!==n){const t=u-x,a=z+(V-z)*t;return a+(y+(_-y)*t-a)*(p-c)}}}function s(t,a,i){return t<a?a:t>i?i:t}export{e as ElevationTile};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{result as e}from\"../../core/asyncUtils.js\";import t from\"../../core/Error.js\";import{assertIsSome as i,isNone as s,isSome as n}from\"../../core/maybe.js\";import{whenOrAbort as o,throwIfAbortError as l,eachAlways as a}from\"../../core/promiseUtils.js\";import{getMetersPerUnitForSR as r}from\"../../core/unitUtils.js\";import c from\"../../geometry/Multipoint.js\";import u from\"../../geometry/Point.js\";import h from\"../../geometry/Polyline.js\";import{initializeProjection as p,project as m}from\"../../geometry/projection.js\";import{fromExtent as f,create as d,contains as y}from\"../../geometry/support/aaBoundingRect.js\";import{MultiTileElevationSampler as T}from\"./ElevationSampler.js\";import{ElevationTile as v}from\"./ElevationTile.js\";import{TileKey as w}from\"./TileKey.js\";class g{async queryAll(e,i,s){if(!(e=s&&s.ignoreInvisibleLayers?e.filter((e=>e.visible)):e.slice()).length)throw new t(\"elevation-query:invalid-layer\",\"Elevation queries require at least one elevation layer to fetch tiles from\");const n=x.fromGeometry(i);let o=!1;s&&s.returnSampleInfo||(o=!0);const l={...A,...s,returnSampleInfo:!0},a=await this.query(e[e.length-1],n,l),r=await this._queryAllContinue(e,a,l);return r.geometry=r.geometry.export(),o&&delete r.sampleInfo,r}async query(e,i,s){if(!e)throw new t(\"elevation-query:invalid-layer\",\"Elevation queries require an elevation layer to fetch tiles from\");if(!i||!(i instanceof x)&&\"point\"!==i.type&&\"multipoint\"!==i.type&&\"polyline\"!==i.type)throw new t(\"elevation-query:invalid-geometry\",\"Only point, polyline and multipoint geometries can be used to query elevation\");const n={...A,...s},o=new R(e,i.spatialReference,n),l=n.signal;return await e.load({signal:l}),await this._createGeometryDescriptor(o,i,l),await this._selectTiles(o,l),await this._populateElevationTiles(o,l),this._sampleGeometryWithElevation(o),this._createQueryResult(o,l)}async createSampler(e,i,s){if(!e)throw new t(\"elevation-query:invalid-layer\",\"Elevation queries require an elevation layer to fetch tiles from\");if(!i||\"extent\"!==i.type)throw new t(\"elevation-query:invalid-extent\",\"Invalid or undefined extent\");const n={...A,...s};return this._createSampler(e,i,n)}async createSamplerAll(e,i,s){if(!(e=s&&s.ignoreInvisibleLayers?e.filter((e=>e.visible)):e.slice()).length)throw new t(\"elevation-query:invalid-layer\",\"Elevation queries require at least one elevation layer to fetch tiles from\");if(!i||\"extent\"!==i.type)throw new t(\"elevation-query:invalid-extent\",\"Invalid or undefined extent\");const n={...A,...s,returnSampleInfo:!0},o=await this._createSampler(e[e.length-1],i,n);return this._createSamplerAllContinue(e,i,o,n)}async _createSampler(e,t,i,s){const n=i.signal;await e.load({signal:n});const o=t.spatialReference,l=e.tileInfo.spatialReference;o.equals(l)||(await p([{source:o,dest:l}],{signal:n}),t=m(t,l));const a=new q(e,t,i,s);return await this._selectTiles(a,n),await this._populateElevationTiles(a,n),new T(a.elevationTiles,a.layer.tileInfo,a.options.noDataValue)}async _createSamplerAllContinue(e,t,i,s){if(e.pop(),!e.length)return i;const n=i.samplers.map((e=>f(e.extent))),o=await this._createSampler(e[e.length-1],t,s,n);if(0===o.samplers.length)return i;const l=i.samplers.concat(o.samplers),a=new T(l,s.noDataValue);return this._createSamplerAllContinue(e,t,a,s)}async _queryAllContinue(e,t,s){const n=e.pop(),o=t.geometry.coordinates,l=t.sampleInfo;i(l);const a=[],r=[];for(let i=0;i<o.length;i++){const t=l[i];t.demResolution>=0?t.source||(t.source=n):e.length&&(a.push(o[i]),r.push(i))}if(!e.length||0===a.length)return t;const c=t.geometry.clone(a),u=await this.query(e[e.length-1],c,s),h=u.sampleInfo;if(!h)throw new Error(\"no sampleInfo\");return r.forEach(((e,t)=>{o[e].z=u.geometry.coordinates[t].z,l[e].demResolution=h[t].demResolution})),this._queryAllContinue(e,t,s)}async _createQueryResult(e,t){const s=await e.geometry.project(e.outSpatialReference,t);i(s);const n={geometry:s.export(),noDataValue:e.options.noDataValue};return e.options.returnSampleInfo&&(n.sampleInfo=this._extractSampleInfo(e)),e.geometry.coordinates.forEach((e=>{e.tile=null,e.elevationTile=null})),n}async _createGeometryDescriptor(e,i,s){let n;const o=e.layer.tileInfo.spatialReference;if(i instanceof x?n=await i.project(o,s):(await p([{source:i.spatialReference,dest:o}],{signal:s}),n=m(i,o)),!n)throw new t(\"elevation-query:spatial-reference-mismatch\",`Cannot query elevation in '${i.spatialReference.wkid}' on an elevation service in '${o.wkid}'`);e.geometry=x.fromGeometry(n)}async _selectTiles(e,i){const s=e.options.demResolution;if(\"geometry\"===e.type&&this._preselectOutsideLayerExtent(e),\"number\"==typeof s)this._selectTilesClosestResolution(e);else if(\"finest-contiguous\"===s)await this._selectTilesFinestContiguous(e,i);else{if(\"auto\"!==s)throw new t(\"elevation-query:invalid-dem-resolution\",`Invalid dem resolution value '${s}', expected a number, \"finest-contiguous\" or \"auto\"`);await this._selectTilesAuto(e,i)}}_preselectOutsideLayerExtent(e){if(s(e.layer.fullExtent))return;const t=new v(null);t.sample=()=>e.options.noDataValue,e.outsideExtentTile=t;const i=e.layer.fullExtent;e.geometry.coordinates.forEach((e=>{const s=e.x,n=e.y;(s<i.xmin||s>i.xmax||n<i.ymin||n>i.ymax)&&(e.elevationTile=t)}))}_selectTilesClosestResolution(e){const t=e.layer.tileInfo,i=this._findNearestDemResolutionLODIndex(t,e.options.demResolution);e.selectTilesAtLOD(i)}_findNearestDemResolutionLODIndex(e,t){const i=t/r(e.spatialReference);let s=e.lods[0],n=0;for(let o=1;o<e.lods.length;o++){const t=e.lods[o];Math.abs(t.resolution-i)<Math.abs(s.resolution-i)&&(s=t,n=o)}return n}async _selectTilesFinestContiguous(e,t){const i=I(e.layer.tileInfo,e.options.minDemResolution);await this._selectTilesFinestContiguousAt(e,i,t)}async _selectTilesFinestContiguousAt(e,i,s){const n=e.layer;if(e.selectTilesAtLOD(i),i<0)return;const a=n.tilemapCache,r=e.getTilesToFetch();try{if(a)await o(Promise.all(r.map((e=>a.fetchAvailability(e.level,e.row,e.col,{signal:s})))),s);else if(await this._populateElevationTiles(e,s),!e.allElevationTilesFetched())throw e.clearElevationTiles(),new t(\"elevation-query:has-unavailable-tiles\")}catch(c){l(c),await this._selectTilesFinestContiguousAt(e,i-1,s)}}async _populateElevationTiles(e,t){const i=e.getTilesToFetch(),s={},l=e.options.cache,r=e.options.noDataValue,c=i.map((async i=>{if(null==i.id)return;const o=`${e.layer.uid}:${i.id}:${r}`,a=n(l)?l.get(o):null,c=n(a)?a:await e.layer.fetchTile(i.level,i.row,i.col,{noDataValue:r,signal:t});n(l)&&l.put(o,c),s[i.id]=new v(i,c)}));await o(a(c),t),e.populateElevationTiles(s)}async _selectTilesAuto(t,i){this._selectTilesAutoFinest(t),this._reduceTilesForMaximumRequests(t);const s=t.layer.tilemapCache;if(!s)return this._selectTilesAutoPrefetchUpsample(t,i);const n=t.getTilesToFetch(),a={},r=n.map((async t=>{const n=new w(null,0,0,0,d()),o=await e(s.fetchAvailabilityUpsample(t.level,t.row,t.col,n,{signal:i}));!1!==o.ok?null!=t.id&&(a[t.id]=n):l(o.error)}));await o(Promise.all(r),i),t.remapTiles(a)}_reduceTilesForMaximumRequests(e){const t=e.layer.tileInfo;let i=0;const s={},n=e=>{null!=e.id&&(e.id in s?s[e.id]++:(s[e.id]=1,i++))},o=e=>{if(null==e.id)return;const t=s[e.id];1===t?(delete s[e.id],i--):s[e.id]=t-1};e.forEachTileToFetch(n,o);let l=!0;for(;l&&(l=!1,e.forEachTileToFetch((s=>{i<=e.options.maximumAutoTileRequests||(o(s),t.upsampleTile(s)&&(l=!0),n(s))}),o),l););}_selectTilesAutoFinest(e){const t=I(e.layer.tileInfo,e.options.minDemResolution);e.selectTilesAtLOD(t,e.options.maximumAutoTileRequests)}async _selectTilesAutoPrefetchUpsample(e,t){const i=e.layer.tileInfo;await this._populateElevationTiles(e,t);let s=!1;e.forEachTileToFetch(((e,t)=>{i.upsampleTile(e)?s=!0:t()})),s&&await this._selectTilesAutoPrefetchUpsample(e,t)}_sampleGeometryWithElevation(e){e.geometry.coordinates.forEach((t=>{const i=t.elevationTile;let s=e.options.noDataValue;if(i){const e=i.sample(t.x,t.y);n(e)?s=e:t.elevationTile=null}t.z=s}))}_extractSampleInfo(e){const t=e.layer.tileInfo,i=r(t.spatialReference);return e.geometry.coordinates.map((s=>{let n=-1;if(s.elevationTile&&s.elevationTile!==e.outsideExtentTile){n=t.lodAt(s.elevationTile.tile.level).resolution*i}return{demResolution:n}}))}}class x{export(){return this._exporter(this.coordinates,this.spatialReference)}clone(e){const t=new x;return t.geometry=this.geometry,t.spatialReference=this.spatialReference,t.coordinates=e||this.coordinates.map((e=>e.clone())),t._exporter=this._exporter,t}async project(e,t){if(this.spatialReference.equals(e))return this.clone();await p([{source:this.spatialReference,dest:e}],{signal:t});const i=new c({spatialReference:this.spatialReference,points:this.coordinates.map((e=>[e.x,e.y]))}),s=m(i,e);if(!s)return null;const n=this.coordinates.map(((e,t)=>{const i=e.clone(),n=s.points[t];return i.x=n[0],i.y=n[1],i})),o=this.clone(n);return o.spatialReference=e,o}static fromGeometry(e){const t=new x;if(t.geometry=e,t.spatialReference=e.spatialReference,e instanceof x)t.coordinates=e.coordinates.map((e=>e.clone())),t._exporter=(t,i)=>{const s=e.clone(t);return s.spatialReference=i,s};else switch(e.type){case\"point\":{const i=e,{hasZ:s,hasM:n}=i;t.coordinates=s&&n?[new _(i.x,i.y,i.z,i.m)]:s?[new _(i.x,i.y,i.z)]:n?[new _(i.x,i.y,null,i.m)]:[new _(i.x,i.y)],t._exporter=(t,i)=>e.hasM?new u(t[0].x,t[0].y,t[0].z,t[0].m,i):new u(t[0].x,t[0].y,t[0].z,i);break}case\"multipoint\":{const i=e,{hasZ:s,hasM:n}=i;t.coordinates=s&&n?i.points.map((e=>new _(e[0],e[1],e[2],e[3]))):s?i.points.map((e=>new _(e[0],e[1],e[2]))):n?i.points.map((e=>new _(e[0],e[1],null,e[2]))):i.points.map((e=>new _(e[0],e[1]))),t._exporter=(t,i)=>e.hasM?new c({points:t.map((e=>[e.x,e.y,e.z,e.m])),hasZ:!0,hasM:!0,spatiaReference:i}):new c(t.map((e=>[e.x,e.y,e.z])),i);break}case\"polyline\":{const i=e,s=[],n=[],{hasZ:o,hasM:l}=e;let a=0;for(const e of i.paths)if(n.push([a,a+e.length]),a+=e.length,o&&l)for(const t of e)s.push(new _(t[0],t[1],t[2],t[3]));else if(o)for(const t of e)s.push(new _(t[0],t[1],t[2]));else if(l)for(const t of e)s.push(new _(t[0],t[1],null,t[2]));else for(const t of e)s.push(new _(t[0],t[1]));t.coordinates=s,t._exporter=(t,i)=>{const s=e.hasM?t.map((e=>[e.x,e.y,e.z,e.m])):t.map((e=>[e.x,e.y,e.z])),o=n.map((e=>s.slice(e[0],e[1])));return new h({paths:o,hasM:e.hasM,hasZ:!0,spatialReference:i})};break}}return t}}class _{constructor(e,t,i=null,s=null,n=null,o=null){this.x=e,this.y=t,this.z=i,this.m=s,this.tile=n,this.elevationTile=o}clone(){return new _(this.x,this.y,this.z,this.m)}}class E{constructor(e,t){this.layer=e,this.options=t}}class R extends E{constructor(e,t,i){super(e,i),this.outSpatialReference=t,this.type=\"geometry\"}selectTilesAtLOD(e){if(e<0)this.geometry.coordinates.forEach((e=>{e.tile=null}));else{const t=this.layer.tileInfo,i=t.lods[e].level;this.geometry.coordinates.forEach((e=>{e.tile=t.tileAt(i,e.x,e.y)}))}}allElevationTilesFetched(){return!this.geometry.coordinates.some((e=>!e.elevationTile))}clearElevationTiles(){for(const e of this.geometry.coordinates)e.elevationTile!==this.outsideExtentTile&&(e.elevationTile=null)}populateElevationTiles(e){for(const t of this.geometry.coordinates)!t.elevationTile&&t.tile?.id&&(t.elevationTile=e[t.tile.id])}remapTiles(e){for(const t of this.geometry.coordinates){const i=t.tile?.id;t.tile=i?e[i]:null}}getTilesToFetch(){const e={},t=[];for(const i of this.geometry.coordinates){const s=i.tile;if(!s)continue;const n=i.tile?.id;i.elevationTile||!n||e[n]||(e[n]=s,t.push(s))}return t}forEachTileToFetch(e){for(const t of this.geometry.coordinates)t.tile&&!t.elevationTile&&e(t.tile,(()=>{t.tile=null}))}}class q extends E{constructor(e,t,i,s){super(e,i),this.type=\"extent\",this.elevationTiles=[],this._candidateTiles=[],this._fetchedCandidates=new Set,this.extent=t.intersection(e.fullExtent),this.maskExtents=s}selectTilesAtLOD(e,t){const i=this._maximumLodForRequests(t),s=Math.min(i,e);s<0?this._candidateTiles.length=0:this._selectCandidateTilesCoveringExtentAt(s)}_maximumLodForRequests(e){const t=this.layer.tileInfo;if(!e)return t.lods.length-1;const i=this.extent;if(s(i))return-1;for(let s=t.lods.length-1;s>=0;s--){const n=t.lods[s],o=n.resolution*t.size[0],l=n.resolution*t.size[1];if(Math.ceil(i.width/o)*Math.ceil(i.height/l)<=e)return s}return-1}allElevationTilesFetched(){return this._candidateTiles.length===this.elevationTiles.length}clearElevationTiles(){this.elevationTiles.length=0,this._fetchedCandidates.clear()}populateElevationTiles(e){for(const t of this._candidateTiles){const i=t.id&&e[t.id];i&&(this._fetchedCandidates.add(t),this.elevationTiles.push(i))}}remapTiles(e){this._candidateTiles=this._uniqueNonOverlappingTiles(this._candidateTiles.map((t=>e[t.id])))}getTilesToFetch(){return this._candidateTiles}forEachTileToFetch(e,t){const i=this._candidateTiles;this._candidateTiles=[],i.forEach((i=>{if(this._fetchedCandidates.has(i))return void(t&&t(i));let s=!1;e(i,(()=>s=!0)),s?t&&t(i):this._candidateTiles.push(i)})),this._candidateTiles=this._uniqueNonOverlappingTiles(this._candidateTiles,t)}_uniqueNonOverlappingTiles(e,t){const i={},s=[];for(const o of e){const e=o.id;e&&!i[e]?(i[e]=o,s.push(o)):t&&t(o)}const n=s.sort(((e,t)=>e.level-t.level));return n.filter(((e,i)=>{for(let s=0;s<i;s++){const i=n[s].extent;if(i&&e.extent&&y(i,e.extent))return t&&t(e),!1}return!0}))}_selectCandidateTilesCoveringExtentAt(e){this._candidateTiles.length=0;const t=this.extent;if(s(t))return;const i=this.layer.tileInfo,n=i.lods[e],o=i.tileAt(n.level,t.xmin,t.ymin),l=o.extent;if(s(l))return;const a=n.resolution*i.size[0],r=n.resolution*i.size[1],c=Math.ceil((t.xmax-l[0])/a),u=Math.ceil((t.ymax-l[1])/r);for(let s=0;s<u;s++)for(let e=0;e<c;e++){const t=new w(null,o.level,o.row-s,o.col+e);i.updateTileInfo(t),this._tileIsMasked(t)||this._candidateTiles.push(t)}}_tileIsMasked(e){return!!this.maskExtents&&this.maskExtents.some((t=>e.extent&&y(t,e.extent)))}}function I(e,t=0){let i=e.lods.length-1;if(t>0){const s=t/r(e.spatialReference),n=e.lods.findIndex((e=>e.resolution<s));0===n?i=0:n>0&&(i=n-1)}return i}const A={maximumAutoTileRequests:20,noDataValue:0,returnSampleInfo:!1,demResolution:\"auto\",minDemResolution:0};export{g as ElevationQuery,x as GeometryDescriptor,I as getFinestLodIndex};\n"],"sourceRoot":""}