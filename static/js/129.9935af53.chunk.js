(this["webpackJsonppopulation-arcgis"]=this["webpackJsonppopulation-arcgis"]||[]).push([[129],{1615:function(e,t,n){"use strict";n.r(t),n.d(t,"registerFunctions",(function(){return v}));var a=n(1435),i=n(1121),r=n(1111),s=n(1175),l=n(1479),o=n(1501),c=n(1193),u=n(1109),f=n(1481),d=n(1393),b=n(1395),m=n(1483),p=n(1397),y=n(1484),O=n(1396),h=n(1115),g=n(1186),j=n(1328),w=n(23),F=n(724),I=n(902),D=n(448);async function E(e,t,n){const a=e.getVariables();if(a.length>0){const i=[];for(let e=0;e<a.length;e++){const r={name:a[e]};i.push(await t.evaluateIdentifier(n,r))}const r={};for(let e=0;e<a.length;e++)r[a[e]]=i[e];return e.parameters=r,e}return e}function N(e,t,n=null){for(const a in e)if(a.toLowerCase()===t.toLowerCase())return e[a];return n}function A(e){if(null===e)return null;const t={type:N(e,"type",""),name:N(e,"name","")};if("range"===t.type)t.range=N(e,"range",[]);else{t.codedValues=[];for(const n of N(e,"codedValues",[]))t.codedValues.push({name:N(n,"name",""),code:N(n,"code",null)})}return t}function S(e){if(null===e)return null;const t={},n=N(e,"wkt",null);null!==n&&(t.wkt=n);const a=N(e,"wkid",null);return null!==a&&(t.wkid=a),t}function x(e){if(null===e)return null;const t={hasZ:N(e,"hasz",!1),hasM:N(e,"hasm",!1)},n=N(e,"spatialreference",null);n&&(t.spatialReference=S(n));const a=N(e,"x",null);if(null!==a)return t.x=a,t.y=N(e,"y",null),t;const i=N(e,"rings",null);if(null!==i)return t.rings=i,t;const r=N(e,"paths",null);if(null!==r)return t.paths=r,t;const s=N(e,"points",null);if(null!==s)return t.points=s,t;for(const l of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){const n=N(e,l,null);null!==n&&(t[l]=n)}return t}function v(e){"async"===e.mode&&(e.functions.getuser=function(t,n){return e.standardFunctionAsync(t,n,(async(e,s,l)=>{Object(u.Z)(l,0,2,t,n);let c=Object(u.a)(l[1],""),f=!0===c;if(c=!0===c||!1===c?"":Object(u.K)(c),0===l.length||l[0]instanceof a.a){let e=null;t.services&&t.services.portal&&(e=t.services.portal),l.length>0&&(e=Object(o.getPortal)(l[0],e));const n=await Object(o.lookupUser)(e,c,f);if(n){const e=JSON.parse(JSON.stringify(n));for(const t of["lastLogin","created","modified"])void 0!==e[t]&&null!==e[t]&&(e[t]=new Date(e[t]));return i.a.convertObjectToArcadeDictionary(e)}return null}let d=null;if(Object(u.t)(l[0])&&(d=l[0]),d){if(f=!1,c)return null;await d.load();const e=await d.getOwningSystemUrl();if(!e){if(!c){const e=await d.getIdentityUser();return e?i.a.convertObjectToArcadeDictionary({username:e}):null}return null}let n=null;t.services&&t.services.portal&&(n=t.services.portal),n=Object(o.getPortal)(new a.a(e),n);const r=await Object(o.lookupUser)(n,c,f);if(r){const e=JSON.parse(JSON.stringify(r));for(const t of["lastLogin","created","modified"])void 0!==e[t]&&null!==e[t]&&(e[t]=new Date(e[t]));return i.a.convertObjectToArcadeDictionary(e)}return null}throw new r.b(t,r.d.InvalidParameter,n)}))},e.signatures.push({name:"getuser",min:1,max:2}),e.functions.featuresetbyid=function(t,n){return e.standardFunctionAsync(t,n,((e,a,i)=>{if(Object(u.Z)(i,2,4,t,n),i[0]instanceof l.a){const e=Object(u.K)(i[1]);let a=Object(u.a)(i[2],null);const s=Object(u.I)(Object(u.a)(i[3],!0));if(null===a&&(a=["*"]),!1===Object(u.N)(a))throw new r.b(t,r.d.InvalidParameter,n);return i[0].featureSetById(e,s,a)}throw new r.b(t,r.d.InvalidParameter,n)}))},e.signatures.push({name:"featuresetbyid",min:2,max:4}),e.functions.getfeatureset=function(t,n){return e.standardFunctionAsync(t,n,((e,a,i)=>{if(Object(u.Z)(i,1,2,t,n),Object(u.X)(i[0])){let e=Object(u.a)(i[1],"datasource");return null===e&&(e="datasource"),e=Object(u.K)(e).toLowerCase(),Object(o.convertToFeatureSet)(i[0].fullSchema(),e,t.lrucache,t.interceptor,t.spatialReference)}throw new r.b(t,r.d.InvalidParameter,n)}))},e.signatures.push({name:"getfeatureset",min:1,max:2}),e.functions.featuresetbyportalitem=function(t,n){return e.standardFunctionAsync(t,n,((e,i,s)=>{if(Object(u.Z)(s,2,5,t,n),null===s[0])throw new r.b(t,r.d.PortalRequired,n);if(s[0]instanceof a.a){const e=Object(u.K)(s[1]),a=Object(u.K)(s[2]);let i=Object(u.a)(s[3],null);const l=Object(u.I)(Object(u.a)(s[4],!0));if(null===i&&(i=["*"]),!1===Object(u.N)(i))throw new r.b(t,r.d.InvalidParameter,n);let c=null;return t.services&&t.services.portal&&(c=t.services.portal),c=Object(o.getPortal)(s[0],c),Object(o.constructFeatureSetFromPortalItem)(e,a,t.spatialReference,i,l,c,t.lrucache,t.interceptor)}if(!1===Object(u.D)(s[0]))throw new r.b(t,r.d.PortalRequired,n);const l=Object(u.K)(s[0]),c=Object(u.K)(s[1]);let f=Object(u.a)(s[2],null);const d=Object(u.I)(Object(u.a)(s[3],!0));if(null===f&&(f=["*"]),!1===Object(u.N)(f))throw new r.b(t,r.d.InvalidParameter,n);if(t.services&&t.services.portal)return Object(o.constructFeatureSetFromPortalItem)(l,c,t.spatialReference,f,d,t.services.portal,t.lrucache,t.interceptor);throw new r.b(t,r.d.PortalRequired,n)}))},e.signatures.push({name:"featuresetbyportalitem",min:2,max:5}),e.functions.featuresetbyname=function(t,n){return e.standardFunctionAsync(t,n,((e,a,i)=>{if(Object(u.Z)(i,2,4,t,n),i[0]instanceof l.a){const e=Object(u.K)(i[1]);let a=Object(u.a)(i[2],null);const s=Object(u.I)(Object(u.a)(i[3],!0));if(null===a&&(a=["*"]),!1===Object(u.N)(a))throw new r.b(t,r.d.InvalidParameter,n);return i[0].featureSetByName(e,s,a)}throw new r.b(t,r.d.InvalidParameter,n)}))},e.signatures.push({name:"featuresetbyname",min:2,max:4}),e.functions.featureset=function(t,n){return e.standardFunction(t,n,((e,a,s)=>{Object(u.Z)(s,1,1,t,n);let l=s[0];const o={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if(Object(u.D)(l))l=JSON.parse(l),void 0!==l.layerDefinition?(o.layerDefinition=l.layerDefinition,o.featureSet=l.featureSet,l.layerDefinition.spatialReference&&(o.layerDefinition.spatialReference=l.layerDefinition.spatialReference)):(o.featureSet.features=l.features,o.featureSet.geometryType=l.geometryType,o.layerDefinition.geometryType=o.featureSet.geometryType,o.layerDefinition.objectIdField=l.objectIdFieldName,o.layerDefinition.typeIdField=l.typeIdFieldName,o.layerDefinition.globalIdField=l.globalIdFieldName,o.layerDefinition.fields=l.fields,l.spatialReference&&(o.layerDefinition.spatialReference=l.spatialReference));else{if(!(s[0]instanceof i.a))throw new r.b(t,r.d.InvalidParameter,n);{l=JSON.parse(s[0].castToText(!0));const e=N(l,"layerdefinition");if(null!==e){o.layerDefinition.geometryType=N(e,"geometrytype",""),o.featureSet.geometryType=o.layerDefinition.geometryType,o.layerDefinition.globalIdField=N(e,"globalidfield",""),o.layerDefinition.objectIdField=N(e,"objectidfield",""),o.layerDefinition.typeIdField=N(e,"typeidfield","");const t=N(e,"spatialreference",null);t&&(o.layerDefinition.spatialReference=S(t));for(const a of N(e,"fields",[])){const e={name:N(a,"name",""),alias:N(a,"alias",""),type:N(a,"type",""),nullable:N(a,"nullable",!0),editable:N(a,"editable",!0),length:N(a,"length",null),domain:A(N(a,"domain"))};o.layerDefinition.fields.push(e)}const n=N(l,"featureset",null);if(n){const e={};for(const t of o.layerDefinition.fields)e[t.name.toLowerCase()]=t.name;for(const t of N(n,"features",[])){const n={},a=N(t,"attributes",{});for(const t in a)n[e[t.toLowerCase()]]=a[t];o.featureSet.features.push({attributes:n,geometry:x(N(t,"geometry",null))})}}}else{o.layerDefinition.geometryType=N(l,"geometrytype",""),o.featureSet.geometryType=o.layerDefinition.geometryType,o.layerDefinition.objectIdField=N(l,"objectidfieldname",""),o.layerDefinition.typeIdField=N(l,"typeidfieldname","");const e=N(l,"spatialreference",null);e&&(o.layerDefinition.spatialReference=S(e));for(const n of N(l,"fields",[])){const e={name:N(n,"name",""),alias:N(n,"alias",""),type:N(n,"type",""),nullable:N(n,"nullable",!0),editable:N(n,"editable",!0),length:N(n,"length",null),domain:A(N(n,"domain"))};o.layerDefinition.fields.push(e)}const t={};for(const n of o.layerDefinition.fields)t[n.name.toLowerCase()]=n.name;for(const n of N(l,"features",[])){const e={},a=N(n,"attributes",{});for(const n in a)e[t[n.toLowerCase()]]=a[n];o.featureSet.features.push({attributes:e,geometry:x(N(n,"geometry",null))})}}}}if(!1===function(e){return!!e.layerDefinition&&!!e.featureSet&&!1!==function(e,t){for(const n of t)if(n===e)return!0;return!1}(e.layerDefinition.geometryType,["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&null!==e.layerDefinition.objectIdField&&""!==e.layerDefinition.objectIdField&&!1!==Object(u.N)(e.layerDefinition.fields)&&!1!==Object(u.N)(e.featureSet.features)}(o))throw new r.b(t,r.d.InvalidParameter,n);return y.a.create(o,t.spatialReference)}))},e.signatures.push({name:"featureset",min:1,max:1}),e.functions.filter=function(t,n){return e.standardFunctionAsync(t,n,(async(a,i,s)=>{if(Object(u.Z)(s,2,2,t,n),Object(u.N)(s[0])||Object(u.Y)(s[0])){const e=[];let a=s[0];a instanceof c.a&&(a=a.toArray());let i=null;if(!Object(u.J)(s[1]))throw new r.b(t,r.d.InvalidParameter,n);i=s[1].createFunction(t);for(const t of a){const n=i(t);Object(w.l)(n)?!0===await n&&e.push(t):!0===n&&e.push(t)}return e}if(Object(u.t)(s[0])){const n=await s[0].load(),a=F.WhereClause.create(s[1],n.getFieldsIndex()),i=a.getVariables();if(i.length>0){const n=[];for(let a=0;a<i.length;a++){const r={name:i[a]};n.push(await e.evaluateIdentifier(t,r))}const r={};for(let e=0;e<i.length;e++)r[i[e]]=n[e];return a.parameters=r,new d.a({parentfeatureset:s[0],whereclause:a})}return new d.a({parentfeatureset:s[0],whereclause:a})}throw new r.b(t,r.d.InvalidParameter,n)}))},e.signatures.push({name:"filter",min:2,max:2}),e.functions.orderby=function(t,n){return e.standardFunctionAsync(t,n,(async(e,a,i)=>{if(Object(u.Z)(i,2,2,t,n),Object(u.t)(i[0])){const e=new O.a(i[1]);return new b.a({parentfeatureset:i[0],orderbyclause:e})}throw new r.b(t,r.d.InvalidParameter,n)}))},e.signatures.push({name:"orderby",min:2,max:2}),e.functions.top=function(t,n){return e.standardFunctionAsync(t,n,(async(e,a,i)=>{if(Object(u.Z)(i,2,2,t,n),Object(u.t)(i[0]))return new m.a({parentfeatureset:i[0],topnum:i[1]});if(Object(u.N)(i[0]))return Object(u.H)(i[1])>=i[0].length?i[0].slice(0):i[0].slice(0,Object(u.H)(i[1]));if(Object(u.Y)(i[0]))return Object(u.H)(i[1])>=i[0].length()?i[0].slice(0):i[0].slice(0,Object(u.H)(i[1]));throw new r.b(t,r.d.InvalidParameter,n)}))},e.signatures.push({name:"top",min:2,max:2}),e.functions.first=function(t,n){return e.standardFunctionAsync(t,n,(async(e,a,i)=>{if(Object(u.Z)(i,1,1,t,n),Object(u.t)(i[0])){const t=await i[0].first(e.abortSignal);if(null!==t){const e=s.a.createFromGraphicLikeObject(t.geometry,t.attributes,i[0]);return e._underlyingGraphic=t,e}return t}return Object(u.N)(i[0])?0===i[0].length?null:i[0][0]:Object(u.Y)(i[0])?0===i[0].length()?null:i[0].get(0):null}))},e.signatures.push({name:"first",min:1,max:1}),e.functions.attachments=function(t,n){return e.standardFunctionAsync(t,n,(async(e,a,s)=>{Object(u.Z)(s,1,2,t,n);const l={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(s.length>1)if(s[1]instanceof i.a){if(s[1].hasField("minsize")&&(l.minsize=Object(u.H)(s[1].field("minsize"))),s[1].hasField("metadata")&&(l.returnMetadata=Object(u.I)(s[1].field("metadata"))),s[1].hasField("maxsize")&&(l.maxsize=Object(u.H)(s[1].field("maxsize"))),s[1].hasField("types")){const e=Object(u.x)(s[1].field("types"),!1);e.length>0&&(l.types=e)}}else if(null!==s[1])throw new r.b(t,r.d.InvalidParameter,n);if(Object(u.X)(s[0])){let e=s[0]._layer;return e instanceof I.default&&(e=Object(o.constructFeatureSet)(e,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===e||!1===Object(u.t)(e)?[]:(await e.load(),e.queryAttachments(s[0].field(e.objectIdField),l.minsize,l.maxsize,l.types,l.returnMetadata))}if(null===s[0])return[];throw new r.b(t,r.d.InvalidParameter,n)}))},e.signatures.push({name:"attachments",min:1,max:2}),e.functions.featuresetbyrelationshipname=function(t,n){return e.standardFunctionAsync(t,n,(async(e,a,i)=>{Object(u.Z)(i,2,4,t,n);const s=i[0],l=Object(u.K)(i[1]);let c=Object(u.a)(i[2],null);const f=Object(u.I)(Object(u.a)(i[3],!0));if(null===c&&(c=["*"]),!1===Object(u.N)(c))throw new r.b(t,r.d.InvalidParameter,n);if(null===i[0])return null;if(!Object(u.X)(i[0]))throw new r.b(t,r.d.InvalidParameter,n);let d=s._layer;if(d instanceof I.default&&(d=Object(o.constructFeatureSet)(d,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===d)return null;if(!1===Object(u.t)(d))return null;d=await d.load();const b=d.relationshipMetaData().filter((e=>e.name===l));if(0===b.length)return null;if(void 0!==b[0].relationshipTableId&&null!==b[0].relationshipTableId&&b[0].relationshipTableId>-1)return Object(o.constructFeatureSetFromRelationship)(d,b[0],s.field(d.objectIdField),d.spatialReference,c,f,t.lrucache,t.interceptor);let m=d.serviceUrl();if(!m)return null;m="/"===m.charAt(m.length-1)?m+b[0].relatedTableId.toString():m+"/"+b[0].relatedTableId.toString();const y=await Object(o.constructFeatureSetFromUrl)(m,d.spatialReference,c,f,t.lrucache,t.interceptor);await y.load();let O=y.relationshipMetaData();if(O=O.filter((e=>e.id===b[0].id)),!1===s.hasField(b[0].keyField)||null===s.field(b[0].keyField)){const e=await d.getFeatureByObjectId(s.field(d.objectIdField),[b[0].keyField]);if(e){const t=F.WhereClause.create(O[0].keyField+"= @id",y.getFieldsIndex());return t.parameters={id:e.attributes[b[0].keyField]},y.filter(t)}return new p.a({parentfeatureset:y})}const h=F.WhereClause.create(O[0].keyField+"= @id",y.getFieldsIndex());return h.parameters={id:s.field(b[0].keyField)},y.filter(h)}))},e.signatures.push({name:"featuresetbyrelationshipname",min:2,max:4}),e.functions.featuresetbyassociation=function(t,n){return e.standardFunctionAsync(t,n,(async(e,a,i)=>{Object(u.Z)(i,2,3,t,n);const s=i[0],l=Object(u.K)(Object(u.a)(i[1],"")).toLowerCase(),c=Object(u.D)(i[2])?Object(u.K)(i[2]):null;if(null===i[0])return null;if(!Object(u.X)(i[0]))throw new r.b(t,r.d.InvalidParameter,n);let d=s._layer;if(d instanceof I.default&&(d=Object(o.constructFeatureSet)(d,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===d)return null;if(!1===Object(u.t)(d))return null;await d.load();const b=d.serviceUrl(),m=await Object(o.constructAssociationMetaDataFeatureSetFromUrl)(b,t.spatialReference);let p=null,y=null,O=!1;if(null!==c&&""!==c&&void 0!==c){for(const e of m.terminals)e.terminalName===c&&(y=e.terminalId);null===y&&(O=!0)}const g=m.associations.getFieldsIndex(),j=g.get("TOGLOBALID").name,w=g.get("FROMGLOBALID").name,E=g.get("TOTERMINALID").name,N=g.get("FROMTERMINALID").name,A=g.get("FROMNETWORKSOURCEID").name,S=g.get("TONETWORKSOURCEID").name,x=g.get("ASSOCIATIONTYPE").name,v=g.get("ISCONTENTVISIBLE").name,$=g.get("OBJECTID").name;for(const t of d.fields)if("global-id"===t.type){p=s.field(t.name);break}let T=null,L=new f.d(new D.a({name:"percentalong",alias:"percentalong",type:"double"}),F.WhereClause.create("0",m.associations.getFieldsIndex())),C=new f.d(new D.a({name:"side",alias:"side",type:"string"}),F.WhereClause.create("''",m.associations.getFieldsIndex()));const P="globalid",R="globalId",W={};for(const t in m.lkp)W[t]=m.lkp[t].sourceId;const M=new f.e(new D.a({name:"classname",alias:"classname",type:"string"}),null,W);let k="";switch(l){case"midspan":{k=`((${j}='${p}') OR ( ${w}='${p}')) AND (${x} IN (5))`,M.codefield=F.WhereClause.create(`CASE WHEN (${j}='${p}') THEN ${A} ELSE ${S} END`,m.associations.getFieldsIndex());const e=Object(h.c)(f.a.findField(m.associations.fields,w));e.name=P,e.alias=P,T=new f.d(e,F.WhereClause.create(`CASE WHEN (${w}='${p}') THEN ${j} ELSE ${w} END`,m.associations.getFieldsIndex())),L=m.unVersion>=4?new f.c(f.a.findField(m.associations.fields,g.get("PERCENTALONG").name)):new f.d(new D.a({name:"percentalong",alias:"percentalong",type:"double"}),F.WhereClause.create("0",m.associations.getFieldsIndex()));break}case"junctionedge":{k=`((${j}='${p}') OR ( ${w}='${p}')) AND (${x} IN (4,6))`,M.codefield=F.WhereClause.create(`CASE WHEN (${j}='${p}') THEN ${A} ELSE ${S} END`,m.associations.getFieldsIndex());const e=Object(h.c)(f.a.findField(m.associations.fields,w));e.name=P,e.alias=P,T=new f.d(e,F.WhereClause.create(`CASE WHEN (${w}='${p}') THEN ${j} ELSE ${w} END`,m.associations.getFieldsIndex())),C=new f.d(new D.a({name:"side",alias:"side",type:"string"}),F.WhereClause.create(`CASE WHEN (${x}=4) THEN 'from' ELSE 'to' END`,m.associations.getFieldsIndex()));break}case"connected":{var H,K;let e=`${j}='@T'`,t=`${w}='@T'`;null!==y&&(e+=` AND ${E}=@A`,t+=` AND ${N}=@A`),k="(("+e+") OR ("+t+"))",k=Object(u.l)(k,"@T",null!=(H=p)?H:""),e=Object(u.l)(e,"@T",null!=(K=p)?K:""),null!==y&&(e=Object(u.l)(e,"@A",y.toString()),k=Object(u.l)(k,"@A",y.toString())),M.codefield=F.WhereClause.create("CASE WHEN "+e+` THEN ${A} ELSE ${S} END`,m.associations.getFieldsIndex());const n=Object(h.c)(f.a.findField(m.associations.fields,w));n.name=P,n.alias=P,T=new f.d(n,F.WhereClause.create("CASE WHEN "+e+` THEN ${w} ELSE ${j} END`,m.associations.getFieldsIndex()));break}case"container":k=`${j}='${p}' AND ${x} = 2`,null!==y&&(k+=` AND ${E} = `+y.toString()),M.codefield=A,k="( "+k+" )",T=new f.b(f.a.findField(m.associations.fields,w),P,P);case"content":k=`(${w}='${p}' AND ${x} = 2)`,null!==y&&(k+=` AND ${N} = `+y.toString()),M.codefield=S,k="( "+k+" )",T=new f.b(f.a.findField(m.associations.fields,j),P,P);break;case"structure":k=`(${j}='${p}' AND ${x} = 3)`,null!==y&&(k+=` AND ${E} = `+y.toString()),M.codefield=A,k="( "+k+" )",T=new f.b(f.a.findField(m.associations.fields,w),P,R);break;case"attached":k=`(${w}='${p}' AND ${x} = 3)`,null!==y&&(k+=` AND ${N} = `+y.toString()),M.codefield=S,k="( "+k+" )",T=new f.b(f.a.findField(m.associations.fields,j),P,R);break;default:throw new r.b(t,r.d.InvalidParameter,n)}return O&&(k="1 <> 1"),new f.a({parentfeatureset:m.associations,adaptedFields:[new f.c(f.a.findField(m.associations.fields,$)),new f.c(f.a.findField(m.associations.fields,v)),T,C,M,L],extraFilter:k?F.WhereClause.create(k,m.associations.getFieldsIndex()):null})}))},e.signatures.push({name:"featuresetbyassociation",min:2,max:6}),e.functions.groupby=function(t,n){return e.standardFunctionAsync(t,n,(async(a,s,l)=>{if(Object(u.Z)(l,3,3,t,n),!Object(u.t)(l[0]))throw new r.b(t,r.d.InvalidParameter,n);const o=await l[0].load(),c=[],f=[];let d=!1,b=[];if(Object(u.D)(l[1]))b.push(l[1]);else if(l[1]instanceof i.a)b.push(l[1]);else if(Object(u.N)(l[1]))b=l[1];else{if(!Object(u.Y)(l[1]))throw new r.b(t,r.d.InvalidParameter,n);b=l[1].toArray()}for(const e of b)if(Object(u.D)(e)){const t=F.WhereClause.create(Object(u.K)(e),o.getFieldsIndex()),n=!0===Object(g.c)(t)?Object(u.K)(e):"%%%%FIELDNAME";c.push({name:n,expression:t}),"%%%%FIELDNAME"===n&&(d=!0)}else{if(!(e instanceof i.a))throw new r.b(t,r.d.InvalidParameter,n);{const a=e.hasField("name")?e.field("name"):"%%%%FIELDNAME",i=e.hasField("expression")?e.field("expression"):"";if("%%%%FIELDNAME"===a&&(d=!0),!a)throw new r.b(t,r.d.InvalidParameter,n);c.push({name:a,expression:F.WhereClause.create(i||a,o.getFieldsIndex())})}}if(b=[],Object(u.D)(l[2]))b.push(l[2]);else if(Object(u.N)(l[2]))b=l[2];else if(Object(u.Y)(l[2]))b=l[2].toArray();else{if(!(l[2]instanceof i.a))throw new r.b(t,r.d.InvalidParameter,n);b.push(l[2])}for(const e of b){if(!(e instanceof i.a))throw new r.b(t,r.d.InvalidParameter,n);{const a=e.hasField("name")?e.field("name"):"",i=e.hasField("statistic")?e.field("statistic"):"",s=e.hasField("expression")?e.field("expression"):"";if(!a||!i||!s)throw new r.b(t,r.d.InvalidParameter,n);f.push({name:a,statistic:i.toLowerCase(),expression:F.WhereClause.create(s,o.getFieldsIndex())})}}if(d){const e={};for(const n of o.fields)e[n.name.toLowerCase()]=1;for(const n of c)"%%%%FIELDNAME"!==n.name&&(e[n.name.toLowerCase()]=1);for(const n of f)"%%%%FIELDNAME"!==n.name&&(e[n.name.toLowerCase()]=1);let t=0;for(const n of c)if("%%%%FIELDNAME"===n.name){for(;1===e["field_"+t.toString()];)t++;e["field_"+t.toString()]=1,n.name="FIELD_"+t.toString()}}for(const n of c)await E(n.expression,e,t);for(const n of f)await E(n.expression,e,t);return l[0].groupby(c,f)}))},e.signatures.push({name:"groupby",min:3,max:3}),e.functions.distinct=function(t,n){return e.standardFunctionAsync(t,n,(async(a,s,l)=>{if(Object(u.t)(l[0])){Object(u.Z)(l,2,2,t,n);const a=await l[0].load(),s=[];let o=[];if(Object(u.D)(l[1]))o.push(l[1]);else if(l[1]instanceof i.a)o.push(l[1]);else if(Object(u.N)(l[1]))o=l[1];else{if(!Object(u.Y)(l[1]))throw new r.b(t,r.d.InvalidParameter,n);o=l[1].toArray()}let c=!1;for(const e of o)if(Object(u.D)(e)){const t=F.WhereClause.create(Object(u.K)(e),a.getFieldsIndex()),n=!0===Object(g.c)(t)?Object(u.K)(e):"%%%%FIELDNAME";s.push({name:n,expression:t}),"%%%%FIELDNAME"===n&&(c=!0)}else{if(!(e instanceof i.a))throw new r.b(t,r.d.InvalidParameter,n);{const i=e.hasField("name")?e.field("name"):"%%%%FIELDNAME",l=e.hasField("expression")?e.field("expression"):"";if("%%%%FIELDNAME"===i&&(c=!0),!i)throw new r.b(t,r.d.InvalidParameter,n);s.push({name:i,expression:F.WhereClause.create(l||i,a.getFieldsIndex())})}}if(c){const e={};for(const n of a.fields)e[n.name.toLowerCase()]=1;for(const n of s)"%%%%FIELDNAME"!==n.name&&(e[n.name.toLowerCase()]=1);let t=0;for(const n of s)if("%%%%FIELDNAME"===n.name){for(;1===e["field_"+t.toString()];)t++;e["field_"+t.toString()]=1,n.name="FIELD_"+t.toString()}}for(const n of s)await E(n.expression,e,t);return l[0].groupby(s,[])}return function(e,t,n,a){if(1===a.length){if(Object(u.N)(a[0]))return Object(j.a)(e,a[0],-1);if(Object(u.Y)(a[0]))return Object(j.a)(e,a[0].toArray(),-1)}return Object(j.a)(e,a,-1)}("distinct",0,0,l)}))})}}}]);
//# sourceMappingURL=129.9935af53.chunk.js.map