{"version":3,"sources":["../node_modules/@arcgis/core/layers/MapImageLayer.js"],"names":["q","I","T","M","P","v","S","O","E","p","L","j","w","i","x","constructor","e","super","this","datesInUnknownTimezone","dpi","gdbVersion","imageFormat","imageMaxHeight","imageMaxWidth","imageTransparency","isReference","labelsVisible","operationalLayerType","sourceJSON","sublayers","type","url","normalizeCtorArgs","r","load","a","signal","addResolvingPromise","loadFromPortal","supportedTypes","catch","n","then","_fetchService","Promise","resolve","readImageFormat","t","supportedImageFormatTypes","includes","writeSublayers","o","loaded","slice","reverse","flatten","toArray","s","capabilities","operations","supportsExportMap","exportMap","supportsDynamicLayers","d","origin","f","PORTAL_ITEM","createSublayersForOrigin","A","SERVICE","writeSublayerStructure","forEach","write","push","originOf","some","Object","keys","length","layers","visibleLayers","filter","visible","map","id","createExportImageParameters","pixelRatio","version","clone","shiftCentralMeridian","R","layer","floors","scale","b","extent","width","toJSON","destroy","rotation","spatialReference","m","wkid","JSON","stringify","l","timeExtent","start","end","time","timeInfo","hasLiveData","bbox","xmin","ymin","xmax","ymax","bboxSR","imageSR","size","async","_fetchImage","createImageBitmap","query","returnUpdates","customParameters","token","apiKey","data","fullExtent","g","fromJSON","loadAll","allSublayers","serviceSupportsSpatialReference","J","responseType","parsedUrl","refreshParameters","path","dynamicLayers","error","read","ssl","replace","Boolean","prototype","y","json","origins","service","source","enabled","overridePolicy","ignoreOrigin","h","N","c","readOnly","value","U","u","F"],"mappings":"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","file":"static/js/185.2d8e53cd.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import r from\"../request.js\";import t from\"../TimeExtent.js\";import o from\"../core/Error.js\";import{HandleOwnerMixin as i}from\"../core/HandleOwner.js\";import{loadAll as s}from\"../core/loadAll.js\";import{isSome as a}from\"../core/maybe.js\";import{MultiOriginJSONMixin as p}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as n,isAbortError as m}from\"../core/promiseUtils.js\";import{property as l}from\"../core/accessorSupport/decorators/property.js\";import\"../core/arrayUtils.js\";import{Integer as c}from\"../core/accessorSupport/ensureType.js\";import{reader as y}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as u}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as h}from\"../core/accessorSupport/decorators/writer.js\";import{nameToId as d,OriginId as f}from\"../core/accessorSupport/PropertyOrigin.js\";import g from\"../geometry/Extent.js\";import{getScale as b}from\"../geometry/support/scaleUtils.js\";import x from\"./Layer.js\";import{APIKeyMixin as j}from\"./mixins/APIKeyMixin.js\";import{ArcGISMapService as v}from\"./mixins/ArcGISMapService.js\";import{ArcGISService as S}from\"./mixins/ArcGISService.js\";import{BlendLayer as I}from\"./mixins/BlendLayer.js\";import{CustomParametersMixin as w}from\"./mixins/CustomParametersMixin.js\";import{OperationalLayer as O}from\"./mixins/OperationalLayer.js\";import{PortalLayer as E}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as L}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as M}from\"./mixins/ScaleRangeLayer.js\";import{SublayersOwner as P}from\"./mixins/SublayersOwner.js\";import{TemporalLayer as T}from\"./mixins/TemporalLayer.js\";import{url as U}from\"./support/commonProperties.js\";import{ExportImageParameters as R}from\"./support/ExportImageParameters.js\";import N from\"./support/Sublayer.js\";import{shouldWriteSublayerStructure as A}from\"./support/sublayerUtils.js\";import{serviceSupportsSpatialReference as J}from\"./support/versionUtils.js\";let q=class extends(I(T(M(P(v(S(O(E(p(L(j(w(i(x)))))))))))))){constructor(...e){super(...e),this.datesInUnknownTimezone=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat=\"png24\",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.isReference=null,this.labelsVisible=!1,this.operationalLayerType=\"ArcGISMapServiceLayer\",this.sourceJSON=null,this.sublayers=null,this.type=\"map-image\",this.url=null}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}load(e){const r=a(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Map Service\"]},e).catch(n).then((()=>this._fetchService(r)))),Promise.resolve(this)}readImageFormat(e,r){const t=r.supportedImageFormatTypes;return t&&t.includes(\"PNG32\")?\"png32\":\"png24\"}writeSublayers(e,r,t,o){if(!this.loaded||!e)return;const i=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray();let s=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){const e=d(o.origin);if(e===f.PORTAL_ITEM){const e=this.createSublayersForOrigin(\"service\").sublayers;s=A(i,e,f.SERVICE)}else if(e>f.PORTAL_ITEM){const e=this.createSublayersForOrigin(\"portal-item\");s=A(i,e.sublayers,d(e.origin))}}const a=[],p={writeSublayerStructure:s,...o};let n=s;i.forEach((e=>{const r=e.write({},p);a.push(r),n=n||\"user\"===e.originOf(\"visible\")}));a.some((e=>Object.keys(e).length>1))&&(r.layers=a),n&&(r.visibleLayers=i.filter((e=>e.visible)).map((e=>e.id)))}createExportImageParameters(e,r,t,o){const i=o&&o.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());const s=new R({layer:this,floors:o?.floors,scale:b({extent:e,width:r})*i}),a=s.toJSON();s.destroy();const p=!o||!o.rotation||this.version<10.3?{}:{rotation:-o.rotation},n=e&&e.spatialReference,m=n.wkid||JSON.stringify(n.toJSON());a.dpi*=i;const l={};if(o?.timeExtent){const{start:e,end:r}=o.timeExtent.toJSON();l.time=e&&r&&e===r?\"\"+e:`${e??\"null\"},${r??\"null\"}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(l.time=\"null,null\");return{bbox:e&&e.xmin+\",\"+e.ymin+\",\"+e.xmax+\",\"+e.ymax,bboxSR:m,imageSR:m,size:r+\",\"+t,...a,...p,...l}}async fetchImage(e,r,t,o){return this._fetchImage(\"image\",e,r,t,o)}async fetchImageBitmap(e,r,t,o){const i=await this._fetchImage(\"blob\",e,r,t,o);return createImageBitmap(i)}async fetchRecomputedExtents(e={}){const o={...e,query:{returnUpdates:!0,f:\"json\",...this.customParameters,token:this.apiKey}},{data:i}=await r(this.url,o),{extent:s,fullExtent:a,timeExtent:p}=i,n=s||a;return{fullExtent:n&&g.fromJSON(n),timeExtent:p&&t.fromJSON({start:p[0],end:p[1]})}}loadAll(){return s(this,(e=>{e(this.allSublayers)}))}serviceSupportsSpatialReference(e){return J(this,e)}async _fetchImage(e,t,i,s,a){const p={responseType:e,signal:a?.signal??null,query:{...this.parsedUrl.query,...this.createExportImageParameters(t,i,s,a),f:\"image\",...this.refreshParameters,...this.customParameters,token:this.apiKey}},n=this.parsedUrl.path+\"/export\";if(null!=p.query.dynamicLayers&&!this.capabilities.exportMap.supportsDynamicLayers)throw new o(\"mapimagelayer:dynamiclayer-not-supported\",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:p.query});try{const{data:e}=await r(n,p);return e}catch(l){if(m(l))throw l;throw new o(\"mapimagelayer:image-fetch-error\",`Unable to load image: ${n}`,{error:l})}}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:\"service\",url:this.parsedUrl});const{data:t,ssl:o}=await r(this.parsedUrl.path,{query:{f:\"json\",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},signal:e});o&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=t,this.read(t,{origin:\"service\",url:this.parsedUrl})}};e([l({type:Boolean})],q.prototype,\"datesInUnknownTimezone\",void 0),e([l()],q.prototype,\"dpi\",void 0),e([l()],q.prototype,\"gdbVersion\",void 0),e([l()],q.prototype,\"imageFormat\",void 0),e([y(\"imageFormat\",[\"supportedImageFormatTypes\"])],q.prototype,\"readImageFormat\",null),e([l({json:{origins:{service:{read:{source:\"maxImageHeight\"}}}}})],q.prototype,\"imageMaxHeight\",void 0),e([l({json:{origins:{service:{read:{source:\"maxImageWidth\"}}}}})],q.prototype,\"imageMaxWidth\",void 0),e([l()],q.prototype,\"imageTransparency\",void 0),e([l({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],q.prototype,\"isReference\",void 0),e([l({json:{read:!1,write:!1}})],q.prototype,\"labelsVisible\",void 0),e([l({type:[\"ArcGISMapServiceLayer\"]})],q.prototype,\"operationalLayerType\",void 0),e([l({json:{read:!1,write:!1}})],q.prototype,\"popupEnabled\",void 0),e([l()],q.prototype,\"sourceJSON\",void 0),e([l({json:{write:{ignoreOrigin:!0}}})],q.prototype,\"sublayers\",void 0),e([h(\"sublayers\",{layers:{type:[N]},visibleLayers:{type:[c]}})],q.prototype,\"writeSublayers\",null),e([l({type:[\"show\",\"hide\",\"hide-children\"]})],q.prototype,\"listMode\",void 0),e([l({json:{read:!1},readOnly:!0,value:\"map-image\"})],q.prototype,\"type\",void 0),e([l(U)],q.prototype,\"url\",void 0),q=e([u(\"esri.layers.MapImageLayer\")],q);const F=q;export{F as default};\n"],"sourceRoot":""}